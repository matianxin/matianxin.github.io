<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>JWT Token</title>
    <link href="/2022/04/14/other/jwt_token/"/>
    <url>/2022/04/14/other/jwt_token/</url>
    
    <content type="html"><![CDATA[<h3 id="JWT的认证流程图"><a href="#JWT的认证流程图" class="headerlink" title="JWT的认证流程图"></a>JWT的认证流程图</h3><p><img src="/images/jwt_token.jpg" alt="JWT的认证流程图"></p><p>流程说明：</p><ul><li><ol><li>浏览器发起请求登录，携带用户名和密码。</li></ol></li><li><ol start="2"><li>服务端验证身份，根据算法，将用户标识符打包生成 token。</li></ol></li><li><ol start="3"><li>服务器返回JWT信息给浏览器，JWT不包含敏感信息。</li></ol></li><li><ol start="4"><li>浏览器发起请求获取用户资料，把刚刚拿到的 token一起发送给服务器。</li></ol></li><li><ol start="5"><li>服务器发现数据中有 token，验证。</li></ol></li><li><ol start="6"><li>服务器返回该用户的用户资料。</li></ol></li></ul><h3 id="JWT组成及构建方式"><a href="#JWT组成及构建方式" class="headerlink" title="JWT组成及构建方式"></a>JWT组成及构建方式</h3><p><img src="/images/jwt_include.jpg" alt="JWT组成及构建方式"></p><h3 id="JWT-Options"><a href="#JWT-Options" class="headerlink" title="JWT Options"></a>JWT Options</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># headers headers = &#123;     &#x27;alg&#x27;: &quot;HS256&quot;,  # 声明所使用的算法</span><br>&#125;<br><span class="hljs-string">&quot;&quot;&quot;headers 中一些固定参数名称的意义&quot;&quot;&quot;</span><br><span class="hljs-comment"># jku: 发送JWK的地址；最好用HTTPS来传输</span><br><span class="hljs-comment"># jwk: 就是之前说的JWK</span><br><span class="hljs-comment"># kid: jwk的ID编号</span><br><span class="hljs-comment"># x5u: 指向一组X509公共证书的URL</span><br><span class="hljs-comment"># x5c: X509证书链</span><br><span class="hljs-comment"># x5t：X509证书的SHA-1指纹</span><br><span class="hljs-comment"># x5t#S256: X509证书的SHA-256指纹</span><br><span class="hljs-comment"># typ: 在原本未加密的JWT的基础上增加了 JOSE 和 JOSE+ JSON。JOSE序列化后文会说及。适用于JOSE标头的对象与此JWT混合的情况。</span><br><span class="hljs-comment"># crit: 字符串数组，包含声明的名称，用作实现定义的扩展，必须由 this-&gt;JWT的解析器处理。不常见。</span><br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># payload token_dict = &#123;     &#x27;iat&#x27;: time.time(),  # 时间戳</span><br>　　 <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;xyz&#x27;</span>  <span class="hljs-comment"># 自定义的参数</span><br>&#125;<br><span class="hljs-string">&quot;&quot;&quot;payload 中一些固定参数名称的意义, 同时可以在payload中自定义参数&quot;&quot;&quot;</span><br><span class="hljs-comment"># iss  【issuer】发布者的url地址</span><br><span class="hljs-comment"># sub 【subject】该JWT所面向的用户，用于处理特定应用，不是常用的字段</span><br><span class="hljs-comment"># aud 【audience】接受者的url地址</span><br><span class="hljs-comment"># exp 【expiration】 该jwt销毁的时间；unix时间戳</span><br><span class="hljs-comment"># nbf  【not before】 该jwt的使用时间不能早于该时间；unix时间戳</span><br><span class="hljs-comment"># iat   【issued at】 该jwt的发布时间；unix 时间戳</span><br><span class="hljs-comment"># jti    【JWT ID】 该jwt的唯一ID编号</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>其它</category>
      
    </categories>
    
    
    <tags>
      
      <tag>其它</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Openstack与Docker的融合</title>
    <link href="/2021/12/27/docker/openstack_docker/"/>
    <url>/2021/12/27/docker/openstack_docker/</url>
    
    <content type="html"><![CDATA[<h2 id="OpenStack-Docker-综述"><a href="#OpenStack-Docker-综述" class="headerlink" title="OpenStack &amp; Docker 综述"></a>OpenStack &amp; Docker 综述</h2><p>时至今日，云计算已经从概念、评估而逐步进入了 Gartner 定义的复苏期 （Slope of Enlightenment） ，逐步在企业中落地推广。而云计算中热门的两个技术 OpenStack 与 Docker也早已是企业中不可或缺的技术话题，看看国内围绕两大技术的创业公司、技术Meetup、技术大会以及各联盟组织就可见一斑。Google Trends 的趋势曲线也印证了两大技术的火热情况：<br><img src="/images/openstack/ops_docker_1.jpeg" alt="Past 5 Years the trends of Openstack &amp; Docker"></p><p>先简单回顾一下两大技术的历史和现状：<br>OpenStack 起源于2010年7月的 Austin 版本，作为典型的云计算 IaaS 层的具体实现工具，在与当年的 OpenNebula、CloudStack 的血拼中脱颖而出。通过命名为 Nova、Neutron、Keystone、Glance 等各组件实现对裸机、虚机、块存储、对象存储、文件目录、网络、负载均衡、防火墙等数据中心基础架构的统一调度管理，目前已经发布到 W 版本，形成了较强的开源生态圈和产业链，同时也成为了国内企业开源私有云构建的事实首选。</p><p>Docker 起源于2013年3月的首版，是基于LXC为基础构建的容器引擎，通过 Namespace 和 Cgroup 实现了资源隔离和调配，使用分层存储来构建镜像，这些特性实现了将 OS 和应用捆绑的方法，直接造成了整个玩法的变革，使得应用系统环境标准化、集装箱化传递成为现实。如果说 OpenStack 只能让数据中心的架构师、系统网络工程师兴奋的话，那么 Docker 则是可以让开发、测试、应用运维、系统网络工程师都兴奋的东西（从曲线的热度即可印证），同时随着DevOps、CI&#x2F;CD、微服务的火热，Docker 正好是实现上述名词的极佳载体。由于 Docker 本身是缺乏集群调度、管理、监控、服务注册发现等集群化运行管理能力的，因此目前也存在三种主流的 COEs（Container Orchestration Engines） 容器调度引擎：原生的 Docker Swarm、Google 的 Kubernetes（Borg 简化版）以及 Apache Mesos，这三种主流的 COEs 目前还在都还在发展中，下图为 Google Trends：<br><img src="/images/openstack/ops_docker_2.jpeg" alt="Past 1 Year and trends of Kubernetes &amp; mesos &amp; docker swarm"></p><h2 id="OpenStack-Docker-的融合开源技术方案"><a href="#OpenStack-Docker-的融合开源技术方案" class="headerlink" title="OpenStack &amp; Docker 的融合开源技术方案"></a>OpenStack &amp; Docker 的融合开源技术方案</h2><h3 id="Nova-Docker"><a href="#Nova-Docker" class="headerlink" title="Nova Docker"></a>Nova Docker</h3><p><img src="/images/openstack/nova_docker.png" alt="Nova Docker"><br>该方案将容器像 VM 一样操作，通过增加 Nova Docker driver，实现对 Docker容器的启停、创建等常规 VM 的操作，可以通过 Docker save 方式将镜像存放在 Glance 之中，该种方案很大的好处在于可以使用现成的 OpenStack Neutron 来管理网络、实现租户的资源配额、使用 Host OS（注：此处不等于 BareMetal ）等 OpenStack 的天然好处。然而缺点也明显，没法使用 Docker&#x2F;COEs 带来的更有价值功能，例如服务发现、端口映射等。国内某大型电商就使用的该方案。该方案是早期的集成方案。目前已经不在官方版本中。</p><p>参考 <a href="https://wiki.openstack.org/wiki/Docker">https://wiki.openstack.org/wiki/Docker</a></p><h3 id="Zun"><a href="#Zun" class="headerlink" title="Zun"></a>Zun</h3><p><img src="/images/openstack/zun_1.png" alt="Zun"><br><img src="/images/openstack/zun_2.png" alt="Zun组件关联"></p><p><strong>OpenStack是一个主流的开源云管理平台，旨在提供丰富的云平台服务，支持轻松实施、大规模向上&#x2F;下扩展和统一标准。数百家全球知名企业正在以OpenStack为基础运营业务，以降低成本并加快行动。</strong></p><p>Zun是Openstack的一个组件，提供容器管理服务，出现于2016年6月。</p><p>Zun的目标是提供统一的Openstack API用于启动和管理容器，支持多种容器技术。Zun原来称为Higgins，后改名为Zun。Zun计划支持多种容器技术，Docker，Rkt，clear container等，目前只支持Docker。OpenStack Queens版本发布，由于容器社区的火热，一项值得关注的补充则为“Zun”，它在OpenStack项目中负责提供容器服务，旨在通过与Neutron、Cinder、Keystone以及其它核心OpenStack服务相集成以实现容器的快速普及。通过这种方式，OpenStack的原有网络、存储以及身份验证工具将全部适用于容器体系，从而确保容器能够满足安全与合规性要求。</p><p>参考 <a href="https://wiki.openstack.org/wiki/Zun">https://wiki.openstack.org/wiki/Zun</a></p><h3 id="Magnum"><a href="#Magnum" class="headerlink" title="Magnum"></a>Magnum</h3><p><img src="/images/openstack/magnum_1.png" alt="Magnum1"><br><img src="/images/openstack/magnum_2.png" alt="Magnum2"><br>Magnum是OpenStack中一个提供容器集群部署的服务。<br>Magnum是一个Pass层的OpenStack项目。Magnum使用Heat部署一个包含Docker和Kubernetes的操作系统镜像，让容器集群运行在虚拟机（Virtual Machine）或者裸机（Bare Metal）中。</p><p>Magnum项目创建之初，项目目标以Caas为宗旨，即容器即服务。但在后续的发展过程中，社区更倾向于分离容器的集群部署功能和Docker容器集群的管理功能。因此Magnum重新修改了项目目标，Magnum本身专注于容器的集群部署功能。另一个项目Zun专注管理Docker容器集群。</p><p>参考 <a href="https://wiki.openstack.org/wiki/Magnum">https://wiki.openstack.org/wiki/Magnum</a></p><h3 id="Heat-Docker-plugin"><a href="#Heat-Docker-plugin" class="headerlink" title="Heat Docker plugin"></a>Heat Docker plugin</h3><p><img src="/images/openstack/heat_docker.png" alt="Heat Docker Plugin"><br>该方案不依赖于 Nova 的调用，而是通过 OpenStack 编排组件 Heat 进行编排调用，通过使用 Heat Docker plugin 在创建的 VM 上使用 Heat Templates 设定 Docker 的参数，这样则可以使用 Docker API 提供的所有功能，缺点在于 VM 上使用 Docker，无法实现资源调度，需要较多的配置工作，无法实现规模集群管理 。</p><p>参考 <a href="https://github.com/MarouenMechtri/Docker-containers-deployment-with-OpenStack-Heat">https://github.com/MarouenMechtri/Docker-containers-deployment-with-OpenStack-Heat</a></p><h3 id="Kuryr"><a href="#Kuryr" class="headerlink" title="Kuryr"></a>Kuryr</h3><p><img src="/images/openstack/kuryr.png" alt="Kuryr"><br>刚才提到了由于 COEs 网络方案的多样性与变数，因此社区专门孵化了 Kuryr 项目，该项目用于实现 Neutron 与 Docker&#x2F;COEs 网络的驱动映射工作，未来可成为 Magnum 网络的选择，实现容器网络的功能性能加强。</p><p>参考 <a href="https://wiki.openstack.org/wiki/Kuryr">https://wiki.openstack.org/wiki/Kuryr</a></p><h3 id="Kolla"><a href="#Kolla" class="headerlink" title="Kolla"></a>Kolla</h3><p><img src="/images/openstack/kolla.png" alt="Kolla"><br>前面谈到的方案均是 OpenStack 怎么与 COEs&#x2F;Docker 结合，提供不同形式的混合负载给上层使用的需求，而 Kolla 则是用于实现 OpenStack 这个“庞大复杂“的管理工具自身的部署&#x2F;升级&#x2F;维护的。虽然 OpenStack 也有许多的自动化运维项目，如 Fuel、Ansible、Puppet 等项目，然而随着 OpenStack 的日益发展和被管理的节点及环境日志扩张，在庞大的生产系统长期维护和运行一套&#x2F;多套 OpenDtack（Day 2 Operations） 也会日渐成为严重的问题。而随着容器化的发展，OpenStack 社区也想到自身使用容器进行部署将不仅解决上述问题，也证明自己充分拥抱容器的决心。</p><p>目前 Kolla 通过容器化绝大部分的 OpenStack 组件，并通过 Ansible 来实现配置自动化管理。实现 OpenStack 自身的容器化管理。未来也会逐步成为国内企业 OpenStack 的管理方案首选。</p><p>参考 <a href="http://docs.openstack.org/developer/kolla/">http://docs.openstack.org/developer/kolla/</a></p>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
      <category>Docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vmware vmdk合并转换</title>
    <link href="/2021/11/30/vmware/vmware_vmdk/"/>
    <url>/2021/11/30/vmware/vmware_vmdk/</url>
    
    <content type="html"><![CDATA[<p><strong>1.将多个vmdk文件合并成一个vmdk</strong><br>KafkaManager-s001.vmdk<br>KafkaManager-s002.vmdk<br>KafkaManager-s003.vmdk<br>KafkaManager-s004.vmdk<br>KafkaManager-s005.vmdk</p><p>进入vmware虚拟机所在目录：执行</p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs moonscript">&gt; <span class="hljs-name">C</span>:\Users\HP\Application\VMware\VMware Workstation\vmware-vdiskmanager.exe -r KafkaManager.vmdk -t <span class="hljs-number">0</span> CMAK.cmdk<br></code></pre></td></tr></table></figure><p><strong>2.将vmdk转化为qcow2</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs swift"># qemu<span class="hljs-operator">-</span>img convert <span class="hljs-operator">-</span>c <span class="hljs-operator">-</span>f vmdk <span class="hljs-operator">-</span><span class="hljs-type">O</span> qcow2 <span class="hljs-type">CMAK</span>.vmdk <span class="hljs-type">CMAK</span>.qcow2<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Vmware</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Vmware</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ubuntu18.04安装</title>
    <link href="/2021/08/13/linux/ubuntu1804/"/>
    <url>/2021/08/13/linux/ubuntu1804/</url>
    
    <content type="html"><![CDATA[<h3 id="版本介绍"><a href="#版本介绍" class="headerlink" title="版本介绍"></a>版本介绍</h3><p>ISO镜像<br>版本信息：ubuntu-18.04.5-live-server-amd64.iso</p><p>虚拟机资源配置<br>VCPU：1个 内存：1GB 磁盘：20GB</p><h3 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h3><p>安装<br>选择系统语言： English<br><img src="/images/ubuntu18/install-0.png" alt="语言选择-English"></p><p>配置系统更新： 不更新<br>选择 -&gt; Contiune without updating<br><img src="/images/ubuntu18/install-1.png" alt="配置系统更新"></p><p>键盘keyboard配置： 英文<br>选择 -&gt; English(US) -&gt; Done<br><img src="/images/ubuntu18/install-2.png" alt="keyboard配置"></p><p>网络连接配置： 默认DHCP<br>选择 -&gt; Done<br><img src="/images/ubuntu18/install-3.png" alt="网络连接配置"></p><p>配置代理： 不配置<br>Proxy address： ‘’ 选择 -&gt; Done<br><img src="/images/ubuntu18/install-4.png" alt="配置代理"></p><p>配置Ubuntu Mirror源地址：<br>默认：Ubuntu源 <a href="http://cn.archive.ubuntu.com/ubuntu/">http://cn.archive.ubuntu.com/ubuntu/</a><br>Mirror address -&gt; 修改为 清华大学源：<a href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu/">https://mirrors.tuna.tsinghua.edu.cn/ubuntu/</a><br><img src="/images/ubuntu18/install-5.png" alt="配置Ubuntu Mirror源"></p><p>配置磁盘存储：<br>选择： (×) Use an entire disk [×] Set up this disk as an LVM group 选择 -&gt; Done<br><img src="/images/ubuntu18/install-disk1.png" alt="配置磁盘存储1"><br><img src="/images/ubuntu18/install-disk2.png" alt="配置磁盘存储2"><br><img src="/images/ubuntu18/install-disk3.png" alt="配置磁盘存储3"></p><p>配置文件设置：<br>用户名：ubuntu 密码：ubuntu</p><p>SSH配置：<br>安装OpenSSH：[×]Install OpenSSH server</p><p>服务器特殊配置： 默认不选择，跳过</p><p>开始安装，安装结束重启系统<br><img src="/images/ubuntu18/reboot.png" alt="完成安装"></p><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>设置root密码</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">ubuntu@ubuntu:~$ sudo passwd<br>[sudo] <span class="hljs-keyword">password</span> <span class="hljs-keyword">for</span> ubuntu: ubuntu<br>Enter <span class="hljs-built_in">new</span> UNIX <span class="hljs-keyword">password</span>: <span class="hljs-keyword">PASSWORD</span><br>Retype <span class="hljs-built_in">new</span> UNIX <span class="hljs-keyword">password</span>: <span class="hljs-keyword">PASSWORD</span><br>passwd: <span class="hljs-keyword">password</span> updated successfully<br></code></pre></td></tr></table></figure><p>系统配置网卡名称为eth<br>GRUB配置文件路径: &#x2F;etc&#x2F;default&#x2F;grub</p><p>授权GRUB配置文件:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:~</span><span class="hljs-comment"># chmod u+x /etc/default/grub</span><br></code></pre></td></tr></table></figure><p>修改GRUB配置文件GRUB_CMDLINE_LINUX, vim &#x2F;etc&#x2F;default&#x2F;grub</p><p>修改 GRUB_CMDLINE_LINUX&#x3D;”” -&gt;<br>GRUB_CMDLINE_LINUX&#x3D;”net.ifnames&#x3D;0 biosdevname&#x3D;0”<br>执行以下命令</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">root</span>@ubuntu:~# grub-mkconfig -o /boot/grub/grub.cfg<br><span class="hljs-attribute">Sourcing</span> file /etc/default/grub<br><span class="hljs-attribute">Generating</span> grub configuration file ...<br><span class="hljs-attribute">Found</span> linux image: /boot/vmlinuz-<span class="hljs-number">4</span>.<span class="hljs-number">15</span>.<span class="hljs-number">0</span>-<span class="hljs-number">153</span>-generic<br><span class="hljs-attribute">Found</span> initrd image: /boot/initrd.img-<span class="hljs-number">4</span>.<span class="hljs-number">15</span>.<span class="hljs-number">0</span>-<span class="hljs-number">153</span>-generic<br><span class="hljs-attribute">done</span><br><span class="hljs-attribute">root</span>@ubuntu:~# reboot<br></code></pre></td></tr></table></figure><p>配置SSH服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /etc/ssh/sshd_config<br><br>修改 <span class="hljs-comment">#PermitRootLogin prohibit-password</span><br>-&gt;<br>PermitRootLogin <span class="hljs-built_in">yes</span><br></code></pre></td></tr></table></figure><p>重启sshd服务</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">systemctl restart sshd</span><br></code></pre></td></tr></table></figure><p>禁用Ubuntu18系统cloud-init相关服务<br>查看cloud-init相关服务</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs routeros">root@ubuntu:/# systemctl status cloud-init-local cloud-init cloud-config cloud-final<br>● cloud-init-local.service - Initial cloud-init job (pre-networking)<br>   Loaded: loaded (/lib/systemd/system/cloud-init-local.service; enabled; vendor preset: enabled)<br>   Active: active (exited) since Fri 2021-08-13 06:46:52 UTC; 9min ago<br>  Process: 787 <span class="hljs-attribute">ExecStart</span>=/bin/touch /run/cloud-init/network-config-ready (<span class="hljs-attribute">code</span>=exited, <span class="hljs-attribute">status</span>=0/SUCCESS)<br>  Process: 725 <span class="hljs-attribute">ExecStart</span>=/usr/bin/cloud-init init --local (<span class="hljs-attribute">code</span>=exited, <span class="hljs-attribute">status</span>=0/SUCCESS)<br> Main PID: 787 (<span class="hljs-attribute">code</span>=exited, <span class="hljs-attribute">status</span>=0/SUCCESS)<br><br>Aug 13 06:46:51 ubuntu systemd[1]: Starting Initial cloud-init job (pre-networking)<span class="hljs-built_in">..</span>.<br>Aug 13 06:46:52 ubuntu cloud-init[725]: Cloud-init v. 20.2-45-g5f7825e2-0ubuntu1~18.04.1 running <span class="hljs-string">&#x27;init-local&#x27;</span> at Fri, 13 Aug 2021 06:46<br>Aug 13 06:46:52 ubuntu systemd[1]: Started Initial cloud-init job (pre-networking).<br><br>● cloud-init.service - Initial cloud-init job (metadata<span class="hljs-built_in"> service </span>crawler)<br>   Loaded: loaded (/lib/systemd/system/cloud-init.service; enabled; vendor preset: enabled)<br>   Active: active (exited) since Fri 2021-08-13 06:46:52 UTC; 9min ago<br>  Process: 801 <span class="hljs-attribute">ExecStart</span>=/usr/bin/cloud-init init (<span class="hljs-attribute">code</span>=exited, <span class="hljs-attribute">status</span>=0/SUCCESS)<br> Main PID: 801 (<span class="hljs-attribute">code</span>=exited, <span class="hljs-attribute">status</span>=0/SUCCESS)<br><br>Aug 13 06:46:52 ubuntu cloud-init[801]: ci-info: +--------+-------+-----------+-----------+-------+-------------------+<br>Aug 13 06:46:52 ubuntu cloud-init[801]: ci-info: |  eth0  | <span class="hljs-literal">False</span> |     .     |     .     |   .   | 00:0c:29:f1:72:2b |<br>Aug 13 06:46:52 ubuntu cloud-init[801]: ci-info: |   lo   |  <span class="hljs-literal">True</span> | 127.0.0.1 | 255.0.0.0 |  host |         .         |<br>Aug 13 06:46:52 ubuntu cloud-init[801]: ci-info: |   lo   |  <span class="hljs-literal">True</span> |  ::1/128  |     .     |  host |         .         |<br>Aug 13 06:46:52 ubuntu cloud-init[801]: ci-info: +--------+-------+-----------+-----------+-------+-------------------+<br>Aug 13 06:46:52 ubuntu cloud-init[801]: ci-info: +++++++++++++++++++Route<span class="hljs-built_in"> IPv6 </span>info+++++++++++++++++++<br>Aug 13 06:46:52 ubuntu cloud-init[801]: ci-info: +-------+-------------+---------+-----------+-------+<br>Aug 13 06:46:52 ubuntu cloud-init[801]: ci-info: |<span class="hljs-built_in"> Route </span>| Destination | Gateway |<span class="hljs-built_in"> Interface </span>| Flags |<br>Aug 13 06:46:52 ubuntu cloud-init[801]: ci-info: +-------+-------------+---------+-----------+-------+<br>Aug 13 06:46:52 ubuntu systemd[1]: Started Initial cloud-init job (metadata<span class="hljs-built_in"> service </span>crawler).<br><br>● cloud-config.service - Apply the<span class="hljs-built_in"> settings </span>specified <span class="hljs-keyword">in</span> cloud-config<br>   Loaded: loaded (/lib/systemd/system/cloud-config.service; enabled; vendor preset: enabled)<br>   Active: active (exited) since Fri 2021-08-13 06:46:54 UTC; 9min ago<br>  Process: 968 <span class="hljs-attribute">ExecStart</span>=/usr/bin/cloud-init modules <span class="hljs-attribute">--mode</span>=config (<span class="hljs-attribute">code</span>=exited, <span class="hljs-attribute">status</span>=0/SUCCESS)<br> Main PID: 968 (<span class="hljs-attribute">code</span>=exited, <span class="hljs-attribute">status</span>=0/SUCCESS)<br><br>Aug 13 06:46:54 ubuntu systemd[1]: Starting Apply the<span class="hljs-built_in"> settings </span>specified <span class="hljs-keyword">in</span> cloud-config<span class="hljs-built_in">..</span>.<br>Aug 13 06:46:54 ubuntu cloud-init[968]: Cloud-init v. 20.2-45-g5f7825e2-0ubuntu1~18.04.1 running <span class="hljs-string">&#x27;modules:config&#x27;</span> at Fri, 13 Aug 2021 0<br>Aug 13 06:46:54 ubuntu systemd[1]: Started Apply the<span class="hljs-built_in"> settings </span>specified <span class="hljs-keyword">in</span> cloud-config.<br><br>● cloud-final.service - Execute cloud user/final scripts<br>   Loaded: loaded (/lib/systemd/system/cloud-final.service; enabled; vendor preset: enabled)<br>   Active: active (exited) since Fri 2021-08-13 06:46:55 UTC; 9min ago<br>  Process: 1008 <span class="hljs-attribute">ExecStart</span>=/usr/bin/cloud-init modules <span class="hljs-attribute">--mode</span>=final (<span class="hljs-attribute">code</span>=exited, <span class="hljs-attribute">status</span>=0/SUCCESS)<br> Main PID: 1008 (<span class="hljs-attribute">code</span>=exited, <span class="hljs-attribute">status</span>=0/SUCCESS)<br><br>Aug 13 06:46:54 ubuntu systemd[1]: Starting Execute cloud user/final scripts<span class="hljs-built_in">..</span>.<br>Aug 13 06:46:55 ubuntu cloud-init[1008]: Cloud-init v. 20.2-45-g5f7825e2-0ubuntu1~18.04.1 running <span class="hljs-string">&#x27;modules:final&#x27;</span> at Fri, 13 Aug 2021 0<br>Aug 13 06:46:55 ubuntu cloud-init[1008]: Cloud-init v. 20.2-45-g5f7825e2-0ubuntu1~18.04.1 finished at Fri, 13 Aug 2021 06:46:55 +0000.<br>Aug 13 06:46:55 ubuntu cloud-init[1008]: 2021-08-13 06:46:55,311 - cc_final_message.py[<span class="hljs-built_in">WARNING</span>]: Used fallback datasource<br>Aug 13 06:46:55 ubuntu systemd[1]: Started Execute cloud user/final scripts.<br></code></pre></td></tr></table></figure><p>停止并禁用cloud-init相关服务</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs swift">root<span class="hljs-meta">@ubuntu</span>:<span class="hljs-operator">/</span># systemctl stop cloud<span class="hljs-operator">-</span><span class="hljs-keyword">init</span><span class="hljs-operator">-</span>local cloud<span class="hljs-operator">-</span><span class="hljs-keyword">init</span> cloud<span class="hljs-operator">-</span>config cloud<span class="hljs-operator">-</span><span class="hljs-keyword">final</span><br>root<span class="hljs-meta">@ubuntu</span>:<span class="hljs-operator">/</span># systemctl disable cloud<span class="hljs-operator">-</span><span class="hljs-keyword">init</span><span class="hljs-operator">-</span>local cloud<span class="hljs-operator">-</span><span class="hljs-keyword">init</span> cloud<span class="hljs-operator">-</span>config cloud<span class="hljs-operator">-</span><span class="hljs-keyword">final</span><br><span class="hljs-type">Removed</span> <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/</span>cloud<span class="hljs-operator">-</span><span class="hljs-keyword">init</span>.target.wants<span class="hljs-operator">/</span>cloud<span class="hljs-operator">-</span><span class="hljs-keyword">final</span>.service.<br><span class="hljs-type">Removed</span> <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/</span>cloud<span class="hljs-operator">-</span><span class="hljs-keyword">init</span>.target.wants<span class="hljs-operator">/</span>cloud<span class="hljs-operator">-</span><span class="hljs-keyword">init</span><span class="hljs-operator">-</span>local.service.<br><span class="hljs-type">Removed</span> <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/</span>cloud<span class="hljs-operator">-</span><span class="hljs-keyword">init</span>.target.wants<span class="hljs-operator">/</span>cloud<span class="hljs-operator">-</span><span class="hljs-keyword">init</span>.service.<br><span class="hljs-type">Removed</span> <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/</span>cloud<span class="hljs-operator">-</span><span class="hljs-keyword">init</span>.target.wants<span class="hljs-operator">/</span>cloud<span class="hljs-operator">-</span>config.service.<br></code></pre></td></tr></table></figure><p>查看cloud-init.target服务</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs llvm">root<span class="hljs-title">@ubuntu</span>:/# systemctl status cloud-init.<span class="hljs-keyword">target</span><br>● cloud-init.<span class="hljs-keyword">target</span> - Cloud-init <span class="hljs-keyword">target</span><br>   Loaded: loaded (/lib/systemd/system/cloud-init.<span class="hljs-keyword">target</span><span class="hljs-comment">; enabled-runtime; vendor preset: enabled)</span><br>   Active: active since Fri <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-13</span> <span class="hljs-number">06</span>:<span class="hljs-number">46</span>:<span class="hljs-number">55</span> UTC<span class="hljs-comment">; 11min ago</span><br><br>Aug <span class="hljs-number">13</span> <span class="hljs-number">06</span>:<span class="hljs-number">46</span>:<span class="hljs-number">55</span> ubuntu systemd[<span class="hljs-number">1</span>]: Reached <span class="hljs-keyword">target</span> Cloud-init <span class="hljs-keyword">target</span>.<br></code></pre></td></tr></table></figure><p>停止并禁用cloud-init.target相关服务</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/</span><span class="hljs-comment"># systemctl stop cloud-init.target</span><br>root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/</span><span class="hljs-comment"># systemctl disable cloud-init.target</span><br></code></pre></td></tr></table></figure><p>安装ifupdown服务<br>安装包* ifupdown_0.8.17ubuntu1.1_amd64.deb</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">root@ubuntu:~<span class="hljs-comment"># dpkg -i ifupdown_0.8.17ubuntu1.1_amd64.deb</span><br>Selecting previously unselected package ifupdown.<br><span class="hljs-params">(Reading database ... 67145 files and directories currently installed.)</span><br>Preparing to unpack ifupdown_0.8.17ubuntu1.1_amd64.deb <span class="hljs-string">...</span><br>Unpacking ifupdown <span class="hljs-params">(0.8.17ubuntu1.1)</span> <span class="hljs-string">...</span><br>Setting up ifupdown <span class="hljs-params">(0.8.17ubuntu1.1)</span> <span class="hljs-string">...</span><br>Created symlink <span class="hljs-string">/etc/systemd/system/multi-user.target.wants/networking.service</span> → <span class="hljs-string">/lib/systemd/system/networking.service.</span><br>Created symlink <span class="hljs-string">/etc/systemd/system/network-online.target.wants/networking.service</span> → <span class="hljs-string">/lib/systemd/system/networking.service.</span><br>Processing triggers for systemd <span class="hljs-params">(237-3ubuntu10.50)</span> <span class="hljs-string">...</span><br>Processing triggers for ureadahead <span class="hljs-params">(0.100.0-21)</span> <span class="hljs-string">...</span><br>Processing triggers for man-db <span class="hljs-params">(2.8.3-2ubuntu0.1)</span> <span class="hljs-string">...</span><br></code></pre></td></tr></table></figure><p>启动并查看networking服务</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs routeros">root@ubuntu:~# systemctl start networking<br>root@ubuntu:~# systemctl status networking<br>● networking.service - Raise<span class="hljs-built_in"> network </span>interfaces<br>   Loaded: loaded (/lib/systemd/system/networking.service; enabled; vendor preset: enabled)<br>   Active: active (exited) since Fri 2021-08-13 07:26:52 UTC; 1s ago<br>     Docs: man:interfaces(5)<br>  Process: 1653 <span class="hljs-attribute">ExecStart</span>=/sbin/ifup -a --read-environment (<span class="hljs-attribute">code</span>=exited, <span class="hljs-attribute">status</span>=0/SUCCESS)<br>  Process: 1651 <span class="hljs-attribute">ExecStartPre</span>=/bin/sh -c [ <span class="hljs-string">&quot;<span class="hljs-variable">$CONFIGURE_INTERFACES</span>&quot;</span> != <span class="hljs-string">&quot;no&quot;</span> ] &amp;&amp; [ -n <span class="hljs-string">&quot;<span class="hljs-variable">$(ifquery --read-environment --list --exclude=lo)</span>&quot;</span><br> Main PID: 1653 (<span class="hljs-attribute">code</span>=exited, <span class="hljs-attribute">status</span>=0/SUCCESS)<br><br>Aug 13 07:26:52 ubuntu systemd[1]: Starting Raise<span class="hljs-built_in"> network </span>interfaces<span class="hljs-built_in">..</span>.<br>Aug 13 07:26:52 ubuntu systemd[1]: Started Raise<span class="hljs-built_in"> network </span>interfaces.<br></code></pre></td></tr></table></figure><p>禁用系统netplan及systemd-networkd服务</p><p>查看systemd-networkd相关服务状态</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs nsis">root@ubuntu:~<span class="hljs-comment"># systemctl status systemd-networkd networkd-dispatcher.service systemd-networkd-wait-online systemd-resolved</span><br>● <span class="hljs-params">system</span>d-networkd.service - Network Service<br>   Loaded: loaded (/lib/<span class="hljs-params">system</span>d/<span class="hljs-params">system</span>/<span class="hljs-params">system</span>d-networkd.service<span class="hljs-comment">; enabled; vendor preset: enab</span><br>   Active: active (running) since Fri <span class="hljs-number">2021</span>-<span class="hljs-number">08</span>-<span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">10</span>:<span class="hljs-number">02</span> UTC<span class="hljs-comment">; 18min ago</span><br>     Docs: man:<span class="hljs-params">system</span>d-networkd.service(<span class="hljs-number">8</span>)<br> Main PID: <span class="hljs-number">670</span> (<span class="hljs-params">system</span>d-network)<br>   Status: <span class="hljs-string">&quot;Processing requests...&quot;</span><br>    Tasks: <span class="hljs-number">1</span> (limit: <span class="hljs-number">1077</span>)<br>   CGroup: /<span class="hljs-params">system</span>.slice/<span class="hljs-params">system</span>d-networkd.service<br>           └─<span class="hljs-number">670</span> /lib/<span class="hljs-params">system</span>d/<span class="hljs-params">system</span>d-networkd<br><br>Aug <span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">10</span>:<span class="hljs-number">02</span> ubuntu <span class="hljs-params">system</span>d[<span class="hljs-number">1</span>]: Starting Network Service...<br>Aug <span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">10</span>:<span class="hljs-number">02</span> ubuntu <span class="hljs-params">system</span>d-networkd[<span class="hljs-number">670</span>]: Enumeration completed<br>Aug <span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">10</span>:<span class="hljs-number">02</span> ubuntu <span class="hljs-params">system</span>d[<span class="hljs-number">1</span>]: Started Network Service.<br>Aug <span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">11</span>:<span class="hljs-number">11</span> ubuntu <span class="hljs-params">system</span>d-networkd[<span class="hljs-number">670</span>]: eth0: Link UP<br>Aug <span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">11</span>:<span class="hljs-number">11</span> ubuntu <span class="hljs-params">system</span>d-networkd[<span class="hljs-number">670</span>]: eth0: Gained carrier<br>Aug <span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">11</span>:<span class="hljs-number">12</span> ubuntu <span class="hljs-params">system</span>d-networkd[<span class="hljs-number">670</span>]: eth0: Gained IPv6LL<br><br>● networkd-dispatcher.service - Dispatcher daemon for <span class="hljs-params">system</span>d-networkd<br>   Loaded: loaded (/lib/<span class="hljs-params">system</span>d/<span class="hljs-params">system</span>/networkd-dispatcher.service<span class="hljs-comment">; enabled; vendor preset: e</span><br>   Active: active (running) since Fri <span class="hljs-number">2021</span>-<span class="hljs-number">08</span>-<span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">10</span>:<span class="hljs-number">05</span> UTC<span class="hljs-comment">; 18min ago</span><br> Main PID: <span class="hljs-number">750</span> (networkd-dispat)<br>    Tasks: <span class="hljs-number">2</span> (limit: <span class="hljs-number">1077</span>)<br>   CGroup: /<span class="hljs-params">system</span>.slice/networkd-dispatcher.service<br>           └─<span class="hljs-number">750</span> /usr/bin/python3 /usr/bin/networkd-dispatcher --run-startup-triggers<br><br>Aug <span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">10</span>:<span class="hljs-number">03</span> ubuntu <span class="hljs-params">system</span>d[<span class="hljs-number">1</span>]: Starting Dispatcher daemon for <span class="hljs-params">system</span>d-networkd...<br>Aug <span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">10</span>:<span class="hljs-number">05</span> ubuntu networkd-dispatcher[<span class="hljs-number">750</span>]: No valid path found for iwconfig<br>Aug <span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">10</span>:<span class="hljs-number">05</span> ubuntu <span class="hljs-params">system</span>d[<span class="hljs-number">1</span>]: Started Dispatcher daemon for <span class="hljs-params">system</span>d-networkd.<br><br>● <span class="hljs-params">system</span>d-networkd-wait-online.service - Wait for Network to be Configured<br>   Loaded: loaded (/lib/<span class="hljs-params">system</span>d/<span class="hljs-params">system</span>/<span class="hljs-params">system</span>d-networkd-wait-online.service<span class="hljs-comment">; enabled; vendor</span><br>   Active: active (exited) since Fri <span class="hljs-number">2021</span>-<span class="hljs-number">08</span>-<span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">10</span>:<span class="hljs-number">02</span> UTC<span class="hljs-comment">; 18min ago</span><br>     Docs: man:<span class="hljs-params">system</span>d-networkd-wait-online.service(<span class="hljs-number">8</span>)<br> Main PID: <span class="hljs-number">691</span> (code=exited, status=<span class="hljs-number">0</span>/SUCCESS)<br>    Tasks: <span class="hljs-number">0</span> (limit: <span class="hljs-number">1077</span>)<br>   CGroup: /<span class="hljs-params">system</span>.slice/<span class="hljs-params">system</span>d-networkd-wait-online.service<br><br>Aug <span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">10</span>:<span class="hljs-number">02</span> ubuntu <span class="hljs-params">system</span>d[<span class="hljs-number">1</span>]: Starting Wait for Network to be Configured...<br>Aug <span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">10</span>:<span class="hljs-number">02</span> ubuntu <span class="hljs-params">system</span>d-networkd-wait-online[<span class="hljs-number">691</span>]: ignoring: lo<br>Aug <span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">10</span>:<span class="hljs-number">02</span> ubuntu <span class="hljs-params">system</span>d[<span class="hljs-number">1</span>]: Started Wait for Network to be Configured.<br><br>● <span class="hljs-params">system</span>d-resolved.service - Network <span class="hljs-keyword">Name</span> Resolution<br>   Loaded: loaded (/lib/<span class="hljs-params">system</span>d/<span class="hljs-params">system</span>/<span class="hljs-params">system</span>d-resolved.service<span class="hljs-comment">; enabled; vendor preset: enab</span><br>   Active: active (running) since Fri <span class="hljs-number">2021</span>-<span class="hljs-number">08</span>-<span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">11</span>:<span class="hljs-number">11</span> UTC<span class="hljs-comment">; 17min ago</span><br>     Docs: man:<span class="hljs-params">system</span>d-resolved.service(<span class="hljs-number">8</span>)<br>           https://www.freedesktop.org/wiki/Software/<span class="hljs-params">system</span>d/resolved<br>           https://www.freedesktop.org/wiki/Software/<span class="hljs-params">system</span>d/writing-network-configuration-ma<br>           https://www.freedesktop.org/wiki/Software/<span class="hljs-params">system</span>d/writing-resolver-clients<br> Main PID: <span class="hljs-number">1147</span> (<span class="hljs-params">system</span>d-resolve)<br>   Status: <span class="hljs-string">&quot;Processing requests...&quot;</span><br>    Tasks: <span class="hljs-number">1</span> (limit: <span class="hljs-number">1077</span>)<br>   CGroup: /<span class="hljs-params">system</span>.slice/<span class="hljs-params">system</span>d-resolved.service<br>           └─<span class="hljs-number">1147</span> /lib/<span class="hljs-params">system</span>d/<span class="hljs-params">system</span>d-resolved<br><br>Aug <span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">11</span>:<span class="hljs-number">11</span> ubuntu <span class="hljs-params">system</span>d[<span class="hljs-number">1</span>]: Starting Network <span class="hljs-keyword">Name</span> Resolution...<br>Aug <span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">11</span>:<span class="hljs-number">11</span> ubuntu <span class="hljs-params">system</span>d-resolved[<span class="hljs-number">1147</span>]: Positive Trust Anchors:<br>Aug <span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">11</span>:<span class="hljs-number">11</span> ubuntu <span class="hljs-params">system</span>d-resolved[<span class="hljs-number">1147</span>]: . IN DS <span class="hljs-number">19036</span> <span class="hljs-number">8</span> <span class="hljs-number">2</span> <span class="hljs-number">49</span>aac11d7b6f6446702e54a16073<br>Aug <span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">11</span>:<span class="hljs-number">11</span> ubuntu <span class="hljs-params">system</span>d-resolved[<span class="hljs-number">1147</span>]: . IN DS <span class="hljs-number">20326</span> <span class="hljs-number">8</span> <span class="hljs-number">2</span> e06d44b80b8f1d39a95c0b0d7c65<br>Aug <span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">11</span>:<span class="hljs-number">11</span> ubuntu <span class="hljs-params">system</span>d-resolved[<span class="hljs-number">1147</span>]: Negative trust anchors: <span class="hljs-number">10</span>.in-addr.arpa <span class="hljs-number">16.172</span><br>Aug <span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">11</span>:<span class="hljs-number">11</span> ubuntu <span class="hljs-params">system</span>d-resolved[<span class="hljs-number">1147</span>]: Using <span class="hljs-params">system</span> hostname <span class="hljs-string">&#x27;ubuntu&#x27;</span>.<br>Aug <span class="hljs-number">13</span> <span class="hljs-number">07</span>:<span class="hljs-number">11</span>:<span class="hljs-number">11</span> ubuntu <span class="hljs-params">system</span>d[<span class="hljs-number">1</span>]: Started Network <span class="hljs-keyword">Name</span> Resolution.<br></code></pre></td></tr></table></figure><p>停止并关闭systemd-networkd相关服务</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs nsis">root@ubuntu:~<span class="hljs-comment"># systemctl stop systemd-networkd networkd-dispatcher.service systemd-networkd-wait-online systemd-resolved</span><br>Warning: Stopping <span class="hljs-params">system</span>d-networkd.service, but it can still be activated by:<br>  <span class="hljs-params">system</span>d-networkd.socket<br>root@ubuntu:~<span class="hljs-comment"># systemctl disable systemd-networkd networkd-dispatcher.service systemd-networkd-wait-online systemd-resolved</span><br>Removed /etc/<span class="hljs-params">system</span>d/<span class="hljs-params">system</span>/network-online.target.wants/<span class="hljs-params">system</span>d-networkd-wait-online.service.<br>Removed /etc/<span class="hljs-params">system</span>d/<span class="hljs-params">system</span>/sockets.target.wants/<span class="hljs-params">system</span>d-networkd.socket.<br>Removed /etc/<span class="hljs-params">system</span>d/<span class="hljs-params">system</span>/multi-<span class="hljs-literal">user</span>.target.wants/<span class="hljs-params">system</span>d-resolved.service.<br>Removed /etc/<span class="hljs-params">system</span>d/<span class="hljs-params">system</span>/multi-<span class="hljs-literal">user</span>.target.wants/<span class="hljs-params">system</span>d-networkd.service.<br>Removed /etc/<span class="hljs-params">system</span>d/<span class="hljs-params">system</span>/multi-<span class="hljs-literal">user</span>.target.wants/networkd-dispatcher.service.<br>Removed /etc/<span class="hljs-params">system</span>d/<span class="hljs-params">system</span>/dbus-org.freedesktop.resolve1.service.<br></code></pre></td></tr></table></figure><p>安装vsftpd服务</p><p>安装包 * vsftpd_3.0.3-9build1_amd64.deb, ssl-cert_1.0.39_all.deb</p><figure class="highlight mercury"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mercury">root@ubuntu:~# dpkg -i vsftpd_3.<span class="hljs-number">0.3</span>-<span class="hljs-number">9</span>build1_amd64.deb ssl-cert_1.<span class="hljs-number">0.39</span>_all.deb<br>Selecting previously unselected package vsftpd.<br>(Reading database ... <span class="hljs-number">67182</span> files and directories currently installed.)<br>Preparing to unpack vsftpd_3.<span class="hljs-number">0.3</span>-<span class="hljs-number">9</span>build1_amd64.deb ...<br>Unpacking vsftpd (<span class="hljs-number">3.0</span>.<span class="hljs-number">3</span>-<span class="hljs-number">9</span>build1) ...<br>Selecting previously unselected package ssl-cert.<br>Preparing to unpack ssl-cert_1.<span class="hljs-number">0.39</span>_all.deb ...<br>Unpacking ssl-cert (<span class="hljs-number">1.0</span>.<span class="hljs-number">39</span>) ...<br>Setting up vsftpd (<span class="hljs-number">3.0</span>.<span class="hljs-number">3</span>-<span class="hljs-number">9</span>build1) ...<br>Created symlink /etc/systemd/system/<span class="hljs-keyword">multi</span>-user.target.wants/vsftpd.service → /lib/systemd/system/vsftpd.service.<br>Setting up ssl-cert (<span class="hljs-number">1.0</span>.<span class="hljs-number">39</span>) ...<br>Processing triggers for systemd (<span class="hljs-number">237</span>-<span class="hljs-number">3</span>ubuntu10.<span class="hljs-number">50</span>) ...<br>Processing triggers for ureadahead (<span class="hljs-number">0.100</span>.<span class="hljs-number">0</span>-<span class="hljs-number">21</span>) ...<br>Processing triggers for man-db (<span class="hljs-number">2.8</span>.<span class="hljs-number">3</span>-<span class="hljs-number">2</span>ubuntu0.<span class="hljs-number">1</span>) ...<br></code></pre></td></tr></table></figure><p>修改vsftpd服务配置: vim &#x2F;etc&#x2F;vsftpd.conf</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">31 </span> write_enable=YES<br><span class="hljs-symbol">122 </span>chroot_local_user=YES<br><span class="hljs-symbol">123 </span>chroot_list_enable=YES<br><span class="hljs-symbol">125 </span>chroot_list_file=/etc/vsftpd/chroot_list<br><span class="hljs-symbol">126 </span>allow_writeable_chroot=YES<br><span class="hljs-symbol">158 </span>pasv_enable=YES<br><span class="hljs-symbol">159 </span>pasv_min_port=<span class="hljs-number">64000</span><br><span class="hljs-symbol">160 </span>pasv_max_port=<span class="hljs-number">64321</span><br><span class="hljs-symbol">161 </span>port_enable=YES<br><span class="hljs-symbol">162 </span>pasv_address=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br><span class="hljs-symbol">163 </span>pasv_addr_resolve=NO<br></code></pre></td></tr></table></figure><p>创建chroot_list文件</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:~</span><span class="hljs-comment"># cd /etc</span><br>root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/etc</span><span class="hljs-comment"># mkdir vsftpd</span><br>root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/etc</span><span class="hljs-comment"># cd vsftpd/</span><br>root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/etc/vsftpd</span><span class="hljs-comment"># touch chroot_list</span><br></code></pre></td></tr></table></figure><p>重启并查看vsftpd服务</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dts">root@ubuntu:<span class="hljs-keyword">/etc/</span>vsftpd<span class="hljs-meta"># systemctl restart vsftpd</span><br>root@ubuntu:<span class="hljs-keyword">/etc/</span>vsftpd<span class="hljs-meta"># systemctl status vsftpd</span><br>● vsftpd.service - vsftpd FTP server<br><span class="hljs-symbol">   Loaded:</span> loaded (<span class="hljs-keyword">/lib/</span>systemd<span class="hljs-keyword">/system/</span>vsftpd.<span class="hljs-attr">service</span><span class="hljs-punctuation">;</span> <span class="hljs-attr">enabled</span><span class="hljs-punctuation">;</span> vendor preset: enabled)<br><span class="hljs-symbol">   Active:</span> active (running) since Fri <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-13</span> <span class="hljs-number">08</span>:<span class="hljs-number">11</span>:<span class="hljs-number">34</span> UTC<span class="hljs-punctuation">;</span> <span class="hljs-number">5</span>s ago<br><span class="hljs-symbol">  Process:</span> <span class="hljs-number">2224</span> ExecStartP<span class="hljs-attr">re</span><span class="hljs-operator">=</span><span class="hljs-keyword">/bin/</span>mkdir -p <span class="hljs-keyword">/var/</span>run<span class="hljs-keyword">/vsftpd/</span>empty (<span class="hljs-attr">code</span><span class="hljs-operator">=</span>exited, <span class="hljs-attr">status</span><span class="hljs-operator">=</span><span class="hljs-number">0</span>/SUCCESS)<br> Main PID: <span class="hljs-number">2225</span> (vsftpd)<br><span class="hljs-symbol">    Tasks:</span> <span class="hljs-number">1</span> (limit: <span class="hljs-number">1077</span>)<br><span class="hljs-symbol">   CGroup:</span> /system.slice/vsftpd.service<br>           └─<span class="hljs-number">2225</span> <span class="hljs-keyword">/usr/</span>sbin/vsftpd <span class="hljs-keyword">/etc/</span>vsftpd.conf<br><br>Aug <span class="hljs-number">13</span> <span class="hljs-number">08</span>:<span class="hljs-number">11</span>:<span class="hljs-number">34</span> ubuntu systemd[<span class="hljs-number">1</span>]: Starting vsftpd FTP server...<br>Aug <span class="hljs-number">13</span> <span class="hljs-number">08</span>:<span class="hljs-number">11</span>:<span class="hljs-number">34</span> ubuntu systemd[<span class="hljs-number">1</span>]: Started vsftpd FTP server.<br></code></pre></td></tr></table></figure><p>创建ftpuser用户</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/etc/vsftpd</span><span class="hljs-comment"># useradd ftpuser</span><br>root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/etc/vsftpd</span><span class="hljs-comment"># passwd ftpuser</span><br><span class="hljs-title class_">Enter</span> new <span class="hljs-title class_">UNIX</span> <span class="hljs-symbol">password:</span> ftpuser123<br><span class="hljs-title class_">Retype</span> new <span class="hljs-title class_">UNIX</span> <span class="hljs-symbol">password:</span> ftpuser123<br><span class="hljs-symbol">passwd:</span> password updated successfully<br></code></pre></td></tr></table></figure><p>创建ftpuser目录并授权</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/</span><span class="hljs-comment"># cd /home</span><br>root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/home</span><span class="hljs-comment"># mkdir ftpuser</span><br>root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/home</span><span class="hljs-comment"># chmod 777 ftpuser/</span><br>root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/home</span><span class="hljs-comment"># chown ftpuser:ftpuser ftpuser/</span><br></code></pre></td></tr></table></figure><p>安装python2.7并设置为系统默认python环境<br>Ubuntu18.04由于默认使用Python3.6, 这里安装Python2.7环境并设置为系统默认python环境<br>安装包:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">python2</span>.<span class="hljs-number">7</span>-minimal_2.<span class="hljs-number">7</span>.<span class="hljs-number">17</span>-<span class="hljs-number">118</span>.<span class="hljs-number">04</span>ubuntu1.<span class="hljs-number">6</span>_amd64.deb<br><span class="hljs-attribute">python2</span>.<span class="hljs-number">7</span>_2.<span class="hljs-number">7</span>.<span class="hljs-number">17</span>-<span class="hljs-number">118</span>.<span class="hljs-number">04</span>ubuntu1.<span class="hljs-number">6</span>_amd64.deb<br><span class="hljs-attribute">libpython2</span>.<span class="hljs-number">7</span>-minimal_2.<span class="hljs-number">7</span>.<span class="hljs-number">17</span>-<span class="hljs-number">118</span>.<span class="hljs-number">04</span>ubuntu1.<span class="hljs-number">6</span>_amd64.deb<br><span class="hljs-attribute">libpython2</span>.<span class="hljs-number">7</span>-stdlib_2.<span class="hljs-number">7</span>.<span class="hljs-number">17</span>-<span class="hljs-number">118</span>.<span class="hljs-number">04</span>ubuntu1.<span class="hljs-number">6</span>_amd64.deb<br></code></pre></td></tr></table></figure><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs vim">root@ubuntu:~/Python2.<span class="hljs-number">7</span># dpkg -i python2.<span class="hljs-number">7</span>_2.<span class="hljs-number">7.17</span>-<span class="hljs-number">1</span>~<span class="hljs-number">18.04</span>ubuntu1.<span class="hljs-number">6</span>_amd64.<span class="hljs-keyword">deb</span> python2.<span class="hljs-number">7</span>-minimal_2.<span class="hljs-number">7.17</span>-<span class="hljs-number">1</span>~<span class="hljs-number">18.04</span>ubuntu1.<span class="hljs-number">6</span>_amd64.<span class="hljs-keyword">deb</span> libpython2.<span class="hljs-number">7</span>-minimal_2.<span class="hljs-number">7.17</span>-<span class="hljs-number">1</span>~<span class="hljs-number">18.04</span>ubuntu1.<span class="hljs-number">6</span>_amd64.<span class="hljs-keyword">deb</span> libpython2.<span class="hljs-number">7</span>-stdlib_2.<span class="hljs-number">7.17</span>-<span class="hljs-number">1</span>~<span class="hljs-number">18.04</span>ubuntu1.<span class="hljs-number">6</span>_amd64.<span class="hljs-keyword">deb</span><br>Selecting previously unselected package python2.<span class="hljs-number">7</span>.<br>(Reading database ... <span class="hljs-number">67248</span> <span class="hljs-keyword">files</span> <span class="hljs-built_in">and</span> directories currently installed.)<br>Preparing <span class="hljs-keyword">to</span> unpack python2.<span class="hljs-number">7</span>_2.<span class="hljs-number">7.17</span>-<span class="hljs-number">1</span>~<span class="hljs-number">18.04</span>ubuntu1.<span class="hljs-number">6</span>_amd64.<span class="hljs-keyword">deb</span> ...<br>Unpacking python2.<span class="hljs-number">7</span> (<span class="hljs-number">2.7</span>.<span class="hljs-number">17</span>-<span class="hljs-number">1</span>~<span class="hljs-number">18.04</span>ubuntu1.<span class="hljs-number">6</span>) ...<br>Selecting previously unselected package python2.<span class="hljs-number">7</span>-minimal.<br>Preparing <span class="hljs-keyword">to</span> unpack python2.<span class="hljs-number">7</span>-minimal_2.<span class="hljs-number">7.17</span>-<span class="hljs-number">1</span>~<span class="hljs-number">18.04</span>ubuntu1.<span class="hljs-number">6</span>_amd64.<span class="hljs-keyword">deb</span> ...<br>Unpacking python2.<span class="hljs-number">7</span>-minimal (<span class="hljs-number">2.7</span>.<span class="hljs-number">17</span>-<span class="hljs-number">1</span>~<span class="hljs-number">18.04</span>ubuntu1.<span class="hljs-number">6</span>) ...<br>Selecting previously unselected package libpython2.<span class="hljs-number">7</span>-minima<span class="hljs-variable">l:amd64</span>.<br>Preparing <span class="hljs-keyword">to</span> unpack libpython2.<span class="hljs-number">7</span>-minimal_2.<span class="hljs-number">7.17</span>-<span class="hljs-number">1</span>~<span class="hljs-number">18.04</span>ubuntu1.<span class="hljs-number">6</span>_amd64.<span class="hljs-keyword">deb</span> ...<br>Unpacking libpython2.<span class="hljs-number">7</span>-minima<span class="hljs-variable">l:amd64</span> (<span class="hljs-number">2.7</span>.<span class="hljs-number">17</span>-<span class="hljs-number">1</span>~<span class="hljs-number">18.04</span>ubuntu1.<span class="hljs-number">6</span>) ...<br>Selecting previously unselected package libpython2.<span class="hljs-number">7</span>-stdli<span class="hljs-variable">b:amd64</span>.<br>Preparing <span class="hljs-keyword">to</span> unpack libpython2.<span class="hljs-number">7</span>-stdlib_2.<span class="hljs-number">7.17</span>-<span class="hljs-number">1</span>~<span class="hljs-number">18.04</span>ubuntu1.<span class="hljs-number">6</span>_amd64.<span class="hljs-keyword">deb</span> ...<br>Unpacking libpython2.<span class="hljs-number">7</span>-stdli<span class="hljs-variable">b:amd64</span> (<span class="hljs-number">2.7</span>.<span class="hljs-number">17</span>-<span class="hljs-number">1</span>~<span class="hljs-number">18.04</span>ubuntu1.<span class="hljs-number">6</span>) ...<br>Setting <span class="hljs-keyword">up</span> libpython2.<span class="hljs-number">7</span>-minima<span class="hljs-variable">l:amd64</span> (<span class="hljs-number">2.7</span>.<span class="hljs-number">17</span>-<span class="hljs-number">1</span>~<span class="hljs-number">18.04</span>ubuntu1.<span class="hljs-number">6</span>) ...<br>Setting <span class="hljs-keyword">up</span> libpython2.<span class="hljs-number">7</span>-stdli<span class="hljs-variable">b:amd64</span> (<span class="hljs-number">2.7</span>.<span class="hljs-number">17</span>-<span class="hljs-number">1</span>~<span class="hljs-number">18.04</span>ubuntu1.<span class="hljs-number">6</span>) ...<br>Setting <span class="hljs-keyword">up</span> python2.<span class="hljs-number">7</span>-minimal (<span class="hljs-number">2.7</span>.<span class="hljs-number">17</span>-<span class="hljs-number">1</span>~<span class="hljs-number">18.04</span>ubuntu1.<span class="hljs-number">6</span>) ...<br>Linking <span class="hljs-built_in">and</span> byte-compiling packages <span class="hljs-keyword">for</span> <span class="hljs-keyword">runtime</span> python2.<span class="hljs-number">7</span>...<br>Setting <span class="hljs-keyword">up</span> python2.<span class="hljs-number">7</span> (<span class="hljs-number">2.7</span>.<span class="hljs-number">17</span>-<span class="hljs-number">1</span>~<span class="hljs-number">18.04</span>ubuntu1.<span class="hljs-number">6</span>) ...<br>Processing triggers <span class="hljs-keyword">for</span> mime-support (<span class="hljs-number">3.60</span>ubuntu1) ...<br>Processing triggers <span class="hljs-keyword">for</span> man-db (<span class="hljs-number">2.8</span>.<span class="hljs-number">3</span>-<span class="hljs-number">2</span>ubuntu0.<span class="hljs-number">1</span>) ...<br></code></pre></td></tr></table></figure><p>设置为系统默认python环境</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs subunit">root@ubuntu:~# ln -sf /usr/bin/python2.7 /usr/bin/python<br>安装python-dev<br>安装包:<br>libc6_2.27<span class="hljs-string">-3</span>ubuntu1.4_amd64.deb<br>libc6-dev_2.27<span class="hljs-string">-3</span>ubuntu1.4_amd64.deb<br>libc-dev-bin_2.27<span class="hljs-string">-3</span>ubuntu1.4_amd64.deb<br>libexpat1-dev_2.2.5<span class="hljs-string">-3</span>ubuntu0.2_amd64.deb<br>libpython2.7_2.7.17<span class="hljs-string">-118</span>.04ubuntu1.6_amd64.deb<br>libpython2.7-dev_2.7.17<span class="hljs-string">-118</span>.04ubuntu1.6_amd64.deb<br>libpython-dev_2.7.15rc1<span class="hljs-string">-1</span>_amd64.deb<br>libpython-stdlib_2.7.15rc1<span class="hljs-string">-1</span>_amd64.deb<br>linux-libc-dev_4.15.0<span class="hljs-string">-154</span>.161_amd64.deb<br>manpages-dev_4.15<span class="hljs-string">-1</span>_all.deb<br>python_2.7.15rc1<span class="hljs-string">-1</span>_amd64.deb<br>python2.7-dev_2.7.17<span class="hljs-string">-118</span>.04ubuntu1.6_amd64.deb<br>python-dev_2.7.15rc1<span class="hljs-string">-1</span>_amd64.deb<br>python-minimal_2.7.15rc1<span class="hljs-string">-1</span>_amd64.deb<br></code></pre></td></tr></table></figure><p>第一次安装遇到问题, 反复安装一次即可解决</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs subunit">root@ubuntu:~/python-dev# dpkg -i *.deb<br>(Reading database ... 71747 files and directories currently installed.)<br>Preparing to unpack libc6_2.27<span class="hljs-string">-3</span>ubuntu1.4_amd64.deb ...<br>Unpacking libc6:amd64 (2.27<span class="hljs-string">-3</span>ubuntu1.4) over (2.27<span class="hljs-string">-3</span>ubuntu1.4) ...<br>Preparing to unpack libc6-dev_2.27<span class="hljs-string">-3</span>ubuntu1.4_amd64.deb ...<br>Unpacking libc6-dev:amd64 (2.27<span class="hljs-string">-3</span>ubuntu1.4) over (2.27<span class="hljs-string">-3</span>ubuntu1.4) ...<br>Preparing to unpack libc-dev-bin_2.27<span class="hljs-string">-3</span>ubuntu1.4_amd64.deb ...<br>Unpacking libc-dev-bin (2.27<span class="hljs-string">-3</span>ubuntu1.4) over (2.27<span class="hljs-string">-3</span>ubuntu1.4) ...<br>Preparing to unpack libexpat1-dev_2.2.5<span class="hljs-string">-3</span>ubuntu0.2_amd64.deb ...<br>Unpacking libexpat1-dev:amd64 (2.2.5<span class="hljs-string">-3</span>ubuntu0.2) over (2.2.5<span class="hljs-string">-3</span>ubuntu0.2) ...<br>Preparing to unpack libpython2.7_2.7.17<span class="hljs-string">-1</span>~18.04ubuntu1.6_amd64.deb ...<br>Unpacking libpython2.7:amd64 (2.7.17<span class="hljs-string">-1</span>~18.04ubuntu1.6) over (2.7.17<span class="hljs-string">-1</span>~18.04ubuntu1.6) ...<br>Preparing to unpack libpython2.7-dev_2.7.17<span class="hljs-string">-1</span>~18.04ubuntu1.6_amd64.deb ...<br>Unpacking libpython2.7-dev:amd64 (2.7.17<span class="hljs-string">-1</span>~18.04ubuntu1.6) over (2.7.17<span class="hljs-string">-1</span>~18.04ubuntu1.6) ...<br>Preparing to unpack libpython-dev_2.7.15~rc1<span class="hljs-string">-1</span>_amd64.deb ...<br>Unpacking libpython-dev:amd64 (2.7.15~rc1<span class="hljs-string">-1</span>) over (2.7.15~rc1<span class="hljs-string">-1</span>) ...<br>Preparing to unpack libpython-stdlib_2.7.15~rc1<span class="hljs-string">-1</span>_amd64.deb ...<br>Unpacking libpython-stdlib:amd64 (2.7.15~rc1<span class="hljs-string">-1</span>) over (2.7.15~rc1<span class="hljs-string">-1</span>) ...<br>Preparing to unpack linux-libc-dev_4.15.0<span class="hljs-string">-154</span>.161_amd64.deb ...<br>Unpacking linux-libc-dev:amd64 (4.15.0<span class="hljs-string">-154</span>.161) over (4.15.0<span class="hljs-string">-154</span>.161) ...<br>Preparing to unpack manpages-dev_4.15<span class="hljs-string">-1</span>_all.deb ...<br>Unpacking manpages-dev (4.15<span class="hljs-string">-1</span>) over (4.15<span class="hljs-string">-1</span>) ...<br>Preparing to unpack python_2.7.15~rc1<span class="hljs-string">-1</span>_amd64.deb ...<br>Unpacking python (2.7.15~rc1<span class="hljs-string">-1</span>) ...<br>Preparing to unpack python2.7-dev_2.7.17<span class="hljs-string">-1</span>~18.04ubuntu1.6_amd64.deb ...<br>Unpacking python2.7-dev (2.7.17<span class="hljs-string">-1</span>~18.04ubuntu1.6) over (2.7.17<span class="hljs-string">-1</span>~18.04ubuntu1.6) ...<br>Preparing to unpack python-dev_2.7.15~rc1<span class="hljs-string">-1</span>_amd64.deb ...<br>Unpacking python-dev (2.7.15~rc1<span class="hljs-string">-1</span>) over (2.7.15~rc1<span class="hljs-string">-1</span>) ...<br>Preparing to unpack python-minimal_2.7.15~rc1<span class="hljs-string">-1</span>_amd64.deb ...<br>Unpacking python-minimal (2.7.15~rc1<span class="hljs-string">-1</span>) over (2.7.15~rc1<span class="hljs-string">-1</span>) ...<br>Setting up libc6:amd64 (2.27<span class="hljs-string">-3</span>ubuntu1.4) ...<br>Setting up libc-dev-bin (2.27<span class="hljs-string">-3</span>ubuntu1.4) ...<br>Setting up libpython2.7:amd64 (2.7.17<span class="hljs-string">-1</span>~18.04ubuntu1.6) ...<br>Setting up libpython-stdlib:amd64 (2.7.15~rc1<span class="hljs-string">-1</span>) ...<br>Setting up linux-libc-dev:amd64 (4.15.0<span class="hljs-string">-154</span>.161) ...<br>Setting up manpages-dev (4.15<span class="hljs-string">-1</span>) ...<br>Setting up python-minimal (2.7.15~rc1<span class="hljs-string">-1</span>) ...<br>Setting up libc6-dev:amd64 (2.27<span class="hljs-string">-3</span>ubuntu1.4) ...<br>Setting up libexpat1-dev:amd64 (2.2.5<span class="hljs-string">-3</span>ubuntu0.2) ...<br>Setting up libpython2.7-dev:amd64 (2.7.17<span class="hljs-string">-1</span>~18.04ubuntu1.6) ...<br>Setting up libpython-dev:amd64 (2.7.15~rc1<span class="hljs-string">-1</span>) ...<br>Setting up python (2.7.15~rc1<span class="hljs-string">-1</span>) ...<br>Setting up python2.7-dev (2.7.17<span class="hljs-string">-1</span>~18.04ubuntu1.6) ...<br>Setting up python-dev (2.7.15~rc1<span class="hljs-string">-1</span>) ...<br>Processing triggers for libc-bin (2.27<span class="hljs-string">-3</span>ubuntu1.2) ...<br>Processing triggers for man-db (2.8.3<span class="hljs-string">-2</span>ubuntu0.1) ...<br></code></pre></td></tr></table></figure><p>安装gcc</p><p>psutil安装需要gcc支持, 否则会报错:</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><code class="hljs subunit">x86_64-linux-gnu-gcc -pthread -fno-strict-aliasing -Wdate-time -D_FORTIFY_SOURCE=2 -g -fdebug-prefix-map=/build/python2.7-gnDdqE/python2.7<span class="hljs-string">-2</span>.7.17=. -fstack-protector-strong -Wformat -Werror=format-security -fPIC -DPSUTIL_POSIX=1 -DPSUTIL_VERSION=522 -DPSUTIL_LINUX=1 -DPSUTIL_ETHTOOL_MISSING_TYPES=1 -I/usr/include/python2.7 -c psutil/_psutil_linux.c -o build/temp.linux-x86_64<span class="hljs-string">-2</span>.7/psutil/_psutil_linux.o<br>unable to execute &#x27;x86_64-linux-gnu-gcc&#x27;: No such file or directory<br><span class="hljs-keyword">error: </span>command &#x27;x86_64-linux-gnu-gcc&#x27; failed with exit status 1<br>gcc安装包:<br><br>-rw-r--r-- 1 root root    3388 Aug 13 08:34 binutils_2.30<span class="hljs-string">-21</span>ubuntu1~18.04.5_amd64.deb<br>-rw-r--r-- 1 root root  196672 Aug 13 08:34 binutils-common_2.30<span class="hljs-string">-21</span>ubuntu1~18.04.5_amd64.deb<br>-rw-r--r-- 1 root root 1838912 Aug 13 08:34 binutils-x86<span class="hljs-string">-64</span>-linux-gnu_2.30<span class="hljs-string">-21</span>ubuntu1~18.04.5_amd64.deb<br>-rw-r--r-- 1 root root   27656 Aug 13 08:34 cpp_4%3a7.4.0<span class="hljs-string">-1</span>ubuntu2.3_amd64.deb<br>-rw-r--r-- 1 root root 8591092 Aug 13 08:34 cpp<span class="hljs-string">-7</span>_7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04_amd64.deb<br>-rw-r--r-- 1 root root    5184 Aug 13 08:34 gcc_4%3a7.4.0<span class="hljs-string">-1</span>ubuntu2.3_amd64.deb<br>-rw-r--r-- 1 root root 9381188 Aug 13 08:34 gcc<span class="hljs-string">-7</span>_7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04_amd64.deb<br>-rw-r--r-- 1 root root   18268 Aug 13 08:34 gcc<span class="hljs-string">-7</span>-base_7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04_amd64.deb<br>-rw-r--r-- 1 root root  358376 Aug 13 08:34 libasan4_7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04_amd64.deb<br>-rw-r--r-- 1 root root    9192 Aug 13 08:34 libatomic1_8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04_amd64.deb<br>-rw-r--r-- 1 root root  488584 Aug 13 08:34 libbinutils_2.30<span class="hljs-string">-21</span>ubuntu1~18.04.5_amd64.deb<br>-rw-r--r-- 1 root root 2831804 Aug 13 08:34 libc6_2.27<span class="hljs-string">-3</span>ubuntu1.4_amd64.deb<br>-rw-r--r-- 1 root root 2584868 Aug 13 08:34 libc6-dev_2.27<span class="hljs-string">-3</span>ubuntu1.4_amd64.deb<br>-rw-r--r-- 1 root root   39384 Aug 13 08:34 libcc1<span class="hljs-string">-0</span>_8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04_amd64.deb<br>-rw-r--r-- 1 root root   71848 Aug 13 08:34 libc-dev-bin_2.27<span class="hljs-string">-3</span>ubuntu1.4_amd64.deb<br>-rw-r--r-- 1 root root   42464 Aug 13 08:34 libcilkrts5_7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04_amd64.deb<br>-rw-r--r-- 1 root root 2378308 Aug 13 08:34 libgcc<span class="hljs-string">-7</span>-dev_7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04_amd64.deb<br>-rw-r--r-- 1 root root   76452 Aug 13 08:34 libgomp1_8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04_amd64.deb<br>-rw-r--r-- 1 root root  551452 Aug 13 08:34 libisl19_0.19<span class="hljs-string">-1</span>_amd64.deb<br>-rw-r--r-- 1 root root   27904 Aug 13 08:34 libitm1_8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04_amd64.deb<br>-rw-r--r-- 1 root root  132688 Aug 13 08:34 liblsan0_8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04_amd64.deb<br>-rw-r--r-- 1 root root   40784 Aug 13 08:34 libmpc3_1.1.0<span class="hljs-string">-1</span>_amd64.deb<br>-rw-r--r-- 1 root root   11636 Aug 13 08:34 libmpx2_8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04_amd64.deb<br>-rw-r--r-- 1 root root  133600 Aug 13 08:34 libquadmath0_8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04_amd64.deb<br>-rw-r--r-- 1 root root  288108 Aug 13 08:34 libtsan0_8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04_amd64.deb<br>-rw-r--r-- 1 root root  126228 Aug 13 08:34 libubsan0_7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04_amd64.deb<br>-rw-r--r-- 1 root root  993704 Aug 13 08:34 linux-libc-dev_4.15.0<span class="hljs-string">-153</span>.160_amd64.deb<br>-rw-r--r-- 1 root root 2216684 Aug 13 08:34 manpages-dev_4.15<span class="hljs-string">-1</span>_all.deb<br>root@ubuntu:~/gcc# dpkg -i *.deb<br>Selecting previously unselected package binutils.<br>(Reading database ... 71802 files and directories currently installed.)<br>Preparing to unpack binutils_2.30<span class="hljs-string">-21</span>ubuntu1~18.04.5_amd64.deb ...<br>Unpacking binutils (2.30<span class="hljs-string">-21</span>ubuntu1~18.04.5) ...<br>Selecting previously unselected package binutils-common:amd64.<br>Preparing to unpack binutils-common_2.30<span class="hljs-string">-21</span>ubuntu1~18.04.5_amd64.deb ...<br>Unpacking binutils-common:amd64 (2.30<span class="hljs-string">-21</span>ubuntu1~18.04.5) ...<br>Selecting previously unselected package binutils-x86<span class="hljs-string">-64</span>-linux-gnu.<br>Preparing to unpack binutils-x86<span class="hljs-string">-64</span>-linux-gnu_2.30<span class="hljs-string">-21</span>ubuntu1~18.04.5_amd64.deb ...<br>Unpacking binutils-x86<span class="hljs-string">-64</span>-linux-gnu (2.30<span class="hljs-string">-21</span>ubuntu1~18.04.5) ...<br>Selecting previously unselected package cpp.<br>Preparing to unpack cpp_4%3a7.4.0<span class="hljs-string">-1</span>ubuntu2.3_amd64.deb ...<br>Unpacking cpp (4:7.4.0<span class="hljs-string">-1</span>ubuntu2.3) ...<br>Selecting previously unselected package cpp<span class="hljs-string">-7</span>.<br>Preparing to unpack cpp<span class="hljs-string">-7</span>_7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04_amd64.deb ...<br>Unpacking cpp<span class="hljs-string">-7</span> (7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04) ...<br>Selecting previously unselected package gcc.<br>Preparing to unpack gcc_4%3a7.4.0<span class="hljs-string">-1</span>ubuntu2.3_amd64.deb ...<br>Unpacking gcc (4:7.4.0<span class="hljs-string">-1</span>ubuntu2.3) ...<br>Selecting previously unselected package gcc<span class="hljs-string">-7</span>.<br>Preparing to unpack gcc<span class="hljs-string">-7</span>_7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04_amd64.deb ...<br>Unpacking gcc<span class="hljs-string">-7</span> (7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04) ...<br>Selecting previously unselected package gcc<span class="hljs-string">-7</span>-base:amd64.<br>Preparing to unpack gcc<span class="hljs-string">-7</span>-base_7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04_amd64.deb ...<br>Unpacking gcc<span class="hljs-string">-7</span>-base:amd64 (7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04) ...<br>Selecting previously unselected package libasan4:amd64.<br>Preparing to unpack libasan4_7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04_amd64.deb ...<br>Unpacking libasan4:amd64 (7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04) ...<br>Selecting previously unselected package libatomic1:amd64.<br>Preparing to unpack libatomic1_8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04_amd64.deb ...<br>Unpacking libatomic1:amd64 (8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04) ...<br>Selecting previously unselected package libbinutils:amd64.<br>Preparing to unpack libbinutils_2.30<span class="hljs-string">-21</span>ubuntu1~18.04.5_amd64.deb ...<br>Unpacking libbinutils:amd64 (2.30<span class="hljs-string">-21</span>ubuntu1~18.04.5) ...<br>Preparing to unpack libc6_2.27<span class="hljs-string">-3</span>ubuntu1.4_amd64.deb ...<br>Unpacking libc6:amd64 (2.27<span class="hljs-string">-3</span>ubuntu1.4) over (2.27<span class="hljs-string">-3</span>ubuntu1.4) ...<br>Preparing to unpack libc6-dev_2.27<span class="hljs-string">-3</span>ubuntu1.4_amd64.deb ...<br>Unpacking libc6-dev:amd64 (2.27<span class="hljs-string">-3</span>ubuntu1.4) over (2.27<span class="hljs-string">-3</span>ubuntu1.4) ...<br>Selecting previously unselected package libcc1<span class="hljs-string">-0</span>:amd64.<br>Preparing to unpack libcc1<span class="hljs-string">-0</span>_8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04_amd64.deb ...<br>Unpacking libcc1<span class="hljs-string">-0</span>:amd64 (8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04) ...<br>Preparing to unpack libc-dev-bin_2.27<span class="hljs-string">-3</span>ubuntu1.4_amd64.deb ...<br>Unpacking libc-dev-bin (2.27<span class="hljs-string">-3</span>ubuntu1.4) over (2.27<span class="hljs-string">-3</span>ubuntu1.4) ...<br>Selecting previously unselected package libcilkrts5:amd64.<br>Preparing to unpack libcilkrts5_7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04_amd64.deb ...<br>Unpacking libcilkrts5:amd64 (7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04) ...<br>Selecting previously unselected package libgcc<span class="hljs-string">-7</span>-dev:amd64.<br>Preparing to unpack libgcc<span class="hljs-string">-7</span>-dev_7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04_amd64.deb ...<br>Unpacking libgcc<span class="hljs-string">-7</span>-dev:amd64 (7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04) ...<br>Selecting previously unselected package libgomp1:amd64.<br>Preparing to unpack libgomp1_8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04_amd64.deb ...<br>Unpacking libgomp1:amd64 (8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04) ...<br>Selecting previously unselected package libisl19:amd64.<br>Preparing to unpack libisl19_0.19<span class="hljs-string">-1</span>_amd64.deb ...<br>Unpacking libisl19:amd64 (0.19<span class="hljs-string">-1</span>) ...<br>Selecting previously unselected package libitm1:amd64.<br>Preparing to unpack libitm1_8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04_amd64.deb ...<br>Unpacking libitm1:amd64 (8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04) ...<br>Selecting previously unselected package liblsan0:amd64.<br>Preparing to unpack liblsan0_8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04_amd64.deb ...<br>Unpacking liblsan0:amd64 (8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04) ...<br>Selecting previously unselected package libmpc3:amd64.<br>Preparing to unpack libmpc3_1.1.0<span class="hljs-string">-1</span>_amd64.deb ...<br>Unpacking libmpc3:amd64 (1.1.0<span class="hljs-string">-1</span>) ...<br>Selecting previously unselected package libmpx2:amd64.<br>Preparing to unpack libmpx2_8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04_amd64.deb ...<br>Unpacking libmpx2:amd64 (8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04) ...<br>Selecting previously unselected package libquadmath0:amd64.<br>Preparing to unpack libquadmath0_8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04_amd64.deb ...<br>Unpacking libquadmath0:amd64 (8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04) ...<br>Selecting previously unselected package libtsan0:amd64.<br>Preparing to unpack libtsan0_8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04_amd64.deb ...<br>Unpacking libtsan0:amd64 (8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04) ...<br>Selecting previously unselected package libubsan0:amd64.<br>Preparing to unpack libubsan0_7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04_amd64.deb ...<br>Unpacking libubsan0:amd64 (7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04) ...<br>dpkg: warning: downgrading linux-libc-dev:amd64 from 4.15.0<span class="hljs-string">-154</span>.161 to 4.15.0<span class="hljs-string">-153</span>.160<br>Preparing to unpack linux-libc-dev_4.15.0<span class="hljs-string">-153</span>.160_amd64.deb ...<br>Unpacking linux-libc-dev:amd64 (4.15.0<span class="hljs-string">-153</span>.160) over (4.15.0<span class="hljs-string">-154</span>.161) ...<br>Preparing to unpack manpages-dev_4.15<span class="hljs-string">-1</span>_all.deb ...<br>Unpacking manpages-dev (4.15<span class="hljs-string">-1</span>) over (4.15<span class="hljs-string">-1</span>) ...<br>Setting up binutils-common:amd64 (2.30<span class="hljs-string">-21</span>ubuntu1~18.04.5) ...<br>Setting up gcc<span class="hljs-string">-7</span>-base:amd64 (7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04) ...<br>Setting up libc6:amd64 (2.27<span class="hljs-string">-3</span>ubuntu1.4) ...<br>Setting up libcc1<span class="hljs-string">-0</span>:amd64 (8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04) ...<br>Setting up libc-dev-bin (2.27<span class="hljs-string">-3</span>ubuntu1.4) ...<br>Setting up libcilkrts5:amd64 (7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04) ...<br>Setting up libgomp1:amd64 (8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04) ...<br>Setting up libisl19:amd64 (0.19<span class="hljs-string">-1</span>) ...<br>Setting up libitm1:amd64 (8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04) ...<br>Setting up liblsan0:amd64 (8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04) ...<br>Setting up libmpc3:amd64 (1.1.0<span class="hljs-string">-1</span>) ...<br>Setting up libmpx2:amd64 (8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04) ...<br>Setting up libquadmath0:amd64 (8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04) ...<br>Setting up libtsan0:amd64 (8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04) ...<br>Setting up libubsan0:amd64 (7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04) ...<br>Setting up linux-libc-dev:amd64 (4.15.0<span class="hljs-string">-153</span>.160) ...<br>Setting up manpages-dev (4.15<span class="hljs-string">-1</span>) ...<br>Setting up cpp<span class="hljs-string">-7</span> (7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04) ...<br>Setting up libasan4:amd64 (7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04) ...<br>Setting up libatomic1:amd64 (8.4.0<span class="hljs-string">-1</span>ubuntu1~18.04) ...<br>Setting up libbinutils:amd64 (2.30<span class="hljs-string">-21</span>ubuntu1~18.04.5) ...<br>Setting up libc6-dev:amd64 (2.27<span class="hljs-string">-3</span>ubuntu1.4) ...<br>Setting up libgcc<span class="hljs-string">-7</span>-dev:amd64 (7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04) ...<br>Setting up binutils-x86<span class="hljs-string">-64</span>-linux-gnu (2.30<span class="hljs-string">-21</span>ubuntu1~18.04.5) ...<br>Setting up cpp (4:7.4.0<span class="hljs-string">-1</span>ubuntu2.3) ...<br>Setting up binutils (2.30<span class="hljs-string">-21</span>ubuntu1~18.04.5) ...<br>Setting up gcc<span class="hljs-string">-7</span> (7.5.0<span class="hljs-string">-3</span>ubuntu1~18.04) ...<br>Setting up gcc (4:7.4.0<span class="hljs-string">-1</span>ubuntu2.3) ...<br>Processing triggers for man-db (2.8.3<span class="hljs-string">-2</span>ubuntu0.1) ...<br>Processing triggers for libc-bin (2.27<span class="hljs-string">-3</span>ubuntu1.2) ...<br></code></pre></td></tr></table></figure><p>安装psutil</p><p>安装包: psutil-5.2.2.tar.gz</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br></pre></td><td class="code"><pre><code class="hljs gradle">root@ubuntu:~# tar -zxvf psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span>.tar.gz<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span>/<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span>/IDEAS<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span><br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>_psutil_common.c<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>_psutil_bsd.c<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch/<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/osx/</span><br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/osx/</span>process_info.c<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/osx/</span>process_info.h<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/windows/</span><br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/windows/</span>process_handles.h<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/windows/i</span>net_ntop.c<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/windows/</span>security.c<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/windows/</span>security.h<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/windows/</span>process_info.c<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/windows/g</span>lpi.h<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/windows/</span>services.c<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/windows/</span>process_handles.c<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/windows/</span>ntextapi.h<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/windows/</span>process_info.h<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/windows/i</span>net_ntop.h<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/windows/</span>services.h<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/bsd/</span><br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/bsd/</span>netbsd_socks.c<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/bsd/</span>netbsd.h<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/bsd/</span>netbsd_socks.h<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/bsd/</span>freebsd.h<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/bsd/</span>openbsd.h<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/bsd/</span>freebsd.c<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/bsd/</span>freebsd_socks.c<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/bsd/</span>freebsd_socks.h<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/bsd/</span>netbsd.c<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/bsd/</span>openbsd.c<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/solaris/</span><br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/solaris/</span>v10/<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/solaris/</span>v10/ifaddrs.h<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>arch<span class="hljs-regexp">/solaris/</span>v10/ifaddrs.c<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>_psutil_posix.h<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>_psutil_sunos.c<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>_psutil_common.h<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>_psutil_windows.c<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>_psposix.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>_psbsd.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>_pssunos.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>_pslinux.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>_psutil_linux.c<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>_common.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>__init__.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>tests/<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>tests/test_bsd.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>tests/test_memory_leaks.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>tests/test_system.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>tests/test_linux.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>tests/test_misc.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>tests/__init__.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>tests/test_osx.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>tests/test_process.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>tests/test_windows.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>tests/runner.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>tests/test_posix.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>tests/test_sunos.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>tests/README.rst<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>_psutil_osx.c<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>_psosx.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>_compat.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>_psutil_posix.c<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil/</span>_pswindows.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span>/setup.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/docs/</span><br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/docs/M</span>akefile<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/docs/</span>_template/<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/docs/</span>_template/indexsidebar.html<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/docs/</span>_template/page.html<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/docs/</span>_template/indexcontent.html<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/docs/</span>_template/globaltoc.html<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/docs/</span>_static/<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/docs/</span>_static/copybutton.js<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/docs/</span>_static/sidebar.js<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/docs/i</span>ndex.rst<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/docs/m</span>ake.bat<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/docs/</span>conf.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/docs/</span>README<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/docs/</span>_themes/<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/docs/</span>_themes<span class="hljs-regexp">/pydoctheme/</span><br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/docs/</span>_themes<span class="hljs-regexp">/pydoctheme/</span>theme.conf<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/docs/</span>_themes<span class="hljs-regexp">/pydoctheme/</span><span class="hljs-keyword">static</span>/<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/docs/</span>_themes<span class="hljs-regexp">/pydoctheme/</span><span class="hljs-keyword">static</span>/pydoctheme.css<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span>/Makefile<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span>/MANIFEST.in<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span>/tox.ini<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span>/.coveragerc<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil.egg-info/</span><br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil.egg-info/</span>SOURCES.txt<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil.egg-info/</span>top_level.txt<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil.egg-info/</span>not-zip-safe<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil.egg-info/</span>dependency_links.txt<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/psutil.egg-info/</span>PKG-INFO<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span>/LICENSE<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span>/make.bat<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/</span><br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/</span>procsmem.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/</span>fans.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/</span>temperatures.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/i</span>otop.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/i</span>fconfig.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/m</span>eminfo.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/</span>procinfo.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/</span>ps.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/</span>sensors.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/</span>killall.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/</span>pmap.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/</span>free.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/i</span>nternal/<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/i</span>nternal/bench_oneshot.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/i</span>nternal/bench_oneshot_2.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/i</span>nternal/print_announce.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/i</span>nternal/download_exes.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/i</span>nternal/winmake.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/</span>who.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/</span>disk_usage.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/</span>battery.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/</span>pstree.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/</span>cpu_distribution.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/</span>top.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/</span>pidof.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/</span>netstat.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/</span>winservices.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span><span class="hljs-regexp">/scripts/</span>nettop.py<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span>/setup.cfg<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span>/INSTALL.rst<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span>/CREDITS<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span>/HISTORY.rst<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span>/DEVGUIDE.rst<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span>/PKG-INFO<br>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span>/README.rst<br>root@ubuntu:~# cd psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span>/<br>root@ubuntu:~/psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span># python setup.py install<br><span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/python2.7/</span>distutils/dist.py:<span class="hljs-number">267</span>: UserWarning: Unknown distribution option: <span class="hljs-string">&#x27;zip_safe&#x27;</span><br>  warnings.warn(msg)<br><span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/python2.7/</span>distutils/dist.py:<span class="hljs-number">267</span>: UserWarning: Unknown distribution option: <span class="hljs-string">&#x27;test_suite&#x27;</span><br>  warnings.warn(msg)<br><span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/python2.7/</span>distutils/dist.py:<span class="hljs-number">267</span>: UserWarning: Unknown distribution option: <span class="hljs-string">&#x27;tests_require&#x27;</span><br>  warnings.warn(msg)<br>running install<br>running build<br>running build_py<br>running build_ext<br>building <span class="hljs-string">&#x27;psutil._psutil_linux&#x27;</span> extension<br>x86_64-linux-gnu-gcc -pthread -fno-strict-aliasing -Wdate-time -D_FORTIFY_SOURCE=<span class="hljs-number">2</span> -g -fdebug-prefix-map=<span class="hljs-regexp">/build/</span>python2.<span class="hljs-number">7</span>-gnDdqE<span class="hljs-regexp">/python2.7-2.7.17=. -fstack-protector-strong -Wformat -Werror=format-security -fPIC -DPSUTIL_POSIX=1 -DPSUTIL_VERSION=522 -DPSUTIL_LINUX=1 -I/u</span>sr<span class="hljs-regexp">/include/</span>python2.<span class="hljs-number">7</span> -c psutil<span class="hljs-regexp">/_psutil_linux.c -o build/</span>temp.linux-x86_64-<span class="hljs-number">2.7</span><span class="hljs-regexp">/psutil/</span>_psutil_linux.o<br>x86_64-linux-gnu-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -Wdate-time -D_FORTIFY_SOURCE=<span class="hljs-number">2</span> -g -fdebug-prefix-map=<span class="hljs-regexp">/build/</span>python2.<span class="hljs-number">7</span>-gnDdqE<span class="hljs-regexp">/python2.7-2.7.17=. -fstack-protector-strong -Wformat -Werror=format-security -Wl,-Bsymbolic-functions -Wl,-z,relro -Wdate-time -D_FORTIFY_SOURCE=2 -g -fdebug-prefix-map=/</span>build<span class="hljs-regexp">/python2.7-gnDdqE/</span>python2.<span class="hljs-number">7</span>-<span class="hljs-number">2.7</span>.<span class="hljs-number">17</span>=. -fstack-protector-strong -Wformat -Werror=format-security -fPIC build<span class="hljs-regexp">/temp.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/_psutil_linux.o -o build/</span>lib.linux-x86_64-<span class="hljs-number">2.7</span><span class="hljs-regexp">/psutil/</span>_psutil_linux.so<br>building <span class="hljs-string">&#x27;psutil._psutil_posix&#x27;</span> extension<br>x86_64-linux-gnu-gcc -pthread -fno-strict-aliasing -Wdate-time -D_FORTIFY_SOURCE=<span class="hljs-number">2</span> -g -fdebug-prefix-map=<span class="hljs-regexp">/build/</span>python2.<span class="hljs-number">7</span>-gnDdqE<span class="hljs-regexp">/python2.7-2.7.17=. -fstack-protector-strong -Wformat -Werror=format-security -fPIC -DPSUTIL_POSIX=1 -DPSUTIL_VERSION=522 -DPSUTIL_LINUX=1 -I/u</span>sr<span class="hljs-regexp">/include/</span>python2.<span class="hljs-number">7</span> -c psutil<span class="hljs-regexp">/_psutil_posix.c -o build/</span>temp.linux-x86_64-<span class="hljs-number">2.7</span><span class="hljs-regexp">/psutil/</span>_psutil_posix.o<br>x86_64-linux-gnu-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -Wdate-time -D_FORTIFY_SOURCE=<span class="hljs-number">2</span> -g -fdebug-prefix-map=<span class="hljs-regexp">/build/</span>python2.<span class="hljs-number">7</span>-gnDdqE<span class="hljs-regexp">/python2.7-2.7.17=. -fstack-protector-strong -Wformat -Werror=format-security -Wl,-Bsymbolic-functions -Wl,-z,relro -Wdate-time -D_FORTIFY_SOURCE=2 -g -fdebug-prefix-map=/</span>build<span class="hljs-regexp">/python2.7-gnDdqE/</span>python2.<span class="hljs-number">7</span>-<span class="hljs-number">2.7</span>.<span class="hljs-number">17</span>=. -fstack-protector-strong -Wformat -Werror=format-security -fPIC build<span class="hljs-regexp">/temp.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/_psutil_posix.o -o build/</span>lib.linux-x86_64-<span class="hljs-number">2.7</span><span class="hljs-regexp">/psutil/</span>_psutil_posix.so<br>running install_lib<br>creating <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/_pslinux.py -&gt; /u</span>sr<span class="hljs-regexp">/local/</span>lib<span class="hljs-regexp">/python2.7/</span>dist-packages/psutil<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/_compat.py -&gt; /u</span>sr<span class="hljs-regexp">/local/</span>lib<span class="hljs-regexp">/python2.7/</span>dist-packages/psutil<br>creating <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil/tests<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/tests/</span>test_osx.py -&gt; <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil/tests<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/tests/</span>test_sunos.py -&gt; <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil/tests<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/tests/</span>test_system.py -&gt; <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil/tests<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/tests/</span>runner.py -&gt; <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil/tests<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/tests/</span>test_memory_leaks.py -&gt; <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil/tests<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/tests/</span>test_process.py -&gt; <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil/tests<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/tests/</span>test_posix.py -&gt; <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil/tests<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/tests/</span>test_misc.py -&gt; <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil/tests<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/tests/</span>test_linux.py -&gt; <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil/tests<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/tests/</span>test_bsd.py -&gt; <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil/tests<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/tests/</span>test_windows.py -&gt; <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil/tests<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/tests/</span>__init__.py -&gt; <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil/tests<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/_pssunos.py -&gt; /u</span>sr<span class="hljs-regexp">/local/</span>lib<span class="hljs-regexp">/python2.7/</span>dist-packages/psutil<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/_common.py -&gt; /u</span>sr<span class="hljs-regexp">/local/</span>lib<span class="hljs-regexp">/python2.7/</span>dist-packages/psutil<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/_psosx.py -&gt; /u</span>sr<span class="hljs-regexp">/local/</span>lib<span class="hljs-regexp">/python2.7/</span>dist-packages/psutil<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/_psutil_posix.so -&gt; /u</span>sr<span class="hljs-regexp">/local/</span>lib<span class="hljs-regexp">/python2.7/</span>dist-packages/psutil<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/_pswindows.py -&gt; /u</span>sr<span class="hljs-regexp">/local/</span>lib<span class="hljs-regexp">/python2.7/</span>dist-packages/psutil<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/_psutil_linux.so -&gt; /u</span>sr<span class="hljs-regexp">/local/</span>lib<span class="hljs-regexp">/python2.7/</span>dist-packages/psutil<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/_psbsd.py -&gt; /u</span>sr<span class="hljs-regexp">/local/</span>lib<span class="hljs-regexp">/python2.7/</span>dist-packages/psutil<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/__init__.py -&gt; /u</span>sr<span class="hljs-regexp">/local/</span>lib<span class="hljs-regexp">/python2.7/</span>dist-packages/psutil<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>psutil<span class="hljs-regexp">/_psposix.py -&gt; /u</span>sr<span class="hljs-regexp">/local/</span>lib<span class="hljs-regexp">/python2.7/</span>dist-packages/psutil<br><span class="hljs-keyword">byte</span>-compiling <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil/_pslinux.py to _pslinux.pyc<br><span class="hljs-keyword">byte</span>-compiling <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil/_compat.py to _compat.pyc<br><span class="hljs-keyword">byte</span>-compiling <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil<span class="hljs-regexp">/tests/</span>test_osx.py to test_osx.pyc<br><span class="hljs-keyword">byte</span>-compiling <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil<span class="hljs-regexp">/tests/</span>test_sunos.py to test_sunos.pyc<br><span class="hljs-keyword">byte</span>-compiling <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil<span class="hljs-regexp">/tests/</span>test_system.py to test_system.pyc<br><span class="hljs-keyword">byte</span>-compiling <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil<span class="hljs-regexp">/tests/</span>runner.py to runner.pyc<br><span class="hljs-keyword">byte</span>-compiling <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil<span class="hljs-regexp">/tests/</span>test_memory_leaks.py to test_memory_leaks.pyc<br><span class="hljs-keyword">byte</span>-compiling <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil<span class="hljs-regexp">/tests/</span>test_process.py to test_process.pyc<br><span class="hljs-keyword">byte</span>-compiling <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil<span class="hljs-regexp">/tests/</span>test_posix.py to test_posix.pyc<br><span class="hljs-keyword">byte</span>-compiling <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil<span class="hljs-regexp">/tests/</span>test_misc.py to test_misc.pyc<br><span class="hljs-keyword">byte</span>-compiling <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil<span class="hljs-regexp">/tests/</span>test_linux.py to test_linux.pyc<br><span class="hljs-keyword">byte</span>-compiling <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil<span class="hljs-regexp">/tests/</span>test_bsd.py to test_bsd.pyc<br><span class="hljs-keyword">byte</span>-compiling <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil<span class="hljs-regexp">/tests/</span>test_windows.py to test_windows.pyc<br><span class="hljs-keyword">byte</span>-compiling <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil<span class="hljs-regexp">/tests/</span>__init__.py to __init__.pyc<br><span class="hljs-keyword">byte</span>-compiling <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil/_pssunos.py to _pssunos.pyc<br><span class="hljs-keyword">byte</span>-compiling <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil/_common.py to _common.pyc<br><span class="hljs-keyword">byte</span>-compiling <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil/_psosx.py to _psosx.pyc<br><span class="hljs-keyword">byte</span>-compiling <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil/_pswindows.py to _pswindows.pyc<br><span class="hljs-keyword">byte</span>-compiling <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil/_psbsd.py to _psbsd.pyc<br><span class="hljs-keyword">byte</span>-compiling <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil/__init__.py to __init__.pyc<br><span class="hljs-keyword">byte</span>-compiling <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil/_psposix.py to _psposix.pyc<br>running install_egg_info<br>Writing <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>psutil-<span class="hljs-number">5.2</span>.<span class="hljs-number">2</span>.egg-info<br>netifaces<br>安装包:<br>netifaces-<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span>.tar.gz<br>python-setuptools_39.<span class="hljs-number">0.1</span>-<span class="hljs-number">2</span>_all.deb<br>python-pkg-resources_39.<span class="hljs-number">0.1</span>-<span class="hljs-number">2</span>_all.deb<br><br>root@ubuntu:~# dpkg -i python-setuptools_39.<span class="hljs-number">0.1</span>-<span class="hljs-number">2</span>_all.deb  python-pkg-resources_39.<span class="hljs-number">0.1</span>-<span class="hljs-number">2</span>_all.deb<br>(Reading database ... <span class="hljs-number">72501</span> files and directories currently installed.)<br>Preparing to unpack python-setuptools_39.<span class="hljs-number">0.1</span>-<span class="hljs-number">2</span>_all.deb ...<br>Unpacking python-setuptools (<span class="hljs-number">39.0</span>.<span class="hljs-number">1</span>-<span class="hljs-number">2</span>) over (<span class="hljs-number">39.0</span>.<span class="hljs-number">1</span>-<span class="hljs-number">2</span>) ...<br>Selecting previously unselected <span class="hljs-keyword">package</span> python-pkg-resources.<br>Preparing to unpack python-pkg-resources_39.<span class="hljs-number">0.1</span>-<span class="hljs-number">2</span>_all.deb ...<br>Unpacking python-pkg-resources (<span class="hljs-number">39.0</span>.<span class="hljs-number">1</span>-<span class="hljs-number">2</span>) ...<br>Setting up python-pkg-resources (<span class="hljs-number">39.0</span>.<span class="hljs-number">1</span>-<span class="hljs-number">2</span>) ...<br>Setting up python-setuptools (<span class="hljs-number">39.0</span>.<span class="hljs-number">1</span>-<span class="hljs-number">2</span>) ...<br><br>root@ubuntu:~# tar -zxvf netifaces-<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span>.tar.gz<br>netifaces-<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span>/<br>netifaces-<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span>/LICENSE<br>netifaces-<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span>/MANIFEST.in<br>netifaces-<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span>/PKG-INFO<br>netifaces-<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span>/README.rst<br>netifaces-<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span>/netifaces.c<br>netifaces-<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span><span class="hljs-regexp">/netifaces.egg-info/</span><br>netifaces-<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span><span class="hljs-regexp">/netifaces.egg-info/</span>PKG-INFO<br>netifaces-<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span><span class="hljs-regexp">/netifaces.egg-info/</span>SOURCES.txt<br>netifaces-<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span><span class="hljs-regexp">/netifaces.egg-info/</span>dependency_links.txt<br>netifaces-<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span><span class="hljs-regexp">/netifaces.egg-info/</span>top_level.txt<br>netifaces-<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span><span class="hljs-regexp">/netifaces.egg-info/</span>zip-safe<br>netifaces-<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span>/setup.cfg<br>netifaces-<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span>/setup.py<br>netifaces-<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span>/test.py<br>root@ubuntu:~# cd netifaces-<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span>/<br><br>root@ubuntu:~/netifaces-<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span># python setup.py install<br>running install<br>running bdist_egg<br>running egg_info<br>writing netifaces.egg-info/PKG-INFO<br>writing top-level names to netifaces.egg-info/top_level.txt<br>writing dependency_links to netifaces.egg-info/dependency_links.txt<br>reading manifest <span class="hljs-keyword">file</span> <span class="hljs-string">&#x27;netifaces.egg-info/SOURCES.txt&#x27;</span><br>reading manifest template <span class="hljs-string">&#x27;MANIFEST.in&#x27;</span><br>writing manifest <span class="hljs-keyword">file</span> <span class="hljs-string">&#x27;netifaces.egg-info/SOURCES.txt&#x27;</span><br>installing library code to build<span class="hljs-regexp">/bdist.linux-x86_64/</span>egg<br>running install_lib<br>running build_ext<br>checking <span class="hljs-keyword">for</span> getifaddrs...found.<br>checking <span class="hljs-keyword">for</span> getnameinfo...found.<br>checking <span class="hljs-keyword">for</span> IPv6 socket IOCTLs...not found.<br>checking <span class="hljs-keyword">for</span> optional header files...netash<span class="hljs-regexp">/ash.h netatalk/</span>at.h netax25<span class="hljs-regexp">/ax25.h neteconet/</span>ec.h netipx<span class="hljs-regexp">/ipx.h netpacket/</span>packet.h netrose<span class="hljs-regexp">/rose.h linux/i</span>rda.h linux<span class="hljs-regexp">/atm.h linux/</span>llc.h linux<span class="hljs-regexp">/tipc.h linux/</span>dn.h.<br>checking whether struct sockaddr has a length field...no.<br>checking which sockaddr_xxx structs are defined...at ax25 in in6 ipx un rose ash ec ll atmpvc atmsvc dn irda llc.<br>checking <span class="hljs-keyword">for</span> routing socket support...no.<br>checking <span class="hljs-keyword">for</span> sysctl(CTL_NET...) support...no.<br>checking <span class="hljs-keyword">for</span> netlink support...yes.<br>will use netlink to <span class="hljs-keyword">read</span> routing table<br>building <span class="hljs-string">&#x27;netifaces&#x27;</span> extension<br>x86_64-linux-gnu-gcc -pthread -fno-strict-aliasing -Wdate-time -D_FORTIFY_SOURCE=<span class="hljs-number">2</span> -g -fdebug-prefix-map=<span class="hljs-regexp">/build/</span>python2.<span class="hljs-number">7</span>-gnDdqE<span class="hljs-regexp">/python2.7-2.7.17=. -fstack-protector-strong -Wformat -Werror=format-security -fPIC -DNETIFACES_VERSION=0.11.0 -DHAVE_GETIFADDRS=1 -DHAVE_GETNAMEINFO=1 -DHAVE_NETASH_ASH_H=1 -DHAVE_NETATALK_AT_H=1 -DHAVE_NETAX25_AX25_H=1 -DHAVE_NETECONET_EC_H=1 -DHAVE_NETIPX_IPX_H=1 -DHAVE_NETPACKET_PACKET_H=1 -DHAVE_NETROSE_ROSE_H=1 -DHAVE_LINUX_IRDA_H=1 -DHAVE_LINUX_ATM_H=1 -DHAVE_LINUX_LLC_H=1 -DHAVE_LINUX_TIPC_H=1 -DHAVE_LINUX_DN_H=1 -DHAVE_SOCKADDR_AT=1 -DHAVE_SOCKADDR_AX25=1 -DHAVE_SOCKADDR_IN=1 -DHAVE_SOCKADDR_IN6=1 -DHAVE_SOCKADDR_IPX=1 -DHAVE_SOCKADDR_UN=1 -DHAVE_SOCKADDR_ROSE=1 -DHAVE_SOCKADDR_ASH=1 -DHAVE_SOCKADDR_EC=1 -DHAVE_SOCKADDR_LL=1 -DHAVE_SOCKADDR_ATMPVC=1 -DHAVE_SOCKADDR_ATMSVC=1 -DHAVE_SOCKADDR_DN=1 -DHAVE_SOCKADDR_IRDA=1 -DHAVE_SOCKADDR_LLC=1 -DHAVE_PF_NETLINK=1 -I/u</span>sr<span class="hljs-regexp">/include/</span>python2.<span class="hljs-number">7</span> -c netifaces.c -o build<span class="hljs-regexp">/temp.linux-x86_64-2.7/</span>netifaces.o<br>creating build/lib.linux-x86_64-<span class="hljs-number">2.7</span><br>x86_64-linux-gnu-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -Wdate-time -D_FORTIFY_SOURCE=<span class="hljs-number">2</span> -g -fdebug-prefix-map=<span class="hljs-regexp">/build/</span>python2.<span class="hljs-number">7</span>-gnDdqE<span class="hljs-regexp">/python2.7-2.7.17=. -fstack-protector-strong -Wformat -Werror=format-security -Wl,-Bsymbolic-functions -Wl,-z,relro -Wdate-time -D_FORTIFY_SOURCE=2 -g -fdebug-prefix-map=/</span>build<span class="hljs-regexp">/python2.7-gnDdqE/</span>python2.<span class="hljs-number">7</span>-<span class="hljs-number">2.7</span>.<span class="hljs-number">17</span>=. -fstack-protector-strong -Wformat -Werror=format-security -fPIC build<span class="hljs-regexp">/temp.linux-x86_64-2.7/</span>netifaces.o -o build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>netifaces.so<br>creating build/bdist.linux-x86_64<br>creating build<span class="hljs-regexp">/bdist.linux-x86_64/</span>egg<br>copying build<span class="hljs-regexp">/lib.linux-x86_64-2.7/</span>netifaces.so -&gt; build<span class="hljs-regexp">/bdist.linux-x86_64/</span>egg<br>creating stub loader <span class="hljs-keyword">for</span> netifaces.so<br><span class="hljs-keyword">byte</span>-compiling build<span class="hljs-regexp">/bdist.linux-x86_64/</span>egg/netifaces.py to netifaces.pyc<br>creating build<span class="hljs-regexp">/bdist.linux-x86_64/</span>egg/EGG-INFO<br>copying netifaces.egg-info<span class="hljs-regexp">/PKG-INFO -&gt; build/</span>bdist.linux-x86_64<span class="hljs-regexp">/egg/</span>EGG-INFO<br>copying netifaces.egg-info<span class="hljs-regexp">/SOURCES.txt -&gt; build/</span>bdist.linux-x86_64<span class="hljs-regexp">/egg/</span>EGG-INFO<br>copying netifaces.egg-info<span class="hljs-regexp">/dependency_links.txt -&gt; build/</span>bdist.linux-x86_64<span class="hljs-regexp">/egg/</span>EGG-INFO<br>copying netifaces.egg-info<span class="hljs-regexp">/top_level.txt -&gt; build/</span>bdist.linux-x86_64<span class="hljs-regexp">/egg/</span>EGG-INFO<br>copying netifaces.egg-info<span class="hljs-regexp">/zip-safe -&gt; build/</span>bdist.linux-x86_64<span class="hljs-regexp">/egg/</span>EGG-INFO<br>writing build<span class="hljs-regexp">/bdist.linux-x86_64/</span>egg<span class="hljs-regexp">/EGG-INFO/</span>native_libs.txt<br>creating dist<br>creating <span class="hljs-string">&#x27;dist/netifaces-0.11.0-py2.7-linux-x86_64.egg&#x27;</span> and adding <span class="hljs-string">&#x27;build/bdist.linux-x86_64/egg&#x27;</span> to it<br>removing <span class="hljs-string">&#x27;build/bdist.linux-x86_64/egg&#x27;</span> (and everything under it)<br>Processing netifaces-<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span>-py2.<span class="hljs-number">7</span>-linux-x86_64.egg<br>Copying netifaces-<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span>-py2.<span class="hljs-number">7</span>-linux-x86_64.egg to <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span>/dist-packages<br>Adding netifaces <span class="hljs-number">0.11</span>.<span class="hljs-number">0</span> to easy-install.pth <span class="hljs-keyword">file</span><br><br>Installed <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python2.<span class="hljs-number">7</span><span class="hljs-regexp">/dist-packages/</span>netifaces-<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span>-py2.<span class="hljs-number">7</span>-linux-x86_64.egg<br>Processing <span class="hljs-keyword">dependencies</span> <span class="hljs-keyword">for</span> netifaces==<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span><br>Finished processing <span class="hljs-keyword">dependencies</span> <span class="hljs-keyword">for</span> netifaces==<span class="hljs-number">0.11</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>安装qemu-guest-agent服务</p><p>安装包: qemu-guest-agent_1%3a2.11+dfsg-1ubuntu7.37_amd64.deb</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs erlang">root@ubuntu:~# dpkg -i qemu-guest-agent_1<span class="hljs-comment">%3a2.11+dfsg-1ubuntu7.37_amd64.deb</span><br>Selecting previously unselected package qemu-guest-agent.<br>(Reading database ... <span class="hljs-number">72525</span> files <span class="hljs-keyword">and</span> directories currently installed.)<br>Preparing to unpack qemu-guest-agent_1<span class="hljs-comment">%3a2.11+dfsg-1ubuntu7.37_amd64.deb ...</span><br>Unpacking qemu-guest-agent (<span class="hljs-number">1</span>:<span class="hljs-number">2.11</span>+dfsg-<span class="hljs-number">1</span>ubuntu7.<span class="hljs-number">37</span>) ...<br>Setting up qemu-guest-agent (<span class="hljs-number">1</span>:<span class="hljs-number">2.11</span>+dfsg-<span class="hljs-number">1</span>ubuntu7.<span class="hljs-number">37</span>) ...<br>Processing triggers for systemd (<span class="hljs-number">237</span>-<span class="hljs-number">3</span>ubuntu10.<span class="hljs-number">50</span>) ...<br>Processing triggers for ureadahead (<span class="hljs-number">0.100</span>.<span class="hljs-number">0</span>-<span class="hljs-number">21</span>) ...<br>Processing triggers for man-db (<span class="hljs-number">2.8</span>.<span class="hljs-number">3</span>-<span class="hljs-number">2</span>ubuntu0.<span class="hljs-number">1</span>) ...<br></code></pre></td></tr></table></figure><p>查看qemu-guest-agent服务状态</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">root@ubuntu:~#</span> <span class="hljs-string">systemctl</span> <span class="hljs-string">status</span> <span class="hljs-string">qemu-guest-agent</span><br><span class="hljs-string">●</span> <span class="hljs-attr">qemu-guest-agent.service - LSB:</span> <span class="hljs-string">QEMU</span> <span class="hljs-string">Guest</span> <span class="hljs-string">Agent</span> <span class="hljs-string">startup</span> <span class="hljs-string">script</span><br>   <span class="hljs-attr">Loaded:</span> <span class="hljs-string">loaded</span> <span class="hljs-string">(/etc/init.d/qemu-guest-agent;</span> <span class="hljs-string">generated)</span><br>   <span class="hljs-attr">Active:</span> <span class="hljs-string">active</span> <span class="hljs-string">(exited)</span> <span class="hljs-string">since</span> <span class="hljs-string">Fri</span> <span class="hljs-number">2021-08-13 08:43:22 </span><span class="hljs-string">UTC;</span> <span class="hljs-string">1min</span> <span class="hljs-string">7s</span> <span class="hljs-string">ago</span><br>     <span class="hljs-attr">Docs:</span> <span class="hljs-string">man:systemd-sysv-generator(8)</span><br>    <span class="hljs-attr">Tasks:</span> <span class="hljs-number">0</span> <span class="hljs-string">(limit:</span> <span class="hljs-number">1077</span><span class="hljs-string">)</span><br>   <span class="hljs-attr">CGroup:</span> <span class="hljs-string">/system.slice/qemu-guest-agent.service</span><br><br><span class="hljs-string">Aug</span> <span class="hljs-number">13</span> <span class="hljs-number">08</span><span class="hljs-string">:43:22</span> <span class="hljs-string">ubuntu</span> <span class="hljs-string">systemd[1]:</span> <span class="hljs-attr">Starting LSB:</span> <span class="hljs-string">QEMU</span> <span class="hljs-string">Guest</span> <span class="hljs-string">Agent</span> <span class="hljs-string">startup</span> <span class="hljs-string">script...</span><br><span class="hljs-string">Aug</span> <span class="hljs-number">13</span> <span class="hljs-number">08</span><span class="hljs-string">:43:22</span> <span class="hljs-string">ubuntu</span> <span class="hljs-string">qemu-guest-agent[8752]:</span>  <span class="hljs-string">*</span> <span class="hljs-attr">qemu-ga:</span> <span class="hljs-string">transport</span> <span class="hljs-string">endpoint</span> <span class="hljs-string">not</span> <span class="hljs-string">found,</span> <span class="hljs-string">not</span> <span class="hljs-string">starting</span><br><span class="hljs-string">Aug</span> <span class="hljs-number">13</span> <span class="hljs-number">08</span><span class="hljs-string">:43:22</span> <span class="hljs-string">ubuntu</span> <span class="hljs-string">systemd[1]:</span> <span class="hljs-attr">Started LSB:</span> <span class="hljs-string">QEMU</span> <span class="hljs-string">Guest</span> <span class="hljs-string">Agent</span> <span class="hljs-string">startup</span> <span class="hljs-string">script.</span><br></code></pre></td></tr></table></figure><p>网卡热加载系统服务</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs tap">drwxr-xr-x <span class="hljs-number"> 2 </span>root root <span class="hljs-number"> 4096 </span>Aug<span class="hljs-number"> 13 </span>08:47 ./<br>drwx------<span class="hljs-number"> 11 </span>root root <span class="hljs-number"> 4096 </span>Aug<span class="hljs-number"> 13 </span>08:47 ../<br>-rw-r--r-- <span class="hljs-number"> 1 </span>root root <span class="hljs-number"> 4060 </span>Aug<span class="hljs-number"> 13 </span>08:47 hotplug.c<br>-rw-r--r-- <span class="hljs-number"> 1 </span>root root  <span class="hljs-number"> 187 </span>Aug<span class="hljs-number"> 13 </span>08:47 hotplug.conf<br>-rw-r--r-- <span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 12120 </span>Aug<span class="hljs-number"> 13 </span>08:47 hotplugd<br>-rw-r--r-- <span class="hljs-number"> 1 </span>root root  <span class="hljs-number"> 671 </span>Aug<span class="hljs-number"> 13 </span>08:47 kdpa-hotplug<br>-rw-r--r-- <span class="hljs-number"> 1 </span>root root  <span class="hljs-number"> 262 </span>Aug<span class="hljs-number"> 13 </span>08:47 kdpa-hotplug.service<br>-rw-r--r-- <span class="hljs-number"> 1 </span>root root <span class="hljs-number"> 1231 </span>Aug<span class="hljs-number"> 13 </span>08:47 nic_hotplug.py<br>以上程序拷贝到/var/www/kdpa/project/daemon/hotplug/目录下,<br></code></pre></td></tr></table></figure><p>编译nic_hotplug.py</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:~/hotplug_rocky</span><span class="hljs-comment"># mkdir -p /var/www/kdpa/project/daemon/hotplug</span><br>root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:~/hotplug_rocky</span><span class="hljs-comment"># cd /var/www/kdpa/project/daemon/hotplug</span><br>root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/var/www/kdpa/project/daemon/hotplug</span><span class="hljs-comment"># cp /root/hotplug_rocky/* .</span><br>root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/var/www/kdpa/project/daemon/hotplug</span><span class="hljs-comment"># python -m py_compile nic_hotplug.py</span><br>root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/var/www/kdpa/project/daemon/hotplug</span><span class="hljs-comment"># chmod 755 *</span><br>root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/var/www/kdpa/project/daemon/hotplug</span><span class="hljs-comment"># cp kdpa-hotplug.service /etc/systemd/system/.</span><br></code></pre></td></tr></table></figure><p>启动kdpa-hotplug.service服务并设置开机启动</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dts">root@ubuntu:~<span class="hljs-meta"># systemctl start kdpa-hotplug.service</span><br>root@ubuntu:~<span class="hljs-meta"># systemctl status kdpa-hotplug.service</span><br>● kdpa-hotplug.service - kdpa-hotplug<br><span class="hljs-symbol">   Loaded:</span> loaded (<span class="hljs-keyword">/etc/</span>systemd<span class="hljs-keyword">/system/</span>kdpa-hotplug.<span class="hljs-attr">service</span><span class="hljs-punctuation">;</span> <span class="hljs-attr">disabled</span><span class="hljs-punctuation">;</span> vendor preset: enabled)<br><span class="hljs-symbol">   Active:</span> active (running) since Fri <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-13</span> <span class="hljs-number">08</span>:<span class="hljs-number">52</span>:<span class="hljs-number">25</span> UTC<span class="hljs-punctuation">;</span> <span class="hljs-number">4</span>s ago<br><span class="hljs-symbol">  Process:</span> <span class="hljs-number">9011</span> ExecS<span class="hljs-attr">tart</span><span class="hljs-operator">=</span><span class="hljs-keyword">/var/</span>www<span class="hljs-keyword">/kdpa/</span>project<span class="hljs-keyword">/daemon/</span>hotplug/kdpa-hotplug start (<span class="hljs-attr">code</span><span class="hljs-operator">=</span>exited, <span class="hljs-attr">status</span><span class="hljs-operator">=</span><span class="hljs-number">0</span>/SUCCESS)<br> Main PID: <span class="hljs-number">9013</span> (hotplugd)<br><span class="hljs-symbol">    Tasks:</span> <span class="hljs-number">1</span> (limit: <span class="hljs-number">1077</span>)<br><span class="hljs-symbol">   CGroup:</span> /system.slice/kdpa-hotplug.service<br>           └─<span class="hljs-number">9013</span> <span class="hljs-keyword">/var/</span>www<span class="hljs-keyword">/kdpa/</span>project<span class="hljs-keyword">/daemon/</span>hotplug/hotplugd<br><br>Aug <span class="hljs-number">13</span> <span class="hljs-number">08</span>:<span class="hljs-number">52</span>:<span class="hljs-number">25</span> ubuntu systemd[<span class="hljs-number">1</span>]: Starting kdpa-hotplug...<br>Aug <span class="hljs-number">13</span> <span class="hljs-number">08</span>:<span class="hljs-number">52</span>:<span class="hljs-number">25</span> ubuntu systemd[<span class="hljs-number">1</span>]: Started kdpa-hotplug.<br></code></pre></td></tr></table></figure><p>qga服务脚本qga_cmd.py</p><p>放到&#x2F;root&#x2F;qga_cmd.py</p><p>网卡初始化脚本kd_nic_control.py<br>放到&#x2F;root&#x2F;kd_nic_control.py</p><p>网卡eth0设置DHCP模式<br>允许网卡热插拔, 开机自启动, IP地址0.0.0.0, 掩码255.255.255.0</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gradle">vim <span class="hljs-regexp">/etc/</span>network<span class="hljs-regexp">/interfaces.d/</span>eth0<br><br>auto eth0<br>iface eth0 inet <span class="hljs-keyword">static</span><br>address <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><br>netmask <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br></code></pre></td></tr></table></figure><p>开机自启动脚本rc.local配置</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:~</span><span class="hljs-comment"># touch /etc/rc.local</span><br>root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:~</span><span class="hljs-comment"># chmod 755 /etc/rc.local</span><br>root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:~</span><span class="hljs-comment"># vim /etc/rc.local</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br>/usr/bin/python /root/kd_nic_control.py init_conf<br>/usr/bin/python /root/kd_nic_control.py checksum_off<br>注:/usr/bin/python /root/kd_nic_control.py init_conf脚本只运行一次, 因此需制作镜像时添加。<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Ubuntu18</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Ubuntu18</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Rocky6.0.60安装</title>
    <link href="/2021/08/12/linux/rocky6/"/>
    <url>/2021/08/12/linux/rocky6/</url>
    
    <content type="html"><![CDATA[<h2 id="服务端配置"><a href="#服务端配置" class="headerlink" title="服务端配置"></a>服务端配置</h2><h3 id="1-安装apt-mirror"><a href="#1-安装apt-mirror" class="headerlink" title="1.安装apt-mirror"></a>1.安装apt-mirror</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">apt-<span class="hljs-built_in">get</span> install apt-mirror<br></code></pre></td></tr></table></figure><h3 id="2-修改apt-mirror配置文件"><a href="#2-修改apt-mirror配置文件" class="headerlink" title="2.修改apt-mirror配置文件"></a>2.修改apt-mirror配置文件</h3><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">vim /etc/apt/mirror<span class="hljs-meta">.list</span><br></code></pre></td></tr></table></figure><p>参考以下配置文件：<br>清空原有的配置文件，直接使用以下配置文件即可</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs clean">############# config ##################<br># 以下注释的内容都是默认配置，如果需要自定义，取消注释修改即可<br>set base_path /var/spool/apt-mirror<br>#<br># 镜像文件下载地址<br># set mirror_path $base_path/mirror<br># 临时索引下载文件目录，也就是存放软件仓库的dists目录下的文件（默认即可）<br># set skel_path $base_path/skel<br># 配置日志（默认即可）<br># set var_path $base_path/var<br># clean脚本位置<br># set cleanscript $var_path/clean.sh<br># 架构配置，i386/amd64，默认的话会下载跟本机相同的架构的源<br>set defaultarch amd64<br># set postmirror_script $var_path/postmirror.sh<br># set run_postmirror <span class="hljs-number">0</span><br># 下载线程数<br>set nthreads <span class="hljs-number">20</span><br>set _tilde <span class="hljs-number">0</span><br>#<br>############# end config ##############<br># Ali yun（这里没有添加deb-src的源）<br>deb http:<span class="hljs-comment">//mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse</span><br>deb http:<span class="hljs-comment">//mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse</span><br>deb http:<span class="hljs-comment">//mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse</span><br>deb http:<span class="hljs-comment">//mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse</span><br>deb http:<span class="hljs-comment">//mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse</span><br><br>clean http:<span class="hljs-comment">//mirrors.aliyun.com/ubuntu</span><br></code></pre></td></tr></table></figure><h3 id="3-开始同步"><a href="#3-开始同步" class="headerlink" title="3.开始同步"></a>3.开始同步</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">apt-mirror</span><br></code></pre></td></tr></table></figure><p>然后等待很长时间（该镜像差不多100G左右，具体时间看网络环境），同步的镜像文件目录为&#x2F;var&#x2F;spool&#x2F;apt-mirror&#x2F;mirror&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F;，当然如果增加了其他的源，在&#x2F;var&#x2F;spool&#x2F;apt-mirror&#x2F;mirror目录下还有其他的地址为名的目录。</p><p>注意：当apt-mirror 被意外中断时，只需要重新运行即可，apt-mirror支持断点续存；另外，意外关闭，需要在&#x2F;var&#x2F;spool&#x2F;apt-mirror&#x2F;var目录下面删除 apt-mirror.lock文件【 sudo rm apt-mirror.lock 】，之后执行apt-mirror重新启动</p><h3 id="4-安装apache2"><a href="#4-安装apache2" class="headerlink" title="4.安装apache2"></a>4.安装apache2</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">apt-<span class="hljs-built_in">get</span> install apache2<br></code></pre></td></tr></table></figure><p>由于Apache2的默认网页文件目录位于&#x2F;var&#x2F;www&#x2F;html，因此，可以做个软链接（这样我们就可以直接访问了，无需将其直接导入该目录）</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">ln -s <span class="hljs-regexp">/var/</span>spool<span class="hljs-regexp">/apt-mirror/mi</span>rror<span class="hljs-regexp">/mirrors.aliyun.com/u</span>buntu <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/u</span>buntu<br></code></pre></td></tr></table></figure><p>然后就可以通过如下地址访问了<br>http:&#x2F;&#x2F;[host]:[port]&#x2F;ubuntu   #ip和port是自己本机的，其中端口默认为80</p><h2 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h2><h3 id="1-编辑-etc-apt-sources-list，加入以下内容"><a href="#1-编辑-etc-apt-sources-list，加入以下内容" class="headerlink" title="1.编辑&#x2F;etc&#x2F;apt&#x2F;sources.list，加入以下内容"></a>1.编辑&#x2F;etc&#x2F;apt&#x2F;sources.list，加入以下内容</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"># Local Source 　　　　 #ip和port是自己本机的，其中端口默认为80<br>deb [arch=amd64] <span class="hljs-link">http://</span>[<span class="hljs-string">host</span>]:[port]/ubuntu/ trusty main restricted universe multiverse<br>deb [arch=amd64] <span class="hljs-link">http://</span>[<span class="hljs-string">host</span>]:[port]/ubuntu/ trusty-security main restricted universe multiverse<br>deb [arch=amd64] <span class="hljs-link">http://</span>[<span class="hljs-string">host</span>]:[port]/ubuntu/ trusty-updates main restricted universe multiverse<br>deb [arch=amd64] <span class="hljs-link">http://</span>[<span class="hljs-string">host</span>]:[port]/ubuntu/ trusty-proposed main restricted universe multiverse<br>deb [arch=amd64] <span class="hljs-link">http://</span>[<span class="hljs-string">host</span>]:[port]/ubuntu/ trusty-backports main restricted universe multiverse为80<br></code></pre></td></tr></table></figure><h3 id="2-更新apt-get源"><a href="#2-更新apt-get源" class="headerlink" title="2.更新apt-get源"></a>2.更新apt-get源</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">apt-<span class="hljs-keyword">get</span> update　　　　<span class="hljs-comment">#这步很重要</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Rocky</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Rocky</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>测试不同操作系统制作快照的时间</title>
    <link href="/2021/07/15/openstack/sp_time/"/>
    <url>/2021/07/15/openstack/sp_time/</url>
    
    <content type="html"><![CDATA[<p>Openstack命令行：</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">glance image-create<br></code></pre></td></tr></table></figure><p>调用novaclient API：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">novaclient<span class="hljs-selector-class">.servers</span>.create_image<br></code></pre></td></tr></table></figure><p>实例镜像状态变化：</p><p><strong>queued（已排队） -&gt; saving（保存中） -&gt; active（已运行） &#x2F; error（错误）</strong></p><p>系统 时间 详情 资源占用情况</p><hr><p>Centos7 17.6s queued: 10.5s 1VCPU 1G内存 10G磁盘 镜像磁盘745MB<br>saving: 6.3s 1网卡：虚拟业务</p><hr><p>Win7 3m46.4s queued: 2m 39.2s 1VCPU 1G内存 20G磁盘 镜像磁盘8.7GB<br>saving: 1m 6.6s 1网卡：虚拟管控</p><hr><p>凝思8 1m33s queued: 58.5s 2VCPU 2G内存 20G磁盘 镜像磁盘3.3GB<br>saving: 1m6.6s 1网卡：虚拟管控</p><hr><p>虚拟路由器 20.2s queued: 13.5s 1VCPU 1G内存 20G磁盘 镜像磁盘857MB<br>saving: 6.3s 4网卡：其它网络，虚拟管控，虚拟业务，虚拟业务</p><hr><p>pfSense 18.1s queued: 11.4s 2VCPU 2G内存 20G磁盘 镜像磁盘857MB<br>saving: 6.1s 4网卡：其它网络，虚拟管控，虚拟业务，虚拟业务</p><hr><p>纵向 17.1s queued: 11.5s 1VCPU 1G内存 10G磁盘 镜像磁盘652MB<br>saving: 5.3s 4网卡：虚拟业务，虚拟业务，虚拟管控，外部网络</p><hr><p>隔离 12.9s queued: 8.3s 1VCPU 1G内存 10G磁盘 镜像磁盘≈540MB<br>saving: 4.2s 5网卡：虚拟业务，虚拟业务，虚拟管控，虚拟业务，虚拟业务</p><hr><p>监测装置 39.1s queued: 27.2s 1VCPU 2G内存 25G磁盘 镜像磁盘1.4GB<br>saving: 11.5s 2网卡：虚拟业务，虚拟管控</p><hr><p>网安平台 13m3.3s queued: 7m3s 8VCPU 16G内存 100G磁盘 镜像磁盘21GB<br>saving: 5m59.7s 2网卡：虚拟业务，外部网络</p><hr><p>根据上述测试结果总结：<br>1、创建快照（制作镜像）所需时间与磁盘镜像占用空间大小成正比，<br>也就是说镜像占用磁盘空间越大，创建快照时间越长。<br>2、创建快照所需时间与实例类型及实例网卡个数无关。</p>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
      <tag>KVM</tag>
      
      <tag>快照</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>KVM安装凝思8解决鼠标漂移的问题</title>
    <link href="/2021/07/12/linux/rocky8_mouse/"/>
    <url>/2021/07/12/linux/rocky8_mouse/</url>
    
    <content type="html"><![CDATA[<p>KVM环境安装凝思8(V6.0.8)版本: Linx-6.0.80-20180821-amd64-DVD.iso<br>安装完成后，鼠标漂移严重，环境无法使用，解决方法如下:<br>需要在virt-manager修改虚拟机显卡配置项:</p><p><strong>1.显示协议</strong></p><p><strong>修改显示协议 由SPICE服务器 -&gt; VNC服务器</strong><br><img src="/images/display_protocol.png" alt="VNC"></p><p><strong>2.显卡</strong></p><p><strong>修改显卡 由 QXL -&gt; Cirrus</strong><br><img src="/images/display_card.png" alt="Cirrus"></p><p><strong>3.磁盘</strong></p><p><strong>磁盘 - 高级选项 - 磁盘总线 IDE -&gt; VirtIO</strong></p>]]></content>
    
    
    <categories>
      
      <category>凝思</category>
      
    </categories>
    
    
    <tags>
      
      <tag>凝思</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Openstack 虚拟机修改ERROR状态为ACTIVE</title>
    <link href="/2021/07/05/openstack/state_error/"/>
    <url>/2021/07/05/openstack/state_error/</url>
    
    <content type="html"><![CDATA[<p><strong>1.SSH登录Controller节点，执行授权脚本</strong></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">. /<span class="hljs-meta">opt</span>/kdpastack/admin-openrc<br></code></pre></td></tr></table></figure><p><strong>2.浏览器登录Openstack的WebUI：<a href="http://controller:10080/dashboard">http://controller:10080/dashboard</a></strong></p><p>进入项目 -&gt; 计算 -&gt; 实例，<br>筛选条件选择：状态&#x3D;， 筛选框中输入ERROR，筛选状态为错误的实例列表，<br>点击 实例名称 如：ps_T16Z2PS-SCENE32@-1，进入实例概况页面，<br>复制【ID】后面32位字符串。</p><p><strong>3.Controller节点，执行重置状态操作：</strong></p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">nova <span class="hljs-keyword">reset</span>-<span class="hljs-keyword">state</span> <span class="hljs-number">2</span>步复制的ID --active<br></code></pre></td></tr></table></figure><p><strong>4.Controller节点，执行将实例关机：</strong></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nova</span> stop <span class="hljs-number">2</span>步复制的ID<br></code></pre></td></tr></table></figure><p><strong>5.以上步骤结束后，登录实训平台，场景管理对应的场景页面，</strong></p><p>在场景中对此错误状态的实例进行开机操作，<br>*如果实例当前状态为开机，需先关机再开机。</p>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>FreeBSD更新pkg</title>
    <link href="/2021/06/16/linux/freebsd_pkg/"/>
    <url>/2021/06/16/linux/freebsd_pkg/</url>
    
    <content type="html"><![CDATA[<p><strong>1.PKG二进制仓储源文件存储目录 的使用方法</strong></p><p>系统中常用的PKG二进制仓储源文件存储目录有两个，一个是系统级仓储文件目录，另一个是用户级仓储文件目录，系统级仓储文件目录为 &#x2F;etc&#x2F;pkg&#x2F;， 而用户级别仓储文件目录为 &#x2F;usr&#x2F;local&#x2F;etc&#x2F;pkg&#x2F;repos&#x2F;，这个目录在默认情况下并不存在于系统中，需要用户手工建立，而这两个路径均由 &#x2F;usr&#x2F;local&#x2F;etc&#x2F;pkg.conf 中 REPOS_DIR 变量控制，原则上可以由用户自由定制。</p><p><strong>2. 建立通用户级PKG二进制仓储源文件存储目录</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> -p /usr/local/etc/pkg/repos</span><br></code></pre></td></tr></table></figure><p><strong>3. 建立常用的用户级PKG二进制仓储源文件</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">cd</span> /usr/local/etc/pkg/repos</span><br></code></pre></td></tr></table></figure><p>建立仓储源文件的格式要求为：必须使用 .conf 为后缀名结尾的文件。最好使用 “0.” 或者 “1-“ 等数字为前缀的文件名，因为同时启用多个 PKG 源文件时，PKG源文件名的第一个数字前缀直接影响着源的使用优先级，其文件格式的建立如下：</p><p>定制第一个仓储文件为 0.bme.conf</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">bme:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-symbol">  url:</span> <span class="hljs-string">&quot;pkg+http://pkg0.bme.freebsd.org/$&#123;ABI&#125;/quarterly&quot;</span>,<br><span class="hljs-symbol">  mirror_type:</span> <span class="hljs-string">&quot;srv&quot;</span>,<br><span class="hljs-symbol">  signature_type:</span> <span class="hljs-string">&quot;none&quot;</span>,<br><span class="hljs-symbol">  fingerprints:</span> <span class="hljs-string">&quot;/usr/share/keys/pkg&quot;</span>,<br><span class="hljs-symbol">  enabled:</span> yes<br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>定制第二个仓储文件为 1.nyi.conf</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">nyi:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-symbol">  url:</span> <span class="hljs-string">&quot;pkg+http://pkg0.nyi.freebsd.org/$&#123;ABI&#125;/quarterly&quot;</span>,<br><span class="hljs-symbol">  mirror_type:</span> <span class="hljs-string">&quot;srv&quot;</span>,<br><span class="hljs-symbol">  signature_type:</span> <span class="hljs-string">&quot;none&quot;</span>,<br><span class="hljs-symbol">  fingerprints:</span> <span class="hljs-string">&quot;/usr/share/keys/pkg&quot;</span>,<br><span class="hljs-symbol">  enabled:</span> yes<br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>定制第三个仓储文件为 2.ydx.conf</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">ydx:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-symbol">  url:</span> <span class="hljs-string">&quot;pkg+http://pkg0.ydx.freebsd.org/$&#123;ABI&#125;/quarterly&quot;</span>,<br><span class="hljs-symbol">  mirror_type:</span> <span class="hljs-string">&quot;srv&quot;</span>,<br><span class="hljs-symbol">  signature_type:</span> <span class="hljs-string">&quot;none&quot;</span>,<br><span class="hljs-symbol">  fingerprints:</span> <span class="hljs-string">&quot;/usr/share/keys/pkg&quot;</span>,<br><span class="hljs-symbol">  enabled:</span> yes<br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>定制第四个仓储文件为 3.isc.conf</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">isc:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-symbol">  url:</span> <span class="hljs-string">&quot;pkg+http://pkg0.isc.freebsd.org/$&#123;ABI&#125;/quarterly&quot;</span>,<br><span class="hljs-symbol">  mirror_type:</span> <span class="hljs-string">&quot;srv&quot;</span>,<br><span class="hljs-symbol">  signature_type:</span> <span class="hljs-string">&quot;none&quot;</span>,<br><span class="hljs-symbol">  fingerprints:</span> <span class="hljs-string">&quot;/usr/share/keys/pkg&quot;</span>,<br><span class="hljs-symbol">  enabled:</span> yes<br><span class="hljs-punctuation">&#125;</span><br>定制第五个仓储文件为 <span class="hljs-number">4.</span>chinafreebsd.conf<br><span class="hljs-symbol"></span><br><span class="hljs-symbol">chinafreebsd:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-symbol">  url:</span> <span class="hljs-string">&quot;pkg+http://pkg.reebsd.cn/$&#123;ABI&#125;/quarterly&quot;</span>,<br><span class="hljs-symbol">  mirror_type:</span> <span class="hljs-string">&quot;srv&quot;</span>,<br><span class="hljs-symbol">  signature_type:</span> <span class="hljs-string">&quot;none&quot;</span>,<br><span class="hljs-symbol">  fingerprints:</span> <span class="hljs-string">&quot;/usr/share/keys/pkg&quot;</span>,<br><span class="hljs-symbol">  enabled:</span> yes<br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>重要:<br>建议只选用一个最快的PKG源，而不是同时启用多个，如果同时启用了多个 PKG 源，那么在安装软件包或升级 PKG 源时候请使用 -r 选项指定要操作的 PKG 源。<br>比如：pkg update -r chinafreebsd 或者 pkg install -r chinafreebsd -y xxxx 。</p><p><strong>4. 禁用默认 PKG 仓储源</strong></p><p>可以直接禁用系统级源文件，换源的主要目的是增加 pkg install 命令下载速度，或者是不能忍受默认源的龟速，用户可以直接禁用系统默认的官方源。比如：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"># echo <span class="hljs-string">&quot;FreeBSD: &#123; enabled: no &#125;&quot;</span> &gt; <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/etc/</span>pkg<span class="hljs-regexp">/repos/</span>FreeBSD.conf<br></code></pre></td></tr></table></figure><p>注意:<br>此步骤不是必须，如果保留系统仓储源文件，则系统默认源将和用户源一同有效</p><p><strong>5. 更新源</strong><br>所有源在使用前最好进行一次强制更新。比如：</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs erlang"># pkg update -f Updating nyi repository catalogue...<br>Fetching meta.txz: <span class="hljs-number">100</span><span class="hljs-comment">%    944 B   0.9kB/s    00:01</span><br>Fetching packagesite.txz: <span class="hljs-number">100</span><span class="hljs-comment">%    6 MiB 268.1kB/s    00:22</span><br>Processing entries: <span class="hljs-number">100</span><span class="hljs-comment">%</span><br>nyi repository update completed. <span class="hljs-number">25828</span> packages processed.<br>Updating ydx repository catalogue...<br>Fetching meta.txz: <span class="hljs-number">100</span><span class="hljs-comment">%    944 B   0.9kB/s    00:01</span><br>Fetching packagesite.txz: <span class="hljs-number">100</span><span class="hljs-comment">%    1 KiB   0.0kB/s    01:00</span><br>......<br></code></pre></td></tr></table></figure><p>或者更新某个想要使用的源。比如：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># pkg update -r bme Updating bme repository catalogue...</span><br><span class="hljs-attribute">Fetching</span> meta.txz: <span class="hljs-number">100</span>%    <span class="hljs-number">944</span> B   <span class="hljs-number">0</span>.<span class="hljs-number">9</span>kB/s    <span class="hljs-number">00</span>:<span class="hljs-number">01</span><br><span class="hljs-attribute">Fetching</span> packagesite.txz: <span class="hljs-number">100</span>%    <span class="hljs-number">6</span> MiB <span class="hljs-number">268</span>.<span class="hljs-number">1</span>kB/s    <span class="hljs-number">00</span>:<span class="hljs-number">22</span><br><span class="hljs-attribute">Processing</span> entries: <span class="hljs-number">100</span>%<br><span class="hljs-attribute">bme</span> repository update completed. <span class="hljs-number">25828</span> packages processed.<br></code></pre></td></tr></table></figure><p><strong>6. 验证当前生效源</strong></p><p>使用 pkg -vv 命令可以打印当前 PKG 的配置信息，以及所有生效源配置，例如：</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"># pkg -vv Version                 : <span class="hljs-number">1.8</span>.<span class="hljs-number">8</span><br>PKG_DBDIR = <span class="hljs-string">&quot;/var/db/pkg&quot;</span>;<br>PKG_CACHEDIR = <span class="hljs-string">&quot;/var/cache/pkg&quot;</span>;<br>PORTSDIR = <span class="hljs-string">&quot;/usr/ports&quot;</span>;<br>INDEXDIR = <span class="hljs-string">&quot;&quot;</span>;<br>INDEXFILE = <span class="hljs-string">&quot;INDEX-11&quot;</span>;<br>HANDLE_RC_SCRIPTS = <span class="hljs-literal">false</span>;<br>DEFAULT_ALWAYS_YES = <span class="hljs-literal">false</span>;<br>ASSUME_ALWAYS_YES = <span class="hljs-literal">false</span>;<br>REPOS_DIR [<br>    <span class="hljs-string">&quot;/etc/pkg/&quot;</span>,<br>    <span class="hljs-string">&quot;/usr/local/etc/pkg/repos/&quot;</span>,<br>]<br>PLIST_KEYWORDS_DIR = <span class="hljs-string">&quot;&quot;</span>;<br>SYSLOG = <span class="hljs-literal">true</span>;<br>ABI = <span class="hljs-string">&quot;FreeBSD:11:amd64&quot;</span>;<br>ALTABI = <span class="hljs-string">&quot;freebsd:11:x86:64&quot;</span>;<br>DEVELOPER_MODE = <span class="hljs-literal">false</span>;<br>VULNXML_SITE = <span class="hljs-string">&quot;http://vuxml.freebsd.org/freebsd/vuln.xml.bz2&quot;</span>;<br>FETCH_RETRY = <span class="hljs-number">3</span>;<br>PKG_PLUGINS_DIR = <span class="hljs-string">&quot;/usr/local/lib/pkg/&quot;</span>;<br>PKG_ENABLE_PLUGINS = <span class="hljs-literal">true</span>;<br>PLUGINS [<br>]<br>DEBUG_SCRIPTS = <span class="hljs-literal">false</span>;<br>PLUGINS_CONF_DIR = <span class="hljs-string">&quot;/usr/local/etc/pkg/&quot;</span>;<br>PERMISSIVE = <span class="hljs-literal">false</span>;<br>REPO_AUTOUPDATE = <span class="hljs-literal">true</span>;<br>NAMESERVER = <span class="hljs-string">&quot;&quot;</span>;<br>HTTP_USER_AGENT = <span class="hljs-string">&quot;pkg/1.8.8&quot;</span>;<br>EVENT_PIPE = <span class="hljs-string">&quot;&quot;</span>;<br>FETCH_TIMEOUT = <span class="hljs-number">30</span>;<br>UNSET_TIMESTAMP = <span class="hljs-literal">false</span>;<br>SSH_RESTRICT_DIR = <span class="hljs-string">&quot;&quot;</span>;<br>PKG_ENV &#123;<br>&#125;<br>PKG_SSH_ARGS = <span class="hljs-string">&quot;&quot;</span>;<br>DEBUG_LEVEL = <span class="hljs-number">0</span>;<br>ALIAS &#123;<br>    all-depends = <span class="hljs-string">&quot;query %dn-%dv&quot;</span>;<br>    annotations = <span class="hljs-string">&quot;info -A&quot;</span>;<br>    build-depends = <span class="hljs-string">&quot;info -qd&quot;</span>;<br>    cinfo = <span class="hljs-string">&quot;info -Cx&quot;</span>;<br>    comment = <span class="hljs-string">&quot;query -i \&quot;%c\&quot;&quot;</span>;<br>    csearch = <span class="hljs-string">&quot;search -Cx&quot;</span>;<br>    desc = <span class="hljs-string">&quot;query -i \&quot;%e\&quot;&quot;</span>;<br>    download = <span class="hljs-string">&quot;fetch&quot;</span>;<br>    iinfo = <span class="hljs-string">&quot;info -ix&quot;</span>;<br>    isearch = <span class="hljs-string">&quot;search -ix&quot;</span>;<br>    prime-list = <span class="hljs-string">&quot;query -e &#x27;%a = 0&#x27; &#x27;%n&#x27;&quot;</span>;<br>    leaf = <span class="hljs-string">&quot;query -e &#x27;%#r == 0&#x27; &#x27;%n-%v&#x27;&quot;</span>;<br>    list = <span class="hljs-string">&quot;info -ql&quot;</span>;<br>    noauto = <span class="hljs-string">&quot;query -e &#x27;%a == 0&#x27; &#x27;%n-%v&#x27;&quot;</span>;<br>    options = <span class="hljs-string">&quot;query -i \&quot;%n - %Ok: %Ov\&quot;&quot;</span>;<br>    origin = <span class="hljs-string">&quot;info -qo&quot;</span>;<br>    provided-depends = <span class="hljs-string">&quot;info -qb&quot;</span>;<br>    raw = <span class="hljs-string">&quot;info -R&quot;</span>;<br>    <span class="hljs-keyword">required</span>-depends = <span class="hljs-string">&quot;info -qr&quot;</span>;<br>    roptions = <span class="hljs-string">&quot;rquery -i \&quot;%n - %Ok: %Ov\&quot;&quot;</span>;<br>    shared-depends = <span class="hljs-string">&quot;info -qB&quot;</span>;<br>    show = <span class="hljs-string">&quot;info -f -k&quot;</span>;<br>    size = <span class="hljs-string">&quot;info -sq&quot;</span>;<br>&#125;<br>CUDF_SOLVER = <span class="hljs-string">&quot;&quot;</span>;<br>SAT_SOLVER = <span class="hljs-string">&quot;&quot;</span>;<br>RUN_SCRIPTS = <span class="hljs-literal">true</span>;<br>CASE_SENSITIVE_MATCH = <span class="hljs-literal">false</span>;<br>LOCK_WAIT = <span class="hljs-number">1</span>;<br>LOCK_RETRIES = <span class="hljs-number">5</span>;<br>SQLITE_PROFILE = <span class="hljs-literal">false</span>;<br>WORKERS_COUNT = <span class="hljs-number">0</span>;<br>READ_LOCK = <span class="hljs-literal">false</span>;<br>PLIST_ACCEPT_DIRECTORIES = <span class="hljs-literal">false</span>;<br>IP_VERSION = <span class="hljs-number">0</span>;<br>AUTOMERGE = <span class="hljs-literal">true</span>;<br>VERSION_SOURCE = <span class="hljs-string">&quot;&quot;</span>;<br>CONSERVATIVE_UPGRADE = <span class="hljs-literal">true</span>;<br>PKG_CREATE_VERBOSE = <span class="hljs-literal">false</span>;<br>AUTOCLEAN = <span class="hljs-literal">false</span>;<br>DOT_FILE = <span class="hljs-string">&quot;&quot;</span>;<br>REPOSITORIES &#123;<br>&#125;<br>VALID_URL_SCHEME [<br>    <span class="hljs-string">&quot;pkg+http&quot;</span>,<br>    <span class="hljs-string">&quot;pkg+https&quot;</span>,<br>    <span class="hljs-string">&quot;https&quot;</span>,<br>    <span class="hljs-string">&quot;http&quot;</span>,<br>    <span class="hljs-string">&quot;file&quot;</span>,<br>    <span class="hljs-string">&quot;ssh&quot;</span>,<br>    <span class="hljs-string">&quot;ftp&quot;</span>,<br>    <span class="hljs-string">&quot;ftps&quot;</span>,<br>    <span class="hljs-string">&quot;pkg+ssh&quot;</span>,<br>    <span class="hljs-string">&quot;pkg+ftp&quot;</span>,<br>    <span class="hljs-string">&quot;pkg+ftps&quot;</span>,<br>]<br>ALLOW_BASE_SHLIBS = <span class="hljs-literal">false</span>;<br>WARN_SIZE_LIMIT = <span class="hljs-number">1048576</span>;<br><br><br>Repositories:<br>  bme: &#123;<br>    url             : <span class="hljs-string">&quot;pkg+http://pkg0.bme.freebsd.org/FreeBSD:11:amd64/quarterly&quot;</span>,<br>    enabled         : yes,<br>    priority        : <span class="hljs-number">0</span>,<br>    mirror_type     : <span class="hljs-string">&quot;SRV&quot;</span>,<br>    fingerprints    : <span class="hljs-string">&quot;/usr/share/keys/pkg&quot;</span><br>  &#125;<br>  nyi: &#123;<br>    url             : <span class="hljs-string">&quot;pkg+http://pkg0.nyi.freebsd.org/FreeBSD:11:amd64/quarterly&quot;</span>,<br>    enabled         : yes,<br>    priority        : <span class="hljs-number">0</span>,<br>    mirror_type     : <span class="hljs-string">&quot;SRV&quot;</span>,<br>    fingerprints    : <span class="hljs-string">&quot;/usr/share/keys/pkg&quot;</span><br>  &#125;<br>  ydx: &#123;<br>    url             : <span class="hljs-string">&quot;pkg+http://pkg0.ydx.freebsd.org/FreeBSD:11:amd64/quarterly&quot;</span>,<br>    enabled         : yes,<br>    priority        : <span class="hljs-number">0</span>,<br>    mirror_type     : <span class="hljs-string">&quot;SRV&quot;</span>,<br>    fingerprints    : <span class="hljs-string">&quot;/usr/share/keys/pkg&quot;</span><br>  &#125;<br>  isc: &#123;<br>    url             : <span class="hljs-string">&quot;pkg+http://pkg0.isc.freebsd.org/FreeBSD:11:amd64/quarterly&quot;</span>,<br>    enabled         : yes,<br>    priority        : <span class="hljs-number">0</span>,<br>    mirror_type     : <span class="hljs-string">&quot;SRV&quot;</span>,<br>    fingerprints    : <span class="hljs-string">&quot;/usr/share/keys/pkg&quot;</span><br>  &#125;<br>  chinafreebsd: &#123;<br>    url             : <span class="hljs-string">&quot;pkg+http://pkg.freebsd.cn/FreeBSD:11:amd64/quarterly&quot;</span>,<br>    enabled         : yes,<br>    priority        : <span class="hljs-number">0</span>,<br>    mirror_type     : <span class="hljs-string">&quot;SRV&quot;</span>,<br>    fingerprints    : <span class="hljs-string">&quot;/usr/share/keys/pkg&quot;</span><br>  &#125;<br></code></pre></td></tr></table></figure><p><strong>7. 用 -r 选项使用任意指定源安装软件</strong></p><p>安装二进制安装包时可以使用 -r 选项选定要使用的源，源名称为源文件中第一行中冒号之前的名称 比如 bme</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># pkg install -y -r bme vim-lite</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>libguestfs 简介</title>
    <link href="/2021/02/23/tools/libguestfs/"/>
    <url>/2021/02/23/tools/libguestfs/</url>
    
    <content type="html"><![CDATA[<p><strong>简介</strong></p><p>使用 libguestfs 实现宿主机与虚拟机的文件传输。</p><p>libguestfs 是一组 Linux 下的 C 语言的 API ，用来访问虚拟机的磁盘映像文件。</p><p>其项目主页是<a href="http://libguestfs.org/">http://libguestfs.org/</a> ，该工具包内包含的工具有virt-cat、virt-df、virt-ls、virt-copy-in、virt-copy-out、virt- edit、guestfs、guestmount、virt-list-filesystems、virt-list-partitions等工具，具体 用法也可以参看官网。该工具可以在不启动KVM guest主机的情况下，直接查看guest主机内的文内容，也可以直接向img镜像中写入文件和复制文件到外面的物理机，当然其也可以像mount一 样，支持挂载操作。</p><p><strong>安装</strong></p><p>计算节点安装libguestfs</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@compute</span> ~]<span class="hljs-meta"># yum -y install libguestfs-tools</span><br></code></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-meta"># 对于windows虚拟机的支持</span><br>[root<span class="hljs-symbol">@compute</span> ~]<span class="hljs-meta"># yum -y install libguestfs-winsupport</span><br></code></pre></td></tr></table></figure><p>命令列表</p><p><strong>libguestfs命令</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">root@compute144:~ # virt-<br>virt-alignment-scan      virt-customize           virt-host-<span class="hljs-keyword">validate</span>       virt-pki-<span class="hljs-keyword">validate</span>        virt-tar-<span class="hljs-keyword">out</span><br>virt-builder             virt-df                  virt-<span class="hljs-keyword">index</span>-<span class="hljs-keyword">validate</span>      virt-rescue              virt-what<br>virt-builder-repository  virt-diff                virt-inspector           virt-resize              virt-win-reg<br>virt-cat                 virt-edit                virt-install             virt-sparsify            virt-<span class="hljs-type">xml</span><br>virt-clone               virt-filesystems         virt-<span class="hljs-keyword">log</span>                 virt-sysprep             virt-<span class="hljs-type">xml</span>-<span class="hljs-keyword">validate</span><br>virt-<span class="hljs-keyword">copy</span>-<span class="hljs-keyword">in</span>             virt-<span class="hljs-keyword">format</span>              virt-ls                  virt-tail<br>virt-<span class="hljs-keyword">copy</span>-<span class="hljs-keyword">out</span>            virt-<span class="hljs-keyword">get</span>-kernel          virt-make-fs             virt-tar-<span class="hljs-keyword">in</span><br></code></pre></td></tr></table></figure><p><strong>virt-ls： 可以列出虚拟机中目录下的文件或目录</strong></p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@compute144</span><span class="hljs-symbol">:~</span> <span class="hljs-comment"># virt-ls -d instance-00001445 /home/</span><br>agent_linux<br>ftpuser<br>kedong<br></code></pre></td></tr></table></figure><p><strong>virt-cat： 可以查看虚拟机中文件的内容</strong></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs ruby">root<span class="hljs-variable">@compute144</span><span class="hljs-symbol">:~</span> <span class="hljs-comment"># virt-cat -d instance-00001445 /etc/passwd</span><br><span class="hljs-symbol">root:</span><span class="hljs-symbol">x:</span><span class="hljs-number">0</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span><span class="hljs-symbol">:root</span><span class="hljs-symbol">:/root</span><span class="hljs-symbol">:/bin/bash</span><br><span class="hljs-symbol">bin:</span><span class="hljs-symbol">x:</span><span class="hljs-number">1</span><span class="hljs-symbol">:</span><span class="hljs-number">1</span><span class="hljs-symbol">:bin</span><span class="hljs-symbol">:/bin</span><span class="hljs-symbol">:/sbin/nologin</span><br><span class="hljs-symbol">daemon:</span><span class="hljs-symbol">x:</span><span class="hljs-number">2</span><span class="hljs-symbol">:</span><span class="hljs-number">2</span><span class="hljs-symbol">:daemon</span><span class="hljs-symbol">:/sbin</span><span class="hljs-symbol">:/sbin/nologin</span><br><span class="hljs-symbol">adm:</span><span class="hljs-symbol">x:</span><span class="hljs-number">3</span><span class="hljs-symbol">:</span><span class="hljs-number">4</span><span class="hljs-symbol">:adm</span><span class="hljs-symbol">:/var/adm</span><span class="hljs-symbol">:/sbin/nologin</span><br><span class="hljs-symbol">lp:</span><span class="hljs-symbol">x:</span><span class="hljs-number">4</span><span class="hljs-symbol">:</span><span class="hljs-number">7</span><span class="hljs-symbol">:lp</span><span class="hljs-symbol">:/var/spool/lpd</span><span class="hljs-symbol">:/sbin/nologin</span><br><span class="hljs-symbol">sync:</span><span class="hljs-symbol">x:</span><span class="hljs-number">5</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span><span class="hljs-symbol">:sync</span><span class="hljs-symbol">:/sbin</span><span class="hljs-symbol">:/bin/sync</span><br><span class="hljs-symbol">shutdown:</span><span class="hljs-symbol">x:</span><span class="hljs-number">6</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span><span class="hljs-symbol">:shutdown</span><span class="hljs-symbol">:/sbin</span><span class="hljs-symbol">:/sbin/shutdown</span><br><span class="hljs-symbol">halt:</span><span class="hljs-symbol">x:</span><span class="hljs-number">7</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span><span class="hljs-symbol">:halt</span><span class="hljs-symbol">:/sbin</span><span class="hljs-symbol">:/sbin/halt</span><br><span class="hljs-symbol">mail:</span><span class="hljs-symbol">x:</span><span class="hljs-number">8</span><span class="hljs-symbol">:</span><span class="hljs-number">12</span><span class="hljs-symbol">:mail</span><span class="hljs-symbol">:/var/spool/mail</span><span class="hljs-symbol">:/sbin/nologin</span><br><span class="hljs-symbol">operator:</span><span class="hljs-symbol">x:</span><span class="hljs-number">11</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span><span class="hljs-symbol">:operator</span><span class="hljs-symbol">:/root</span><span class="hljs-symbol">:/sbin/nologin</span><br><span class="hljs-symbol">games:</span><span class="hljs-symbol">x:</span><span class="hljs-number">12</span><span class="hljs-symbol">:</span><span class="hljs-number">100</span><span class="hljs-symbol">:games</span><span class="hljs-symbol">:/usr/games</span><span class="hljs-symbol">:/sbin/nologin</span><br><span class="hljs-symbol">ftp:</span><span class="hljs-symbol">x:</span><span class="hljs-number">14</span><span class="hljs-symbol">:</span><span class="hljs-number">50</span><span class="hljs-symbol">:FTP</span> <span class="hljs-title class_">User</span><span class="hljs-symbol">:/var/ftp</span><span class="hljs-symbol">:/sbin/nologin</span><br></code></pre></td></tr></table></figure><p><strong>virt-df： 将在虚拟机中执行df命令的结果输出</strong></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">root</span>@compute144:~ # virt-df -d instance-<span class="hljs-number">00001445</span><br><span class="hljs-attribute">Filesystem</span>                           <span class="hljs-number">1</span>K-blocks       Used  Available  Use%<br><span class="hljs-attribute">instance</span>-<span class="hljs-number">00001445</span>:/dev/sdb                 <span class="hljs-number">490</span>        <span class="hljs-number">490</span>          <span class="hljs-number">0</span>  <span class="hljs-number">100</span>%<br><span class="hljs-attribute">instance</span>-<span class="hljs-number">00001445</span>:/dev/sda1            <span class="hljs-number">1038336</span>     <span class="hljs-number">100948</span>     <span class="hljs-number">937388</span>   <span class="hljs-number">10</span>%<br><span class="hljs-attribute">instance</span>-<span class="hljs-number">00001445</span>:/dev/centos/root     <span class="hljs-number">2238464</span>    <span class="hljs-number">1897392</span>     <span class="hljs-number">341072</span>   <span class="hljs-number">85</span>%<br></code></pre></td></tr></table></figure><p><strong>virt-copy-in：将文件复制到虚拟机里面</strong></p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs stata">virt-<span class="hljs-keyword">copy</span>-<span class="hljs-keyword">in</span> - <span class="hljs-keyword">Copy</span> files and directories into a virtual machine disk image.<br><br>SYNOPSIS<br> virt-<span class="hljs-keyword">copy</span>-<span class="hljs-keyword">in</span> -a disk.img <span class="hljs-keyword">file</span>|<span class="hljs-keyword">dir</span> [<span class="hljs-keyword">file</span>|<span class="hljs-keyword">dir</span> ...] /destination<br><br> virt-<span class="hljs-keyword">copy</span>-<span class="hljs-keyword">in</span> -<span class="hljs-keyword">d</span> domain <span class="hljs-keyword">file</span>|<span class="hljs-keyword">dir</span> [<span class="hljs-keyword">file</span>|<span class="hljs-keyword">dir</span> ...] /destination<br>WARNING<br>Using virt-<span class="hljs-keyword">copy</span>-<span class="hljs-keyword">in</span> <span class="hljs-keyword">on</span> live virtual machines, or concurrently with other disk editing tools, can be dangerous, potentially causing disk corruption. The virtual machine must be shut down before you <span class="hljs-keyword">use</span> this command, and disk images must not be edited concurrently.<br><br>DESCRIPTION<br>virt-<span class="hljs-keyword">copy</span>-<span class="hljs-keyword">in</span> copies files and directories from the <span class="hljs-keyword">local</span> disk into a virtual machine disk image or named libvirt domain.<br><br>You can give <span class="hljs-keyword">one</span> or <span class="hljs-keyword">more</span> filenames and directories <span class="hljs-keyword">on</span> the command <span class="hljs-keyword">line</span>. Directories are copied <span class="hljs-keyword">in</span> recursively. The final parameter must be the destination directory <span class="hljs-keyword">in</span> the disk image <span class="hljs-keyword">which</span> must be <span class="hljs-keyword">an</span> absolute path starting with a / character.<br><br>EXAMPLES<br><span class="hljs-keyword">Update</span> /etc/resolv.<span class="hljs-keyword">conf</span> <span class="hljs-keyword">in</span> a guest:<br><br> virt-<span class="hljs-keyword">copy</span>-<span class="hljs-keyword">in</span> -<span class="hljs-keyword">d</span> MyGuest resolv.<span class="hljs-keyword">conf</span> /etc<br>Upload a home directory to a guest:<br><br> virt-<span class="hljs-keyword">copy</span>-<span class="hljs-keyword">in</span> -<span class="hljs-keyword">d</span> MyGuest skel /home<br>JUST A <span class="hljs-keyword">SHELL</span> SCRIPT WRAPPER AROUND GUESTFISH<br>This command is just a simple <span class="hljs-keyword">shell</span> script wrapper around the guestfish(1) <span class="hljs-keyword">copy</span>-<span class="hljs-keyword">in</span> command. <span class="hljs-keyword">For</span> anything <span class="hljs-keyword">more</span> complex than a trivial <span class="hljs-keyword">copy</span>, you are probably better off using guestfish directly.<br><br>OPTIONS<br>Since the <span class="hljs-keyword">shell</span> script just passes options straight to guestfish, <span class="hljs-keyword">read</span> guestfish(1) to see the full <span class="hljs-keyword">list</span> of options.<br><br>SEE ALSO<br>guestfish(1), virt-<span class="hljs-keyword">cat</span>(1), virt-<span class="hljs-keyword">copy</span>-<span class="hljs-keyword">out</span>(1), virt-<span class="hljs-keyword">edit</span>(1), virt-tar-<span class="hljs-keyword">in</span>(1), virt-tar-<span class="hljs-keyword">out</span>(1), http:<span class="hljs-comment">//libguestfs.org/.</span><br><br>AUTHORS<br>Richard W.<span class="hljs-keyword">M</span>. Jones (rjones at redhat dot com)<br><br><span class="hljs-keyword">COPYRIGHT</span><br><span class="hljs-keyword">Copyright</span> (C) 2011-2012 Red Hat Inc.<br><br>LICENSE<br>This <span class="hljs-keyword">program</span> is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License <span class="hljs-keyword">as</span> published <span class="hljs-keyword">by</span> the Free Software Foundation; either <span class="hljs-keyword">version</span> 2 of the License, or (at your option) any later <span class="hljs-keyword">version</span>.<br><br>This <span class="hljs-keyword">program</span> is distributed <span class="hljs-keyword">in</span> the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS <span class="hljs-keyword">FOR</span> A PARTICULAR PURPOSE. See the GNU General Public License <span class="hljs-keyword">for</span> <span class="hljs-keyword">more</span> details.<br><br>You should have received a <span class="hljs-keyword">copy</span> of the GNU General Public License along with this <span class="hljs-keyword">program</span>; <span class="hljs-keyword">if</span> not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, <span class="hljs-keyword">MA</span> 02110-1301 USA.<br><br>BUGS<br>To get a <span class="hljs-keyword">list</span> of bugs against libguestfs, <span class="hljs-keyword">use</span> this link: https:<span class="hljs-comment">//bugzilla.redhat.com/buglist.cgi?component=libguestfs&amp;product=Virtualization+Tools</span><br><br>To <span class="hljs-keyword">report</span> a new bug against libguestfs, <span class="hljs-keyword">use</span> this link: https:<span class="hljs-comment">//bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&amp;product=Virtualization+Tools</span><br><br>When reporting a bug, please supply:<br><br>The <span class="hljs-keyword">version</span> of libguestfs.<br><br>Where you got libguestfs (eg. <span class="hljs-keyword">which</span> Linux distro, compiled from source, etc)<br><br><span class="hljs-keyword">Describe</span> the bug accurately and give a way to reproduce it.<br><br><span class="hljs-keyword">Run</span> libguestfs-<span class="hljs-keyword">test</span>-tool(1) and paste the complete, unedited output into the bug <span class="hljs-keyword">report</span>.<br></code></pre></td></tr></table></figure><p><strong>virt-copy-out： 可以把虚拟机里的文件复制出来到本地主机</strong></p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs stata">virt-<span class="hljs-keyword">copy</span>-<span class="hljs-keyword">out</span> - <span class="hljs-keyword">Copy</span> files and directories <span class="hljs-keyword">out</span> of a virtual machine disk image.<br><br>SYNOPSIS<br> virt-<span class="hljs-keyword">copy</span>-<span class="hljs-keyword">out</span> -a disk.img /<span class="hljs-keyword">file</span>|<span class="hljs-keyword">dir</span> [/<span class="hljs-keyword">file</span>|<span class="hljs-keyword">dir</span> ...] localdir<br><br> virt-<span class="hljs-keyword">copy</span>-<span class="hljs-keyword">out</span> -<span class="hljs-keyword">d</span> domain /<span class="hljs-keyword">file</span>|<span class="hljs-keyword">dir</span> [/<span class="hljs-keyword">file</span>|<span class="hljs-keyword">dir</span> ...] localdir<br>DESCRIPTION<br>virt-<span class="hljs-keyword">copy</span>-<span class="hljs-keyword">out</span> copies files and directories <span class="hljs-keyword">out</span> of a virtual machine disk image or named libvirt domain.<br><br>You can give <span class="hljs-keyword">one</span> or <span class="hljs-keyword">more</span> filenames and directories <span class="hljs-keyword">on</span> the command <span class="hljs-keyword">line</span>. Directories are copied <span class="hljs-keyword">out</span> recursively.<br><br>EXAMPLES<br>Download the home directories from a virtual machine:<br><br> <span class="hljs-keyword">mkdir</span> homes<br> virt-<span class="hljs-keyword">copy</span>-<span class="hljs-keyword">out</span> -<span class="hljs-keyword">d</span> MyGuest /home homes<br>JUST A <span class="hljs-keyword">SHELL</span> SCRIPT WRAPPER AROUND GUESTFISH<br>This command is just a simple <span class="hljs-keyword">shell</span> script wrapper around the guestfish(1) <span class="hljs-keyword">copy</span>-<span class="hljs-keyword">out</span> command. <span class="hljs-keyword">For</span> anything <span class="hljs-keyword">more</span> complex than a trivial <span class="hljs-keyword">copy</span>, you are probably better off using guestfish directly.<br><br>OPTIONS<br>Since the <span class="hljs-keyword">shell</span> script just passes options straight to guestfish, <span class="hljs-keyword">read</span> guestfish(1) to see the full <span class="hljs-keyword">list</span> of options.<br><br>SEE ALSO<br>guestfish(1), virt-<span class="hljs-keyword">cat</span>(1), virt-<span class="hljs-keyword">copy</span>-<span class="hljs-keyword">in</span>(1), virt-<span class="hljs-keyword">edit</span>(1), virt-tar-<span class="hljs-keyword">in</span>(1), virt-tar-<span class="hljs-keyword">out</span>(1), http:<span class="hljs-comment">//libguestfs.org/.</span><br><br>AUTHORS<br>Richard W.<span class="hljs-keyword">M</span>. Jones (rjones at redhat dot com)<br><br><span class="hljs-keyword">COPYRIGHT</span><br><span class="hljs-keyword">Copyright</span> (C) 2011-2012 Red Hat Inc.<br><br>LICENSE<br>This <span class="hljs-keyword">program</span> is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License <span class="hljs-keyword">as</span> published <span class="hljs-keyword">by</span> the Free Software Foundation; either <span class="hljs-keyword">version</span> 2 of the License, or (at your option) any later <span class="hljs-keyword">version</span>.<br><br>This <span class="hljs-keyword">program</span> is distributed <span class="hljs-keyword">in</span> the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS <span class="hljs-keyword">FOR</span> A PARTICULAR PURPOSE. See the GNU General Public License <span class="hljs-keyword">for</span> <span class="hljs-keyword">more</span> details.<br><br>You should have received a <span class="hljs-keyword">copy</span> of the GNU General Public License along with this <span class="hljs-keyword">program</span>; <span class="hljs-keyword">if</span> not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, <span class="hljs-keyword">MA</span> 02110-1301 USA.<br><br>BUGS<br>To get a <span class="hljs-keyword">list</span> of bugs against libguestfs, <span class="hljs-keyword">use</span> this link: https:<span class="hljs-comment">//bugzilla.redhat.com/buglist.cgi?component=libguestfs&amp;product=Virtualization+Tools</span><br><br>To <span class="hljs-keyword">report</span> a new bug against libguestfs, <span class="hljs-keyword">use</span> this link: https:<span class="hljs-comment">//bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&amp;product=Virtualization+Tools</span><br><br>When reporting a bug, please supply:<br><br>The <span class="hljs-keyword">version</span> of libguestfs.<br><br>Where you got libguestfs (eg. <span class="hljs-keyword">which</span> Linux distro, compiled from source, etc)<br><br><span class="hljs-keyword">Describe</span> the bug accurately and give a way to reproduce it.<br><br><span class="hljs-keyword">Run</span> libguestfs-<span class="hljs-keyword">test</span>-tool(1) and paste the complete, unedited output into the bug <span class="hljs-keyword">report</span>.<br></code></pre></td></tr></table></figure><p><strong>系统组件适配</strong></p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">系统组件适配 virt</span><span class="hljs-literal">-</span><span class="hljs-comment">copy</span><span class="hljs-literal">-</span><span class="hljs-comment">in virt</span><span class="hljs-literal">-</span><span class="hljs-comment">copy</span><span class="hljs-literal">-</span><span class="hljs-comment">out 备注</span><br><span class="hljs-literal">----------</span> <span class="hljs-literal">------------</span> <span class="hljs-literal">-------------</span> <span class="hljs-literal">----------------------------------------</span><br><span class="hljs-comment">Win7            √             √         目前查到只支持传输到根目录 / 下 ，也就是C盘</span><br><span class="hljs-literal">----------</span> <span class="hljs-literal">------------</span> <span class="hljs-literal">-------------</span> <span class="hljs-literal">----------------------------------------</span><br><span class="hljs-comment">Centos7         √             √</span><br><span class="hljs-literal">----------</span> <span class="hljs-literal">------------</span> <span class="hljs-literal">-------------</span> <span class="hljs-literal">----------------------------------------</span><br><span class="hljs-comment">Ubuntu16        √             √</span><br><span class="hljs-literal">----------</span> <span class="hljs-literal">------------</span> <span class="hljs-literal">-------------</span> <span class="hljs-literal">----------------------------------------</span><br><span class="hljs-comment">凝思8            √             √</span><br><span class="hljs-literal">----------</span> <span class="hljs-literal">------------</span> <span class="hljs-literal">-------------</span> <span class="hljs-literal">----------------------------------------</span><br><span class="hljs-comment">pfSense         ×             ×         暂时不支持FreeBSD系统</span><br><span class="hljs-literal">----------</span> <span class="hljs-literal">------------</span> <span class="hljs-literal">-------------</span> <span class="hljs-literal">----------------------------------------</span><br><span class="hljs-comment">Kali            √             √</span><br><span class="hljs-literal">----------</span> <span class="hljs-literal">------------</span> <span class="hljs-literal">-------------</span> <span class="hljs-literal">----------------------------------------</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>KVM</category>
      
      <category>工具</category>
      
    </categories>
    
    
    <tags>
      
      <tag>工具</tag>
      
      <tag>KVM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>zerorpc优化</title>
    <link href="/2021/02/18/other/zerorpc/"/>
    <url>/2021/02/18/other/zerorpc/</url>
    
    <content type="html"><![CDATA[<p><strong>zerorpc官网：<a href="https://www.zerorpc.io/">https://www.zerorpc.io/</a></strong></p><p>Introduction：</p><p>An easy to use, intuitive, and cross-language RPC<br>zerorpc is a light-weight, reliable and language-agnostic library for distributed communication between server-side processes. It builds on top of ZeroMQ and MessagePack. Support for streamed responses - similar to python generators - makes zerorpc more than a typical RPC engine. Built-in heartbeats and timeouts detect and recover from failed requests. Introspective capabilities, first-class exceptions and the command-line utility make debugging easy.</p><p>简介：</p><p>一个易于使用、直观和跨语言的RPC</p><p>zerorpc是一个轻量级、可靠和语言无关的库，用于服务器端进程之间的分布式通信。它构建在ZeroMQ和MessagePack之上。支持流响应——类似于python生成器——使得zerorpc不仅仅是一个典型的RPC引擎。内置的心跳和超时检测并从失败的请求中恢复。内省功能、一级异常和命令行实用程序使调试变得容易。</p><p>官网示例：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># 官网-<span class="hljs-keyword">Server</span><br><span class="hljs-keyword">import</span> zerorpc<br><br><span class="hljs-keyword">class</span> HelloRPC(<span class="hljs-keyword">object</span>):<br>    def hello(self, <span class="hljs-type">name</span>):<br>        <span class="hljs-keyword">return</span> &quot;Hello, %s&quot; % <span class="hljs-type">name</span><br><br>s = zerorpc.<span class="hljs-keyword">Server</span>(HelloRPC())<br>s.bind(&quot;tcp://0.0.0.0:4242&quot;)<br>s.run()<br></code></pre></td></tr></table></figure><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs arduino"># 官网-<span class="hljs-built_in">Client</span><br><span class="hljs-keyword">import</span> zerorpc<br><br>c = zerorpc.<span class="hljs-built_in">Client</span>()<br>c.<span class="hljs-built_in">connect</span>(<span class="hljs-string">&quot;tcp://127.0.0.1:4242&quot;</span>)<br>print c.<span class="hljs-built_in">hello</span>(<span class="hljs-string">&quot;RPC&quot;</span>)<br></code></pre></td></tr></table></figure><p><strong>优化1：使用gevent方式启动zerorpc服务端，提高并发连接数量。</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-meta"># 优化1-Server</span><br>import zerorpc<br><br>s = zerorpc.Server(HelloRPC())<br>s.bind(<span class="hljs-string">&quot;tcp://0.0.0.0:4242&quot;</span>)<br>zerorpc.gevent.spawn(s.<span class="hljs-built_in">run</span>)<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    zerorpc.gevent.<span class="hljs-built_in">sleep</span>(<span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure><p><strong>优化2：报错：报错zerorpc.exceptions.LostRemote: Lost remote after 10s heartbeat，这是因为zerorpc有一个心跳检测，如果客户端没及时得到服务端反馈就报错。</strong></p><p>解决办法为：在客户端引用zerorpc.Client时加一个参数heartbeat&#x3D;None， 即c &#x3D; zerorpc.Client(heartbeat&#x3D;None) 但是有时还是报错zerorpc.exceptions.LostRemote: Lost remote after 30s heartbeat， 这是相应延长大于30s，没有找到很好的彻底解决响应时间的办法，但是可以“治标”： 对应报错的地方会有提示报错文件：Python27\lib\site-packages\zerorpc\channel.py”或者Python27\lib\site-packages\zerorpc\core.py”，哪个文件报错就改哪个，将文件里面对timeout赋值的语句timeout&#x3D;30改成timeout&#x3D;300或者更长，视你需要的响应时间而定，亦可以更长，timeout&#x3D;30的需要改，然后就可以了，如果不行别忘了前面加上heartbeat&#x3D;None参数。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># 优化2-Client</span><br>import zerorpc<br><br>c = zerorpc.Client(<span class="hljs-attribute">heartbeat</span>=None)<br>c.connect(<span class="hljs-string">&quot;tcp://127.0.0.1:4242&quot;</span>)<br><span class="hljs-built_in">print</span> c.hello(<span class="hljs-string">&quot;RPC&quot;</span>)<br></code></pre></td></tr></table></figure><p>zerorpc服务器端不并发处理，客户端连接阻塞。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># 举例<span class="hljs-number">1</span>-<span class="hljs-keyword">Server</span><br><span class="hljs-keyword">import</span> zerorpc<br><span class="hljs-keyword">import</span> <span class="hljs-type">time</span><br><br><span class="hljs-keyword">class</span> HelloRPC(<span class="hljs-keyword">object</span>):<br>    def hello(self, <span class="hljs-type">name</span>):<br>        <span class="hljs-type">time</span>.sleep(<span class="hljs-number">10</span>) # -&gt; zerorpc.gevent.sleep(<span class="hljs-number">10</span>)<br>        <span class="hljs-keyword">return</span> &quot;Hello, %s&quot; % <span class="hljs-type">name</span><br><br>s = zerorpc.<span class="hljs-keyword">Server</span>(HelloRPC())<br>s.bind(&quot;tcp://0.0.0.0:4242&quot;)<br>s.run()<br></code></pre></td></tr></table></figure><p>这里由于time.sleep()导致所有该zerorpc的进程使用，导致连接的客户端协程全部被阻塞，故这里应该使用协程的sleep()方法，协程才能正常的并发执行。</p>]]></content>
    
    
    <categories>
      
      <category>工具</category>
      
    </categories>
    
    
    <tags>
      
      <tag>工具</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>QEMU / KVM 快照相关命令介绍</title>
    <link href="/2021/01/19/linux/virsh_snapshot_cmd/"/>
    <url>/2021/01/19/linux/virsh_snapshot_cmd/</url>
    
    <content type="html"><![CDATA[<p>• INSTANCE_NAME： 实例instance名称<br>• SNAPSHOT_NAME： 快照名称<br>• SNAPSHOT_DESCRIPTION： 快照描述</p><p><strong>1.创建快照命令：</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">virsh <span class="hljs-keyword">snapshot</span>-<span class="hljs-keyword">create</span>-<span class="hljs-keyword">as</span> –<span class="hljs-keyword">domain</span> INSTANCE_NAME –<span class="hljs-type">name</span> SNAPSHOT_NAME –description SNAPSHOT_DESCRIPTION<br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[root@compute144 ~]# virsh <span class="hljs-keyword">snapshot</span>-<span class="hljs-keyword">create</span>-<span class="hljs-keyword">as</span> <span class="hljs-comment">--domain instance-00001286 --name scene-init --description scene-init</span><br><span class="hljs-keyword">Domain</span> <span class="hljs-keyword">snapshot</span> scene-init created<br></code></pre></td></tr></table></figure><p><strong>2.删除快照命令：</strong></p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">virsh <span class="hljs-keyword">snapshot</span>-<span class="hljs-keyword">delete</span> INSTANCE_NAME SNAPSHOT_NAME<br></code></pre></td></tr></table></figure><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mel">[root@compute144 ~]# virsh <span class="hljs-keyword">snapshot</span>-<span class="hljs-keyword">delete</span> <span class="hljs-keyword">instance</span><span class="hljs-number">-00001286</span> scene-init<br>Domain <span class="hljs-keyword">snapshot</span> scene-init deleted<br></code></pre></td></tr></table></figure><p><strong>3.恢复快照命令：</strong></p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">virsh snapshot-<span class="hljs-built_in">revert</span> INSTANCE_NAME SNAPSHOT_NAME<br></code></pre></td></tr></table></figure><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">[root@compute144 ~]# virsh <span class="hljs-keyword">snapshot</span>-revert <span class="hljs-keyword">instance</span><span class="hljs-number">-00001286</span> scene-init<br></code></pre></td></tr></table></figure><p><strong>4.查看快照disk信息</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">qemu-img <span class="hljs-built_in">info</span> disk<br></code></pre></td></tr></table></figure><p>根据instance_name得到实例的uuid</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@compute144</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># cd /var/lib/nova/instances/27a7b4d6-9036-4625-99f2-dbe6141d7eb7</span><br>[<span class="hljs-string">root@compute144</span> <span class="hljs-string">27a7b4d6-9036-4625-99f2-dbe6141d7eb7</span>]<span class="hljs-comment"># qemu-img info disk</span><br><span class="hljs-attr">image:</span> <span class="hljs-string">disk</span><br><span class="hljs-attr">file format:</span> <span class="hljs-string">qcow2</span><br><span class="hljs-attr">virtual size:</span> <span class="hljs-string">10G</span> <span class="hljs-string">(10737418240</span> <span class="hljs-string">bytes)</span><br><span class="hljs-attr">disk size:</span> <span class="hljs-string">445M</span><br><span class="hljs-attr">cluster_size:</span> <span class="hljs-number">65536</span><br><span class="hljs-attr">backing file:</span> <span class="hljs-string">/var/lib/nova/instances/_base</span><br><span class="hljs-string">ID</span>        <span class="hljs-string">TAG</span>                 <span class="hljs-string">VM</span> <span class="hljs-string">SIZE</span>                <span class="hljs-string">DATE</span>       <span class="hljs-string">VM</span> <span class="hljs-string">CLOCK</span><br><span class="hljs-number">1</span>         <span class="hljs-string">scene-init</span>             <span class="hljs-string">253M</span> <span class="hljs-number">2021-01-18 11:48:18   </span><span class="hljs-number">02</span><span class="hljs-string">:25:45.194</span><br><span class="hljs-attr">Format specific information:</span><br>    <span class="hljs-attr">compat:</span> <span class="hljs-number">1.1</span><br>    <span class="hljs-attr">lazy refcounts:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">refcount bits:</span> <span class="hljs-number">16</span><br>    <span class="hljs-attr">corrupt:</span> <span class="hljs-string">fals</span><br><br><span class="hljs-string">*</span> <span class="hljs-string">此功能必须为虚拟机关机状态下生效，否则：</span><br><span class="hljs-attr">qemu-img:</span> <span class="hljs-string">Could</span> <span class="hljs-string">not</span> <span class="hljs-string">open</span> <span class="hljs-attr">&#x27;disk&#x27;:</span> <span class="hljs-string">Failed</span> <span class="hljs-string">to</span> <span class="hljs-string">get</span> <span class="hljs-string">shared</span> <span class="hljs-string">&quot;write&quot;</span> <span class="hljs-string">lock</span><br><span class="hljs-string">Is</span> <span class="hljs-string">another</span> <span class="hljs-string">process</span> <span class="hljs-string">using</span> <span class="hljs-string">the</span> <span class="hljs-string">image</span> [<span class="hljs-string">disk</span>]<span class="hljs-string">?</span><br></code></pre></td></tr></table></figure><p><strong>5.查看快照列表</strong></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">virsh snapshot-list INSTANCE_NAME</span><br></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">[root@compute144 ~]# virsh snapshot-list instance-00001286<br><span class="hljs-section"> Name                 Creation Time             State</span><br><span class="hljs-section">------------------------------------------------------------</span><br><span class="hljs-code"> scene-init           2021-01-19 08:51:22 +0800 shutoff</span><br></code></pre></td></tr></table></figure><p><strong>6.查看快照信息</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">virsh <span class="hljs-keyword">snapshot</span>-<span class="hljs-keyword">info</span> INSTANCE_NAME –<span class="hljs-keyword">current</span><br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@compute144</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># virsh snapshot-info instance-00001286 --current</span><br><span class="hljs-attr">Name:</span>           <span class="hljs-string">scene-init</span><br><span class="hljs-attr">Domain:</span>         <span class="hljs-string">instance-00001286</span><br><span class="hljs-attr">Current:</span>        <span class="hljs-literal">yes</span><br><span class="hljs-attr">State:</span>          <span class="hljs-string">shutoff</span><br><span class="hljs-attr">Location:</span>       <span class="hljs-string">internal</span><br><span class="hljs-attr">Parent:</span>         <span class="hljs-bullet">-</span><br><span class="hljs-attr">Children:</span>       <span class="hljs-number">0</span><br><span class="hljs-attr">Descendants:</span>    <span class="hljs-number">0</span><br><span class="hljs-attr">Metadata:</span>       <span class="hljs-literal">yes</span><br></code></pre></td></tr></table></figure><p><strong>7.查看当前快照所有信息</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">virsh <span class="hljs-keyword">snapshot</span>-<span class="hljs-keyword">current</span> INSTANCE_NAME<br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><code class="hljs xml">[root@compute144 ~]# virsh snapshot-current instance-00001286<br><span class="hljs-tag">&lt;<span class="hljs-name">domainsnapshot</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>scene-init<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>scene-init<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">state</span>&gt;</span>shutoff<span class="hljs-tag">&lt;/<span class="hljs-name">state</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">creationTime</span>&gt;</span>1611017482<span class="hljs-tag">&lt;/<span class="hljs-name">creationTime</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">memory</span> <span class="hljs-attr">snapshot</span>=<span class="hljs-string">&#x27;no&#x27;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">disks</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">disk</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;vda&#x27;</span> <span class="hljs-attr">snapshot</span>=<span class="hljs-string">&#x27;internal&#x27;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">disk</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;hda&#x27;</span> <span class="hljs-attr">snapshot</span>=<span class="hljs-string">&#x27;no&#x27;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">disks</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">domain</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;kvm&#x27;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>instance-00001286<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">uuid</span>&gt;</span>27a7b4d6-9036-4625-99f2-dbe6141d7eb7<span class="hljs-tag">&lt;/<span class="hljs-name">uuid</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">metadata</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">nova:instance</span> <span class="hljs-attr">xmlns:nova</span>=<span class="hljs-string">&quot;http://openstack.org/xmlns/libvirt/nova/1.0&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">nova:package</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;17.0.10-1.el7&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">nova:name</span>&gt;</span>ps_T15Z2PS-SCENE220@-1<span class="hljs-tag">&lt;/<span class="hljs-name">nova:name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">nova:creationTime</span>&gt;</span>2021-01-18 06:41:30<span class="hljs-tag">&lt;/<span class="hljs-name">nova:creationTime</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">nova:flavor</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;<span class="hljs-symbol">&amp;#x4E3B;</span><span class="hljs-symbol">&amp;#x7AD9;</span><span class="hljs-symbol">&amp;#x7EB5;</span><span class="hljs-symbol">&amp;#x5411;</span>&quot;</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">nova:memory</span>&gt;</span>1024<span class="hljs-tag">&lt;/<span class="hljs-name">nova:memory</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">nova:disk</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-name">nova:disk</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">nova:swap</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">nova:swap</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">nova:ephemeral</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">nova:ephemeral</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">nova:vcpus</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">nova:vcpus</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">nova:flavor</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">nova:owner</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">nova:user</span> <span class="hljs-attr">uuid</span>=<span class="hljs-string">&quot;d5853486b6904865abaf98e1eedfd926&quot;</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-name">nova:user</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">nova:project</span> <span class="hljs-attr">uuid</span>=<span class="hljs-string">&quot;a385d3107887463abebad53b48dda754&quot;</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-name">nova:project</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">nova:owner</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">nova:root</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;image&quot;</span> <span class="hljs-attr">uuid</span>=<span class="hljs-string">&quot;ebe94aab-979a-4311-bf59-9be20a3f44e7&quot;</span>/&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">nova:instance</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">metadata</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">memory</span> <span class="hljs-attr">unit</span>=<span class="hljs-string">&#x27;KiB&#x27;</span>&gt;</span>1048576<span class="hljs-tag">&lt;/<span class="hljs-name">memory</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">currentMemory</span> <span class="hljs-attr">unit</span>=<span class="hljs-string">&#x27;KiB&#x27;</span>&gt;</span>1048576<span class="hljs-tag">&lt;/<span class="hljs-name">currentMemory</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">vcpu</span> <span class="hljs-attr">placement</span>=<span class="hljs-string">&#x27;static&#x27;</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">vcpu</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">cputune</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">shares</span>&gt;</span>1024<span class="hljs-tag">&lt;/<span class="hljs-name">shares</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">cputune</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">sysinfo</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;smbios&#x27;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">system</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;manufacturer&#x27;</span>&gt;</span>RDO<span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;product&#x27;</span>&gt;</span>OpenStack Compute<span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;version&#x27;</span>&gt;</span>17.0.10-1.el7<span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;serial&#x27;</span>&gt;</span>12c77e03-1355-43af-a482-61ecf2aad317<span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;uuid&#x27;</span>&gt;</span>27a7b4d6-9036-4625-99f2-dbe6141d7eb7<span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;family&#x27;</span>&gt;</span>Virtual Machine<span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">system</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">sysinfo</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">os</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">type</span> <span class="hljs-attr">arch</span>=<span class="hljs-string">&#x27;x86_64&#x27;</span> <span class="hljs-attr">machine</span>=<span class="hljs-string">&#x27;pc-i440fx-rhel7.6.0&#x27;</span>&gt;</span>hvm<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">boot</span> <span class="hljs-attr">dev</span>=<span class="hljs-string">&#x27;hd&#x27;</span>/&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">smbios</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">&#x27;sysinfo&#x27;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">os</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">features</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">acpi</span>/&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">apic</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">features</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">cpu</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">&#x27;host-model&#x27;</span> <span class="hljs-attr">check</span>=<span class="hljs-string">&#x27;partial&#x27;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">model</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#x27;allow&#x27;</span>/&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">topology</span> <span class="hljs-attr">sockets</span>=<span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-attr">cores</span>=<span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-attr">threads</span>=<span class="hljs-string">&#x27;1&#x27;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">cpu</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">clock</span> <span class="hljs-attr">offset</span>=<span class="hljs-string">&#x27;utc&#x27;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">timer</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;pit&#x27;</span> <span class="hljs-attr">tickpolicy</span>=<span class="hljs-string">&#x27;delay&#x27;</span>/&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">timer</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;rtc&#x27;</span> <span class="hljs-attr">tickpolicy</span>=<span class="hljs-string">&#x27;catchup&#x27;</span>/&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">timer</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;hpet&#x27;</span> <span class="hljs-attr">present</span>=<span class="hljs-string">&#x27;no&#x27;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">clock</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">on_poweroff</span>&gt;</span>destroy<span class="hljs-tag">&lt;/<span class="hljs-name">on_poweroff</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">on_reboot</span>&gt;</span>restart<span class="hljs-tag">&lt;/<span class="hljs-name">on_reboot</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">on_crash</span>&gt;</span>destroy<span class="hljs-tag">&lt;/<span class="hljs-name">on_crash</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">devices</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">emulator</span>&gt;</span>/usr/libexec/qemu-kvm<span class="hljs-tag">&lt;/<span class="hljs-name">emulator</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">disk</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;file&#x27;</span> <span class="hljs-attr">device</span>=<span class="hljs-string">&#x27;disk&#x27;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">driver</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;qemu&#x27;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;qcow2&#x27;</span> <span class="hljs-attr">cache</span>=<span class="hljs-string">&#x27;none&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&#x27;/var/lib/nova/instances/27a7b4d6-9036-4625-99f2-dbe6141d7eb7/disk&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">target</span> <span class="hljs-attr">dev</span>=<span class="hljs-string">&#x27;vda&#x27;</span> <span class="hljs-attr">bus</span>=<span class="hljs-string">&#x27;virtio&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">address</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;pci&#x27;</span> <span class="hljs-attr">domain</span>=<span class="hljs-string">&#x27;0x0000&#x27;</span> <span class="hljs-attr">bus</span>=<span class="hljs-string">&#x27;0x00&#x27;</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">&#x27;0x07&#x27;</span> <span class="hljs-attr">function</span>=<span class="hljs-string">&#x27;0x0&#x27;</span>/&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">disk</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">disk</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;file&#x27;</span> <span class="hljs-attr">device</span>=<span class="hljs-string">&#x27;cdrom&#x27;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">driver</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;qemu&#x27;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;raw&#x27;</span> <span class="hljs-attr">cache</span>=<span class="hljs-string">&#x27;none&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&#x27;/var/lib/nova/instances/27a7b4d6-9036-4625-99f2-dbe6141d7eb7/disk.config&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">target</span> <span class="hljs-attr">dev</span>=<span class="hljs-string">&#x27;hda&#x27;</span> <span class="hljs-attr">bus</span>=<span class="hljs-string">&#x27;ide&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">readonly</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">address</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;drive&#x27;</span> <span class="hljs-attr">controller</span>=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-attr">bus</span>=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-attr">unit</span>=<span class="hljs-string">&#x27;0&#x27;</span>/&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">disk</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">controller</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;ide&#x27;</span> <span class="hljs-attr">index</span>=<span class="hljs-string">&#x27;0&#x27;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">address</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;pci&#x27;</span> <span class="hljs-attr">domain</span>=<span class="hljs-string">&#x27;0x0000&#x27;</span> <span class="hljs-attr">bus</span>=<span class="hljs-string">&#x27;0x00&#x27;</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">&#x27;0x01&#x27;</span> <span class="hljs-attr">function</span>=<span class="hljs-string">&#x27;0x1&#x27;</span>/&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">controller</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">controller</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;usb&#x27;</span> <span class="hljs-attr">index</span>=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-attr">model</span>=<span class="hljs-string">&#x27;piix3-uhci&#x27;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">address</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;pci&#x27;</span> <span class="hljs-attr">domain</span>=<span class="hljs-string">&#x27;0x0000&#x27;</span> <span class="hljs-attr">bus</span>=<span class="hljs-string">&#x27;0x00&#x27;</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">&#x27;0x01&#x27;</span> <span class="hljs-attr">function</span>=<span class="hljs-string">&#x27;0x2&#x27;</span>/&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">controller</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">controller</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;pci&#x27;</span> <span class="hljs-attr">index</span>=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-attr">model</span>=<span class="hljs-string">&#x27;pci-root&#x27;</span>/&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">interface</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;bridge&#x27;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mac</span> <span class="hljs-attr">address</span>=<span class="hljs-string">&#x27;fa:16:3e:70:8f:e9&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">bridge</span>=<span class="hljs-string">&#x27;qbr9a416b99-f4&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">target</span> <span class="hljs-attr">dev</span>=<span class="hljs-string">&#x27;tap9a416b99-f4&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">model</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;virtio&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mtu</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&#x27;1450&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">address</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;pci&#x27;</span> <span class="hljs-attr">domain</span>=<span class="hljs-string">&#x27;0x0000&#x27;</span> <span class="hljs-attr">bus</span>=<span class="hljs-string">&#x27;0x00&#x27;</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">&#x27;0x03&#x27;</span> <span class="hljs-attr">function</span>=<span class="hljs-string">&#x27;0x0&#x27;</span>/&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">interface</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">interface</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;bridge&#x27;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mac</span> <span class="hljs-attr">address</span>=<span class="hljs-string">&#x27;fa:16:3e:cb:8b:c6&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">bridge</span>=<span class="hljs-string">&#x27;qbr4e232a0d-3e&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">target</span> <span class="hljs-attr">dev</span>=<span class="hljs-string">&#x27;tap4e232a0d-3e&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">model</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;virtio&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mtu</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&#x27;1500&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">address</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;pci&#x27;</span> <span class="hljs-attr">domain</span>=<span class="hljs-string">&#x27;0x0000&#x27;</span> <span class="hljs-attr">bus</span>=<span class="hljs-string">&#x27;0x00&#x27;</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">&#x27;0x04&#x27;</span> <span class="hljs-attr">function</span>=<span class="hljs-string">&#x27;0x0&#x27;</span>/&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">interface</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">interface</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;bridge&#x27;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mac</span> <span class="hljs-attr">address</span>=<span class="hljs-string">&#x27;fa:16:3e:dd:4e:8d&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">bridge</span>=<span class="hljs-string">&#x27;qbr3a023c95-a5&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">target</span> <span class="hljs-attr">dev</span>=<span class="hljs-string">&#x27;tap3a023c95-a5&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">model</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;virtio&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mtu</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&#x27;1500&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">address</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;pci&#x27;</span> <span class="hljs-attr">domain</span>=<span class="hljs-string">&#x27;0x0000&#x27;</span> <span class="hljs-attr">bus</span>=<span class="hljs-string">&#x27;0x00&#x27;</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">&#x27;0x05&#x27;</span> <span class="hljs-attr">function</span>=<span class="hljs-string">&#x27;0x0&#x27;</span>/&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">interface</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">interface</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;bridge&#x27;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mac</span> <span class="hljs-attr">address</span>=<span class="hljs-string">&#x27;fa:16:3e:66:a0:b7&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">bridge</span>=<span class="hljs-string">&#x27;qbr0c33b092-d0&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">target</span> <span class="hljs-attr">dev</span>=<span class="hljs-string">&#x27;tap0c33b092-d0&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">model</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;virtio&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mtu</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&#x27;1450&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">address</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;pci&#x27;</span> <span class="hljs-attr">domain</span>=<span class="hljs-string">&#x27;0x0000&#x27;</span> <span class="hljs-attr">bus</span>=<span class="hljs-string">&#x27;0x00&#x27;</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">&#x27;0x06&#x27;</span> <span class="hljs-attr">function</span>=<span class="hljs-string">&#x27;0x0&#x27;</span>/&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">interface</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">serial</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;pty&#x27;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">log</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&#x27;/var/lib/nova/instances/27a7b4d6-9036-4625-99f2-dbe6141d7eb7/console.log&#x27;</span> <span class="hljs-attr">append</span>=<span class="hljs-string">&#x27;off&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">target</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;isa-serial&#x27;</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&#x27;0&#x27;</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">model</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;isa-serial&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">serial</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">console</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;pty&#x27;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">log</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&#x27;/var/lib/nova/instances/27a7b4d6-9036-4625-99f2-dbe6141d7eb7/console.log&#x27;</span> <span class="hljs-attr">append</span>=<span class="hljs-string">&#x27;off&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">target</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;serial&#x27;</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&#x27;0&#x27;</span>/&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">console</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;tablet&#x27;</span> <span class="hljs-attr">bus</span>=<span class="hljs-string">&#x27;usb&#x27;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">address</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;usb&#x27;</span> <span class="hljs-attr">bus</span>=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&#x27;1&#x27;</span>/&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">input</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;mouse&#x27;</span> <span class="hljs-attr">bus</span>=<span class="hljs-string">&#x27;ps2&#x27;</span>/&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;keyboard&#x27;</span> <span class="hljs-attr">bus</span>=<span class="hljs-string">&#x27;ps2&#x27;</span>/&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">graphics</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;vnc&#x27;</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&#x27;-1&#x27;</span> <span class="hljs-attr">autoport</span>=<span class="hljs-string">&#x27;yes&#x27;</span> <span class="hljs-attr">listen</span>=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span> <span class="hljs-attr">keymap</span>=<span class="hljs-string">&#x27;en-us&#x27;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">listen</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;address&#x27;</span> <span class="hljs-attr">address</span>=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>/&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">graphics</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">video</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">model</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;cirrus&#x27;</span> <span class="hljs-attr">vram</span>=<span class="hljs-string">&#x27;16384&#x27;</span> <span class="hljs-attr">heads</span>=<span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-attr">primary</span>=<span class="hljs-string">&#x27;yes&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">address</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;pci&#x27;</span> <span class="hljs-attr">domain</span>=<span class="hljs-string">&#x27;0x0000&#x27;</span> <span class="hljs-attr">bus</span>=<span class="hljs-string">&#x27;0x00&#x27;</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">&#x27;0x02&#x27;</span> <span class="hljs-attr">function</span>=<span class="hljs-string">&#x27;0x0&#x27;</span>/&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">memballoon</span> <span class="hljs-attr">model</span>=<span class="hljs-string">&#x27;virtio&#x27;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">stats</span> <span class="hljs-attr">period</span>=<span class="hljs-string">&#x27;10&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">address</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;pci&#x27;</span> <span class="hljs-attr">domain</span>=<span class="hljs-string">&#x27;0x0000&#x27;</span> <span class="hljs-attr">bus</span>=<span class="hljs-string">&#x27;0x00&#x27;</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">&#x27;0x08&#x27;</span> <span class="hljs-attr">function</span>=<span class="hljs-string">&#x27;0x0&#x27;</span>/&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">memballoon</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">devices</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">domain</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">domainsnapshot</span>&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>KVM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>KVM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>QEMU / KVM 快照介绍</title>
    <link href="/2021/01/18/linux/qemu_snapshot/"/>
    <url>/2021/01/18/linux/qemu_snapshot/</url>
    
    <content type="html"><![CDATA[<p><strong>1.QEMU&#x2F;KVM快照</strong></p><p><strong>1.1 概念</strong><br>QEMU&#x2F;KVM 快照的定义：快照就是将虚机在某一个时间点上的磁盘、内存和设备状态保存一下，以备将来之用。它包括以下几类：</p><p>磁盘快照：磁盘的内容（可能是虚机的全部磁盘或者部分磁盘）在某个时间点上被保存，然后可以被恢复。<br>磁盘数据的保存状态：<br>在一个运行着的系统上，一个磁盘快照很可能只是崩溃一致的（crash-consistent） 而不是完整一致（clean）的，也是说它所保存的磁盘状态可能相当于机器突然掉电时硬盘数据的状态，机器重启后需要通过 fsck 或者别的工具来恢复到完整一致的状态（类似于 Windows 机器在断电后会执行文件检查）。(注：命令 qemu-img check -f qcow2 –output&#x3D;qcow2 -r all filename-img.qcow2 可以对 qcow2 和 vid 格式的镜像做一致性检查。)<br>对一个非运行中的虚机来说，如果上次虚机关闭的时候磁盘是完整一致的，那么其被快照的磁盘快照也将是完整一致的。</p><p>磁盘快照有两种：<br>• 内部快照 - 使用单个的 qcow2 的文件来保存快照和快照之后的改动。这种快照是 libvirt 的默认行为，现在的支持很完善（创建、回滚和删除），但是只能针对 qcow2 格式的磁盘镜像文件，而且其过程较慢等。<br>• 外部快照 - 快照是一个只读文件，快照之后的修改是另一个 qcow2 文件中。外置快照可以针对各种格式的磁盘镜像文件。外置快照的结果是形成一个<br>qcow2 文件链：original &lt;- snap1 &lt;- snap2 &lt;- snap3。</p><p>内存状态（或者虚机状态）：只是保持内存和虚机使用的其它资源的状态。如果虚机状态快照在做和恢复之间磁盘没有被修改，那么虚机将保持一个持续的状态；如果被修改了，那么很可能导致数据corruption。<br>系统还原点（system checkpoint）：虚机的所有磁盘的快照和内存状态快照的集合，可用于恢复完整的系统状态（类似于系统休眠）。<br>关于 崩溃一致（crash-consistent）的附加说明：</p><p>应该尽量避免在虚机I&#x2F;O繁忙的时候做快照。这种时候做快照不是可取的办法。<br>vmware 的做法是装一个 tools，它是个 PV driver，可以在做快照的时候挂起系统<br>似乎 KVM 也有类似的实现 QEMU Guest Agent，但是还不是很成熟，<br>可参考 <a href="http://wiki.libvirt.org/page/Qemu_guest_agent">http://wiki.libvirt.org/page/Qemu_guest_agent</a></p><p>快照还可以分为 live snapshot（热快照）和 Cold snapshot：<br>Live snapshot：系统运行状态下做的快照<br>Cold snapshot：系统停止状态下的快照<br>libvit 做 snapshot 的各个 API：</p><p><img src="/images/snapshot1.png" alt="API"></p><p>分别来看看这些 API 是如何工作的：<br>virDomainSnapshotCreateXML (virDomainPtr domain, const char * xmlDesc, unsigned int flags)<br>作用：根据 xmlDesc 指定的 snapshot xml 和 flags 来创建虚机的快照。</p><p><img src="/images/snapshot2.png" alt="virDomainSnapshotCreateXML"></p><p>其内部实现根据虚机的运行状态有两种情形：<br>• 对运行着的虚机，API 使用 QEMU Monitor 去做快照，磁盘镜像文件必须是 qcow2 格式，虚机的 CPU 被停止，快照结束后会重新启动。<br>• 对停止着的虚机，API 调用 qemu-img 方法来操作所有磁盘镜像文件。<br>这里有其实现代码，可见其基本的实现步骤：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-keyword">static</span> virDomainSnapshotPtr qemuDomainSnapshotCreateXML<br>&#123;<br>    ....<br>    <span class="hljs-built_in">call</span> qemuDomainSnapshotCreateDiskActive<br>    &#123;<br>        <span class="hljs-built_in">call</span> qemuProcessStopCPUs <span class="hljs-meta"># 停止 vCPUs</span><br>        <span class="hljs-keyword">for</span> each disk <span class="hljs-built_in">call</span> qemuDomainSnapshotCreateSingleDiskActive<br>        &#123;<br>            <span class="hljs-built_in">call</span> qemuMonitorDiskSnapshot <span class="hljs-meta"># 调用 QEMU Monitor 去为每个磁盘做snapshot</span><br>        &#125;<br>        <span class="hljs-built_in">call</span> qemuProcessStartCPUs <span class="hljs-meta"># 启动 vCPUs</span><br>     &#125;<br>     ....<br>&#125;<br></code></pre></td></tr></table></figure><p>virDomainSave 相关的几个 API<br>这几个API 功能都比较类似：</p><p><img src="/images/snapshot3.png" alt="virDomainSave"></p><p><strong>1.2 使用 virsh 实验</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">virsh <span class="hljs-keyword">snapshot</span>-<span class="hljs-keyword">create</span>/snapshort-<span class="hljs-keyword">create</span>-<span class="hljs-keyword">as</span><br></code></pre></td></tr></table></figure><p>先看看它的用法：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">virsh # help <span class="hljs-keyword">snapshot</span>-<span class="hljs-keyword">create</span>-<span class="hljs-keyword">as</span><br>  <span class="hljs-type">NAME</span><br>    <span class="hljs-keyword">snapshot</span>-<span class="hljs-keyword">create</span>-<span class="hljs-keyword">as</span> - <span class="hljs-keyword">Create</span> a <span class="hljs-keyword">snapshot</span> <span class="hljs-keyword">from</span> a <span class="hljs-keyword">set</span> <span class="hljs-keyword">of</span> args<br><br>  SYNOPSIS<br>    <span class="hljs-keyword">snapshot</span>-<span class="hljs-keyword">create</span>-<span class="hljs-keyword">as</span> &lt;<span class="hljs-keyword">domain</span>&gt; [&lt;<span class="hljs-type">name</span>&gt;] [&lt;description&gt;] [<span class="hljs-comment">--print-xml] [--no-metadata] [--halt] [--disk-only] [--reuse-external] [--quiesce] [--atomic] [--live] [--memspec &lt;string&gt;] [[--diskspec] &lt;string&gt;]...</span><br><br>  DESCRIPTION<br>    <span class="hljs-keyword">Create</span> a <span class="hljs-keyword">snapshot</span> (disk <span class="hljs-keyword">and</span> RAM) <span class="hljs-keyword">from</span> arguments<br><br>  <span class="hljs-keyword">OPTIONS</span><br>    [<span class="hljs-comment">--domain] &lt;string&gt;  domain name, id or uuid</span><br>    [<span class="hljs-comment">--name] &lt;string&gt;  name of snapshot</span><br>    [<span class="hljs-comment">--description] &lt;string&gt;  description of snapshot</span><br>    <span class="hljs-comment">--print-xml      print XML document rather than create</span><br>    <span class="hljs-comment">--no-metadata    take snapshot but create no metadata  #创建的快照不带任何元数据</span><br>    <span class="hljs-comment">--halt           halt domain after snapshot is created #快照创建后虚机会关闭</span><br>    <span class="hljs-comment">--disk-only      capture disk state but not vm state   #只对磁盘做快照，忽略其它参数</span><br>    <span class="hljs-comment">--reuse-external  reuse any existing external files</span><br>    <span class="hljs-comment">--quiesce        quiesce guest&#x27;s file systems #libvirt 会通过 QEMU GA 尝试去freeze和unfreeze客户机已经mounted的文件系统；如果客户机没有安装QEMU GA，则操作会失败。</span><br>    <span class="hljs-comment">--atomic         require atomic operation #快照要么完全成功要么完全失败，不允许部分成果。不是所有的VMM都支持。</span><br>    <span class="hljs-comment">--live           take a live snapshot     #当客户机处于运行状态下做快照</span><br>    <span class="hljs-comment">--memspec &lt;string&gt;  memory attributes: [file=]name[,snapshot=type]</span><br>    [<span class="hljs-comment">--diskspec] &lt;string&gt;  disk attributes: disk[,snapshot=type][,driver=type][,file=name]</span><br></code></pre></td></tr></table></figure><p>其中一些参数，比如 –atomic，在一些老的 QEMU libary 上不支持，需要更新它到新的版本。根据 这篇文章，atomic 应该是 QEMU 1.0 中加入的。<br>（1）默认的话，该命令创建虚机的所有磁盘和内存做内部快照，创建快照时虚机处于 paused 状态，快照完成后变为 running 状态。持续时间较长。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&lt;memory <span class="hljs-keyword">snapshot</span>=<span class="hljs-string">&#x27;internal&#x27;</span>/&gt;<br>  &lt;disks&gt;<br>    &lt;disk <span class="hljs-type">name</span>=<span class="hljs-string">&#x27;vda&#x27;</span> <span class="hljs-keyword">snapshot</span>=<span class="hljs-string">&#x27;internal&#x27;</span>/&gt;<br>    &lt;disk <span class="hljs-type">name</span>=<span class="hljs-string">&#x27;vdb&#x27;</span> <span class="hljs-keyword">snapshot</span>=<span class="hljs-string">&#x27;internal&#x27;</span>/&gt;<br>    &lt;disk <span class="hljs-type">name</span>=<span class="hljs-string">&#x27;vdc&#x27;</span> <span class="hljs-keyword">snapshot</span>=<span class="hljs-string">&#x27;internal&#x27;</span>/&gt;<br>  &lt;/disks&gt;<br></code></pre></td></tr></table></figure><p>每个磁盘的镜像文件都包含了 snapshot 的信息：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@compute144</span> <span class="hljs-string">8984f8b3-8429-4d16-a6f6-bff239605f46</span>]<span class="hljs-comment"># qemu-img info disk</span><br><span class="hljs-attr">image:</span> <span class="hljs-string">disk</span><br><span class="hljs-attr">file format:</span> <span class="hljs-string">qcow2</span><br><span class="hljs-attr">virtual size:</span> <span class="hljs-string">10G</span> <span class="hljs-string">(10737418240</span> <span class="hljs-string">bytes)</span><br><span class="hljs-attr">disk size:</span> <span class="hljs-string">745M</span><br><span class="hljs-attr">cluster_size:</span> <span class="hljs-number">65536</span><br><span class="hljs-attr">backing file:</span> <span class="hljs-string">/var/lib/nova/instances/_base/af01f8737b75e5ccf8a5f51ce051bde57b71fdfb</span><br><span class="hljs-attr">Snapshot list:</span><br><span class="hljs-string">ID</span>        <span class="hljs-string">TAG</span>                 <span class="hljs-string">VM</span> <span class="hljs-string">SIZE</span>                <span class="hljs-string">DATE</span>       <span class="hljs-string">VM</span> <span class="hljs-string">CLOCK</span><br><span class="hljs-number">1</span>         <span class="hljs-number">123</span>                       <span class="hljs-number">0</span> <span class="hljs-number">2021-01-15 16:30:00   </span><span class="hljs-number">00</span><span class="hljs-string">:00:00.000</span><br><span class="hljs-number">2</span>         <span class="hljs-number">12345</span>                  <span class="hljs-string">230M</span> <span class="hljs-number">2021-01-15 16:40:42   </span><span class="hljs-number">00</span><span class="hljs-string">:07:27.665</span><br><span class="hljs-number">3</span>         <span class="hljs-number">345</span>                    <span class="hljs-string">229M</span> <span class="hljs-number">2021-01-15 16:57:44   </span><span class="hljs-number">00</span><span class="hljs-string">:07:16.928</span><br><span class="hljs-attr">Format specific information:</span><br>    <span class="hljs-attr">compat:</span> <span class="hljs-number">1.1</span><br>    <span class="hljs-attr">lazy refcounts:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">refcount bits:</span> <span class="hljs-number">16</span><br>    <span class="hljs-attr">corrupt:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><p>你可以运行 snapshot-revert 命令回滚到指定的snapshot。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">virsh</span> # snapshot-revert instance-<span class="hljs-number">0000002</span>e <span class="hljs-number">1433950148</span><br></code></pre></td></tr></table></figure><p>根据 这篇文章，libvirt 将内存状态保存到某一个磁盘镜像文件内 （”state is saved inside one of the disks (as in qemu’s ‘savevm’system checkpoint implementation). If needed in the future,we can also add an attribute pointing out which disk saved the internal state; maybe disk&#x3D;’vda’.）</p><p>（2）可以使用 “–memspec” 和 “–diskspec” 参数来给内存和磁盘外部快照。这时候，在获取内存状态之前需要 Pause 虚机，就会产生服务的 downtime。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">virsh # <span class="hljs-keyword">snapshot</span>-<span class="hljs-keyword">create</span>-<span class="hljs-keyword">as</span> <span class="hljs-number">0000002</span>e livesnap2  <span class="hljs-comment">--memspec /home/s1/livesnap2mem,snapshot=external --diskspec vda,snapshot=external</span><br><span class="hljs-keyword">Domain</span> <span class="hljs-keyword">snapshot</span> livesnap2 created<br>virsh # <span class="hljs-keyword">snapshot</span>-dumpxml <span class="hljs-number">0000002</span>e livesnap2<br>  &lt;memory <span class="hljs-keyword">snapshot</span>=<span class="hljs-string">&#x27;external&#x27;</span> file=<span class="hljs-string">&#x27;/home/s1/livesnap2mem&#x27;</span>/&gt;<br>  &lt;disks&gt;<br>    &lt;disk <span class="hljs-type">name</span>=<span class="hljs-string">&#x27;vda&#x27;</span> <span class="hljs-keyword">snapshot</span>=<span class="hljs-string">&#x27;external&#x27;</span> <span class="hljs-keyword">type</span>=<span class="hljs-string">&#x27;file&#x27;</span>&gt;<br>      &lt;driver <span class="hljs-keyword">type</span>=<span class="hljs-string">&#x27;qcow2&#x27;</span>/&gt;<br>      &lt;source file=<span class="hljs-string">&#x27;/home/s1/testvm/testvm1.livesnap2&#x27;</span>/&gt;<br>    &lt;/disk&gt;<br>  &lt;/disks&gt;<br></code></pre></td></tr></table></figure><p>（3）可以使用 “–disk-only” 参数，这时会做所有磁盘的外部快照，但是不包含内存的快照。不指定快照文件名字的话，会放在原来的磁盘文件所在的目录中。多次快照后，会形成一个外部快照链，新的快照使用前一个快照的镜像文件作为 backing file。</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs 1c">virsh <span class="hljs-meta"># snapshot-list instance-0000002e --tree</span><br><span class="hljs-number">1433950148</span> <span class="hljs-meta">#内部快照</span><br><span class="hljs-number">1433950810</span> <span class="hljs-meta">#内部快照</span><br><span class="hljs-number">1433950946</span> <span class="hljs-meta">#内部快照</span><br>snap1 <span class="hljs-meta">#第一个外部快照</span><br>  <span class="hljs-string">|</span><br>  +- snap2 <span class="hljs-meta">#第二个外部快照</span><br>      <span class="hljs-string">|</span><br>      +- <span class="hljs-number">1433954941</span> <span class="hljs-meta">#第三个外部快照</span><br>          <span class="hljs-string">|</span><br>          +- <span class="hljs-number">1433954977</span> <span class="hljs-meta">#第四个外部快照</span><br></code></pre></td></tr></table></figure><p>而第一个外部快照的镜像文件是以虚机的原始镜像文件作为 backing file 的：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@compute1</span><span class="hljs-symbol">:/var/lib/nova/instances/eddc46a8-e026-</span><span class="hljs-number">4</span>b2c-af51-dfaa436fcc7b<span class="hljs-comment"># qemu-img info disk.snap1</span><br><span class="hljs-symbol">image:</span> disk.snap1<br>file <span class="hljs-symbol">format:</span> qcow2<br>virtual <span class="hljs-symbol">size:</span> <span class="hljs-number">30</span>M (<span class="hljs-number">31457280</span> bytes)<br>disk <span class="hljs-symbol">size:</span> <span class="hljs-number">196</span>K<br><span class="hljs-symbol">cluster_size:</span> <span class="hljs-number">65536</span><br>backing <span class="hljs-symbol">file:</span> /var/lib/nova/instances/eddc46a8-e026<span class="hljs-number">-4</span>b2c-af51-dfaa436fcc7b/disk.swap <span class="hljs-comment">#虚机的 swap disk 原始镜像文件</span><br>backing file <span class="hljs-symbol">format:</span> qcow2<br><span class="hljs-title class_">Format</span> specific <span class="hljs-symbol">information:</span><br>    <span class="hljs-symbol">compat:</span> <span class="hljs-number">1.1</span><br>    lazy <span class="hljs-symbol">refcounts:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><p>目前还不支持回滚到某一个extrenal disk snapshot。这篇文章 谈到了一个workaround。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[root@rh65 osdomains]# virsh <span class="hljs-keyword">snapshot</span>-revert d<span class="hljs-number">-2</span> <span class="hljs-number">1434467974</span><br>error: unsupported <span class="hljs-keyword">configuration</span>: revert <span class="hljs-keyword">to</span> <span class="hljs-keyword">external</span> disk <span class="hljs-keyword">snapshot</span> <span class="hljs-keyword">not</span> supported yet<br>（<span class="hljs-number">4</span>）还可以使用 “–live” 参数创建系统还原点，包括磁盘、内存和设备状态等。使用这个参数时，虚机不会被 Paused（那怎么实现的？）。其后果是增加了内存 dump 文件的大小，但是减少了系统的 downtime。该参数只能用于做外部的系统还原点（<span class="hljs-keyword">external</span> <span class="hljs-keyword">checkpoint</span>）。<br><br>virsh # <span class="hljs-keyword">snapshot</span>-<span class="hljs-keyword">create</span>-<span class="hljs-keyword">as</span> <span class="hljs-number">0000002</span>e livesnap3  <span class="hljs-comment">--memspec /home/s1/livesnap3mem,snapshot=external --diskspec vda,snapshot=external --live</span><br><span class="hljs-keyword">Domain</span> <span class="hljs-keyword">snapshot</span> livesnap3 created<br>virsh # <span class="hljs-keyword">snapshot</span>-dumpxml <span class="hljs-number">0000002</span>e livesnap3<br>  &lt;memory <span class="hljs-keyword">snapshot</span>=<span class="hljs-string">&#x27;external&#x27;</span> file=<span class="hljs-string">&#x27;/home/s1/livesnap3mem&#x27;</span>/&gt;<br>  &lt;disks&gt;<br>    &lt;disk <span class="hljs-type">name</span>=<span class="hljs-string">&#x27;vda&#x27;</span> <span class="hljs-keyword">snapshot</span>=<span class="hljs-string">&#x27;external&#x27;</span> <span class="hljs-keyword">type</span>=<span class="hljs-string">&#x27;file&#x27;</span>&gt;<br>      &lt;driver <span class="hljs-keyword">type</span>=<span class="hljs-string">&#x27;qcow2&#x27;</span>/&gt;<br>      &lt;source file=<span class="hljs-string">&#x27;/home/s1/testvm/testvm1.livesnap3&#x27;</span>/&gt;<br>    &lt;/disk&gt;<br>  &lt;/disks&gt;<br></code></pre></td></tr></table></figure><p>注意到加 “–live” 生成的快照和不加这个参数生成的快照不会被链在一起：</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs 1c">virsh <span class="hljs-meta"># snapshot-list 0000002e --tree</span><br>livesnap1 <span class="hljs-meta">#没加 --live</span><br>  <span class="hljs-string">|</span><br>  +- livesnap2 <span class="hljs-meta">#没加 --live</span><br><br>livesnap3 <span class="hljs-meta">#加了 --live</span><br>  <span class="hljs-string">|</span><br>  +- livesnap4 <span class="hljs-meta">#加了 --live</span><br></code></pre></td></tr></table></figure><p>不过，奇怪的是，使用 QEMU 2.3 的情况下，即使加了 –live 参数，虚机还是会被短暂的 Paused 住：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">[root@rh65 ~]# virsh snapshot-create-as d-2 --memspec /home/work/d-2/mem3,snapshot=external --diskspec hda,snapshot=external --live<br>Domain snapshot 1434478667 created<br><br>[root@rh65 ~]# virsh list --all<br><span class="hljs-section"> Id    Name                           State</span><br><span class="hljs-section">----------------------------------------------------</span><br><span class="hljs-code"> 40    osvm1                          running</span><br><span class="hljs-code"> 42    osvm2                          running</span><br><span class="hljs-code"> 43    d-2                            running</span><br><br>[root@rh65 ~]# virsh list --all<br><span class="hljs-section"> Id    Name                           State</span><br><span class="hljs-section">----------------------------------------------------</span><br><span class="hljs-code"> 40    osvm1                          running</span><br><span class="hljs-code"> 42    osvm2                          running</span><br><span class="hljs-code"> 43    d-2                            paused</span><br><br>[root@rh65 ~]# virsh list --all<br><span class="hljs-section"> Id    Name                           State</span><br><span class="hljs-section">----------------------------------------------------</span><br><span class="hljs-code"> 40    osvm1                          running</span><br><span class="hljs-code"> 42    osvm2                          running</span><br><span class="hljs-code"> 43    d-2                            running</span><br></code></pre></td></tr></table></figure><p>可以使用 snapshot-revert 命令来回滚到指定的系统还原点，不过得使用 “-force” 参数 。</p>]]></content>
    
    
    <categories>
      
      <category>KVM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>KVM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cloud-init 初始化虚拟机配置</title>
    <link href="/2020/10/21/openstack/cloudinit_intro/"/>
    <url>/2020/10/21/openstack/cloudinit_intro/</url>
    
    <content type="html"><![CDATA[<p>梳理一下，什么是 cloud-init，它解决了什么实际问题，以及最重要的它该怎么用。</p><p><strong>cloud-init 是什么</strong></p><p>cloud-init 是运行在 Guest machine 中，并在初始化时将一些自定义的配置应用到 Guest machine 中的应用程序。想象一下，假如你是一个云主机提供商，每天都需要为客户初始化成千上万台虚拟主机，这些机器可能使用不用的操作系统，可能根据客户需求设定不同的 IP 地址，不同的 SSH key，以及设置不同的 hostname 等等，这个时候需要怎么办，cloud-init 就是为了解决这个问题而诞生的。</p><p>cloud-init 最早由 Ubuntu 的开发商 Canonical 开发，现在已经支持绝大多数 Linux 发行版和 FreeBSD 系统。而目前大部分的公有云都在用 cloud-init 初始化系统配置，cloud-init 也支持部分私有云 (KVM, OpenStack, LXD 等等） 1，已经成为了事实上的标准。而这里就回到了 Proxmox，因为 Proxmox 是用来部署和管理虚拟机的平台，所以天然的适合 cloud-init 的使用场景，甚至可以说是不可或缺的一部分。</p><p>当我们在 AWS，或者 Google Cloud 这些公有云中申请计算资源的时候，云服务的提供商总是会叫我们选择一个系统镜像，然后做一些基础设置 (Hostname, SSH key 等等），然后在此基础上进行系统创建。cloud-init 正是在这个背景下诞生，自动化将用户数据初始化到系统实例中。</p><p>cloud-init 的主旨是定义一些独立于操作系统的配置，比如 hostname, networking configuration 等等。</p><p>cloud-init 特性：</p><ul><li>设置默认的 locale</li><li>设置 hostname</li><li>生成并设置 SSH 私钥</li><li>设置临时的挂载点</li></ul><p><strong>Boot Stages</strong></p><p>cloud-init 对系统的初始化分为这几个阶段：</p><ul><li>Generator</li><li>Local</li><li>Network</li><li>Config</li><li>Final</li></ul><p><strong>Generator</strong></p><p>当系统启动的时候，generator 会检查 cloud-init.target 是否需要启动。默认情况下，generator 会启动 cloud-init. 但是如下情况 cloud-init 不会在开机运行：</p><ul><li>&#x2F;etc&#x2F;cloud&#x2F;cloud-init.disabled 文件存在时</li><li>当内核命令发现文件 &#x2F;proc&#x2F;cmdline 包含 cloud-init&#x3D;disabled 时，当在容器中运行时，内核命令可能会被忽略，但是 cloud-init 会读取 KERNEL_CMDLINE 这个环境变量</li></ul><p><strong>Local</strong><br>Local 阶段会在挂载根分区 &#x2F; 时，立即执行<br><code>cloud-init-local.service</code></p><p>Local 阶段的目的是：</p><ul><li>查找 local data source</li><li>将网络配置应用到本地<br>  大多数情况下，这个阶段就只会做这些事情。它会在 datasource 中查找，并应用网络配置。网络配置可能从这些地方来：</li><li>datasource: 云端通过 metadata 提供</li><li>fallback: 通过 dhcp on eth0，在虚拟机内自行通过 DHCP 获取 IP</li><li>none: 网络配置可以通过 &#x2F;etc&#x2F;cloud&#x2F;cloud.cfg 中配置 network: {config: disabled} 来禁用<br>  如果是该实例的第一次启动，那么被选中的网络配置会被应用，所有老旧的配置都会会清除。</li></ul><p>该阶段需要阻止网络服务启动以及老的配置被应用，这可能带来一些负面的影响，比如 DHCP 服务挂起，或者已经广播了老的 hostname，这可能导致系统进入一个奇怪的状态需要重启网络设备。</p><p>cloud-init 然后再继续启动系统，将网络配置应用后启动。</p><p><strong>Network</strong></p><p>在 local 阶段后，网络服务启动后，启动<br><code>cloud-init.service</code><br>该阶段需要所有的网络配置已经被应用，并且网络在线，然后才会应用所有的 user-data</p><ul><li>递归检索任何 #include 或者 #include-once 包括 http</li><li>解压缩任何压缩的内容</li><li>运行任何找到的 part-handler<br>该阶段运行 disk_set 和 mounts 模块，可能会分区并格式化任何配置挂载点（比如 &#x2F;etc&#x2F;fstab中）的磁盘。这个模块不能再早运行，因为有可能有些信息来源于网络，只有等网络信息获取到后才能执行。比如用户可能在网络资源中提供了挂载点配置信息。<br>在一些云服务中，比如 Azure，这个阶段会创建可以被挂载的文件系统。</li></ul><p>part-handler 也会在这个阶段运行，包括 cloud-config bootcmd。</p><p><strong>Config</strong><br>在网络启动后运行：<br><code>cloud-config.service</code><br>这个阶段只会运行 config 模块，不会对其他阶段产生影响的模块在这里运行。</p><p><strong>Final</strong><br>启动的最后阶段运行：<br><code>cloud-final.service</code><br>用户登录系统后习惯于运行的脚本在这个阶段运行，包括：</p><ul><li>包安装</li><li>配置管理的插件 (puppet, chef, salt-minion)</li><li>用户脚本（包括 runcmd)</li></ul><p><strong>配置文件地址</strong><br>cloud-init 配置文件在：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/etc/</span>cloud/cloud.cfg<br><span class="hljs-regexp">/etc/</span>cloud<span class="hljs-regexp">/cloud.cfg.d/</span>*.cfg<br></code></pre></td></tr></table></figure><p>cloud-init 在配置文件 &#x2F;etc&#x2F;cloud&#x2F;cloud.cfg 中定义了各个阶段需要执行的任务，任务以 module 形式组织。 cloud.cfg 中指定了 set_hostname 这个 module, 则表示 cloud-init 会执行设置 hostname 的任务，但是具体设置的内容由 metadata 指定。</p><p>cloud-init 的日志在：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript">/var/<span class="hljs-built_in">log</span>/cloud-init-output.<span class="hljs-built_in">log</span>: 每一个阶段的输出<br>/var/<span class="hljs-built_in">log</span>/cloud-init.<span class="hljs-built_in">log</span>: 每一个操作更详细的调试日志<br>/<span class="hljs-built_in">run</span>/cloud-init: <span class="hljs-keyword">contains</span> logs <span class="hljs-keyword">about</span> how cloud-init decided <span class="hljs-keyword">to</span> enable <span class="hljs-keyword">or</span> disable itself, <span class="hljs-keyword">as</span> well <span class="hljs-keyword">as</span> what platforms/datasources were detected. These logs are most useful when trying <span class="hljs-keyword">to</span> determine what cloud-init ran <span class="hljs-keyword">or</span> did <span class="hljs-keyword">not</span> <span class="hljs-built_in">run</span>.<br></code></pre></td></tr></table></figure><p>数据存放在：<br><code>/var/lib/cloud</code></p>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Centos7 CloudInit 安装使用及配置说明</title>
    <link href="/2020/10/21/openstack/centos7_cloudinit/"/>
    <url>/2020/10/21/openstack/centos7_cloudinit/</url>
    
    <content type="html"><![CDATA[<p>1.使用本地YUM源安装cloud-init及其依赖，cloud-init版本18.2</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br></pre></td><td class="code"><pre><code class="hljs subunit">[root@localhost ~] yum -y install cloud-init<br><br>Loaded plugins: fastestmirror<br>Determining fastest mirrors<br>Resolving Dependencies<br>--&gt; Running transaction check<br>---&gt; Package cloud-init.x86_64 0:18.2<span class="hljs-string">-1</span>.el7.centos will be installed<br>--&gt; Processing Dependency: python-six for package: cloud-init<span class="hljs-string">-18</span>.2<span class="hljs-string">-1</span>.el7.centos.x86_64<br>--&gt; Processing Dependency: python-requests for package: cloud-init<span class="hljs-string">-18</span>.2<span class="hljs-string">-1</span>.el7.centos.x86_64<br>--&gt; Processing Dependency: python-prettytable for package: cloud-init<span class="hljs-string">-18</span>.2<span class="hljs-string">-1</span>.el7.centos.x86_64<br>--&gt; Processing Dependency: python-jsonpatch for package: cloud-init<span class="hljs-string">-18</span>.2<span class="hljs-string">-1</span>.el7.centos.x86_64<br>--&gt; Processing Dependency: python-jinja2 for package: cloud-init<span class="hljs-string">-18</span>.2<span class="hljs-string">-1</span>.el7.centos.x86_64<br>--&gt; Processing Dependency: pyserial for package: cloud-init<span class="hljs-string">-18</span>.2<span class="hljs-string">-1</span>.el7.centos.x86_64<br>--&gt; Processing Dependency: policycoreutils-python for package: cloud-init<span class="hljs-string">-18</span>.2<span class="hljs-string">-1</span>.el7.centos.x86_64<br>--&gt; Processing Dependency: PyYAML for package: cloud-init<span class="hljs-string">-18</span>.2<span class="hljs-string">-1</span>.el7.centos.x86_64<br>--&gt; Running transaction check<br>---&gt; Package PyYAML.x86_64 0:3.10<span class="hljs-string">-11</span>.el7 will be installed<br>--&gt; Processing Dependency: libyaml<span class="hljs-string">-0</span>.so.2()(64bit) for package: PyYAML<span class="hljs-string">-3</span>.10<span class="hljs-string">-11</span>.el7.x86_64<br>---&gt; Package policycoreutils-python.x86_64 0:2.5<span class="hljs-string">-29</span>.el7 will be installed<br>--&gt; Processing Dependency: policycoreutils = 2.5<span class="hljs-string">-29</span>.el7 for package: policycoreutils-python<span class="hljs-string">-2</span>.5<span class="hljs-string">-29</span>.el7.x86_64<br>--&gt; Processing Dependency: setools-libs &gt;= 3.3.8<span class="hljs-string">-4</span> for package: policycoreutils-python<span class="hljs-string">-2</span>.5<span class="hljs-string">-29</span>.el7.x86_64<br>--&gt; Processing Dependency: libsemanage-python &gt;= 2.5<span class="hljs-string">-14</span> for package: policycoreutils-python<span class="hljs-string">-2</span>.5<span class="hljs-string">-29</span>.el7.x86_64<br>--&gt; Processing Dependency: audit-libs-python &gt;= 2.1.3<span class="hljs-string">-4</span> for package: policycoreutils-python<span class="hljs-string">-2</span>.5<span class="hljs-string">-29</span>.el7.x86_64<br>--&gt; Processing Dependency: python-IPy for package: policycoreutils-python<span class="hljs-string">-2</span>.5<span class="hljs-string">-29</span>.el7.x86_64<br>--&gt; Processing Dependency: libqpol.so.1(VERS_1.4)(64bit) for package: policycoreutils-python<span class="hljs-string">-2</span>.5<span class="hljs-string">-29</span>.el7.x86_64<br>--&gt; Processing Dependency: libqpol.so.1(VERS_1.2)(64bit) for package: policycoreutils-python<span class="hljs-string">-2</span>.5<span class="hljs-string">-29</span>.el7.x86_64<br>--&gt; Processing Dependency: libcgroup for package: policycoreutils-python<span class="hljs-string">-2</span>.5<span class="hljs-string">-29</span>.el7.x86_64<br>--&gt; Processing Dependency: libapol.so.4(VERS_4.0)(64bit) for package: policycoreutils-python<span class="hljs-string">-2</span>.5<span class="hljs-string">-29</span>.el7.x86_64<br>--&gt; Processing Dependency: checkpolicy for package: policycoreutils-python<span class="hljs-string">-2</span>.5<span class="hljs-string">-29</span>.el7.x86_64<br>--&gt; Processing Dependency: libqpol.so.1()(64bit) for package: policycoreutils-python<span class="hljs-string">-2</span>.5<span class="hljs-string">-29</span>.el7.x86_64<br>--&gt; Processing Dependency: libapol.so.4()(64bit) for package: policycoreutils-python<span class="hljs-string">-2</span>.5<span class="hljs-string">-29</span>.el7.x86_64<br>---&gt; Package pyserial.noarch 0:2.6<span class="hljs-string">-6</span>.el7 will be installed<br>---&gt; Package python-prettytable.noarch 0:0.7.2<span class="hljs-string">-3</span>.el7 will be installed<br>---&gt; Package python2-jinja2.noarch 0:2.10<span class="hljs-string">-2</span>.el7 will be installed<br>--&gt; Processing Dependency: python2-babel &gt;= 0.8 for package: python2-jinja2<span class="hljs-string">-2</span>.10<span class="hljs-string">-2</span>.el7.noarch<br>--&gt; Processing Dependency: python2-markupsafe for package: python2-jinja2<span class="hljs-string">-2</span>.10<span class="hljs-string">-2</span>.el7.noarch<br>---&gt; Package python2-jsonpatch.noarch 0:1.21<span class="hljs-string">-1</span>.el7 will be installed<br>--&gt; Processing Dependency: python2-jsonpointer for package: python2-jsonpatch<span class="hljs-string">-1</span>.21<span class="hljs-string">-1</span>.el7.noarch<br>---&gt; Package python2-requests.noarch 0:2.14.2<span class="hljs-string">-1</span>.el7 will be installed<br>--&gt; Processing Dependency: python2-urllib3 = 1.21.1 for package: python2-requests<span class="hljs-string">-2</span>.14.2<span class="hljs-string">-1</span>.el7.noarch<br>--&gt; Processing Dependency: python-idna for package: python2-requests<span class="hljs-string">-2</span>.14.2<span class="hljs-string">-1</span>.el7.noarch<br>--&gt; Processing Dependency: python-chardet for package: python2-requests<span class="hljs-string">-2</span>.14.2<span class="hljs-string">-1</span>.el7.noarch<br>---&gt; Package python2-six.noarch 0:1.10.0<span class="hljs-string">-9</span>.el7 will be installed<br>--&gt; Running transaction check<br>---&gt; Package audit-libs-python.x86_64 0:2.8.4<span class="hljs-string">-4</span>.el7 will be installed<br>--&gt; Processing Dependency: audit-libs(x86<span class="hljs-string">-64</span>) = 2.8.4<span class="hljs-string">-4</span>.el7 for package: audit-libs-python<span class="hljs-string">-2</span>.8.4<span class="hljs-string">-4</span>.el7.x86_64<br>---&gt; Package checkpolicy.x86_64 0:2.5<span class="hljs-string">-8</span>.el7 will be installed<br>---&gt; Package libcgroup.x86_64 0:0.41<span class="hljs-string">-20</span>.el7 will be installed<br>---&gt; Package libsemanage-python.x86_64 0:2.5<span class="hljs-string">-14</span>.el7 will be installed<br>--&gt; Processing Dependency: libsemanage = 2.5<span class="hljs-string">-14</span>.el7 for package: libsemanage-python<span class="hljs-string">-2</span>.5<span class="hljs-string">-14</span>.el7.x86_64<br>---&gt; Package libyaml.x86_64 0:0.1.4<span class="hljs-string">-11</span>.el7_0 will be installed<br>---&gt; Package policycoreutils.x86_64 0:2.5<span class="hljs-string">-22</span>.el7 will be updated<br>---&gt; Package policycoreutils.x86_64 0:2.5<span class="hljs-string">-29</span>.el7 will be an update<br>--&gt; Processing Dependency: libsepol &gt;= 2.5<span class="hljs-string">-10</span> for package: policycoreutils<span class="hljs-string">-2</span>.5<span class="hljs-string">-29</span>.el7.x86_64<br>--&gt; Processing Dependency: libselinux-utils &gt;= 2.5<span class="hljs-string">-14</span> for package: policycoreutils<span class="hljs-string">-2</span>.5<span class="hljs-string">-29</span>.el7.x86_64<br>---&gt; Package python-IPy.noarch 0:0.75<span class="hljs-string">-6</span>.el7 will be installed<br>---&gt; Package python-chardet.noarch 0:2.2.1<span class="hljs-string">-1</span>.el7_1 will be installed<br>---&gt; Package python2-babel.noarch 0:2.3.4<span class="hljs-string">-1</span>.el7 will be installed<br>--&gt; Processing Dependency: pytz for package: python2-babel<span class="hljs-string">-2</span>.3.4<span class="hljs-string">-1</span>.el7.noarch<br>---&gt; Package python2-idna.noarch 0:2.5<span class="hljs-string">-1</span>.el7 will be installed<br>---&gt; Package python2-jsonpointer.noarch 0:1.10<span class="hljs-string">-4</span>.el7 will be installed<br>---&gt; Package python2-markupsafe.x86_64 0:0.23<span class="hljs-string">-16</span>.el7 will be installed<br>---&gt; Package python2-urllib3.noarch 0:1.21.1<span class="hljs-string">-1</span>.el7 will be installed<br>--&gt; Processing Dependency: python2-pyOpenSSL for package: python2-urllib3<span class="hljs-string">-1</span>.21.1<span class="hljs-string">-1</span>.el7.noarch<br>--&gt; Processing Dependency: python-pysocks for package: python2-urllib3<span class="hljs-string">-1</span>.21.1<span class="hljs-string">-1</span>.el7.noarch<br>--&gt; Processing Dependency: python-cryptography for package: python2-urllib3<span class="hljs-string">-1</span>.21.1<span class="hljs-string">-1</span>.el7.noarch<br>---&gt; Package setools-libs.x86_64 0:3.3.8<span class="hljs-string">-4</span>.el7 will be installed<br>--&gt; Processing Dependency: libselinux &gt;= 2.5<span class="hljs-string">-14</span>.1 for package: setools-libs<span class="hljs-string">-3</span>.3.8<span class="hljs-string">-4</span>.el7.x86_64<br>--&gt; Running transaction check<br>---&gt; Package audit-libs.x86_64 0:2.8.1<span class="hljs-string">-3</span>.el7 will be updated<br>--&gt; Processing Dependency: audit-libs(x86<span class="hljs-string">-64</span>) = 2.8.1<span class="hljs-string">-3</span>.el7 for package: audit<span class="hljs-string">-2</span>.8.1<span class="hljs-string">-3</span>.el7.x86_64<br>---&gt; Package audit-libs.x86_64 0:2.8.4<span class="hljs-string">-4</span>.el7 will be an update<br>---&gt; Package libselinux.x86_64 0:2.5<span class="hljs-string">-12</span>.el7 will be updated<br>--&gt; Processing Dependency: libselinux(x86<span class="hljs-string">-64</span>) = 2.5<span class="hljs-string">-12</span>.el7 for package: libselinux-python<span class="hljs-string">-2</span>.5<span class="hljs-string">-12</span>.el7.x86_64<br>---&gt; Package libselinux.x86_64 0:2.5<span class="hljs-string">-14</span>.1.el7 will be an update<br>---&gt; Package libselinux-utils.x86_64 0:2.5<span class="hljs-string">-12</span>.el7 will be updated<br>---&gt; Package libselinux-utils.x86_64 0:2.5<span class="hljs-string">-14</span>.1.el7 will be an update<br>---&gt; Package libsemanage.x86_64 0:2.5<span class="hljs-string">-11</span>.el7 will be updated<br>---&gt; Package libsemanage.x86_64 0:2.5<span class="hljs-string">-14</span>.el7 will be an update<br>---&gt; Package libsepol.x86_64 0:2.5<span class="hljs-string">-8</span>.1.el7 will be updated<br>---&gt; Package libsepol.x86_64 0:2.5<span class="hljs-string">-10</span>.el7 will be an update<br>---&gt; Package python2-cryptography.x86_64 0:2.1.4<span class="hljs-string">-2</span>.el7 will be installed<br>--&gt; Processing Dependency: python2-cffi &gt;= 1.7 for package: python2-cryptography<span class="hljs-string">-2</span>.1.4<span class="hljs-string">-2</span>.el7.x86_64<br>--&gt; Processing Dependency: python2-asn1crypto &gt;= 0.21 for package: python2-cryptography<span class="hljs-string">-2</span>.1.4<span class="hljs-string">-2</span>.el7.x86_64<br>--&gt; Processing Dependency: python-enum34 for package: python2-cryptography<span class="hljs-string">-2</span>.1.4<span class="hljs-string">-2</span>.el7.x86_64<br>---&gt; Package python2-pyOpenSSL.noarch 0:17.3.0<span class="hljs-string">-3</span>.el7 will be installed<br>---&gt; Package python2-pysocks.noarch 0:1.5.6<span class="hljs-string">-3</span>.el7 will be installed<br>---&gt; Package pytz.noarch 0:2016.10<span class="hljs-string">-2</span>.el7 will be installed<br>--&gt; Running transaction check<br>---&gt; Package audit.x86_64 0:2.8.1<span class="hljs-string">-3</span>.el7 will be updated<br>---&gt; Package audit.x86_64 0:2.8.4<span class="hljs-string">-4</span>.el7 will be an update<br>---&gt; Package libselinux-python.x86_64 0:2.5<span class="hljs-string">-12</span>.el7 will be updated<br>---&gt; Package libselinux-python.x86_64 0:2.5<span class="hljs-string">-14</span>.1.el7 will be an update<br>---&gt; Package python-enum34.noarch 0:1.0.4<span class="hljs-string">-1</span>.el7 will be installed<br>---&gt; Package python2-asn1crypto.noarch 0:0.23.0<span class="hljs-string">-2</span>.el7 will be installed<br>---&gt; Package python2-cffi.x86_64 0:1.11.2<span class="hljs-string">-1</span>.el7 will be installed<br>--&gt; Processing Dependency: python-pycparser for package: python2-cffi<span class="hljs-string">-1</span>.11.2<span class="hljs-string">-1</span>.el7.x86_64<br>--&gt; Running transaction check<br>---&gt; Package python-pycparser.noarch 0:2.14<span class="hljs-string">-1</span>.el7 will be installed<br>--&gt; Processing Dependency: python-ply for package: python-pycparser<span class="hljs-string">-2</span>.14<span class="hljs-string">-1</span>.el7.noarch<br>--&gt; Running transaction check<br>---&gt; Package python-ply.noarch 0:3.4<span class="hljs-string">-11</span>.el7 will be installed<br>--&gt; Finished Dependency Resolution<br><br>Dependencies Resolved<br><br>================================================================================<br> Package                     Arch        Version                Repository<br>                                                                           Size<br>================================================================================<br>Installing:<br> cloud-init                  x86_64      18.2<span class="hljs-string">-1</span>.el7.centos      kdpa      776 k<br>Installing for dependencies:<br> PyYAML                      x86_64      3.10<span class="hljs-string">-11</span>.el7            kdpa      153 k<br> audit-libs-python           x86_64      2.8.4<span class="hljs-string">-4</span>.el7            kdpa       76 k<br> checkpolicy                 x86_64      2.5<span class="hljs-string">-8</span>.el7              kdpa      295 k<br> libcgroup                   x86_64      0.41<span class="hljs-string">-20</span>.el7            kdpa       66 k<br> libsemanage-python          x86_64      2.5<span class="hljs-string">-14</span>.el7             kdpa      113 k<br> libyaml                     x86_64      0.1.4<span class="hljs-string">-11</span>.el7_0         kdpa       55 k<br> policycoreutils-python      x86_64      2.5<span class="hljs-string">-29</span>.el7             kdpa      456 k<br> pyserial                    noarch      2.6<span class="hljs-string">-6</span>.el7              kdpa      124 k<br> python-IPy                  noarch      0.75<span class="hljs-string">-6</span>.el7             kdpa       32 k<br> python-chardet              noarch      2.2.1<span class="hljs-string">-1</span>.el7_1          kdpa      227 k<br> python-enum34               noarch      1.0.4<span class="hljs-string">-1</span>.el7            kdpa       52 k<br> python-ply                  noarch      3.4<span class="hljs-string">-11</span>.el7             kdpa      123 k<br> python-prettytable          noarch      0.7.2<span class="hljs-string">-3</span>.el7            kdpa       37 k<br> python-pycparser            noarch      2.14<span class="hljs-string">-1</span>.el7             kdpa      104 k<br> python2-asn1crypto          noarch      0.23.0<span class="hljs-string">-2</span>.el7           kdpa      172 k<br> python2-babel               noarch      2.3.4<span class="hljs-string">-1</span>.el7            kdpa      4.8 M<br> python2-cffi                x86_64      1.11.2<span class="hljs-string">-1</span>.el7           kdpa      229 k<br> python2-cryptography        x86_64      2.1.4<span class="hljs-string">-2</span>.el7            kdpa      510 k<br> python2-idna                noarch      2.5<span class="hljs-string">-1</span>.el7              kdpa       94 k<br> python2-jinja2              noarch      2.10<span class="hljs-string">-2</span>.el7             kdpa      527 k<br> python2-jsonpatch           noarch      1.21<span class="hljs-string">-1</span>.el7             kdpa       21 k<br> python2-jsonpointer         noarch      1.10<span class="hljs-string">-4</span>.el7             kdpa       14 k<br> python2-markupsafe          x86_64      0.23<span class="hljs-string">-16</span>.el7            kdpa       32 k<br> python2-pyOpenSSL           noarch      17.3.0<span class="hljs-string">-3</span>.el7           kdpa       92 k<br> python2-pysocks             noarch      1.5.6<span class="hljs-string">-3</span>.el7            kdpa       20 k<br> python2-requests            noarch      2.14.2<span class="hljs-string">-1</span>.el7           kdpa      116 k<br> python2-six                 noarch      1.10.0<span class="hljs-string">-9</span>.el7           kdpa       31 k<br> python2-urllib3             noarch      1.21.1<span class="hljs-string">-1</span>.el7           kdpa      173 k<br> pytz                        noarch      2016.10<span class="hljs-string">-2</span>.el7          kdpa       46 k<br> setools-libs                x86_64      3.3.8<span class="hljs-string">-4</span>.el7            kdpa      620 k<br>Updating for dependencies:<br> audit                       x86_64      2.8.4<span class="hljs-string">-4</span>.el7            kdpa      250 k<br> audit-libs                  x86_64      2.8.4<span class="hljs-string">-4</span>.el7            kdpa      100 k<br> libselinux                  x86_64      2.5<span class="hljs-string">-14</span>.1.el7           kdpa      162 k<br> libselinux-python           x86_64      2.5<span class="hljs-string">-14</span>.1.el7           kdpa      235 k<br> libselinux-utils            x86_64      2.5<span class="hljs-string">-14</span>.1.el7           kdpa      151 k<br> libsemanage                 x86_64      2.5<span class="hljs-string">-14</span>.el7             kdpa      151 k<br> libsepol                    x86_64      2.5<span class="hljs-string">-10</span>.el7             kdpa      297 k<br> policycoreutils             x86_64      2.5<span class="hljs-string">-29</span>.el7             kdpa      916 k<br><br>Transaction Summary<br>================================================================================<br>Install  1 Package  (<span class="hljs-string">+30</span> Dependent packages)<br>Upgrade             (  8 Dependent packages)<br><br>Total download size: 12 M<br>Downloading packages:<br>Delta RPMs disabled because /usr/bin/applydeltarpm not installed.<br>--------------------------------------------------------------------------------<br>Total                                               16 MB/s |  12 MB  00:00     <br>Running transaction check<br>Running transaction test<br>Transaction test succeeded<br>Running transaction<br>  Updating   : libsepol<span class="hljs-string">-2</span>.5<span class="hljs-string">-10</span>.el7.x86_64                                  1/47 <br>  Updating   : libselinux<span class="hljs-string">-2</span>.5<span class="hljs-string">-14</span>.1.el7.x86_64                              2/47 <br>  Updating   : audit-libs<span class="hljs-string">-2</span>.8.4<span class="hljs-string">-4</span>.el7.x86_64                               3/47 <br>  Installing : python2-idna<span class="hljs-string">-2</span>.5<span class="hljs-string">-1</span>.el7.noarch                               4/47 <br>  Installing : python2-six<span class="hljs-string">-1</span>.10.0<span class="hljs-string">-9</span>.el7.noarch                             5/47 <br>  Updating   : libsemanage<span class="hljs-string">-2</span>.5<span class="hljs-string">-14</span>.el7.x86_64                               6/47 <br>  Updating   : libselinux-python<span class="hljs-string">-2</span>.5<span class="hljs-string">-14</span>.1.el7.x86_64                       7/47 <br>  Installing : libsemanage-python<span class="hljs-string">-2</span>.5<span class="hljs-string">-14</span>.el7.x86_64                        8/47 <br>  Installing : audit-libs-python<span class="hljs-string">-2</span>.8.4<span class="hljs-string">-4</span>.el7.x86_64                        9/47 <br>  Installing : setools-libs<span class="hljs-string">-3</span>.3.8<span class="hljs-string">-4</span>.el7.x86_64                            10/47 <br>  Updating   : libselinux-utils<span class="hljs-string">-2</span>.5<span class="hljs-string">-14</span>.1.el7.x86_64                       11/47 <br>  Updating   : policycoreutils<span class="hljs-string">-2</span>.5<span class="hljs-string">-29</span>.el7.x86_64                          12/47 <br>  Installing : python-chardet<span class="hljs-string">-2</span>.2.1<span class="hljs-string">-1</span>.el7_1.noarch                        13/47 <br>  Installing : python-prettytable<span class="hljs-string">-0</span>.7.2<span class="hljs-string">-3</span>.el7.noarch                      14/47 <br>  Installing : libyaml<span class="hljs-string">-0</span>.1.4<span class="hljs-string">-11</span>.el7_0.x86_64                              15/47 <br>  Installing : PyYAML<span class="hljs-string">-3</span>.10<span class="hljs-string">-11</span>.el7.x86_64                                  16/47 <br>  Installing : python-ply<span class="hljs-string">-3</span>.4<span class="hljs-string">-11</span>.el7.noarch                               17/47 <br>  Installing : python-pycparser<span class="hljs-string">-2</span>.14<span class="hljs-string">-1</span>.el7.noarch                         18/47 <br>  Installing : python2-cffi<span class="hljs-string">-1</span>.11.2<span class="hljs-string">-1</span>.el7.x86_64                           19/47 <br>  Installing : checkpolicy<span class="hljs-string">-2</span>.5<span class="hljs-string">-8</span>.el7.x86_64                               20/47 <br>  Installing : python2-asn1crypto<span class="hljs-string">-0</span>.23.0<span class="hljs-string">-2</span>.el7.noarch                     21/47 <br>  Installing : python2-markupsafe<span class="hljs-string">-0</span>.23<span class="hljs-string">-16</span>.el7.x86_64                      22/47 <br>  Installing : python2-jsonpointer<span class="hljs-string">-1</span>.10<span class="hljs-string">-4</span>.el7.noarch                      23/47 <br>  Installing : python2-jsonpatch<span class="hljs-string">-1</span>.21<span class="hljs-string">-1</span>.el7.noarch                        24/47 <br>  Installing : python-IPy<span class="hljs-string">-0</span>.75<span class="hljs-string">-6</span>.el7.noarch                               25/47 <br>  Installing : python2-pysocks<span class="hljs-string">-1</span>.5.6<span class="hljs-string">-3</span>.el7.noarch                         26/47 <br>  Installing : pytz<span class="hljs-string">-2016</span>.10<span class="hljs-string">-2</span>.el7.noarch                                  27/47 <br>  Installing : python2-babel<span class="hljs-string">-2</span>.3.4<span class="hljs-string">-1</span>.el7.noarch                           28/47 <br>  Installing : python2-jinja2<span class="hljs-string">-2</span>.10<span class="hljs-string">-2</span>.el7.noarch                           29/47 <br>  Installing : pyserial<span class="hljs-string">-2</span>.6<span class="hljs-string">-6</span>.el7.noarch                                  30/47 <br>  Installing : python-enum34<span class="hljs-string">-1</span>.0.4<span class="hljs-string">-1</span>.el7.noarch                           31/47 <br>  Installing : python2-cryptography<span class="hljs-string">-2</span>.1.4<span class="hljs-string">-2</span>.el7.x86_64                    32/47 <br>  Installing : python2-pyOpenSSL<span class="hljs-string">-17</span>.3.0<span class="hljs-string">-3</span>.el7.noarch                      33/47 <br>  Installing : python2-urllib3<span class="hljs-string">-1</span>.21.1<span class="hljs-string">-1</span>.el7.noarch                        34/47 <br>  Installing : python2-requests<span class="hljs-string">-2</span>.14.2<span class="hljs-string">-1</span>.el7.noarch                       35/47 <br>  Installing : libcgroup<span class="hljs-string">-0</span>.41<span class="hljs-string">-20</span>.el7.x86_64                               36/47 <br>  Installing : policycoreutils-python<span class="hljs-string">-2</span>.5<span class="hljs-string">-29</span>.el7.x86_64                   37/47 <br>  Installing : cloud-init<span class="hljs-string">-18</span>.2<span class="hljs-string">-1</span>.el7.centos.x86_64                        38/47 <br>  Updating   : audit<span class="hljs-string">-2</span>.8.4<span class="hljs-string">-4</span>.el7.x86_64                                   39/47 <br>  Cleanup    : policycoreutils<span class="hljs-string">-2</span>.5<span class="hljs-string">-22</span>.el7.x86_64                          40/47 <br>  Cleanup    : libsemanage<span class="hljs-string">-2</span>.5<span class="hljs-string">-11</span>.el7.x86_64                              41/47 <br>  Cleanup    : libselinux-utils<span class="hljs-string">-2</span>.5<span class="hljs-string">-12</span>.el7.x86_64                         42/47 <br>  Cleanup    : libselinux-python<span class="hljs-string">-2</span>.5<span class="hljs-string">-12</span>.el7.x86_64                        43/47 <br>  Cleanup    : libselinux<span class="hljs-string">-2</span>.5<span class="hljs-string">-12</span>.el7.x86_64                               44/47 <br>  Cleanup    : audit<span class="hljs-string">-2</span>.8.1<span class="hljs-string">-3</span>.el7.x86_64                                   45/47 <br>  Cleanup    : audit-libs<span class="hljs-string">-2</span>.8.1<span class="hljs-string">-3</span>.el7.x86_64                              46/47 <br>  Cleanup    : libsepol<span class="hljs-string">-2</span>.5<span class="hljs-string">-8</span>.1.el7.x86_64                                47/47 <br>  Verifying  : libcgroup<span class="hljs-string">-0</span>.41<span class="hljs-string">-20</span>.el7.x86_64                                1/47 <br>  Verifying  : python-enum34<span class="hljs-string">-1</span>.0.4<span class="hljs-string">-1</span>.el7.noarch                            2/47 <br>  Verifying  : pyserial<span class="hljs-string">-2</span>.6<span class="hljs-string">-6</span>.el7.noarch                                   3/47 <br>  Verifying  : cloud-init<span class="hljs-string">-18</span>.2<span class="hljs-string">-1</span>.el7.centos.x86_64                         4/47 <br>  Verifying  : audit-libs<span class="hljs-string">-2</span>.8.4<span class="hljs-string">-4</span>.el7.x86_64                               5/47 <br>  Verifying  : audit<span class="hljs-string">-2</span>.8.4<span class="hljs-string">-4</span>.el7.x86_64                                    6/47 <br>  Verifying  : pytz<span class="hljs-string">-2016</span>.10<span class="hljs-string">-2</span>.el7.noarch                                   7/47 <br>  Verifying  : python2-pysocks<span class="hljs-string">-1</span>.5.6<span class="hljs-string">-3</span>.el7.noarch                          8/47 <br>  Verifying  : python-IPy<span class="hljs-string">-0</span>.75<span class="hljs-string">-6</span>.el7.noarch                                9/47 <br>  Verifying  : python2-cffi<span class="hljs-string">-1</span>.11.2<span class="hljs-string">-1</span>.el7.x86_64                           10/47 <br>  Verifying  : python2-requests<span class="hljs-string">-2</span>.14.2<span class="hljs-string">-1</span>.el7.noarch                       11/47 <br>  Verifying  : python2-jsonpatch<span class="hljs-string">-1</span>.21<span class="hljs-string">-1</span>.el7.noarch                        12/47 <br>  Verifying  : python2-jsonpointer<span class="hljs-string">-1</span>.10<span class="hljs-string">-4</span>.el7.noarch                      13/47 <br>  Verifying  : setools-libs<span class="hljs-string">-3</span>.3.8<span class="hljs-string">-4</span>.el7.x86_64                            14/47 <br>  Verifying  : policycoreutils<span class="hljs-string">-2</span>.5<span class="hljs-string">-29</span>.el7.x86_64                          15/47 <br>  Verifying  : python2-markupsafe<span class="hljs-string">-0</span>.23<span class="hljs-string">-16</span>.el7.x86_64                      16/47 <br>  Verifying  : python2-urllib3<span class="hljs-string">-1</span>.21.1<span class="hljs-string">-1</span>.el7.noarch                        17/47 <br>  Verifying  : libsemanage-python<span class="hljs-string">-2</span>.5<span class="hljs-string">-14</span>.el7.x86_64                       18/47 <br>  Verifying  : python2-asn1crypto<span class="hljs-string">-0</span>.23.0<span class="hljs-string">-2</span>.el7.noarch                     19/47 <br>  Verifying  : python2-babel<span class="hljs-string">-2</span>.3.4<span class="hljs-string">-1</span>.el7.noarch                           20/47 <br>  Verifying  : libsemanage<span class="hljs-string">-2</span>.5<span class="hljs-string">-14</span>.el7.x86_64                              21/47 <br>  Verifying  : libsepol<span class="hljs-string">-2</span>.5<span class="hljs-string">-10</span>.el7.x86_64                                 22/47 <br>  Verifying  : python2-cryptography<span class="hljs-string">-2</span>.1.4<span class="hljs-string">-2</span>.el7.x86_64                    23/47 <br>  Verifying  : checkpolicy<span class="hljs-string">-2</span>.5<span class="hljs-string">-8</span>.el7.x86_64                               24/47 <br>  Verifying  : python-ply<span class="hljs-string">-3</span>.4<span class="hljs-string">-11</span>.el7.noarch                               25/47 <br>  Verifying  : python2-six<span class="hljs-string">-1</span>.10.0<span class="hljs-string">-9</span>.el7.noarch                            26/47 <br>  Verifying  : libselinux-python<span class="hljs-string">-2</span>.5<span class="hljs-string">-14</span>.1.el7.x86_64                      27/47 <br>  Verifying  : audit-libs-python<span class="hljs-string">-2</span>.8.4<span class="hljs-string">-4</span>.el7.x86_64                       28/47 <br>  Verifying  : python-pycparser<span class="hljs-string">-2</span>.14<span class="hljs-string">-1</span>.el7.noarch                         29/47 <br>  Verifying  : libyaml<span class="hljs-string">-0</span>.1.4<span class="hljs-string">-11</span>.el7_0.x86_64                              30/47 <br>  Verifying  : python-prettytable<span class="hljs-string">-0</span>.7.2<span class="hljs-string">-3</span>.el7.noarch                      31/47 <br>  Verifying  : libselinux-utils<span class="hljs-string">-2</span>.5<span class="hljs-string">-14</span>.1.el7.x86_64                       32/47 <br>  Verifying  : policycoreutils-python<span class="hljs-string">-2</span>.5<span class="hljs-string">-29</span>.el7.x86_64                   33/47 <br>  Verifying  : python2-idna<span class="hljs-string">-2</span>.5<span class="hljs-string">-1</span>.el7.noarch                              34/47 <br>  Verifying  : python-chardet<span class="hljs-string">-2</span>.2.1<span class="hljs-string">-1</span>.el7_1.noarch                        35/47 <br>  Verifying  : PyYAML<span class="hljs-string">-3</span>.10<span class="hljs-string">-11</span>.el7.x86_64                                  36/47 <br>  Verifying  : libselinux<span class="hljs-string">-2</span>.5<span class="hljs-string">-14</span>.1.el7.x86_64                             37/47 <br>  Verifying  : python2-jinja2<span class="hljs-string">-2</span>.10<span class="hljs-string">-2</span>.el7.noarch                           38/47 <br>  Verifying  : python2-pyOpenSSL<span class="hljs-string">-17</span>.3.0<span class="hljs-string">-3</span>.el7.noarch                      39/47 <br>  Verifying  : libsemanage<span class="hljs-string">-2</span>.5<span class="hljs-string">-11</span>.el7.x86_64                              40/47 <br>  Verifying  : libselinux-python<span class="hljs-string">-2</span>.5<span class="hljs-string">-12</span>.el7.x86_64                        41/47 <br>  Verifying  : audit-libs<span class="hljs-string">-2</span>.8.1<span class="hljs-string">-3</span>.el7.x86_64                              42/47 <br>  Verifying  : libselinux-utils<span class="hljs-string">-2</span>.5<span class="hljs-string">-12</span>.el7.x86_64                         43/47 <br>  Verifying  : policycoreutils<span class="hljs-string">-2</span>.5<span class="hljs-string">-22</span>.el7.x86_64                          44/47 <br>  Verifying  : audit<span class="hljs-string">-2</span>.8.1<span class="hljs-string">-3</span>.el7.x86_64                                   45/47 <br>  Verifying  : libsepol<span class="hljs-string">-2</span>.5<span class="hljs-string">-8</span>.1.el7.x86_64                                46/47 <br>  Verifying  : libselinux<span class="hljs-string">-2</span>.5<span class="hljs-string">-12</span>.el7.x86_64                               47/47 <br><br>Installed:<br>  cloud-init.x86_64 0:18.2<span class="hljs-string">-1</span>.el7.centos                                         <br><br>Dependency Installed:<br>  PyYAML.x86_64 0:3.10<span class="hljs-string">-11</span>.el7                                                   <br>  audit-libs-python.x86_64 0:2.8.4<span class="hljs-string">-4</span>.el7                                        <br>  checkpolicy.x86_64 0:2.5<span class="hljs-string">-8</span>.el7                                                <br>  libcgroup.x86_64 0:0.41<span class="hljs-string">-20</span>.el7                                                <br>  libsemanage-python.x86_64 0:2.5<span class="hljs-string">-14</span>.el7                                        <br>  libyaml.x86_64 0:0.1.4<span class="hljs-string">-11</span>.el7_0                                               <br>  policycoreutils-python.x86_64 0:2.5<span class="hljs-string">-29</span>.el7                                    <br>  pyserial.noarch 0:2.6<span class="hljs-string">-6</span>.el7                                                   <br>  python-IPy.noarch 0:0.75<span class="hljs-string">-6</span>.el7                                                <br>  python-chardet.noarch 0:2.2.1<span class="hljs-string">-1</span>.el7_1                                         <br>  python-enum34.noarch 0:1.0.4<span class="hljs-string">-1</span>.el7                                            <br>  python-ply.noarch 0:3.4<span class="hljs-string">-11</span>.el7                                                <br>  python-prettytable.noarch 0:0.7.2<span class="hljs-string">-3</span>.el7                                       <br>  python-pycparser.noarch 0:2.14<span class="hljs-string">-1</span>.el7                                          <br>  python2-asn1crypto.noarch 0:0.23.0<span class="hljs-string">-2</span>.el7                                      <br>  python2-babel.noarch 0:2.3.4<span class="hljs-string">-1</span>.el7                                            <br>  python2-cffi.x86_64 0:1.11.2<span class="hljs-string">-1</span>.el7                                            <br>  python2-cryptography.x86_64 0:2.1.4<span class="hljs-string">-2</span>.el7                                     <br>  python2-idna.noarch 0:2.5<span class="hljs-string">-1</span>.el7                                               <br>  python2-jinja2.noarch 0:2.10<span class="hljs-string">-2</span>.el7                                            <br>  python2-jsonpatch.noarch 0:1.21<span class="hljs-string">-1</span>.el7                                         <br>  python2-jsonpointer.noarch 0:1.10<span class="hljs-string">-4</span>.el7                                       <br>  python2-markupsafe.x86_64 0:0.23<span class="hljs-string">-16</span>.el7                                       <br>  python2-pyOpenSSL.noarch 0:17.3.0<span class="hljs-string">-3</span>.el7                                       <br>  python2-pysocks.noarch 0:1.5.6<span class="hljs-string">-3</span>.el7                                          <br>  python2-requests.noarch 0:2.14.2<span class="hljs-string">-1</span>.el7                                        <br>  python2-six.noarch 0:1.10.0<span class="hljs-string">-9</span>.el7                                             <br>  python2-urllib3.noarch 0:1.21.1<span class="hljs-string">-1</span>.el7                                         <br>  pytz.noarch 0:2016.10<span class="hljs-string">-2</span>.el7                                                   <br>  setools-libs.x86_64 0:3.3.8<span class="hljs-string">-4</span>.el7                                             <br><br>Dependency Updated:<br>  audit.x86_64 0:2.8.4<span class="hljs-string">-4</span>.el7                                                    <br>  audit-libs.x86_64 0:2.8.4<span class="hljs-string">-4</span>.el7                                               <br>  libselinux.x86_64 0:2.5<span class="hljs-string">-14</span>.1.el7                                              <br>  libselinux-python.x86_64 0:2.5<span class="hljs-string">-14</span>.1.el7                                       <br>  libselinux-utils.x86_64 0:2.5<span class="hljs-string">-14</span>.1.el7                                        <br>  libsemanage.x86_64 0:2.5<span class="hljs-string">-14</span>.el7                                               <br>  libsepol.x86_64 0:2.5<span class="hljs-string">-10</span>.el7                                                  <br>  policycoreutils.x86_64 0:2.5<span class="hljs-string">-29</span>.el7                                           <br><br>Complete!<br></code></pre></td></tr></table></figure><p>2.查看cloud-init是否安装成功。</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs swift">[root<span class="hljs-meta">@localhost</span> <span class="hljs-operator">~</span>] cloud<span class="hljs-operator">-</span><span class="hljs-keyword">init</span> <span class="hljs-operator">-</span>v<br><span class="hljs-regexp">/bin/</span>cloud<span class="hljs-operator">-</span><span class="hljs-keyword">init</span> <span class="hljs-number">18.2</span><br></code></pre></td></tr></table></figure><p>3.cloud-init默认日志路径：&#x2F;var&#x2F;log&#x2F;cloud-init.log</p>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows CloudBase-Init 安装使用及配置说明</title>
    <link href="/2020/10/20/openstack/windows_cloudbase_init/"/>
    <url>/2020/10/20/openstack/windows_cloudbase_init/</url>
    
    <content type="html"><![CDATA[<p>1.下载Windows CloudBase-Init安装包，地址：<br><a href="https://cloudbase.it/cloudbase-init/#download">https://cloudbase.it/cloudbase-init/#download</a></p><p>当前版本为：CloudbaseInitSetup_1_1_2_x64.msi</p><p>2.安装：<br><img src="/images/windows_cloudinit_install1.png" alt="安装步骤1"><br><img src="/images/windows_cloudinit_install2.png" alt="安装步骤2"><br>安装目录默认为 C:\Program Files\Cloudbase Solutions\Cloudbase-Init<br><img src="/images/windows_cloudinit_install3.png" alt="安装步骤3"><br>用户名修改为当前Windows超级管理员Administrator<br>这里不勾选Use metadata password，勾选此项这里会在孵化虚拟机时生成新的随机密码<br>Serial口选择Windows当前使用的串口COM1<br><img src="/images/windows_cloudinit_install4.png" alt="安装步骤4"><br><img src="/images/windows_cloudinit_install5.png" alt="安装步骤5"><br><img src="/images/windows_cloudinit_install6.png" alt="安装步骤6"><br>安装结束，不勾选Run Sysprep to create a generalized image.及 Shutdown when Sysprep terminates.<br><img src="/images/windows_cloudinit_install7.png" alt="安装步骤7"></p><p>3.安装结束之后，修改Cloudbaase-init配置文件：<br>C:\Program Files\Cloudbase Solutions\Cloudbase-Init\conf\下的<br>cloudbase-init.conf及cloudbase-init-unattend.conf<br>配置修改为：<br>安装CloudBase-init后，cloudbase-init会自动重启，将其关闭重启：<br>allow_reboot&#x3D;false</p><p>关闭CloudBase-init自动更新：<br>check_latest_version&#x3D;false</p><p>4.* Windows在安装cloudbase-init后需要重新启动，再制作镜像。</p><p>5.使用Openstack在孵化过程中上传的文件目录为(E:)config\openstack\content\下。</p>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>cloudbase-init</title>
    <link href="/2020/10/19/openstack/cloud_base-int/"/>
    <url>/2020/10/19/openstack/cloud_base-int/</url>
    
    <content type="html"><![CDATA[<p><strong>官方文档: <a href="https://cloudbase-init.readthedocs.io/en/latest/intro.html">https://cloudbase-init.readthedocs.io/en/latest/intro.html</a></strong></p><h3 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h3><p><strong>Intro</strong><br>The open source project cloudbase-init is a service conceived and maintained by Cloudbase Solutions Srl, currently working on NT systems. It was designed to initialize and configure guest operating systems under OpenStack, OpenNebula, CloudStack, MaaS and many others. Under Cloudbase page, stable and beta installers can be found and the service itself is very easy to configure through configuration files. It can also customize instances based on user input like local scripts and data.</p><p>More details on how you can use this can be found under Tutorial.</p><p><strong>Portable cloud initialization service</strong><br>The main goal of this project is to provide guest cloud initialization for Windows and other operating systems. The architecture of the project is highly flexible and allows extensions for additional clouds and plugins.</p><p>There’s no limitation in the type of supported hypervisors. This service can be used on instances running on Hyper-V, KVM, Xen, ESXi etc.</p><p><strong>Binaries</strong></p><p>Stable installers:</p><p><a href="https://www.cloudbase.it/downloads/CloudbaseInitSetup_Stable_x64.msi">https://www.cloudbase.it/downloads/CloudbaseInitSetup_Stable_x64.msi</a><br><a href="https://www.cloudbase.it/downloads/CloudbaseInitSetup_Stable_x86.msi">https://www.cloudbase.it/downloads/CloudbaseInitSetup_Stable_x86.msi</a></p><p>Beta installers:</p><p><a href="https://www.cloudbase.it/downloads/CloudbaseInitSetup_x64.msi">https://www.cloudbase.it/downloads/CloudbaseInitSetup_x64.msi</a><br><a href="https://www.cloudbase.it/downloads/CloudbaseInitSetup_x86.msi">https://www.cloudbase.it/downloads/CloudbaseInitSetup_x86.msi</a></p><p>Use a x64 installer on 64 bit versions of Windows and the x86 one exclusively on 32 bit versions.</p><h3 id="Tutorial"><a href="#Tutorial" class="headerlink" title="Tutorial"></a>Tutorial</h3><p><strong>Tutorial</strong><br>First, download your desired type of installer from here, then install it and fill in configuration options which suits you best. Based on the current selected cloudbase-init installer architecture, it’ll be available under C:\Program Files or C:\Program Files (x86) as Cloudbase Solutions\Cloudbase-Init directory. There, are located some folders of interest like:</p><p>bin - Executable files and other binaries.<br>conf - Configuration files holding miscellaneous options.<br>log - Here are the cloudbase-init logs.</p><p>LocalScripts - User supplied scripts.</p><p>Python - Bundle of executable and library files to support Python scripts and core execution.</p><p>After install, cloudbase-init acts like a 2-step service which will read metadata using Services and will pass that to the executing Plugins, this way configuring all the supported things. Depending on the platform, some plugins may request reboots.</p><p><strong>Sysprepping</strong><br>The System Preparation (Sysprep) tool prepares an installation of Windows for duplication, auditing, and customer delivery. Duplication, also called imaging, enables you to capture a customized Windows image that you can reuse throughout an organization. The Sysprep phase uses the “Unattend.xml” which implies the service to run using the “cloudbase-init-unattend.conf” configuration file.</p><p><strong>Configuration file</strong><br>In the chosen installation path, under the conf directory, are present two config files named “cloudbase-init.conf” and “cloudbase-init-unattend.conf”. These can hold various config options for picking up the desired available services and plugins ready for execution and also customizing user experience.</p><p>Explained example of configuration file:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs routeros">[DEFAULT]<br><span class="hljs-comment"># What user to create and in which group(s) to be put.</span><br><span class="hljs-attribute">username</span>=Admin<br><span class="hljs-attribute">groups</span>=Administrators<br><span class="hljs-attribute">inject_user_password</span>=<span class="hljs-literal">true</span>  # Use password <span class="hljs-keyword">from</span> the metadata (<span class="hljs-keyword">not</span> random).<br><span class="hljs-comment"># Which devices to inspect for a possible configuration drive (metadata).</span><br><span class="hljs-attribute">config_drive_raw_hhd</span>=<span class="hljs-literal">true</span><br><span class="hljs-attribute">config_drive_cdrom</span>=<span class="hljs-literal">true</span><br><span class="hljs-comment"># Path to tar implementation from Ubuntu.</span><br><span class="hljs-attribute">bsdtar_path</span>=C:\Program Files (x86)\Cloudbase Solutions\Cloudbase-Init\bin\bsdtar.exe<br><span class="hljs-comment"># Logging debugging level.</span><br><span class="hljs-attribute">verbose</span>=<span class="hljs-literal">true</span><br><span class="hljs-attribute">debug</span>=<span class="hljs-literal">true</span><br><span class="hljs-comment"># Where to store logs.</span><br><span class="hljs-attribute">logdir</span>=C:\Program Files (x86)\Cloudbase Solutions\Cloudbase-Init\log\<br><span class="hljs-attribute">logfile</span>=cloudbase-init-unattend.log<br><span class="hljs-attribute">default_log_levels</span>=comtypes=INFO,suds=INFO,iso8601=WARN<br>logging_serial_port_settings=<br><span class="hljs-comment"># Enable MTU and NTP plugins.</span><br><span class="hljs-attribute">mtu_use_dhcp_config</span>=<span class="hljs-literal">true</span><br><span class="hljs-attribute">ntp_use_dhcp_config</span>=<span class="hljs-literal">true</span><br><span class="hljs-comment"># Where are located the user supplied scripts for execution.</span><br><span class="hljs-attribute">local_scripts_path</span>=C:\Program Files (x86)\Cloudbase Solutions\Cloudbase-Init\LocalScripts\<br><span class="hljs-comment"># Services that will be tested for loading until one of them succeeds.</span><br><span class="hljs-attribute">metadata_services</span>=cloudbaseinit.metadata.services.configdrive.ConfigDriveService,<br>                  cloudbaseinit.metadata.services.httpservice.HttpService,<br>                  cloudbaseinit.metadata.services.ec2service.EC2Service,<br>                  cloudbaseinit.metadata.services.maasservice.MaaSHttpService<br><span class="hljs-comment"># What plugins to execute.</span><br><span class="hljs-attribute">plugins</span>=cloudbaseinit.plugins.common.mtu.MTUPlugin,<br>        cloudbaseinit.plugins.common.sethostname.SetHostNamePlugin<br><span class="hljs-comment"># Miscellaneous.</span><br><span class="hljs-attribute">allow_reboot</span>=<span class="hljs-literal">false</span>    # allow the<span class="hljs-built_in"> service </span><span class="hljs-keyword">to</span> reboot the<span class="hljs-built_in"> system</span><br><span class="hljs-built_in"></span><span class="hljs-attribute">stop_service_on_exit</span>=<span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><p>The “cloudbase-init-unattend.conf” configuration file is similar to the default one and is used by the Sysprepping phase. It was designed for the scenario where the minimum user intervention is required and it only runs the MTU and host name plugins, leaving the image ready for further initialization cases.</p><p>More of these explained options are available under the Services, Plugins and Userdata documentation.</p><p>A complete list of config options can be found at Configuration options reference.</p><p><strong>File execution</strong></p><p>Cloudbase-init has the ability to execute user provided scripts, usually found in the default path C:\Program Files (x86)\Cloudbase Solutions\Cloudbase-Init\LocalScripts, through a specific plugin for doing it. Depending on the platform used, the files should be valid PowerShell, Python, Batch or Bash scripts. The userdata can be also a PEM certificate, in a cloud-config format or a MIME content. The user data plugin is capable of executing various script types and exit code value handling.</p><p>Based on their exit codes, you can instruct the system to reboot or even re-execute the plugin on the next boot:</p><p>1001 - reboot and don’t run the plugin again on next boot<br>1002 - don’t reboot now and run the plugin again on next boot<br>1003 - reboot and run the plugin again on next boot</p><h3 id="Services"><a href="#Services" class="headerlink" title="Services"></a>Services</h3><p><strong>Services</strong><br>A metadata service has the role of getting the guest provided data (configuration information) and exposing it to the Plugins for a general and basic initialization of the instance. These sub-services can change their behavior according to custom configuration options documented below.</p><p><strong>Configuring available services</strong><br>Any of these classes can be specified manually in the configuration file under metadata_services option. Based on this option, the service loader will search across these providers in the defined order and load the first one that is available.</p><p>For more details on doing this, see configuration file in Tutorial.</p><p><strong>OpenStack (web API)</strong><br>classcloudbaseinit.metadata.services.httpservice.HttpService<br>A complete service which supports password related capabilities and can be usually accessed at the <a href="http://169.254.169.254/">http://169.254.169.254/</a> magic URL. The magic URL can be customized using the metadata_base_url config option. A default value of True for add_metadata_private_ip_route option is used to add a route for the IP address to the gateway. This is needed for supplying a bridge between different VLANs in order to get access to the web server.</p><p>Metadata version used: latest.</p><p>Capabilities:</p><ul><li>instance id</li><li>hostname</li><li>public keys</li><li>WinRM authentication certificates</li><li>static network configuration</li><li>admin user password</li><li>post admin user password (only once)</li><li>user data</li></ul><p>Config options for openstack section:</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lasso">metadata_base_url (<span class="hljs-built_in">string</span>: “http:<span class="hljs-comment">//169.254.169.254/”) add_metadata_private_ip_route (bool: True)</span><br>https_allow_insecure (bool: <span class="hljs-literal">False</span>)<br>https_ca_bundle (<span class="hljs-built_in">string</span>: <span class="hljs-literal">None</span>)<br></code></pre></td></tr></table></figure><p>Config options for default section:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">retry_count (<span class="hljs-built_in">int</span>eger: <span class="hljs-number">5</span>)<br>retry_count_interval (<span class="hljs-built_in">int</span>eger: <span class="hljs-number">4</span>)<br></code></pre></td></tr></table></figure><p><strong>OpenStack (configuration drive)</strong><br>classcloudbaseinit.metadata.services.configdrive.ConfigDriveService<br>This is similar to the web API, but it “serves” its files locally without requiring network access. The data is generally retrieved from a cdrom, vfat or raw disks&#x2F;partitions by enabling selective lookup across different devices. Use the types option to specify which types of config drive content the service will search for and also on which devices using the locations option.</p><p>It will search for metadata:</p><p>in mounted optical units<br>directly in the physical disk bytes<br>by exploring the physical disk as a vfat drive; which requires mtools (specified by the mtools_path option in the Default section)</p><p>This service is usually faster than the HTTP twin, as there is no timeout waiting for the network to be up.</p><p>Metadata version used: latest.</p><p>Capabilities:</p><ul><li>instance id</li><li>hostname</li><li>public keys</li><li>authentication certificates</li><li>static network configuration</li><li>admin user password</li><li>user data</li></ul><p>Config options for config_drive section:</p><ul><li>raw_hdd (bool: True)</li><li>cdrom (bool: True)</li><li>vfat (bool: True)</li></ul><p>types (list: [“vfat”, “iso”])</p><p>locations (list: [“cdrom”, “hdd”, “partition”])</p><p>NoCloud configuration drive<br>classcloudbaseinit.metadata.services.nocloudservice.NoCloudConfigDriveService<br>NoCloudConfigDriveService is similar to OpenStack config drive metadata in terms of the medium on which the data is provided (as an attached ISO, partition or disk) and similar to the EC2 metadata in terms of how the metadata files are named and structured.</p><p>The metadata is provided on a config-drive (vfat or iso9660) with the label cidata or CIDATA.</p><p>The folder structure for NoCloud is:<br>&#x2F;user-data<br>&#x2F;meta-data</p><p>The user-data and meta-data files respect the EC2 metadata service format.</p><p>Capabilities:</p><ul><li>instance id</li><li>hostname</li><li>public keys</li><li>static network configuration (Debian and network config v1 formats)</li><li>user data</li></ul><p>Config options for config_drive section:</p><ul><li>raw_hdd (bool: True)</li><li>cdrom (bool: True)</li><li>vfat (bool: True)</li></ul><p>types (list: [“vfat”, “iso”])</p><p>locations (list: [“cdrom”, “hdd”, “partition”])</p><p>Example metadata:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">instance</span>-id: windows1<br><span class="hljs-attribute">network</span>-interfaces: |<br>  <span class="hljs-attribute">iface</span> Ethernet0 inet static<br>  <span class="hljs-attribute">address</span> <span class="hljs-number">10.0.0.2</span><br>  <span class="hljs-attribute">network</span> <span class="hljs-number">10.0.0.0</span><br>  <span class="hljs-attribute">netmask</span> <span class="hljs-number">255.255.255.0</span><br>  <span class="hljs-attribute">broadcast</span> <span class="hljs-number">10.0.0.255</span><br>  <span class="hljs-attribute">gateway</span> <span class="hljs-number">10.0.0.1</span><br>  <span class="hljs-attribute">hwaddress</span> ether <span class="hljs-number">00</span>:<span class="hljs-number">11</span>:<span class="hljs-number">22</span>:<span class="hljs-number">33</span>:<span class="hljs-number">44</span>:<span class="hljs-number">55</span><br><span class="hljs-attribute">hostname</span>: windowshost1<br></code></pre></td></tr></table></figure><p>Cloud-init’s network config v1 format can be used to configure static network configuration. The configuration file should be named network-config and should be present at the same folder level with the meta-data and user-data file. If no network-config is found, cloudbase-init will use the network-interfaces value from the metadata (if any).</p><p>The following network config types are implemented: physical, bond, vlan and nameserver. Unsupported config types: bridge and route.</p><p>Example:</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">version</span><span class="hljs-punctuation">:</span> <span class="hljs-string">1</span><br><span class="hljs-attribute">config</span><span class="hljs-punctuation">:</span><br>   <span class="hljs-bullet">-</span> <span class="hljs-string">type: physical</span><br>     <span class="hljs-attribute">name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">interface0</span><br>     <span class="hljs-attribute">mac_address</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;52:54:00:12:34:00&quot;</span><br>     <span class="hljs-attribute">mtu</span><span class="hljs-punctuation">:</span> <span class="hljs-string">1450</span><br>     <span class="hljs-attribute">subnets</span><span class="hljs-punctuation">:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">type: static</span><br>          <span class="hljs-attribute">address</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.1.10</span><br>          <span class="hljs-attribute">netmask</span><span class="hljs-punctuation">:</span> <span class="hljs-string">255.255.255.0</span><br>          <span class="hljs-attribute">dns_nameservers</span><span class="hljs-punctuation">:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">192.168.1.11</span><br>   <span class="hljs-bullet">-</span> <span class="hljs-string">type: bond</span><br>     <span class="hljs-attribute">name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">bond0</span><br>     <span class="hljs-attribute">bond_interfaces</span><span class="hljs-punctuation">:</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-string">gbe0</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-string">gbe1</span><br>     <span class="hljs-attribute">mac_address</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;52:54:00:12:34:00&quot;</span><br>     <span class="hljs-attribute">params</span><span class="hljs-punctuation">:</span><br>       <span class="hljs-attribute">bond-mode</span><span class="hljs-punctuation">:</span> <span class="hljs-string">active-backup</span><br>       <span class="hljs-attribute">bond-lacp-rate</span><span class="hljs-punctuation">:</span> <span class="hljs-string">false</span><br>     <span class="hljs-attribute">mtu</span><span class="hljs-punctuation">:</span> <span class="hljs-string">1450</span><br>     <span class="hljs-attribute">subnets</span><span class="hljs-punctuation">:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">type: static</span><br>          <span class="hljs-attribute">address</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.1.10</span><br>          <span class="hljs-attribute">netmask</span><span class="hljs-punctuation">:</span> <span class="hljs-string">255.255.255.0</span><br>          <span class="hljs-attribute">dns_nameservers</span><span class="hljs-punctuation">:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">192.168.1.11</span><br>   <span class="hljs-bullet">-</span> <span class="hljs-string">type: vlan</span><br>     <span class="hljs-attribute">name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">vlan0</span><br>     <span class="hljs-attribute">vlan_link</span><span class="hljs-punctuation">:</span> <span class="hljs-string">eth1</span><br>     <span class="hljs-attribute">vlan_id</span><span class="hljs-punctuation">:</span> <span class="hljs-string">150</span><br>     <span class="hljs-attribute">mac_address</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;52:54:00:12:34:00&quot;</span><br>     <span class="hljs-attribute">mtu</span><span class="hljs-punctuation">:</span> <span class="hljs-string">1450</span><br>     <span class="hljs-attribute">subnets</span><span class="hljs-punctuation">:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">type: static</span><br>          <span class="hljs-attribute">address</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.1.10</span><br>          <span class="hljs-attribute">netmask</span><span class="hljs-punctuation">:</span> <span class="hljs-string">255.255.255.0</span><br>          <span class="hljs-attribute">dns_nameservers</span><span class="hljs-punctuation">:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">192.168.1.11</span><br>   <span class="hljs-bullet">-</span> <span class="hljs-string">type: nameserver</span><br>     <span class="hljs-attribute">address</span><span class="hljs-punctuation">:</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-string">192.168.23.2</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-string">8.8.8.8</span><br>     <span class="hljs-attribute">search</span><span class="hljs-punctuation">:</span> <span class="hljs-string">acme.local</span><br>More information on the NoCloud metadata service specifications can be found here.<br></code></pre></td></tr></table></figure><p><strong>Amazon EC2</strong></p><p>classcloudbaseinit.metadata.services.ec2service.EC2Service<br>This is similar to the OpenStack HTTP service but is using a different format for metadata endpoints and has general capabilities.</p><p>Metadata version used: 2009-04-04.</p><p>Capabilities:</p><ul><li>instance id</li><li>hostname</li><li>public keys</li><li>user data</li></ul><p>Config options for ec2 section:</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lasso">metadata_base_url (<span class="hljs-built_in">string</span>: “http:<span class="hljs-comment">//169.254.169.254/”) add_metadata_private_ip_route (bool: True)</span><br>https_allow_insecure (bool: <span class="hljs-literal">False</span>)<br>https_ca_bundle (<span class="hljs-built_in">string</span>: <span class="hljs-literal">None</span>)<br></code></pre></td></tr></table></figure><p>Config options for default section:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">retry_count (<span class="hljs-built_in">int</span>eger: <span class="hljs-number">5</span>)<br>retry_count_interval (<span class="hljs-built_in">int</span>eger: <span class="hljs-number">4</span>)<br></code></pre></td></tr></table></figure><p>Note<br><a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html">http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html</a></p><p><strong>Apache CloudStack</strong><br>classcloudbaseinit.metadata.services.cloudstack.CloudStack<br>Another web-based service which usually uses “10.1.1.1” or DHCP addresses for retrieving content. If no metadata can be found at the metadata_base_url, the service will look for the metadata at the DHCP server URL.</p><p>Capabilities:</p><ul><li>instance id</li><li>hostname</li><li>public keys</li><li>admin user password</li><li>poll for, post, delete admin user password (each reboot)</li><li>user data</li></ul><p>Config options for cloudstack section:</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs lasso">metadata_base_url (<span class="hljs-built_in">string</span>: “http:<span class="hljs-comment">//10.1.1.1/”) password_server_port (int: 8080)</span><br>add_metadata_private_ip_route (bool: <span class="hljs-literal">True</span>)<br>https_allow_insecure (bool: <span class="hljs-literal">False</span>)<br>https_ca_bundle (<span class="hljs-built_in">string</span>: <span class="hljs-literal">None</span>)<br></code></pre></td></tr></table></figure><p>Config options for default section:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">retry_count (<span class="hljs-built_in">int</span>eger: <span class="hljs-number">5</span>)<br>retry_count_interval (<span class="hljs-built_in">int</span>eger: <span class="hljs-number">4</span>)<br></code></pre></td></tr></table></figure><p>Note<br>By design, this service can update the password anytime, so it will cause the setuserpassword plugin to run at every boot and by security concerns, the password is deleted right after retrieval and no updating will occur until a new password is available on the server.</p><p><strong>OpenNebula Service</strong><br>classcloudbaseinit.metadata.services.opennebulaservice.OpenNebulaService<br>The OpenNebula provider is related to configuration drive and searches for a specific context file which holds all the available info. The provided details are exposed as bash variables gathered in a shell script.</p><p>Capabilities:</p><ul><li>hardcoded instance id to iid-dsopennebula</li><li>hostname</li><li>public keys</li><li>static network configuration</li><li>user data</li></ul><p>Config options for default section:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">retry_count (<span class="hljs-built_in">int</span>eger: <span class="hljs-number">5</span>)<br>retry_count_interval (<span class="hljs-built_in">int</span>eger: <span class="hljs-number">4</span>)<br></code></pre></td></tr></table></figure><p><strong>Ubuntu MaaS</strong><br>classcloudbaseinit.metadata.services.maasservice.MaaSHttpService<br>This metadata service usually works with instances on baremetal and uses web requests for retrieving the available exposed metadata. It uses OAuth to secure the requests.</p><p>Metadata version used: 2012-03-01.</p><p>Capabilities:</p><ul><li>instance id</li><li>hostname</li><li>public keys</li><li>WinRM authentication certificates</li><li>static network configuration</li><li>user data</li></ul><p>Config options for maas section:</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs lasso">metadata_base_url (<span class="hljs-built_in">string</span>: <span class="hljs-literal">None</span>)<br>oauth_consumer_key (<span class="hljs-built_in">string</span>: <span class="hljs-literal">None</span>)<br>oauth_consumer_secret (<span class="hljs-built_in">string</span>: <span class="hljs-literal">None</span>)<br>oauth_token_key (<span class="hljs-built_in">string</span>: <span class="hljs-literal">None</span>)<br>oauth_token_secret (<span class="hljs-built_in">string</span>: <span class="hljs-literal">None</span>)<br>https_allow_insecure (bool: <span class="hljs-literal">False</span>)<br>https_ca_bundle (<span class="hljs-built_in">string</span>: <span class="hljs-literal">None</span>)<br></code></pre></td></tr></table></figure><p>Config options for default section:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">retry_count (<span class="hljs-built_in">int</span>eger: <span class="hljs-number">5</span>)<br>retry_count_interval (<span class="hljs-built_in">int</span>eger: <span class="hljs-number">4</span>)<br></code></pre></td></tr></table></figure><p>Note<br>By design, the configuration options are set by an agent called curtin which runs the hooks that set the config values. On Windows, these hooks need to be present in the root directory: Windows curtin hooks.</p><p><strong>Open Virtualization Format (OVF)</strong><br>classcloudbaseinit.metadata.services.ovfservice.OvfService<br>The OVF provider searches data from OVF environment ISO transport.</p><p>Capabilities:</p><ul><li>instance id (hardcoded to iid-ovf if not present)</li><li>hostname</li><li>public keys</li><li>admin user name</li><li>admin user password</li><li>user data</li></ul><p>Config options:</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mel">config_file_name (<span class="hljs-keyword">string</span>: “ovf-<span class="hljs-keyword">env</span>.xml”)<br>drive_label (<span class="hljs-keyword">string</span>: “OVF ENV”)<br>ns (<span class="hljs-keyword">string</span>: “oe”)<br></code></pre></td></tr></table></figure><p><strong>Packet Service</strong><br>classcloudbaseinit.metadata.services.packet.PacketService<br>Packet metadata service provides the metadata for baremetal servers at the magic URL <a href="https://metadata.packet.net/">https://metadata.packet.net/</a>.</p><p>Capabilities:</p><ul><li>instance id</li><li>hostname</li><li>public keys</li><li>post admin user password (only once)</li><li>user data</li><li>call home on successful provision</li></ul><p>Config options for packet section:</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lasso">metadata_base_url (<span class="hljs-built_in">string</span>: “https:<span class="hljs-comment">//metadata.packet.net/”) https_allow_insecure (bool: False)</span><br>https_ca_bundle (<span class="hljs-built_in">string</span>: <span class="hljs-literal">None</span>)<br></code></pre></td></tr></table></figure><p>Config options for default section:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">retry_count (<span class="hljs-built_in">int</span>eger: <span class="hljs-number">5</span>)<br>retry_count_interval (<span class="hljs-built_in">int</span>eger: <span class="hljs-number">4</span>)<br></code></pre></td></tr></table></figure><p><strong>Azure Service</strong><br>classcloudbaseinit.metadata.services.azureservice.AzureService<br>Azure metadata service provides the metadata for Microsoft Azure cloud platform.</p><p>Azure metadata is offered via multiple sources like HTTP metadata, config-drive metadata and KVP (Hyper-V Key-Value Pair Data Exchange). This implementation uses only HTTP and config-drive metadata sources.</p><p>Azure service implements the interface to notify the cloud provider when the instance has started provisioning, completed provisioning and if the provisioning failed.</p><p>Metadata version used: 2015-04-05.</p><p>Capabilities:</p><ul><li>instance id</li><li>hostname</li><li>public keys</li><li>WinRM authentication certificates</li><li>admin user name</li><li>admin user password</li><li>user data</li><li>post RDP certificate thumbprint</li><li>provisioning status</li><li>Windows Update status</li><li>VM agent configuration</li><li>licensing configuration</li><li>ephemeral disk warning</li></ul><p>Config options for azure section:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">transport_cert_store_name (<span class="hljs-built_in">string</span>: Windows Azure Environment”)<br></code></pre></td></tr></table></figure><p>Config options for default section:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">retry_count (<span class="hljs-built_in">int</span>eger: <span class="hljs-number">5</span>)<br>retry_count_interval (<span class="hljs-built_in">int</span>eger: <span class="hljs-number">4</span>)<br></code></pre></td></tr></table></figure><p><strong>Empty Metadata Service</strong><br>classcloudbaseinit.metadata.services.base.EmptyMetadataService<br>The empty metadata service can be used to run plugins that do not rely on metadata service information, like setting NTP, MTU, extending volumes, local scripts execution, licensing, etc.</p><p>It can be used also as a fallback metadata service, in case no other previous metadata service could be loaded.</p><p>EmptyMetadataService does not support the following plugins:<br>cloudbaseinit.plugins.windows.createuser.CreateUserPlugin<br>cloudbaseinit.plugins.common.setuserpassword.SetUserPasswordPlugin<br>cloudbaseinit.plugins.common.sshpublickeys.SetUserSSHPublicKeysPlugin<br>cloudbaseinit.plugins.windows.winrmcertificateauth.ConfigWinRMCertificateAuthPlugin</p><p>If any of the plugins defined above are executed, they will fail with exception NotExistingMetadataException. The reason for the hardcoded failure is that these plugins rely on metadata to execute correctly. If metadata like username or password is not provided, these plugins can lock or misconfigure the user, leading to unwanted problems.</p><p>Note<br>If a service returns an empty instance-id (like EmptyMetadataService does), all the plugins will be executed at every cloudbase-init run (reboot, service restart). Plugins that set NTP, MTU, extend volumes are idempotent and can be re-executed with no issues. Make sure that if you configure cloudbase-init to run local scripts, those local scripts are idempotent.</p><p><strong>VMware GuestInfo Service</strong><br>classcloudbaseinit.metadata.services.vmwareguestinfoservice.VMwareGuestInfoService<br>VMwareGuestInfoService is a metadata service which uses VMware’s rpctool to extract guest metadata and userdata configured for machines running on VMware hypervisors.</p><p>The VMware RPC tool used to query the instance metadata and userdata needs to be present at the config option path.</p><p>Both json and yaml are supported as metadata formats. The metadata &#x2F; userdata can be encoded in base64, gzip or gzip+base64.</p><p>Example metadata in yaml format:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">instance-id:</span> <span class="hljs-string">cloud-vm</span><br><span class="hljs-attr">local-hostname:</span> <span class="hljs-string">cloud-vm</span><br><span class="hljs-attr">admin-username:</span> <span class="hljs-string">cloud-username</span><br><span class="hljs-attr">admin-password:</span> <span class="hljs-string">Passw0rd</span><br><span class="hljs-attr">public-keys-data:</span> <span class="hljs-string">|</span><br><span class="hljs-string">  ssh-key 1</span><br><span class="hljs-string">  ssh-key 2</span><br></code></pre></td></tr></table></figure><p>This metadata content needs to be set as string in the guestinfo dictionary, thus needs to be converted to base64 (it is recommended to gzip it too). To convert to gzip+base64 format:</p><p>cat metadata.yml | gzip.exe -9 | base64.exe -w0<br>The output of the gzip+base64 conversion needs to be set in the instance guestinfo, along with the encoding of the metadata &#x2F; userdata.</p><p>For more information on how to achieve this, please check <a href="https://github.com/vmware/cloud-init-vmware-guestinfo#configuration">https://github.com/vmware/cloud-init-vmware-guestinfo#configuration</a></p><p>This is an example how to set the information from the instance:</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><span class="hljs-variable">&lt;rpctool_path&gt;</span> <span class="hljs-string">&quot;info-set guestinfo.metadata &lt;gzip+base64-encoded-metadata&gt;&quot;</span><br><span class="hljs-variable">&lt;rpctool_path&gt;</span> <span class="hljs-string">&quot;info-set guestinfo.metadata.encoding gzip+base64&quot;</span><br><span class="hljs-variable">&lt;rpctool_path&gt;</span> <span class="hljs-string">&quot;info-set guestinfo.userdata &lt;gzip+base64-encoded-userdata&gt;&quot;</span><br><span class="hljs-variable">&lt;rpctool_path&gt;</span> <span class="hljs-string">&quot;info-set guestinfo.userdata.encoding gzip+base64&quot;</span><br></code></pre></td></tr></table></figure><p>Capabilities:</p><ul><li>instance id</li><li>hostname</li><li>public keys</li><li>admin user name</li><li>admin user password</li><li>user data</li></ul><p>Config options for vmwareguestinfo section:</p><p>vmware_rpctool_path (string: “%ProgramFiles%&#x2F;VMware&#x2F;VMware Tools&#x2F;rpctool.exe”)</p><p><strong>Google Compute Engine Service</strong><br>classcloudbaseinit.metadata.services.gceservice.GCEService<br>GCE metadata service provides the metadata for instances running on Google Compute Engine.</p><p>GCE metadata is offered via an internal HTTP metadata endpoint, reachable at the magic URL <a href="http://metadata.google.internal/computeMetadata/v1/">http://metadata.google.internal/computeMetadata/v1/</a>. More information can be found in the GCE metadata documents.</p><p>To provide userdata to be executed by the instance (in cloud-config format, for example), use the user-data and user-data-encoding instance metadata keys.</p><p>Capabilities:</p><ul><li>instance id</li><li>hostname</li><li>public keys</li><li>user data</li></ul><p>Config options for gce section:</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lasso">metadata_base_url (<span class="hljs-built_in">string</span>: http:<span class="hljs-comment">//metadata.google.internal/computeMetadata/v1/”) https_allow_insecure (bool: False)</span><br>https_ca_bundle (<span class="hljs-built_in">string</span>: <span class="hljs-literal">None</span>)<br></code></pre></td></tr></table></figure><p>Config options for default section:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">retry_count (<span class="hljs-built_in">int</span>eger: <span class="hljs-number">5</span>)<br>retry_count_interval (<span class="hljs-built_in">int</span>eger: <span class="hljs-number">4</span>)<br></code></pre></td></tr></table></figure><h3 id="Plugins"><a href="#Plugins" class="headerlink" title="Plugins"></a>Plugins</h3><p><strong>Plugins</strong><br>Plugins execute actions based on the metadata obtained by the loaded service. They are intended to configure the instance using data provided by the underlying cloud and by the user who created the instance. There are three stages for the plugins’ execution:</p><p>The PRE_NETWORKING stage (for setting up the network, before doing any valid web request.<br>The PRE_METADATA_DISCOVERY stage (additional configuration before the metadata service discovery).<br>The default MAIN stage, which holds the rest of the plugins which are (re)executed according to their saved status. The metadata service loaded needs to provide an instance id for the plugins to be able to have a saved status. If the metadata service cannot provide an instance id, the plugins state from the MAIN stage cannot be saved, and therefore, all plugins will be executed at every boot.<br>Note that the plugins from the two stages are executed each time the cloudbase-init service starts (those plugins do not have saved status).</p><p>Just before the MAIN stage, the metadata service can report to the cloud service that the provision started. After the MAIN stage ended, the metadata service can report to the cloud service that the provisioning completed successfully or failed.</p><p>Configuring selected plugins<br>By default, only a subset of plugins is executed. The plugins are:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[DEFAULT]</span><br>plugins = cloudbaseinit<span class="hljs-selector-class">.plugins</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.mtu</span><span class="hljs-selector-class">.MTUPlugin</span>, cloudbaseinit<span class="hljs-selector-class">.plugins</span><span class="hljs-selector-class">.windows</span><span class="hljs-selector-class">.ntpclient</span><span class="hljs-selector-class">.NTPClientPlugin</span>, cloudbaseinit<span class="hljs-selector-class">.plugins</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.sethostname</span><span class="hljs-selector-class">.SetHostNamePlugin</span>, cloudbaseinit<span class="hljs-selector-class">.plugins</span><span class="hljs-selector-class">.windows</span><span class="hljs-selector-class">.createuser</span><span class="hljs-selector-class">.CreateUserPlugin</span>, cloudbaseinit<span class="hljs-selector-class">.plugins</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.networkconfig</span><span class="hljs-selector-class">.NetworkConfigPlugin</span>, cloudbaseinit<span class="hljs-selector-class">.plugins</span><span class="hljs-selector-class">.windows</span><span class="hljs-selector-class">.licensing</span><span class="hljs-selector-class">.WindowsLicensingPlugin</span>, cloudbaseinit<span class="hljs-selector-class">.plugins</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.sshpublickeys</span><span class="hljs-selector-class">.SetUserSSHPublicKeysPlugin</span>, cloudbaseinit<span class="hljs-selector-class">.plugins</span><span class="hljs-selector-class">.windows</span><span class="hljs-selector-class">.extendvolumes</span><span class="hljs-selector-class">.ExtendVolumesPlugin</span>, cloudbaseinit<span class="hljs-selector-class">.plugins</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.userdata</span><span class="hljs-selector-class">.UserDataPlugin</span>, cloudbaseinit<span class="hljs-selector-class">.plugins</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.setuserpassword</span><span class="hljs-selector-class">.SetUserPasswordPlugin</span>, cloudbaseinit<span class="hljs-selector-class">.plugins</span><span class="hljs-selector-class">.windows</span><span class="hljs-selector-class">.winrmlistener</span><span class="hljs-selector-class">.ConfigWinRMListenerPlugin</span>, cloudbaseinit<span class="hljs-selector-class">.plugins</span><span class="hljs-selector-class">.windows</span><span class="hljs-selector-class">.winrmcertificateauth</span><span class="hljs-selector-class">.ConfigWinRMCertificateAuthPlugin</span>, cloudbaseinit<span class="hljs-selector-class">.plugins</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.localscripts</span>.LocalScriptsPlugin<br></code></pre></td></tr></table></figure><p>A custom list of plugins can be specified through the plugins option in the configuration file.</p><p>For more details on doing this, see configuration file in Tutorial.</p><p><strong>Setting hostname (MAIN)</strong><br>classcloudbaseinit.plugins.common.sethostname.SetHostNamePlugin<br>Sets the instance hostname. The hostname gets truncated to 15 characters for Netbios compatibility reasons if netbios_host_name_compatibility is set.</p><p>Config options:</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">netbios_host_name_compatibility (<span class="hljs-type">bool</span>: <span class="hljs-keyword">True</span>)<br></code></pre></td></tr></table></figure><p>Notes:<br>Requires support in the metadata service.<br>May require a system restart.</p><p><strong>Creating user (MAIN)</strong><br>classcloudbaseinit.plugins.windows.createuser.CreateUserPlugin<br>Creates (or updates if existing) a new user and adds it to a set of provided local groups. By default, it creates the user “Admin” under “Administrators” group, but this can be changed in the configuration file.</p><p>A random user password is set for the user. The password length is by default set to 20 and can be customized using the user_password_length configuration option.</p><p>If rename_admin_user is set to True, the user Administrator is renamed to the username config value or to the metadata service provided value.</p><p>Config options:</p><ul><li>username (string: “Admin”)</li><li>groups (list of strings: [“Administrators”])</li><li>user_password_length (int: 20)</li><li>rename_admin_user (bool: false)</li></ul><p>Notes:<br>The metadata service can provide the username. If the metadata service provides the admin username, it will override the username configuration value.</p><p><strong>Setting password (MAIN)</strong><br>classcloudbaseinit.plugins.common.setuserpassword.SetUserPasswordPlugin<br>Sets the cloud user’s password. If a password has been provided in the metadata during boot it will be used, otherwise a random password will be generated, encrypted with the user’s SSH public key and posted to the metadata provider.</p><p>An option called inject_user_password is set True by default to make available the use of metadata password which is found under the “admin_pass” field or through an URL request. If the option is set to False or if the password isn’t found in metadata, then an attempt of using an already set password is done (usually a random value by the CreateUserPlugin plugin). With first_logon_behaviour you can control what happens with the password at the next logon. If this option is set to “always”, the user will be forced to change the password at the next logon.</p><p>If it is set to “clear_text_injected_only”, the user will be forced to change the password only if the password is a clear text password, coming from the metadata. The last option is “no”, when the user is never forced to change the password.</p><p>Config options:</p><ul><li>username (string: “Admin”)</li><li>inject_user_password (bool: True)</li><li>first_logon_behaviour (string: “clear_text_injected_only”)</li><li>user_password_length (int: 20)</li></ul><p>Notes:<br>The metadata service may provide the username. If the metadata service provides the admin username, it will override the username configuration value.</p><p>May run at every boot to (re)set and post the password if the metadata service supports this behaviour.</p><p><strong>Static networking (MAIN)</strong><br>classcloudbaseinit.plugins.common.networkconfig.NetworkConfigPlugin<br>Statically configures each network adapter for which corresponding details are found into metadata. The details&#x2F;addresses association is done using MAC matching and if this fails, then name or interface index matching. The basic setting is based on IPv4 addresses, but it supports IPv6 addresses too if they are enabled and exposed to the metadata. The purpose of this plugin is to configure network adapters, for which the DHCP server is disabled, to have internet access and static IPs.</p><p>NIC teaming (bonding) is supported and uses NetLBFO implementation.</p><p>Notes:<br>Requires support in the metadata service.<br>May require a system restart.</p><p><strong>Saving public keys (MAIN)</strong><br>classcloudbaseinit.plugins.common.sshpublickeys.SetUserSSHPublicKeysPlugin<br>Creates an authorized_keys file in the user’s home directory containing the SSH keys provided in the metadata. It is needed by the plugin responsible for encrypting and setting passwords.</p><p>Config options:<br>username (string: “Admin”)</p><p>Notes:<br>Requires support in the metadata service. The metadata service provides the SSH public keys.</p><p>The metadata service can provide the username. If the metadata service provides the admin username, it will override the username configuration value.</p><p><strong>Volume expanding (MAIN)</strong><br>classcloudbaseinit.plugins.windows.extendvolumes.ExtendVolumesPlugin<br>Extends automatically a disk partition to its maximum size. This is useful when booting images with different flavors. By default, all the volumes are extended, but you can select specific ones by populating with their indexes the volumes_to_extend option.</p><p>Config options:<br>volumes_to_extend (list of integers: None)</p><p>Notes:<br>Runs at every boot.</p><p><strong>WinRM listener (MAIN)</strong><br>classcloudbaseinit.plugins.windows.winrmlistener.ConfigWinRMListenerPlugin<br>Configures a WinRM HTTPS listener to allow remote management via WinRM or PowerShell.</p><p>If winrm_enable_basic_auth is set to True, it enables basic authentication (authentication using username and password) for the WinRM listeners.</p><p>If winrm_configure_http_listener is set to True, the WinRM http listener will also be enabled.</p><p>Config options:<br>winrm_enable_basic_auth (bool: True)<br>winrm_configure_https_listener (bool: True)<br>winrm_configure_http_listener (bool: False)</p><p>Notes:<br>The metadata service can provide the listeners configuration (protocol and certificate thumbprint).</p><p>May run at every boot. If the WinRM Windows service does not exist, it will run at the next boot.</p><p><strong>WinRM certificate (MAIN)</strong><br>classcloudbaseinit.plugins.windows.winrmcertificateauth.ConfigWinRMCertificateAuthPlugin<br>Enables password-less authentication for remote management via WinRS or PowerShell. Usually uses x509 embedded with UPN certificates.</p><p>Config options:<br>username (string: “Admin”)</p><p>Notes<br>Requires support in the metadata service. The metadata service must provide the certificate metadata. The admin user password needs to be present, either from the metadata, either as shared data set by running CreateUserPlugin or SetUserPasswordPlugin. The metadata service can provide the username. If the metadata service provides the admin username, it will override the username configuration value.</p><p>How to use this feature: <a href="http://www.cloudbase.it/windows-without-passwords-in-openstack/">http://www.cloudbase.it/windows-without-passwords-in-openstack/</a></p><p><strong>Local Scripts execution (MAIN)</strong><br>classcloudbaseinit.plugins.common.localscripts.LocalScriptsPlugin<br>Executes any script (powershell, batch, python etc.) located in the following path indicated by local_scripts_path option.</p><p>More details about the supported scripts and content can be found in Tutorial on file execution subject.</p><p>Config options:<br>local_scripts_path (string: None)</p><p>Notes:<br>May require a system restart.</p><p>May run at every boot. It depends on the exit codes of the scripts.</p><p><strong>Licensing (MAIN)</strong><br>classcloudbaseinit.plugins.windows.licensing.WindowsLicensingPlugin<br>Activates the Windows instance if the activate_windows option is True. If set_kms_product_key or set_avma_product_key are set, it will use that KMS or AVMA product key in Windows.</p><p>If kms_host is set, it will set the provided host as the KMS licensing server.</p><p>Config options:<br>activate_windows (bool: False)<br>set_kms_product_key (bool: False)<br>set_avma_product_key (bool: False)<br>kms_host (string: None)<br>log_licensing_info (bool: True)</p><p>Notes:<br>The metadata service can provide the KMS host, overriding the configuration option kms_host. The metadata service can provide the avma_product_key, overriding the configuration option set_avma_product_key.</p><p><strong>Clock synchronization (PRE_NETWORKING)</strong><br>classcloudbaseinit.plugins.windows.ntpclient.NTPClientPlugin<br>Applies NTP client info based on the DHCP server options, if available. This behavior is enabled only when the ntp_use_dhcp_config option is set to True (which by default is False).</p><p>If real_time_clock_utc is set to True, it will set the real time clock to use universal time. If set to False, it will set the real time clock to use the local time.</p><p>Config options:<br>ntp_use_dhcp_config (bool: False)<br>real_time_clock_utc (bool: False)<br>ntp_enable_service (bool: True)</p><p>Notes:<br>May require a reboot.</p><p>May run at every boot.</p><p><strong>MTU customization (PRE_METADATA_DISCOVERY)</strong><br>classcloudbaseinit.plugins.common.mtu.MTUPlugin<br>Sets the network interfaces MTU based on the value provided by the DHCP server options, if available and enabled (by default is True). This is particularly useful for cases in which a lower MTU value is required for networking (e.g. OpenStack GRE Neutron Open vSwitch configurations).</p><p>Config options:<br>mtu_use_dhcp_config (bool: True)</p><p>Notes:<br>Runs at every boot.</p><p><strong>User data (MAIN)</strong><br>classcloudbaseinit.plugins.common.userdata.UserDataPlugin<br>Executes custom scripts provided by user data metadata as plain text or compressed with Gzip. More details, examples and possible formats here: Userdata.</p><p><strong>Trim Config (MAIN)</strong><br>classcloudbaseinit.plugins.common.trim.TrimConfigPlugin<br>Enables or disables TRIM delete notifications for the underlying storage device.</p><p>Config options:<br>trim_enabled (bool: False)</p><p><strong>San Policy Config (MAIN)</strong><br>classcloudbaseinit.plugins.windows.sanpolicy.SANPolicyPlugin<br>If not None, the SAN policy is set to the given value of the configuration option san_policy. The possible values are: OnlineAll, OfflineAll or OfflineShared.</p><p>Config options:<br>san_policy (string: None)</p><p><strong>RDP Settings Config (MAIN)</strong><br>classcloudbaseinit.plugins.windows.rdp.RDPSettingsPlugin<br>Sets the registry key KeepAliveEnable, to enable or disable the RDP keep alive functionality.</p><p>Config options:<br>rdp_set_keepalive (bool: False)</p><p><strong>RDP Post Certificate Thumbprint (MAIN)</strong><br>classcloudbaseinit.plugins.windows.rdp.RDPPostCertificateThumbprintPlugin<br>Posts the RDP certificate thumbprint to the metadata service endpoint.</p><p>Notes:<br>Requires support in the metadata service. The metadata service should expose an HTTP endpoint where the certificate thumbprint can be posted.</p><p><strong>Page Files (MAIN)</strong><br>classcloudbaseinit.plugins.windows.pagefiles.PageFilesPlugin<br>Sets custom page files according to the config options.</p><p>Config options:<br>page_file_volume_labels (array: [])<br>page_file_volume_mount_points (array: [])</p><p>Notes:<br>May require a reboot. If the page file is configured, a reboot is required.</p><p>Runs at every boot.</p><p><strong>Display Idle Timeout Config (MAIN)</strong><br>classcloudbaseinit.plugins.windows.displayidletimeout.DisplayIdleTimeoutConfigPlugin<br>Sets the idle timeout, in seconds, before powering off the display. Set 0 to leave the display always on.</p><p>Config options:<br>display_idle_timeout (int: 0)</p><p><strong>Boot Status Policy Config (MAIN)</strong><br>classcloudbaseinit.plugins.windows.bootconfig.BootStatusPolicyPlugin<br>Sets the Windows BCD boot status policy according to the config option. When set, the only possible value for bcd_boot_status_policy is ignoreallfailures.</p><p>Config options:<br>bcd_boot_status_policy (string: None)</p><p><strong>BCD Config (MAIN)</strong><br>classcloudbaseinit.plugins.windows.bootconfig.BCDConfigPlugin<br>A unique disk ID is needed to avoid disk signature collisions. This plugin resets the boot disk id and enables auto-recovery in the BCD store.</p><p>Config options:<br>set_unique_boot_disk_id (bool: False)<br>bcd_enable_auto_recovery (bool: False)</p><p><strong>Ephemeral Disk Config (MAIN)</strong><br>classcloudbaseinit.plugins.common.ephemeraldisk.EphemeralDiskPlugin<br>Sets the ephemeral disk data loss warning file. On public clouds like Azure, the ephemeral disk should contain a read only file with data loss warning text, that warns the user to not use the ephemeral disk as a persistent storage disk.</p><p>Config options:<br>ephemeral_disk_volume_label (string: None)<br>ephemeral_disk_volume_mount_point (string: None)<br>ephemeral_disk_data_loss_warning_path (string: None)</p><p>Notes:<br>Requires support in the metadata service. The metadata service should provide the disk data loss warning text.</p><p><strong>Windows Auto Updates (MAIN)</strong><br>classcloudbaseinit.plugins.windows.updates.WindowsAutoUpdatesPlugin<br>Enables automatic Windows updates based on the user configuration or the metadata service information. The metadata service setting takes priority over the configuration option.</p><p>Config options:<br>enable_automatic_updates (bool: False)</p><p>Notes:<br>If the metadata service provides the information needed to enable the automatic updates, it will override the enable_automatic_updates configuration value.</p><p><strong>Server Certificates (MAIN)</strong><br>classcloudbaseinit.plugins.windows.certificates.ServerCertificatesPlugin<br>Imports X509 certificates into the desired store location. The metadata service provides the certificate and key in a PFX archive, their store location and store name.</p><p>Notes:<br>Requires support in the metadata service.</p><p><strong>Azure Guest Agent (MAIN)</strong><br>classcloudbaseinit.plugins.windows.azureguestagent.AzureGuestAgentPlugin<br>Installs Azure Guest agent, which is required for the Azure cloud platform.</p><p>Notes:<br>Requires support in the metadata service. Azure metadata service should provide the agent package provisioning data.</p><h3 id="Userdata"><a href="#Userdata" class="headerlink" title="Userdata"></a>Userdata</h3><p><strong>Userdata</strong><br>The userdata is the user custom content exposed to the guest instance by the currently deployed and running cloud infrastructure. Its purpose is to provide additional data for the instance to customize it as much as you need, if the cloud initialization service does support this feature.</p><p>Fortunately, cloudbase-init is able to interpret and use this kind of user specific data in multiple ways. In most of the cases, the thing that indicates of what type is the processed data is usually the first line.</p><p>Currently supported contents:</p><p><strong>PEM certificate</strong><br>—–BEGIN CERTIFICATE—–</p><p>This one should start with a PEM specific beginning header, which will be eventually parsed by the configuration drive and web API OpenStack services and used by the WinRM certificate (MAIN) plugin for storing and using it.</p><p><strong>Batch</strong><br>rem cmd</p><p>The file is executed in a cmd.exe shell (can be changed with the COMSPEC environment variable).</p><p><strong>PowerShell</strong></p><p>#ps1 or #ps1_sysnative (system native)</p><p>#ps1_x86 (Windows On Windows 32bit)</p><p>Execute PowerShell scripts using the desired executable. For finding out more about the system nativeness thing, click here.</p><p><strong>Bash</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br>A bash shell needs to be installed <span class="hljs-keyword">in</span> the system and available <span class="hljs-keyword">in</span> the PATH <span class="hljs-keyword">in</span> order to use this feature.<br></code></pre></td></tr></table></figure><p><strong>Python</strong></p><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-meta">#!/usr/bin/env python</span><br><br>Python <span class="hljs-keyword">is</span> available by <span class="hljs-keyword">default</span> <span class="hljs-keyword">with</span> the build itself, but also it must be <span class="hljs-keyword">in</span> the system PATH.<br></code></pre></td></tr></table></figure><p><strong>EC2 format</strong><br>There is no “first line” here, but the content should follow a XML pattern with valid Batch&#x2F;PowerShell script contents under script or powershell enclosing tags like in this example:</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dos">&lt;script&gt;<br><span class="hljs-built_in">set</span> root=<span class="hljs-variable">%SystemDrive%</span><br><span class="hljs-built_in">echo</span> ec2dir&gt;<span class="hljs-variable">%root%</span>\ec2file.txt<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nsis">&lt;powershell&gt;<br><span class="hljs-variable">$root</span> = <span class="hljs-variable">$env</span>:<span class="hljs-params">System</span>Drive<br><span class="hljs-variable">$dname</span> = Get-Content <span class="hljs-string">&quot;<span class="hljs-variable">$root</span>\ec2file.txt&quot;</span><br>New-Item -path <span class="hljs-string">&quot;<span class="hljs-variable">$root</span>\<span class="hljs-variable">$dname</span>&quot;</span> -type <span class="hljs-literal">directory</span><br>&lt;/powershell&gt;<br></code></pre></td></tr></table></figure><p>Note<br><a href="http://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/UsingConfig_WinAMI.html">http://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/UsingConfig_WinAMI.html</a></p><h3 id="Cloud-config"><a href="#Cloud-config" class="headerlink" title="Cloud config"></a>Cloud config</h3><p>#cloud-config</p><p>Cloud-config YAML configuration as supported by cloud-init, excluding Linux specific content. The following cloud-config directives are supported:</p><p>write_files - Defines a set of files which will be created on the local filesystem. It can be a list of items or only one item, with the following attributes:</p><p>path - Absolute path on disk where the content should be written.<br>content - The content which will be written in the given file.<br>permissions - Integer representing file permissions.<br>encoding - The encoding of the data in content. Supported encodings are: b64, base64 for base64-encoded content, gz, gzip for gzip encoded content, gz+b64, gz+base64, gzip+b64, gzip+base64 for base64 encoded gzip content.</p><p>Examples:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#cloud-config</span><br><span class="hljs-attr">write_files:</span><br>   <span class="hljs-attr">encoding:</span> <span class="hljs-string">b64</span><br>   <span class="hljs-attr">content:</span> <span class="hljs-string">NDI=</span><br>   <span class="hljs-attr">path:</span> <span class="hljs-string">C:\test</span><br>   <span class="hljs-attr">permissions:</span> <span class="hljs-string">&#x27;0o466&#x27;</span><br><span class="hljs-comment">#cloud-config</span><br><span class="hljs-attr">write_files:</span><br>   <span class="hljs-bullet">-</span>   <span class="hljs-attr">encoding:</span> <span class="hljs-string">b64</span><br>       <span class="hljs-attr">content:</span> <span class="hljs-string">NDI=</span><br>       <span class="hljs-attr">path:</span> <span class="hljs-string">C:\b64</span><br>       <span class="hljs-attr">permissions:</span> <span class="hljs-string">&#x27;0644&#x27;</span><br>   <span class="hljs-bullet">-</span>   <span class="hljs-attr">encoding:</span> <span class="hljs-string">base64</span><br>       <span class="hljs-attr">content:</span> <span class="hljs-string">NDI=</span><br>       <span class="hljs-attr">path:</span> <span class="hljs-string">C:\b64_1</span><br>       <span class="hljs-attr">permissions:</span> <span class="hljs-string">&#x27;0644&#x27;</span><br>   <span class="hljs-bullet">-</span>   <span class="hljs-attr">encoding:</span> <span class="hljs-string">gzip</span><br>       <span class="hljs-attr">content:</span> <span class="hljs-type">!!binary</span> <span class="hljs-string">|</span><br><span class="hljs-string">           H4sIAGUfoFQC/zMxAgCIsCQyAgAAAA==</span><br><span class="hljs-string"></span>       <span class="hljs-attr">path:</span> <span class="hljs-string">C:\gzip</span><br>       <span class="hljs-attr">permissions:</span> <span class="hljs-string">&#x27;0644&#x27;</span><br><span class="hljs-string">set_timezone</span> <span class="hljs-bullet">-</span> <span class="hljs-string">Change</span> <span class="hljs-string">the</span> <span class="hljs-string">underlying</span> <span class="hljs-string">timezone.</span><br></code></pre></td></tr></table></figure><p>Example:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment">#cloud-config</span><br>set_timezone: Asia/Tbilisi<br>set_hostname - Override the already<span class="hljs-built_in"> default </span><span class="hljs-built_in">set</span> hostname value (taken <span class="hljs-keyword">from</span> metadata).<br></code></pre></td></tr></table></figure><p>If the hostname is changed, a reboot will be required.</p><p>Example:</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-meta">#cloud-config</span><br>set_hostname: newhostname<br><span class="hljs-keyword">groups</span> - <span class="hljs-keyword">Create</span> <span class="hljs-keyword">local</span> <span class="hljs-keyword">groups</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">add</span> existing users <span class="hljs-keyword">to</span> those <span class="hljs-keyword">local</span> <span class="hljs-keyword">groups</span>.<br></code></pre></td></tr></table></figure><p>The definition of the groups consists of a list in the format:</p><p>: [, ]</p><p>The list of users can be empty, when creating a group without members.</p><p>Example:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">groups</span>:<br>  - windows-group: [user1, user2]<br>  - cloud-users<br><span class="hljs-built_in">users</span> - Create and configure <span class="hljs-built_in">local</span> <span class="hljs-built_in">users</span>.<br></code></pre></td></tr></table></figure><p>The users are defined as a list. Each element from the list represents a user. Each user can have the the following attributes defined:</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-type">name</span> - The username (required string).<br>gecos - the <span class="hljs-keyword">user</span> description.<br>primary_group - the <span class="hljs-keyword">user</span>’s <span class="hljs-keyword">primary</span> <span class="hljs-keyword">group</span>.<br><span class="hljs-keyword">groups</span> - the <span class="hljs-keyword">user</span>’s <span class="hljs-keyword">groups</span>. <span class="hljs-keyword">On</span> Windows, primary_group <span class="hljs-keyword">and</span> <span class="hljs-keyword">groups</span> are concatenated.<br>passwd - the <span class="hljs-keyword">user</span>’s <span class="hljs-keyword">password</span>. <span class="hljs-keyword">On</span> Linux, the <span class="hljs-keyword">password</span> <span class="hljs-keyword">is</span> a hashed string, whereas <span class="hljs-keyword">on</span> Windows the <span class="hljs-keyword">password</span> <span class="hljs-keyword">is</span> a plaintext string. <span class="hljs-keyword">If</span> the <span class="hljs-keyword">password</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> defined, a random <span class="hljs-keyword">password</span> will be <span class="hljs-keyword">set</span>.<br>inactive - <span class="hljs-type">boolean</span> <span class="hljs-keyword">value</span>, defaults <span class="hljs-keyword">to</span> <span class="hljs-keyword">False</span>. <span class="hljs-keyword">If</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">True</span>, the <span class="hljs-keyword">user</span> will be disabled.<br>expiredate - a string <span class="hljs-keyword">in</span> the <span class="hljs-keyword">format</span> <span class="hljs-comment">--. Example: 2020-10-01.</span><br>ssh_authorized_keys - a list <span class="hljs-keyword">of</span> SSH <span class="hljs-built_in">public</span> keys, that will be <span class="hljs-keyword">set</span> <span class="hljs-keyword">in</span> ~/.ssh/authorized_keys.<br></code></pre></td></tr></table></figure><p>Example:</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">users</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-bullet">-</span><br>    <span class="hljs-attribute">name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Admin</span><br>  <span class="hljs-bullet">-</span><br>    <span class="hljs-attribute">name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">brian</span><br>    <span class="hljs-attribute">gecos</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;Brian Cohen&#x27;</span><br>    <span class="hljs-attribute">primary_group</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Users</span><br>    <span class="hljs-attribute">groups</span><span class="hljs-punctuation">:</span> <span class="hljs-string">cloud-users</span><br>    <span class="hljs-attribute">passwd</span><span class="hljs-punctuation">:</span> <span class="hljs-string">StrongPassw0rd</span><br>    <span class="hljs-attribute">inactive</span><span class="hljs-punctuation">:</span> <span class="hljs-string">False</span><br>    <span class="hljs-attribute">expiredate</span><span class="hljs-punctuation">:</span> <span class="hljs-string">2020-10-01</span><br>    <span class="hljs-attribute">ssh_authorized_keys</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ssh-rsa AAAB...byV</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ssh-rsa AAAB...ctV</span><br><span class="hljs-attribute">ntp - Set NTP servers. The definition is a dict with the following attributes</span><span class="hljs-punctuation">:</span><br></code></pre></td></tr></table></figure><p>enabled - Boolean value, defaults to True, to enable or disable the NTP config.<br>servers - A list of NTP servers.<br>pools - A list of NTP pools.</p><p>The servers and pools are aggregated, servers being the first ones in the list. On Windows, there is no difference between an NTP pool or server.</p><p>Example:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-id">#cloud-config</span><br><span class="hljs-selector-tag">ntp</span>:<br>  <span class="hljs-selector-tag">enabled</span>: <span class="hljs-selector-tag">True</span><br>  <span class="hljs-selector-tag">servers</span>: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;my.ntp.server.local&#x27;</span>, <span class="hljs-string">&#x27;192.168.23.2&#x27;</span>]</span><br>  <span class="hljs-selector-tag">pools</span>: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;0.company.pool.ntp.org&#x27;</span>, <span class="hljs-string">&#x27;1.company.pool.ntp.org&#x27;</span>]</span><br><span class="hljs-selector-tag">runcmd</span> <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">Directive</span> <span class="hljs-selector-tag">that</span> <span class="hljs-selector-tag">can</span> <span class="hljs-selector-tag">contain</span> <span class="hljs-selector-tag">a</span> <span class="hljs-selector-tag">list</span> <span class="hljs-selector-tag">of</span> <span class="hljs-selector-tag">commands</span> <span class="hljs-selector-tag">that</span> <span class="hljs-selector-tag">will</span> <span class="hljs-selector-tag">be</span> <span class="hljs-selector-tag">executed</span>, <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">the</span> <span class="hljs-selector-tag">order</span> <span class="hljs-selector-tag">of</span> <span class="hljs-selector-tag">their</span> <span class="hljs-selector-tag">definition</span>.<br></code></pre></td></tr></table></figure><p>A command can be defined as a string or as a list of strings, the first one being the executable path.</p><p>On Windows, the commands are aggregated into a file and executed with cmd.exe. The userdata exit codes can be used to request a reboot: File execution.</p><p>Example:</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-comment">#cloud-config</span><br>runcmd:<br>  - <span class="hljs-string">&#x27;dir C:\\&#x27;</span><br>  - [<span class="hljs-string">&#x27;echo&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>]<br>The cloud-config directives are executed <span class="hljs-keyword">by</span> default <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> following order: write_files, set_timezone, set_hostname, ntp, groups, users, runcmd. Use config option cloud_config_plugins <span class="hljs-built_in">to</span> <span class="hljs-built_in">filter</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">to</span> change <span class="hljs-keyword">the</span> order <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> cloud config plugins.<br></code></pre></td></tr></table></figure><p>The execution of set_hostname or runcmd can request a reboot if needed. The reboot is performed at the end of the cloud-config execution (after all the directives have been executed).</p><p>Multi-part content<br>MIME multi-part user data is supported. The content will be handled based on the content type.</p><p>text&#x2F;x-shellscript - Any script to be executed: PowerShell, Batch, Bash or Python.</p><p>text&#x2F;part-handler - A script that can manage other content type parts. This is used in particular by Heat &#x2F; CFN templates, although Linux specific.</p><p>text&#x2F;x-cfninitdata - Heat &#x2F; CFN content. Written to the path provided by heat_config_dir option which defaults to “C:\cfn”. (examples of Heat Windows templates)</p><p>Sysnativeness<br>When deciding which path to use for system executable files…</p><p>On 32bit OSes, the return value will be the System32 directory, which contains 32bit programs. On 64bit OSes, the return value may be different, depending on the Python bits and the sysnative parameter. If the Python interpreter is 32bit, the return value will be System32 (containing 32bit programs) if sysnative is set to False and Sysnative otherwise. But if the Python interpreter is 64bit and sysnative is False, the return value will be SysWOW64 and System32 for a True value of sysnative.</p><p>Why this behavior and what is the purpose of sysnative parameter?</p><p>On a 32bit OS the things are clear, there is one System32 directory containing 32bit applications and that’s all. On a 64bit OS, there’s a System32 directory containing 64bit applications and a compatibility one named SysWOW64 (WindowsOnWindows) containing the 32bit version of them. Depending on the Python interpreter’s bits, the sysnative flag will try to bring the appropriate version of the system directory, more exactly, the physical System32 or SysWOW64 found on disk. On a WOW case (32bit interpreter on 64bit OS), a return value of System32 will point to the physical SysWOW64 directory and a return value of Sysnative, which is consolidated by the existence of this alias, will point to the real physical System32 directory found on disk. If the OS is still 64bit and there is no WOW case (that means the interpreter is 64bit), the system native concept is out of discussion and each return value will point to the physical location it intends to.</p><p>On a 32bit OS the sysnative parameter has no meaning, but on a 64bit one, based on its value, it will provide a real&#x2F;alias path pointing to system native applications if set to True (64bit programs) and to system compatibility applications if set to False (32bit programs). Its purpose is to provide the correct system paths by taking into account the Python interpreter bits too, because on a 32bit interpreter version, System32 is not the same with the System32 on a 64bit interpreter. Also, using a 64bit interpreter, the Sysnative alias will not work, but the sysnative parameter will take care to return SysWOW64 if you explicitly want 32bit applications, by setting it to False.</p><p>Configuration options reference<br>The following is an overview of all available configuration options in cloudbase-init.</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">DEFAULT</span><br><span class="hljs-keyword">debug</span><br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Mutable<br>This <span class="hljs-keyword">option</span> can be changed <span class="hljs-keyword">without</span> restarting.<br><br><span class="hljs-keyword">If</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">true</span>, the logging <span class="hljs-keyword">level</span> will be <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">DEBUG</span> <span class="hljs-keyword">instead</span> <span class="hljs-keyword">of</span> the <span class="hljs-keyword">default</span> <span class="hljs-keyword">INFO</span> <span class="hljs-keyword">level</span>.<br><br>log_config_append<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br><br>Mutable<br>This <span class="hljs-keyword">option</span> can be changed <span class="hljs-keyword">without</span> restarting.<br><br>The <span class="hljs-type">name</span> <span class="hljs-keyword">of</span> a logging <span class="hljs-keyword">configuration</span> file. This file <span class="hljs-keyword">is</span> appended <span class="hljs-keyword">to</span> <span class="hljs-keyword">any</span> existing logging <span class="hljs-keyword">configuration</span> files. <span class="hljs-keyword">For</span> details about logging <span class="hljs-keyword">configuration</span> files, see the Python logging module documentation. Note that <span class="hljs-keyword">when</span> logging <span class="hljs-keyword">configuration</span> files are used <span class="hljs-keyword">then</span> <span class="hljs-keyword">all</span> logging <span class="hljs-keyword">configuration</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">in</span> the <span class="hljs-keyword">configuration</span> file <span class="hljs-keyword">and</span> other logging <span class="hljs-keyword">configuration</span> <span class="hljs-keyword">options</span> are ignored (<span class="hljs-keyword">for</span> example, <span class="hljs-keyword">log</span>-<span class="hljs-type">date</span>-<span class="hljs-keyword">format</span>).<br><br>Deprecated Variations<br><span class="hljs-keyword">Group</span><br><br><span class="hljs-type">Name</span><br><br><span class="hljs-keyword">DEFAULT</span><br><br><span class="hljs-keyword">log</span>-config<br><br><span class="hljs-keyword">DEFAULT</span><br><br>log_config<br><br>log_date_format<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>%Y-%m-%d %H:%M:%S<br><br>Defines the <span class="hljs-keyword">format</span> string <span class="hljs-keyword">for</span> %(asctime)s <span class="hljs-keyword">in</span> <span class="hljs-keyword">log</span> records. <span class="hljs-keyword">Default</span>: the <span class="hljs-keyword">value</span> above . This <span class="hljs-keyword">option</span> <span class="hljs-keyword">is</span> ignored <span class="hljs-keyword">if</span> log_config_append <span class="hljs-keyword">is</span> <span class="hljs-keyword">set</span>.<br><br>log_file<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br><br>(Optional) <span class="hljs-type">Name</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">log</span> file <span class="hljs-keyword">to</span> send logging output <span class="hljs-keyword">to</span>. <span class="hljs-keyword">If</span> <span class="hljs-keyword">no</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">set</span>, logging will go <span class="hljs-keyword">to</span> stderr <span class="hljs-keyword">as</span> defined <span class="hljs-keyword">by</span> use_stderr. This <span class="hljs-keyword">option</span> <span class="hljs-keyword">is</span> ignored <span class="hljs-keyword">if</span> log_config_append <span class="hljs-keyword">is</span> <span class="hljs-keyword">set</span>.<br><br>Deprecated Variations<br><span class="hljs-keyword">Group</span><br><br><span class="hljs-type">Name</span><br><br><span class="hljs-keyword">DEFAULT</span><br><br>logfile<br><br>log_dir<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br><br>(Optional) The base directory used <span class="hljs-keyword">for</span> relative log_file paths. This <span class="hljs-keyword">option</span> <span class="hljs-keyword">is</span> ignored <span class="hljs-keyword">if</span> log_config_append <span class="hljs-keyword">is</span> <span class="hljs-keyword">set</span>.<br><br>Deprecated Variations<br><span class="hljs-keyword">Group</span><br><br><span class="hljs-type">Name</span><br><br><span class="hljs-keyword">DEFAULT</span><br><br>logdir<br><br>watch_log_file<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Uses logging <span class="hljs-keyword">handler</span> designed <span class="hljs-keyword">to</span> watch file <span class="hljs-keyword">system</span>. <span class="hljs-keyword">When</span> <span class="hljs-keyword">log</span> file <span class="hljs-keyword">is</span> moved <span class="hljs-keyword">or</span> removed this <span class="hljs-keyword">handler</span> will <span class="hljs-keyword">open</span> a <span class="hljs-built_in">new</span> <span class="hljs-keyword">log</span> file <span class="hljs-keyword">with</span> specified <span class="hljs-type">path</span> instantaneously. It makes sense <span class="hljs-keyword">only</span> <span class="hljs-keyword">if</span> log_file <span class="hljs-keyword">option</span> <span class="hljs-keyword">is</span> specified <span class="hljs-keyword">and</span> Linux platform <span class="hljs-keyword">is</span> used. This <span class="hljs-keyword">option</span> <span class="hljs-keyword">is</span> ignored <span class="hljs-keyword">if</span> log_config_append <span class="hljs-keyword">is</span> <span class="hljs-keyword">set</span>.<br><br>use_syslog<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Use syslog <span class="hljs-keyword">for</span> logging. Existing syslog <span class="hljs-keyword">format</span> <span class="hljs-keyword">is</span> DEPRECATED <span class="hljs-keyword">and</span> will be changed later <span class="hljs-keyword">to</span> honor RFC5424. This <span class="hljs-keyword">option</span> <span class="hljs-keyword">is</span> ignored <span class="hljs-keyword">if</span> log_config_append <span class="hljs-keyword">is</span> <span class="hljs-keyword">set</span>.<br><br>use_journal<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br><span class="hljs-keyword">Enable</span> journald <span class="hljs-keyword">for</span> logging. <span class="hljs-keyword">If</span> running <span class="hljs-keyword">in</span> a systemd environment you may wish <span class="hljs-keyword">to</span> <span class="hljs-keyword">enable</span> journal support. Doing so will use the journal native protocol which includes structured metadata <span class="hljs-keyword">in</span> addition <span class="hljs-keyword">to</span> <span class="hljs-keyword">log</span> messages.This <span class="hljs-keyword">option</span> <span class="hljs-keyword">is</span> ignored <span class="hljs-keyword">if</span> log_config_append <span class="hljs-keyword">is</span> <span class="hljs-keyword">set</span>.<br><br>syslog_log_facility<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>LOG_USER<br><br>Syslog facility <span class="hljs-keyword">to</span> receive <span class="hljs-keyword">log</span> lines. This <span class="hljs-keyword">option</span> <span class="hljs-keyword">is</span> ignored <span class="hljs-keyword">if</span> log_config_append <span class="hljs-keyword">is</span> <span class="hljs-keyword">set</span>.<br><br>use_json<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Use <span class="hljs-type">JSON</span> formatting <span class="hljs-keyword">for</span> logging. This <span class="hljs-keyword">option</span> <span class="hljs-keyword">is</span> ignored <span class="hljs-keyword">if</span> log_config_append <span class="hljs-keyword">is</span> <span class="hljs-keyword">set</span>.<br><br>use_stderr<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br><span class="hljs-keyword">Log</span> output <span class="hljs-keyword">to</span> standard error. This <span class="hljs-keyword">option</span> <span class="hljs-keyword">is</span> ignored <span class="hljs-keyword">if</span> log_config_append <span class="hljs-keyword">is</span> <span class="hljs-keyword">set</span>.<br><br>use_eventlog<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br><span class="hljs-keyword">Log</span> output <span class="hljs-keyword">to</span> Windows Event <span class="hljs-keyword">Log</span>.<br><br>log_rotate_interval<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">integer</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-number">1</span><br><br>The amount <span class="hljs-keyword">of</span> <span class="hljs-type">time</span> <span class="hljs-keyword">before</span> the <span class="hljs-keyword">log</span> files are rotated. This <span class="hljs-keyword">option</span> <span class="hljs-keyword">is</span> ignored unless log_rotation_type <span class="hljs-keyword">is</span> setto “<span class="hljs-type">interval</span>”.<br><br>log_rotate_interval_type<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>days<br><br><span class="hljs-keyword">Valid</span> <span class="hljs-keyword">Values</span><br>Seconds, Minutes, Hours, Days, Weekday, Midnight<br><br>Rotation <span class="hljs-type">interval</span> <span class="hljs-keyword">type</span>. The <span class="hljs-type">time</span> <span class="hljs-keyword">of</span> the last file change (<span class="hljs-keyword">or</span> the <span class="hljs-type">time</span> <span class="hljs-keyword">when</span> the service was started) <span class="hljs-keyword">is</span> used <span class="hljs-keyword">when</span> scheduling the next rotation.<br><br>max_logfile_count<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">integer</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-number">30</span><br><br>Maximum number <span class="hljs-keyword">of</span> rotated <span class="hljs-keyword">log</span> files.<br><br>max_logfile_size_mb<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">integer</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-number">200</span><br><br><span class="hljs-keyword">Log</span> file maximum size <span class="hljs-keyword">in</span> MB. This <span class="hljs-keyword">option</span> <span class="hljs-keyword">is</span> ignored <span class="hljs-keyword">if</span> “log_rotation_type” <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span> “size”.<br><br>log_rotation_type<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">none</span><br><br><span class="hljs-keyword">Valid</span> <span class="hljs-keyword">Values</span><br><span class="hljs-type">interval</span>, size, <span class="hljs-keyword">none</span><br><br><span class="hljs-keyword">Log</span> rotation <span class="hljs-keyword">type</span>.<br><br>Possible <span class="hljs-keyword">values</span><br><br><span class="hljs-type">interval</span><br>Rotate logs at predefined <span class="hljs-type">time</span> intervals.<br><br>size<br>Rotate logs once they reach a predefined size.<br><br><span class="hljs-keyword">none</span><br><span class="hljs-keyword">Do</span> <span class="hljs-keyword">not</span> rotate <span class="hljs-keyword">log</span> files.<br><br>logging_context_format_string<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>%(asctime)s.%(msecs)<span class="hljs-number">03</span>d %(process)d %(levelname)s %(<span class="hljs-type">name</span>)s [%(request_id)s %(user_identity)s] %(instance)s%(message)s<br><br><span class="hljs-keyword">Format</span> string <span class="hljs-keyword">to</span> use <span class="hljs-keyword">for</span> <span class="hljs-keyword">log</span> messages <span class="hljs-keyword">with</span> context. Used <span class="hljs-keyword">by</span> oslo_log.formatters.ContextFormatter<br><br>logging_default_format_string<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>%(asctime)s.%(msecs)<span class="hljs-number">03</span>d %(process)d %(levelname)s %(<span class="hljs-type">name</span>)s [-] %(instance)s%(message)s<br><br><span class="hljs-keyword">Format</span> string <span class="hljs-keyword">to</span> use <span class="hljs-keyword">for</span> <span class="hljs-keyword">log</span> messages <span class="hljs-keyword">when</span> context <span class="hljs-keyword">is</span> undefined. Used <span class="hljs-keyword">by</span> oslo_log.formatters.ContextFormatter<br><br>logging_debug_format_suffix<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>%(funcName)s %(pathname)s:%(lineno)d<br><br>Additional data <span class="hljs-keyword">to</span> append <span class="hljs-keyword">to</span> <span class="hljs-keyword">log</span> message <span class="hljs-keyword">when</span> logging <span class="hljs-keyword">level</span> <span class="hljs-keyword">for</span> the message <span class="hljs-keyword">is</span> <span class="hljs-keyword">DEBUG</span>. Used <span class="hljs-keyword">by</span> oslo_log.formatters.ContextFormatter<br><br>logging_exception_prefix<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>%(asctime)s.%(msecs)<span class="hljs-number">03</span>d %(process)d ERROR %(<span class="hljs-type">name</span>)s %(instance)s<br><br>Prefix <span class="hljs-keyword">each</span> <span class="hljs-type">line</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">exception</span> output <span class="hljs-keyword">with</span> this <span class="hljs-keyword">format</span>. Used <span class="hljs-keyword">by</span> oslo_log.formatters.ContextFormatter<br><br>logging_user_identity_format<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>%(<span class="hljs-keyword">user</span>)s %(tenant)s %(<span class="hljs-keyword">domain</span>)s %(user_domain)s %(project_domain)s<br><br>Defines the <span class="hljs-keyword">format</span> string <span class="hljs-keyword">for</span> %(user_identity)s that <span class="hljs-keyword">is</span> used <span class="hljs-keyword">in</span> logging_context_format_string. Used <span class="hljs-keyword">by</span> oslo_log.formatters.ContextFormatter<br><br>default_log_levels<br><span class="hljs-keyword">Type</span><br>list<br><br><span class="hljs-keyword">Default</span><br>[‘amqp=WARN’, ‘amqplib=WARN’, ‘boto=WARN’, ‘qpid=WARN’, ‘sqlalchemy=WARN’, ‘suds=<span class="hljs-keyword">INFO</span>’, ‘oslo.messaging=<span class="hljs-keyword">INFO</span>’, ‘oslo_messaging=<span class="hljs-keyword">INFO</span>’, ‘iso8601=WARN’, ‘requests.packages.urllib3.connectionpool=WARN’, ‘urllib3.connectionpool=WARN’, ‘websocket=WARN’, ‘requests.packages.urllib3.util.retry=WARN’, ‘urllib3.util.retry=WARN’, ‘keystonemiddleware=WARN’, ‘routes.middleware=WARN’, ‘stevedore=WARN’, ‘taskflow=WARN’, ‘keystoneauth=WARN’, ‘oslo.cache=<span class="hljs-keyword">INFO</span>’, ‘oslo_policy=<span class="hljs-keyword">INFO</span>’, ‘dogpile.core.dogpile=<span class="hljs-keyword">INFO</span>’]<br><br>List <span class="hljs-keyword">of</span> package logging levels <span class="hljs-keyword">in</span> logger=<span class="hljs-keyword">LEVEL</span> pairs. This <span class="hljs-keyword">option</span> <span class="hljs-keyword">is</span> ignored <span class="hljs-keyword">if</span> log_config_append <span class="hljs-keyword">is</span> <span class="hljs-keyword">set</span>.<br><br>publish_errors<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Enables <span class="hljs-keyword">or</span> disables <span class="hljs-keyword">publication</span> <span class="hljs-keyword">of</span> error events.<br><br>instance_format<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>“[instance: %(<span class="hljs-type">uuid</span>)s] “<br><br>The <span class="hljs-keyword">format</span> <span class="hljs-keyword">for</span> an instance that <span class="hljs-keyword">is</span> passed <span class="hljs-keyword">with</span> the <span class="hljs-keyword">log</span> message.<br><br>instance_uuid_format<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>“[instance: %(<span class="hljs-type">uuid</span>)s] “<br><br>The <span class="hljs-keyword">format</span> <span class="hljs-keyword">for</span> an instance <span class="hljs-type">UUID</span> that <span class="hljs-keyword">is</span> passed <span class="hljs-keyword">with</span> the <span class="hljs-keyword">log</span> message.<br><br>rate_limit_interval<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">integer</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-number">0</span><br><br><span class="hljs-type">Interval</span>, number <span class="hljs-keyword">of</span> seconds, <span class="hljs-keyword">of</span> <span class="hljs-keyword">log</span> rate limiting.<br><br>rate_limit_burst<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">integer</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-number">0</span><br><br>Maximum number <span class="hljs-keyword">of</span> <span class="hljs-keyword">logged</span> messages per rate_limit_interval.<br><br>rate_limit_except_level<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>CRITICAL<br><br><span class="hljs-keyword">Log</span> <span class="hljs-keyword">level</span> <span class="hljs-type">name</span> used <span class="hljs-keyword">by</span> rate limiting: CRITICAL, ERROR, <span class="hljs-keyword">INFO</span>, <span class="hljs-built_in">WARNING</span>, <span class="hljs-keyword">DEBUG</span> <span class="hljs-keyword">or</span> empty string. Logs <span class="hljs-keyword">with</span> <span class="hljs-keyword">level</span> greater <span class="hljs-keyword">or</span> equal <span class="hljs-keyword">to</span> rate_limit_except_level are <span class="hljs-keyword">not</span> filtered. An empty string means that <span class="hljs-keyword">all</span> levels are filtered.<br><br>fatal_deprecations<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Enables <span class="hljs-keyword">or</span> disables fatal status <span class="hljs-keyword">of</span> deprecations.<br><br>allow_reboot<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">True</span><br><br>Allows OS reboots requested <span class="hljs-keyword">by</span> plugins<br><br>stop_service_on_exit<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">True</span><br><br><span class="hljs-keyword">In</span> <span class="hljs-keyword">case</span> <span class="hljs-keyword">of</span> execution <span class="hljs-keyword">as</span> a service, specifies <span class="hljs-keyword">if</span> the service must be gracefully stopped <span class="hljs-keyword">before</span> exiting<br><br>check_latest_version<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br><span class="hljs-keyword">Check</span> <span class="hljs-keyword">if</span> there <span class="hljs-keyword">is</span> a newer <span class="hljs-keyword">version</span> <span class="hljs-keyword">of</span> cloudbase-init available. <span class="hljs-keyword">If</span> this <span class="hljs-keyword">option</span> <span class="hljs-keyword">is</span> activated, a <span class="hljs-keyword">log</span> message will be emitted <span class="hljs-keyword">if</span> there <span class="hljs-keyword">is</span> a newer <span class="hljs-keyword">version</span> available.<br><br>retry_count<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">integer</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-number">5</span><br><br>Max. number <span class="hljs-keyword">of</span> attempts <span class="hljs-keyword">for</span> fetching metadata <span class="hljs-keyword">in</span> <span class="hljs-keyword">case</span> <span class="hljs-keyword">of</span> transient errors<br><br>retry_count_interval<br><span class="hljs-keyword">Type</span><br>floating <span class="hljs-type">point</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-number">4</span><br><br><span class="hljs-type">Interval</span> <span class="hljs-keyword">between</span> attempts <span class="hljs-keyword">in</span> <span class="hljs-keyword">case</span> <span class="hljs-keyword">of</span> transient errors, expressed <span class="hljs-keyword">in</span> seconds<br><br>mtools_path<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br><br><span class="hljs-type">Path</span> <span class="hljs-keyword">to</span> “mtools” program suite, used <span class="hljs-keyword">for</span> interacting <span class="hljs-keyword">with</span> VFAT filesystems<br><br>bsdtar_path<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>bsdtar.exe<br><br><span class="hljs-type">Path</span> <span class="hljs-keyword">to</span> “bsdtar”, used <span class="hljs-keyword">to</span> extract ISO ConfigDrive files<br><br>netbios_host_name_compatibility<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">True</span><br><br>Truncates the hostname <span class="hljs-keyword">to</span> <span class="hljs-number">15</span> characters <span class="hljs-keyword">for</span> Netbios compatibility<br><br>logging_serial_port_settings<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br><br><span class="hljs-type">Serial</span> port logging settings. <span class="hljs-keyword">Format</span>: “port,baudrate,parity,bytesize”, e.g.: “COM1,<span class="hljs-number">115200</span>,N,<span class="hljs-number">8</span>”. <span class="hljs-keyword">Set</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">None</span> (<span class="hljs-keyword">default</span>) <span class="hljs-keyword">to</span> <span class="hljs-keyword">disable</span>.<br><br>activate_windows<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Activates Windows automatically<br><br>set_kms_product_key<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Sets the KMS product key <span class="hljs-keyword">for</span> this operating <span class="hljs-keyword">system</span><br><br>set_avma_product_key<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Sets the AVMA product key <span class="hljs-keyword">for</span> this operating <span class="hljs-keyword">system</span><br><br>kms_host<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br><br>The KMS host address <span class="hljs-keyword">in</span> form [:], e.g: “kmshost:<span class="hljs-number">1688</span>”<br><br>log_licensing_info<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">True</span><br><br>Logs the operating <span class="hljs-keyword">system</span> licensing information<br><br>winrm_enable_basic_auth<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">True</span><br><br>Enables basic authentication <span class="hljs-keyword">for</span> the WinRM HTTPS listener<br><br>winrm_configure_http_listener<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Configures the WinRM HTTP listener<br><br>winrm_configure_https_listener<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">True</span><br><br>Configures the WinRM HTTPS listener<br><br>volumes_to_extend<br><span class="hljs-keyword">Type</span><br>list<br><br><span class="hljs-keyword">Default</span><br><br>List <span class="hljs-keyword">of</span> volumes that need <span class="hljs-keyword">to</span> be extended <span class="hljs-keyword">if</span> contiguous space <span class="hljs-keyword">is</span> available <span class="hljs-keyword">on</span> the disk. <span class="hljs-keyword">By</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">all</span> the available volumes can be extended. Volumes must be specified <span class="hljs-keyword">using</span> a comma separated list <span class="hljs-keyword">of</span> volume indexes, e.g.: “<span class="hljs-number">1</span>,<span class="hljs-number">2</span>”<br><br>san_policy<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br><br><span class="hljs-keyword">Valid</span> <span class="hljs-keyword">Values</span><br>OnlineAll, OfflineAll, OfflineShared<br><br><span class="hljs-keyword">If</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">None</span>, the SAN <span class="hljs-keyword">policy</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span> the given <span class="hljs-keyword">value</span><br><br>local_scripts_path<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br><br><span class="hljs-type">Path</span> <span class="hljs-keyword">location</span> containing scripts <span class="hljs-keyword">to</span> be executed <span class="hljs-keyword">when</span> the plugin runs<br><br>mtu_use_dhcp_config<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">True</span><br><br>Configures the network interfaces MTU based <span class="hljs-keyword">on</span> the <span class="hljs-keyword">values</span> provided via DHCP<br><br>username<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">Admin</span><br><br><span class="hljs-keyword">User</span> <span class="hljs-keyword">to</span> be added <span class="hljs-keyword">to</span> the <span class="hljs-keyword">system</span> <span class="hljs-keyword">or</span> updated <span class="hljs-keyword">if</span> already existing<br><br><span class="hljs-keyword">groups</span><br><span class="hljs-keyword">Type</span><br>list<br><br><span class="hljs-keyword">Default</span><br>[‘Administrators’]<br><br>List <span class="hljs-keyword">of</span> <span class="hljs-keyword">local</span> <span class="hljs-keyword">groups</span> <span class="hljs-keyword">to</span> which the <span class="hljs-keyword">user</span> specified <span class="hljs-keyword">in</span> “username” will be added<br><br>rename_admin_user<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Renames the builtin <span class="hljs-keyword">admin</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">instead</span> <span class="hljs-keyword">of</span> creating a <span class="hljs-built_in">new</span> <span class="hljs-keyword">user</span><br><br>heat_config_dir<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>C:\cfn<br><br>The directory <span class="hljs-keyword">where</span> the Heat <span class="hljs-keyword">configuration</span> files must be saved<br><br>ntp_enable_service<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">True</span><br><br>Enables the NTP client service<br><br>ntp_use_dhcp_config<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Configures NTP client <span class="hljs-type">time</span> synchronization <span class="hljs-keyword">using</span> the NTP servers provided via DHCP<br><br>real_time_clock_utc<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Sets the <span class="hljs-type">real</span> <span class="hljs-type">time</span> clock <span class="hljs-keyword">to</span> use universal <span class="hljs-type">time</span> (<span class="hljs-keyword">True</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">local</span> <span class="hljs-type">time</span> (<span class="hljs-keyword">False</span>)<br><br>inject_user_password<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">True</span><br><br><span class="hljs-keyword">Set</span> the <span class="hljs-keyword">password</span> provided <span class="hljs-keyword">in</span> the <span class="hljs-keyword">configuration</span>. <span class="hljs-keyword">If</span> <span class="hljs-keyword">False</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">no</span> <span class="hljs-keyword">password</span> <span class="hljs-keyword">is</span> provided, a random one will be <span class="hljs-keyword">set</span><br><br>first_logon_behaviour<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>clear_text_injected_only<br><br><span class="hljs-keyword">Valid</span> <span class="hljs-keyword">Values</span><br>clear_text_injected_only, <span class="hljs-keyword">no</span>, <span class="hljs-keyword">always</span><br><br>Control the behaviour <span class="hljs-keyword">of</span> what happens at next logon. <span class="hljs-keyword">If</span> this <span class="hljs-keyword">option</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">always</span>, <span class="hljs-keyword">then</span> the <span class="hljs-keyword">user</span> will be forced <span class="hljs-keyword">to</span> change the <span class="hljs-keyword">password</span> at next logon. <span class="hljs-keyword">If</span> it <span class="hljs-keyword">is</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span> clear_text_injected_only, <span class="hljs-keyword">then</span> the <span class="hljs-keyword">user</span> will have <span class="hljs-keyword">to</span> change the <span class="hljs-keyword">password</span> <span class="hljs-keyword">only</span> <span class="hljs-keyword">if</span> the <span class="hljs-keyword">password</span> <span class="hljs-keyword">is</span> a clear <span class="hljs-type">text</span> <span class="hljs-keyword">password</span>, coming <span class="hljs-keyword">from</span> the metadata. The last <span class="hljs-keyword">option</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">no</span>, <span class="hljs-keyword">when</span> the <span class="hljs-keyword">user</span> <span class="hljs-keyword">is</span> never forced <span class="hljs-keyword">to</span> change the <span class="hljs-keyword">password</span>.<br><br>metadata_services<br><span class="hljs-keyword">Type</span><br>list<br><br><span class="hljs-keyword">Default</span><br>[‘cloudbaseinit.metadata.services.httpservice.HttpService’, ‘cloudbaseinit.metadata.services.configdrive.ConfigDriveService’, ‘cloudbaseinit.metadata.services.ec2service.EC2Service’, ‘cloudbaseinit.metadata.services.maasservice.MaaSHttpService’, ‘cloudbaseinit.metadata.services.cloudstack.CloudStack’, ‘cloudbaseinit.metadata.services.opennebulaservice.OpenNebulaService’]<br><br>List <span class="hljs-keyword">of</span> enabled metadata service classes, <span class="hljs-keyword">to</span> be tested <span class="hljs-keyword">for</span> availability <span class="hljs-keyword">in</span> the provided <span class="hljs-keyword">order</span>. The first available service will be used <span class="hljs-keyword">to</span> retrieve metadata<br><br>plugins<br><span class="hljs-keyword">Type</span><br>list<br><br><span class="hljs-keyword">Default</span><br>[‘cloudbaseinit.plugins.common.mtu.MTUPlugin’, ‘cloudbaseinit.plugins.windows.ntpclient.NTPClientPlugin’, ‘cloudbaseinit.plugins.common.sethostname.SetHostNamePlugin’, ‘cloudbaseinit.plugins.windows.createuser.CreateUserPlugin’, ‘cloudbaseinit.plugins.common.networkconfig.NetworkConfigPlugin’, ‘cloudbaseinit.plugins.windows.licensing.WindowsLicensingPlugin’, ‘cloudbaseinit.plugins.common.sshpublickeys.SetUserSSHPublicKeysPlugin’, ‘cloudbaseinit.plugins.windows.extendvolumes.ExtendVolumesPlugin’, ‘cloudbaseinit.plugins.common.userdata.UserDataPlugin’, ‘cloudbaseinit.plugins.common.setuserpassword.SetUserPasswordPlugin’, ‘cloudbaseinit.plugins.windows.winrmlistener.ConfigWinRMListenerPlugin’, ‘cloudbaseinit.plugins.windows.winrmcertificateauth.ConfigWinRMCertificateAuthPlugin’, ‘cloudbaseinit.plugins.common.localscripts.LocalScriptsPlugin’]<br><br>List <span class="hljs-keyword">of</span> enabled plugin classes, <span class="hljs-keyword">to</span> be executed <span class="hljs-keyword">in</span> the provided <span class="hljs-keyword">order</span><br><br>user_data_plugins<br><span class="hljs-keyword">Type</span><br>list<br><br><span class="hljs-keyword">Default</span><br>[‘cloudbaseinit.plugins.common.userdataplugins.parthandler.PartHandlerPlugin’, ‘cloudbaseinit.plugins.common.userdataplugins.cloudconfig.CloudConfigPlugin’, ‘cloudbaseinit.plugins.common.userdataplugins.cloudboothook.CloudBootHookPlugin’, ‘cloudbaseinit.plugins.common.userdataplugins.shellscript.ShellScriptPlugin’, ‘cloudbaseinit.plugins.common.userdataplugins.multipartmixed.MultipartMixedPlugin’, ‘cloudbaseinit.plugins.common.userdataplugins.heat.HeatPlugin’]<br><br>List <span class="hljs-keyword">of</span> enabled userdata content plugins<br><br>cloud_config_plugins<br><span class="hljs-keyword">Type</span><br>list<br><br><span class="hljs-keyword">Default</span><br>[]<br><br>List which contains the <span class="hljs-type">name</span> <span class="hljs-keyword">of</span> the cloud config plugins ordered <span class="hljs-keyword">by</span> priority.<br><br>rdp_set_keepalive<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">True</span><br><br>Sets the RDP KeepAlive <span class="hljs-keyword">policy</span><br><br>bcd_boot_status_policy<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br><br><span class="hljs-keyword">Valid</span> <span class="hljs-keyword">Values</span><br>ignoreallfailures<br><br>Sets the Windows BCD boot status <span class="hljs-keyword">policy</span><br><br>bcd_enable_auto_recovery<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Enables <span class="hljs-keyword">or</span> disables the BCD auto recovery<br><br>set_unique_boot_disk_id<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">True</span><br><br>Sets a <span class="hljs-built_in">new</span> random <span class="hljs-keyword">unique</span> id <span class="hljs-keyword">on</span> the boot disk <span class="hljs-keyword">to</span> avoid collisions<br><br>display_idle_timeout<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">integer</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-number">0</span><br><br>The idle timeout, <span class="hljs-keyword">in</span> seconds, <span class="hljs-keyword">before</span> powering <span class="hljs-keyword">off</span> the display. <span class="hljs-keyword">Set</span> <span class="hljs-number">0</span> <span class="hljs-keyword">to</span> leave the display <span class="hljs-keyword">always</span> <span class="hljs-keyword">on</span><br><br>page_file_volume_labels<br><span class="hljs-keyword">Type</span><br>list<br><br><span class="hljs-keyword">Default</span><br>[]<br><br>Labels <span class="hljs-keyword">of</span> volumes <span class="hljs-keyword">on</span> which a Windows page file needs <span class="hljs-keyword">to</span> be created. E.g.: “<span class="hljs-keyword">Temporary</span> <span class="hljs-keyword">Storage</span>”<br><br>page_file_volume_mount_points<br><span class="hljs-keyword">Type</span><br>list<br><br><span class="hljs-keyword">Default</span><br>[]<br><br>Volume mount points <span class="hljs-keyword">on</span> which a Windows page file needs <span class="hljs-keyword">to</span> be created. E.g.: “?GLOBALROOTdeviceHarddisk1Partition1”<br><br>trim_enabled<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Enables <span class="hljs-keyword">or</span> disables TRIM <span class="hljs-keyword">delete</span> notifications <span class="hljs-keyword">for</span> the underlying <span class="hljs-keyword">storage</span> device.<br><br>process_userdata<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">True</span><br><br>Processes the userdata content based <span class="hljs-keyword">on</span> the <span class="hljs-keyword">type</span>, e.g. executing a PowerShell script<br><br>userdata_save_path<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br><br>Copies the userdata <span class="hljs-keyword">to</span> the given file <span class="hljs-type">path</span>. The <span class="hljs-type">path</span> can <span class="hljs-keyword">include</span> environment variables that will be expanded, e.g. “%SYSTEMDRIVE%CloudbaseInitUserData.bin”<br><br>enable_automatic_updates<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><br><span class="hljs-keyword">If</span> <span class="hljs-keyword">set</span>, enables <span class="hljs-keyword">or</span> disables automatic operating <span class="hljs-keyword">system</span> updates.<br><br>metadata_report_provisioning_started<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Reports <span class="hljs-keyword">to</span> the metadata service that provisioning has started<br><br>metadata_report_provisioning_completed<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Reports <span class="hljs-keyword">to</span> the metadata service that provisioning completed successfully <span class="hljs-keyword">or</span> failed<br><br>ephemeral_disk_volume_label<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br><br>Ephemeral disk volume label, e.g.: “<span class="hljs-keyword">Temporary</span> <span class="hljs-keyword">Storage</span>”<br><br>ephemeral_disk_volume_mount_point<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br><br>Ephemeral disk volume mount <span class="hljs-type">point</span>, e.g.:”?GLOBALROOTdeviceHarddisk1Partition1”<br><br>ephemeral_disk_data_loss_warning_path<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br><br>Ephemeral disk data loss <span class="hljs-built_in">warning</span> <span class="hljs-type">path</span>, relative <span class="hljs-keyword">to</span> the ephemeral disk volume <span class="hljs-type">path</span>. E.g.: DATALOSS_WARNING_README.txt<br><br>user_password_length<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">integer</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-number">20</span><br><br>The length <span class="hljs-keyword">of</span> the <span class="hljs-keyword">generated</span> <span class="hljs-keyword">password</span> <span class="hljs-keyword">for</span> the <span class="hljs-keyword">user</span> defined <span class="hljs-keyword">by</span> the username config <span class="hljs-keyword">option</span>.<br><br>azure<br>transport_cert_store_name<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>Windows Azure Environment<br><br>Certificate store <span class="hljs-type">name</span> <span class="hljs-keyword">for</span> metadata certificates<br><br>cloudstack<br>metadata_base_url<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>http://<span class="hljs-number">10.1</span><span class="hljs-number">.1</span><span class="hljs-number">.1</span>/<br><br>The base URL <span class="hljs-keyword">where</span> the service looks <span class="hljs-keyword">for</span> metadata<br><br>Deprecated Variations<br><span class="hljs-keyword">Group</span><br><br><span class="hljs-type">Name</span><br><br><span class="hljs-keyword">DEFAULT</span><br><br>cloudstack_metadata_ip<br><br>password_server_port<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">integer</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-number">8080</span><br><br>The port number used <span class="hljs-keyword">by</span> the <span class="hljs-keyword">Password</span> <span class="hljs-keyword">Server</span>.<br><br>https_allow_insecure<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Whether <span class="hljs-keyword">to</span> <span class="hljs-keyword">disable</span> the validation <span class="hljs-keyword">of</span> HTTPS certificates.<br><br>https_ca_bundle<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br><br>The <span class="hljs-type">path</span> <span class="hljs-keyword">to</span> a CA_BUNDLE file <span class="hljs-keyword">or</span> directory <span class="hljs-keyword">with</span> certificates <span class="hljs-keyword">of</span> <span class="hljs-keyword">trusted</span> CAs.<br><br>add_metadata_private_ip_route<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br><span class="hljs-keyword">Add</span> a route <span class="hljs-keyword">for</span> the metadata ip address <span class="hljs-keyword">to</span> the gateway<br><br>config_drive<br>raw_hdd<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">True</span><br><br>Look <span class="hljs-keyword">for</span> an ISO config drive <span class="hljs-keyword">in</span> raw HDDs<br><br>Deprecated Variations<br><span class="hljs-keyword">Group</span><br><br><span class="hljs-type">Name</span><br><br><span class="hljs-keyword">DEFAULT</span><br><br>config_drive_raw_hhd<br><br><span class="hljs-built_in">Warning</span><br><br>This <span class="hljs-keyword">option</span> <span class="hljs-keyword">is</span> deprecated <span class="hljs-keyword">for</span> removal. Its <span class="hljs-keyword">value</span> may be silently ignored <span class="hljs-keyword">in</span> the future.<br><br>cdrom<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">True</span><br><br>Look <span class="hljs-keyword">for</span> a config drive <span class="hljs-keyword">in</span> the attached cdrom drives<br><br>Deprecated Variations<br><span class="hljs-keyword">Group</span><br><br><span class="hljs-type">Name</span><br><br><span class="hljs-keyword">DEFAULT</span><br><br>config_drive_cdrom<br><br><span class="hljs-built_in">Warning</span><br><br>This <span class="hljs-keyword">option</span> <span class="hljs-keyword">is</span> deprecated <span class="hljs-keyword">for</span> removal. Its <span class="hljs-keyword">value</span> may be silently ignored <span class="hljs-keyword">in</span> the future.<br><br>vfat<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">True</span><br><br>Look <span class="hljs-keyword">for</span> a config drive <span class="hljs-keyword">in</span> VFAT filesystems<br><br>Deprecated Variations<br><span class="hljs-keyword">Group</span><br><br><span class="hljs-type">Name</span><br><br><span class="hljs-keyword">DEFAULT</span><br><br>config_drive_vfat<br><br><span class="hljs-built_in">Warning</span><br><br>This <span class="hljs-keyword">option</span> <span class="hljs-keyword">is</span> deprecated <span class="hljs-keyword">for</span> removal. Its <span class="hljs-keyword">value</span> may be silently ignored <span class="hljs-keyword">in</span> the future.<br><br><span class="hljs-keyword">types</span><br><span class="hljs-keyword">Type</span><br>list<br><br><span class="hljs-keyword">Default</span><br>[‘vfat’, ‘iso’]<br><br>Supported formats <span class="hljs-keyword">of</span> a <span class="hljs-keyword">configuration</span> drive<br><br>Deprecated Variations<br><span class="hljs-keyword">Group</span><br><br><span class="hljs-type">Name</span><br><br><span class="hljs-keyword">DEFAULT</span><br><br>config_drive_types<br><br>locations<br><span class="hljs-keyword">Type</span><br>list<br><br><span class="hljs-keyword">Default</span><br>[‘cdrom’, ‘hdd’, ‘<span class="hljs-keyword">partition</span>’]<br><br>Supported <span class="hljs-keyword">configuration</span> drive locations<br><br>Deprecated Variations<br><span class="hljs-keyword">Group</span><br><br><span class="hljs-type">Name</span><br><br><span class="hljs-keyword">DEFAULT</span><br><br>config_drive_locations<br><br>ec2<br>metadata_base_url<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>http://<span class="hljs-number">169.254</span><span class="hljs-number">.169</span><span class="hljs-number">.254</span>/<br><br>The base URL <span class="hljs-keyword">where</span> the service looks <span class="hljs-keyword">for</span> metadata<br><br>Deprecated Variations<br><span class="hljs-keyword">Group</span><br><br><span class="hljs-type">Name</span><br><br><span class="hljs-keyword">DEFAULT</span><br><br>ec2_metadata_base_url<br><br>add_metadata_private_ip_route<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">True</span><br><br><span class="hljs-keyword">Add</span> a route <span class="hljs-keyword">for</span> the metadata ip address <span class="hljs-keyword">to</span> the gateway<br><br>Deprecated Variations<br><span class="hljs-keyword">Group</span><br><br><span class="hljs-type">Name</span><br><br><span class="hljs-keyword">DEFAULT</span><br><br>ec2_add_metadata_private_ip_route<br><br>https_allow_insecure<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Whether <span class="hljs-keyword">to</span> <span class="hljs-keyword">disable</span> the validation <span class="hljs-keyword">of</span> HTTPS certificates.<br><br>https_ca_bundle<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br><br>The <span class="hljs-type">path</span> <span class="hljs-keyword">to</span> a CA_BUNDLE file <span class="hljs-keyword">or</span> directory <span class="hljs-keyword">with</span> certificates <span class="hljs-keyword">of</span> <span class="hljs-keyword">trusted</span> CAs.<br><br>gce<br>metadata_base_url<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>http://metadata.google.internal/computeMetadata/v1/<br><br>The base URL <span class="hljs-keyword">where</span> the service looks <span class="hljs-keyword">for</span> metadata<br><br>https_allow_insecure<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Whether <span class="hljs-keyword">to</span> <span class="hljs-keyword">disable</span> the validation <span class="hljs-keyword">of</span> HTTPS certificates.<br><br>https_ca_bundle<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br><br>The <span class="hljs-type">path</span> <span class="hljs-keyword">to</span> a CA_BUNDLE file <span class="hljs-keyword">or</span> directory <span class="hljs-keyword">with</span> certificates <span class="hljs-keyword">of</span> <span class="hljs-keyword">trusted</span> CAs.<br><br>maas<br>metadata_base_url<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br><br>The base URL <span class="hljs-keyword">for</span> MaaS metadata<br><br>Deprecated Variations<br><span class="hljs-keyword">Group</span><br><br><span class="hljs-type">Name</span><br><br><span class="hljs-keyword">DEFAULT</span><br><br>maas_metadata_url<br><br>oauth_consumer_key<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>‘’<br><br>The MaaS OAuth consumer key<br><br>Deprecated Variations<br><span class="hljs-keyword">Group</span><br><br><span class="hljs-type">Name</span><br><br><span class="hljs-keyword">DEFAULT</span><br><br>maas_oauth_consumer_key<br><br>oauth_consumer_secret<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>‘’<br><br>The MaaS OAuth consumer secret<br><br>Deprecated Variations<br><span class="hljs-keyword">Group</span><br><br><span class="hljs-type">Name</span><br><br><span class="hljs-keyword">DEFAULT</span><br><br>maas_oauth_consumer_secret<br><br>oauth_token_key<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>‘’<br><br>The MaaS OAuth token key<br><br>Deprecated Variations<br><span class="hljs-keyword">Group</span><br><br><span class="hljs-type">Name</span><br><br><span class="hljs-keyword">DEFAULT</span><br><br>maas_oauth_token_key<br><br>oauth_token_secret<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>‘’<br><br>The MaaS OAuth token secret<br><br>Deprecated Variations<br><span class="hljs-keyword">Group</span><br><br><span class="hljs-type">Name</span><br><br><span class="hljs-keyword">DEFAULT</span><br><br>maas_oauth_token_secret<br><br>https_allow_insecure<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Whether <span class="hljs-keyword">to</span> <span class="hljs-keyword">disable</span> the validation <span class="hljs-keyword">of</span> HTTPS certificates.<br><br>https_ca_bundle<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br><br>The <span class="hljs-type">path</span> <span class="hljs-keyword">to</span> a CA_BUNDLE file <span class="hljs-keyword">or</span> directory <span class="hljs-keyword">with</span> certificates <span class="hljs-keyword">of</span> <span class="hljs-keyword">trusted</span> CAs.<br><br>openstack<br>metadata_base_url<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>http://<span class="hljs-number">169.254</span><span class="hljs-number">.169</span><span class="hljs-number">.254</span>/<br><br>The base URL <span class="hljs-keyword">where</span> the service looks <span class="hljs-keyword">for</span> metadata<br><br>Deprecated Variations<br><span class="hljs-keyword">Group</span><br><br><span class="hljs-type">Name</span><br><br><span class="hljs-keyword">DEFAULT</span><br><br>metadata_base_url<br><br>add_metadata_private_ip_route<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">True</span><br><br><span class="hljs-keyword">Add</span> a route <span class="hljs-keyword">for</span> the metadata ip address <span class="hljs-keyword">to</span> the gateway<br><br>Deprecated Variations<br><span class="hljs-keyword">Group</span><br><br><span class="hljs-type">Name</span><br><br><span class="hljs-keyword">DEFAULT</span><br><br>add_metadata_private_ip_route<br><br>https_allow_insecure<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Whether <span class="hljs-keyword">to</span> <span class="hljs-keyword">disable</span> the validation <span class="hljs-keyword">of</span> HTTPS certificates.<br><br>https_ca_bundle<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br><br>The <span class="hljs-type">path</span> <span class="hljs-keyword">to</span> a CA_BUNDLE file <span class="hljs-keyword">or</span> directory <span class="hljs-keyword">with</span> certificates <span class="hljs-keyword">of</span> <span class="hljs-keyword">trusted</span> CAs.<br><br>ovf<br>config_file_name<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>ovf-env.xml<br><br><span class="hljs-keyword">Configuration</span> file <span class="hljs-type">name</span><br><br>drive_label<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>OVF ENV<br><br>Look <span class="hljs-keyword">for</span> <span class="hljs-keyword">configuration</span> file <span class="hljs-keyword">in</span> drives <span class="hljs-keyword">with</span> this label<br><br>ns<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>oe<br><br>Namespace prefix <span class="hljs-keyword">for</span> ovf environment<br><br>packet<br>metadata_base_url<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>https://metadata.packet.net/<br><br>The URL <span class="hljs-keyword">where</span> the service looks <span class="hljs-keyword">for</span> metadata<br><br>https_allow_insecure<br><span class="hljs-keyword">Type</span><br><span class="hljs-type">boolean</span><br><br><span class="hljs-keyword">Default</span><br><span class="hljs-keyword">False</span><br><br>Whether <span class="hljs-keyword">to</span> <span class="hljs-keyword">disable</span> the validation <span class="hljs-keyword">of</span> HTTPS certificates.<br><br>https_ca_bundle<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br><br>The <span class="hljs-type">path</span> <span class="hljs-keyword">to</span> a CA_BUNDLE file <span class="hljs-keyword">or</span> directory <span class="hljs-keyword">with</span> certificates <span class="hljs-keyword">of</span> <span class="hljs-keyword">trusted</span> CAs.<br><br>vmwareguestinfo<br>vmware_rpctool_path<br><span class="hljs-keyword">Type</span><br>string<br><br><span class="hljs-keyword">Default</span><br>%ProgramFiles%/VMware/VMware Tools/rpctool.exe<br><br>The <span class="hljs-keyword">local</span> <span class="hljs-type">path</span> <span class="hljs-keyword">where</span> VMware rpctool <span class="hljs-keyword">is</span> <span class="hljs-built_in">found</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>网络ISO七层模型图</title>
    <link href="/2020/10/13/other/iso_module/"/>
    <url>/2020/10/13/other/iso_module/</url>
    
    <content type="html"><![CDATA[<p><img src="/images/iso7module.gif" alt="网络ISO七层模型图"></p>]]></content>
    
    
    <categories>
      
      <category>其它</category>
      
    </categories>
    
    
    <tags>
      
      <tag>其它</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pfSense防火墙扩展磁盘大小</title>
    <link href="/2020/10/10/other/pfsense_disk/"/>
    <url>/2020/10/10/other/pfsense_disk/</url>
    
    <content type="html"><![CDATA[<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">df</span> -h<br><span class="hljs-attribute">gpart</span> show<br><span class="hljs-attribute">su</span><br><span class="hljs-attribute">gpart</span> resize -i <span class="hljs-number">1</span> -s <span class="hljs-number">38</span>G -a <span class="hljs-number">4</span>k vtbd0<br><span class="hljs-attribute">gpart</span> show<br><span class="hljs-attribute">gpart</span> delete -i <span class="hljs-number">2</span> vtbd0s1<br><span class="hljs-attribute">gpart</span> resize -i <span class="hljs-number">1</span> -s <span class="hljs-number">47</span>G -a <span class="hljs-number">4</span>k vtbd0s1<br><span class="hljs-attribute">gpart</span> show<br><span class="hljs-attribute">growfs</span> /dev/ufsid/<span class="hljs-number">5</span>cde6f38370e9a3f<br><span class="hljs-attribute">df</span> -h<br></code></pre></td></tr></table></figure><p>参考freebsd官方文档：<a href="https://www.freebsd.org/doc/handbook/disks-growing.html">https://www.freebsd.org/doc/handbook/disks-growing.html</a></p>]]></content>
    
    
    <categories>
      
      <category>Firewall</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Firewall</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>H3C S5130-EI系列以太网交换机典型配置-SSH典型配置</title>
    <link href="/2020/10/09/other/h3c_ssh/"/>
    <url>/2020/10/09/other/h3c_ssh/</url>
    
    <content type="html"><![CDATA[<p><strong>配置步骤</strong></p><p><strong>生成 RSA 密钥对。</strong></p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs maxima">&lt;Device&gt; <span class="hljs-built_in">system</span>-<span class="hljs-built_in">view</span> <br>[Device] public-<span class="hljs-built_in">key</span> <span class="hljs-built_in">local</span> create rsa <br>The <span class="hljs-built_in">range</span> of public <span class="hljs-built_in">key</span> size <span class="hljs-built_in">is</span> (<span class="hljs-number">512</span> ~ <span class="hljs-number">2048</span>). <br>If the <span class="hljs-built_in">key</span> <span class="hljs-built_in">modulus</span> <span class="hljs-built_in">is</span> greater than <span class="hljs-number">512</span>, it will take a few minutes. <br>Press CTRL+C to abort. <br>Input the <span class="hljs-built_in">modulus</span> <span class="hljs-built_in">length</span> [default = <span class="hljs-number">1024</span>]: <br>Generating Keys... <br>........................++++++ <br>...................++++++ <br>..++++++++ <br>............++++++++ <br>Create the <span class="hljs-built_in">key</span> pair successfully.<br></code></pre></td></tr></table></figure><p><strong>生成 DSA 密钥对。</strong></p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs maxima">[Device] public-<span class="hljs-built_in">key</span> <span class="hljs-built_in">local</span> create dsa <br>The <span class="hljs-built_in">range</span> of public <span class="hljs-built_in">key</span> size <span class="hljs-built_in">is</span> (<span class="hljs-number">512</span> ~ <span class="hljs-number">2048</span>). <br>If the <span class="hljs-built_in">key</span> <span class="hljs-built_in">modulus</span> <span class="hljs-built_in">is</span> greater than <span class="hljs-number">512</span>, it will take a few minutes. <br>Press CTRL+C to abort. <br>Input the <span class="hljs-built_in">modulus</span> <span class="hljs-built_in">length</span> [default = <span class="hljs-number">1024</span>]: <br>Generating Keys... <br>.++++++++++++++++++++++++++++++++++++++++++++++++++* <br>........+......+.....+......................................+ <br>...+.................+..........+...+. <br>Create the <span class="hljs-built_in">key</span> pair successfully.<br></code></pre></td></tr></table></figure><p><strong>使能 SSH 服务器功能。</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[Device] ssh <span class="hljs-keyword">server</span> <span class="hljs-keyword">enable</span><br></code></pre></td></tr></table></figure><p><strong>创建 VLAN 2，并将 GigabitEthernet1&#x2F;0&#x2F;2 加入 VLAN 2。</strong></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-string">[Device]</span> vlan <span class="hljs-number">2</span> <br><span class="hljs-string">[Device-vlan2]</span> port gigabitethernet <span class="hljs-number">1</span>/<span class="hljs-number">0</span>/<span class="hljs-number">2</span> <br><span class="hljs-string">[Device-vlan2]</span> quit<br></code></pre></td></tr></table></figure><p><strong>配置 VLAN 接口 2 的 IP 地址，客户端将通过该地址连接 Stelnet 服务器。</strong></p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ceylon">[Device] <span class="hljs-keyword">interface</span> vlan-<span class="hljs-keyword">interface</span> <span class="hljs-number">2</span> <br>[Device-Vlan-<span class="hljs-keyword">interface</span><span class="hljs-number">2</span>] ip address <span class="hljs-number">192.1</span><span class="hljs-number">68.1</span>.<span class="hljs-number">40</span> <span class="hljs-number">255.2</span><span class="hljs-number">55.2</span><span class="hljs-number">55.0</span> <br>[Device-Vlan-<span class="hljs-keyword">interface</span><span class="hljs-number">2</span>] quit<br></code></pre></td></tr></table></figure><p><strong>设置 Stelnet 客户端登录用户界面的认证方式为 scheme。</strong></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim">[Device] <span class="hljs-built_in">line</span> vty <span class="hljs-number">0</span> <span class="hljs-number">63</span> <br>[Device-<span class="hljs-built_in">line</span>-vty0-<span class="hljs-number">63</span>] authentication-<span class="hljs-keyword">mode</span> scheme <br>[Device-<span class="hljs-built_in">line</span>-vty0-<span class="hljs-number">63</span>] <span class="hljs-keyword">quit</span><br></code></pre></td></tr></table></figure><p><strong>创建本地用户 client001，并设置用户密码、服务类型和用户角色。</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[Device] <span class="hljs-keyword">local</span>-<span class="hljs-keyword">user</span> client001 <span class="hljs-keyword">class</span> manage <br><span class="hljs-built_in">New</span> <span class="hljs-keyword">local</span> <span class="hljs-keyword">user</span> added. <br>[Device-luser-manage-client001] <span class="hljs-keyword">password</span> simple aabbcc <br>[Device-luser-manage-client001] service-<span class="hljs-keyword">type</span> ssh <br>[Device-luser-manage-client001] <span class="hljs-keyword">authorization</span>-<span class="hljs-keyword">attribute</span> <span class="hljs-keyword">user</span>-<span class="hljs-keyword">role</span> network-<span class="hljs-keyword">admin</span> <br>[Device-luser-manage-client001] quit<br></code></pre></td></tr></table></figure><p><strong>验证配置</strong><br>打开PuTTY.exe程序，点击“Session”功能区<br>• 在“Host Name（or IP address）”文本框中输入 Stelnet 服务器的 IP 地址为 192.168.1.40。<br>• 在“Port”文本框中输入 SSH 协议端口号 22。<br>• 在“Connection type”区域选择 SSH 协议。</p>]]></content>
    
    
    <categories>
      
      <category>Switch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Switch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows禁用/重新启用笔记本电脑自带键盘</title>
    <link href="/2020/10/09/tools/disable_keyboard/"/>
    <url>/2020/10/09/tools/disable_keyboard/</url>
    
    <content type="html"><![CDATA[<p><strong>禁用：</strong></p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">管理员身份运行cmd<br>输入 <span class="hljs-keyword">sc </span><span class="hljs-built_in">config</span> i8042prt start= <span class="hljs-keyword">disabled </span>回车<br>重启电脑生效<br></code></pre></td></tr></table></figure><p><strong>重新启用：</strong></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arduino">管理员身份运行cmd<br>输入 sc config i8042prt start= <span class="hljs-keyword">auto</span> 回车<br>重启电脑生效<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>工具</category>
      
    </categories>
    
    
    <tags>
      
      <tag>工具</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>解决Docker pull镜像速度过慢的问题</title>
    <link href="/2020/07/06/docker/docker_proxy/"/>
    <url>/2020/07/06/docker/docker_proxy/</url>
    
    <content type="html"><![CDATA[<p>目前，Docker拥有中国的官方镜像，<br>具体内容可访问<a href="https://www.docker-cn.com/registry-mirror">https://www.docker-cn.com/registry-mirror</a></p><p>在使用时，Docker 中国官方镜像加速可通过 registry.docker-cn.com访问。该镜像库只包含流行的公有镜像。私有镜像仍需要从美国镜像库中拉取。</p><p>您可以使用以下命令直接从该镜像加速地址进行拉取：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker pull registry.docker-cn.com/myname/myrepo:mytag</span><br></code></pre></td></tr></table></figure><p>例如:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker pull registry.docker-cn.com/library/ubuntu:16.04</span><br></code></pre></td></tr></table></figure><p>注: 除非您修改了 Docker 守护进程的 –registry-mirror 参数 (见下文), 否则您将需要完整地指定官方镜像的名称。<br>例如，library&#x2F;ubuntu、library&#x2F;redis、library&#x2F;nginx。</p><p>使用 –registry-mirror 配置 Docker 守护进程<br>您可以配置 Docker 守护进程默认使用 Docker 官方镜像加速。这样您可以默认通过官方镜像加速拉取镜像，而无需在每次拉取时指定 registry.docker-cn.com。</p><p>您可以在 Docker 守护进程启动时传入 –registry-mirror 参数：</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-symbol">$</span> docker –registry-mirror=https:<span class="hljs-comment">//registry.docker-cn.com daemon</span><br></code></pre></td></tr></table></figure><p>为了永久性保留更改，您可以修改 &#x2F;etc&#x2F;docker&#x2F;daemon.json 文件并添加上 registry-mirrors 键值。</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs prolog">&#123;<br>  <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;https://registry.docker-cn.com&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure><p>修改保存后重启 Docker 以使配置生效。</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">systemctl restart docker</span><br></code></pre></td></tr></table></figure><p>注: 您也可以使用适用于 Mac 的 Docker 和适用于 Windows 的 Docker 来进行设置。</p>]]></content>
    
    
    <categories>
      
      <category>Docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Too many open files的四种解决办法</title>
    <link href="/2020/06/01/linux/too_many/"/>
    <url>/2020/06/01/linux/too_many/</url>
    
    <content type="html"><![CDATA[<p>【摘要】Too many open files有四种可能:</p><ul><li>一 单个进程打开文件句柄数过多</li><li>二 操作系统打开的文件句柄数过多</li><li>三 systemd对该进程进行了限制</li><li>四 inotify达到上限</li></ul><h3 id="单个进程打开文件句柄数过多"><a href="#单个进程打开文件句柄数过多" class="headerlink" title="单个进程打开文件句柄数过多"></a>单个进程打开文件句柄数过多</h3><p>ulimit中的nofile表示单进程可以打开的最大文件句柄数，可以通过ulimit -a查看，<br>子进程默认继承父进程的限制<br>（注意，是继承，不是共享，子进程和父进程打开的文件句柄数是单独算的）。</p><p>网上还有一种解读是nofile表示单用户可以打开的文件句柄数，因为他们在limit.conf中看到类似于”openstack soft nofile 65536”，便认为是openstack用户最多可以打开的文件句柄数。该解读是错误的，”openstack soft nofile 65536”表示的含义是当你执行”su - openstack”切换到openstack用户后，你创建的所有进程最大可以打开的文件句柄数是65536。<br>要查看一个进程可以打开的文件句柄数，可以通过”cat &#x2F;proc&#x2F;&#x2F;limits”查看。</p><p>要修改ulimit中的nofile，可以通过修改&#x2F;etc&#x2F;security&#x2F;limits.conf文件，<br>在其中加入类似”openstack soft nofile 65536”的语句来进行修改。<br>修改完成后，可以通过”su - openstack”切换用户，或者重新登录，来使该配置生效。</p><p>要动态修改一个进程的限制，可以使用prlimit命令，具体用法为：”prlimit –pid ${pid} –nofile&#x3D;102400:102400”。</p><h3 id="操作系统打开的文件句柄数过多"><a href="#操作系统打开的文件句柄数过多" class="headerlink" title="操作系统打开的文件句柄数过多"></a>操作系统打开的文件句柄数过多</h3><p>整个操作系统可以打开的文件句柄数是有限的，受内核参数”fs.file-max”影响。<br>可以通过执行”echo 100000000 &gt; &#x2F;proc&#x2F;sys&#x2F;fs&#x2F;file-max”命令来动态修改该值，<br>也可以通过修改”&#x2F;etc&#x2F;sysctl.conf”文件来永久修改该值。</p><h3 id="systemd对该进程进行了限制"><a href="#systemd对该进程进行了限制" class="headerlink" title="systemd对该进程进行了限制"></a>systemd对该进程进行了限制</h3><p>该场景仅针对被systemd管理的进程（也就是可以通过systemctl来控制的进程）生效，<br>可以通过修改该进程的service文件（通常在&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;目录下），<br>在”[Service]”下面添加”LimitNOFILE&#x3D;20480000”来实现，<br>修改完成之后需要执行”systemctl daemon-reload”来使该配置生效。</p><h3 id="inotify达到上限"><a href="#inotify达到上限" class="headerlink" title="inotify达到上限"></a>inotify达到上限</h3><p>inotify是linux提供的一种监控机制，可以监控文件系统的变化。<br>该机制受到2个内核参数的影响：”fs.inotify.max_user_instances”和 “fs.inotify.max_user_watches”，<br>其中”fs.inotify.max_user_instances”表示每个用户最多可以创建的inotify instances数量上限，<br>“fs.inotify.max_user_watches”表示么个用户同时可以添加的watch数目，<br>当出现too many open files问题而上面三种方法都无法解决时，可以尝试通过修改这2个内核参数来生效。<br>修改方法是修改”&#x2F;etc&#x2F;sysctl.conf”文件，并执行”sysctl -p”。</p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>centos7部署dzzoffice私有网盘</title>
    <link href="/2020/06/01/tools/dzzoffice/"/>
    <url>/2020/06/01/tools/dzzoffice/</url>
    
    <content type="html"><![CDATA[<h3 id="搭建Lamp框架-Linux-apache-mariadb-php"><a href="#搭建Lamp框架-Linux-apache-mariadb-php" class="headerlink" title="搭建Lamp框架(Linux+apache+mariadb+php)"></a>搭建Lamp框架(Linux+apache+mariadb+php)</h3><p>1.首先安装wget</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> -y wget<br></code></pre></td></tr></table></figure><p>2.下载epel额外包及YUM源配置</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//mi</span>rrors.aliyun.com<span class="hljs-regexp">/epel/</span>RPM-GPG-KEY-EPEL-<span class="hljs-number">7</span>       <span class="hljs-comment">#epel额外包的密钥</span><br>wget https:<span class="hljs-regexp">//mi</span>rrors.aliyun.com<span class="hljs-regexp">/epel/</span>epel-release-latest-<span class="hljs-number">7</span>.noarch.rpm    <span class="hljs-comment">#epel额外包的yum的配置</span><br></code></pre></td></tr></table></figure><p>3.导入密钥，为了防止安装错误，安装yum的配置文件</p><figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs capnproto">rpm --<span class="hljs-keyword">import</span>   RPM-GPG-KEY-EPEL-<span class="hljs-number">7</span>    <span class="hljs-comment">#导入epel额外包的密钥</span><br>rpm -ivh epel-release-latest-<span class="hljs-number">7</span>.noarch.rpm    <span class="hljs-comment">#安装epel额外包的yum配置</span><br></code></pre></td></tr></table></figure><p>4.安装升级php，作为依赖httpd都安装好了，apache(httpd)和php就安装好了</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs stylus">yum install -y php php-mysql           #升级php的软件包<br><br> php                x86_64        <span class="hljs-number">7.3</span>.<span class="hljs-number">4</span>-<span class="hljs-number">1</span><span class="hljs-selector-class">.el7</span><span class="hljs-selector-class">.remi</span>              php           <span class="hljs-number">3.2</span> M<br>为依赖而安装:<br> libargon2          x86_64        <span class="hljs-number">20161029</span>-<span class="hljs-number">3</span><span class="hljs-selector-class">.el7</span>                epel           <span class="hljs-number">23</span> k<br> apr                x86_64        <span class="hljs-number">1.4</span>.<span class="hljs-number">8</span>-<span class="hljs-number">3</span><span class="hljs-selector-class">.el7_4</span>.<span class="hljs-number">1</span>               centos        <span class="hljs-number">103</span> k<br> apr-util           x86_64        <span class="hljs-number">1.5</span>.<span class="hljs-number">2</span>-<span class="hljs-number">6</span><span class="hljs-selector-class">.el7</span>                   centos         <span class="hljs-number">92</span> k<br> httpd              x86_64        <span class="hljs-number">2.4</span>.<span class="hljs-number">6</span>-<span class="hljs-number">88</span><span class="hljs-selector-class">.el7</span><span class="hljs-selector-class">.centos</span>           centos        <span class="hljs-number">2.7</span> M<br> httpd-tools        x86_64        <span class="hljs-number">2.4</span>.<span class="hljs-number">6</span>-<span class="hljs-number">88</span><span class="hljs-selector-class">.el7</span><span class="hljs-selector-class">.centos</span>           centos         <span class="hljs-number">90</span> k<br> mailcap            noarch        <span class="hljs-number">2.1</span>.<span class="hljs-number">41</span>-<span class="hljs-number">2</span><span class="hljs-selector-class">.el7</span>                  centos         <span class="hljs-number">31</span> k<br> php-cli            x86_64        <span class="hljs-number">7.3</span>.<span class="hljs-number">4</span>-<span class="hljs-number">1</span><span class="hljs-selector-class">.el7</span><span class="hljs-selector-class">.remi</span>              php           <span class="hljs-number">4.9</span> M<br> php-common         x86_64        <span class="hljs-number">7.3</span>.<span class="hljs-number">4</span>-<span class="hljs-number">1</span><span class="hljs-selector-class">.el7</span><span class="hljs-selector-class">.remi</span>              php           <span class="hljs-number">1.1</span> M<br> php-json           x86_64        <span class="hljs-number">7.3</span>.<span class="hljs-number">4</span>-<span class="hljs-number">1</span><span class="hljs-selector-class">.el7</span><span class="hljs-selector-class">.remi</span>              php            <span class="hljs-number">63</span> k<br>———————————<br></code></pre></td></tr></table></figure><p>5.安装mariadb数据库</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta">yum -y install mariadb mariadb-<span class="hljs-keyword">server</span>    <span class="hljs-meta">#安装mariadb数据库</span><br></code></pre></td></tr></table></figure><p>6.关闭防火墙服务及关机selinux</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">systemctl stop firewalld<br>systemctl <span class="hljs-built_in">disable</span> firewalld<br>setenforce 0<br>vim /etc/selinux<span class="hljs-built_in">/config </span>-&gt; disabled<br></code></pre></td></tr></table></figure><p>7.开启mariadb和httpd,设置开机自动启动；执行脚本，设置mariadb数据库参数</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">[root@localhost ~]<span class="hljs-comment"># systemctl start mariadb      #开启mariadb</span><br>[root@localhost ~]<span class="hljs-comment"># systemctl start  httpd       #开启httpd</span><br>[root@localhost ~]<span class="hljs-comment"># systemctl enable mariadb     #设置开机自动开启mariadb</span><br>[root@localhost ~]<span class="hljs-comment"># systemctl enable httpd       #设置开机自动开启httpd</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysql_secure_installation                <span class="hljs-comment">#执行脚本</span><br>...<span class="hljs-comment">#省略部分内容</span><br>Set root password? [Y/n] y<br>New password: 123456<br>Re-enter new password: 123456<br>Password updated successfully!<br>Reload privilege tables now? [Y/n] y<br> ... Success!<br>Disallow root login remotely? [Y/n] n<br> ... skipping.<br>Remove <span class="hljs-built_in">test</span> database and access to it? [Y/n] y<br> - Dropping <span class="hljs-built_in">test</span> database...<br> ... Success!<br> - Removing privileges on <span class="hljs-built_in">test</span> database...<br> ... Success!<br>Reload privilege tables now? [Y/n] y<br> ... Success!<br></code></pre></td></tr></table></figure><h3 id="安装dzzoffice"><a href="#安装dzzoffice" class="headerlink" title="安装dzzoffice"></a>安装dzzoffice</h3><p>1.下载最新稳定版本，我现在是2.02为最新版</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/zyx0814/</span>dzzoffice<span class="hljs-regexp">/archive/</span><span class="hljs-number">2.02</span>.tar.gz<br></code></pre></td></tr></table></figure><p>2.解压文件</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">tar</span> -zxvf <span class="hljs-number">2</span>.<span class="hljs-number">02</span>.tar.gz<br></code></pre></td></tr></table></figure><p>3.将解压后的文件移动到apache的目录下，并改名为dzzoffice</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mv</span> dzzoffice-<span class="hljs-number">2</span>.<span class="hljs-number">02</span> /var/www/html/dzzoffice<br></code></pre></td></tr></table></figure><p>4.然后将目录权限授权给apache启动用户，默认为apache用户，如果自己修改了，则以你修改的为准</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /var/www/html/<br><span class="hljs-built_in">chown</span> -R apache. dzzoffice<br></code></pre></td></tr></table></figure><p>5.启动apache</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-params">system</span>ctl start httpd<br><span class="hljs-params">system</span>ctl enable httpd    <span class="hljs-comment"># 设置开机启动apache</span><br></code></pre></td></tr></table></figure><h3 id="访问页面进行安装"><a href="#访问页面进行安装" class="headerlink" title="访问页面进行安装"></a>访问页面进行安装</h3><p>上一步已启动apache，现在可以直接访问你服务器的ip或域名，后跟dzzoffice的路径来来访问dzzoffice，<br>访问如：<a href="http://ip/dzzoffice">http://ip/dzzoffice</a> 会自动跳转到安装界面：</p><p>安装完成后，手动删除安装文件</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">rm -rf <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>dzzoffice<span class="hljs-regexp">/install/i</span>ndex.php<br></code></pre></td></tr></table></figure><h3 id="安装onlyoffice插件"><a href="#安装onlyoffice插件" class="headerlink" title="安装onlyoffice插件"></a>安装onlyoffice插件</h3><p>dzzoffice本身不支持excel或者文档的在线浏览和编辑，需要额外的第三方工具进行支持，<br>在官方文档中也有说明：<a href="http://dzzoffice.com/corpus/list?cid=3#">http://dzzoffice.com/corpus/list?cid=3#</a></p><p>这里我现在安装onlyoffice作为在线文档服务器，部署方式，由于直接在服务器上部署比较繁琐，这里我直接使用docker部署docker版本。首先安装docker，然后用docker启动onlyoffice</p><p>1.删除旧版本，确保机器没有docker</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs axapta">yum remove docker docker-<span class="hljs-keyword">client</span> docker-<span class="hljs-keyword">client</span>-latest docker-<span class="hljs-keyword">common</span> \<br>    docker-latest docker-latest-logrotate docker-logrotate docker-engine<br></code></pre></td></tr></table></figure><p>2.安装依赖</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-title">yum</span> install -y yum-utils device-mapper-persistent-<span class="hljs-class"><span class="hljs-keyword">data</span> lvm2</span><br></code></pre></td></tr></table></figure><p>3.安装yum仓库</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">yum-config-manager --<span class="hljs-built_in">add</span>-repo https://download.docker.<span class="hljs-keyword">com</span>/linux/centos/docker-<span class="hljs-keyword">ce</span>.repo<br></code></pre></td></tr></table></figure><p>4.安装docker</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">yum install docker-<span class="hljs-keyword">ce</span> docker-<span class="hljs-keyword">ce</span>-cli containerd.io<br></code></pre></td></tr></table></figure><p>5.启动docker</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-params">system</span>ctl start docker<br><span class="hljs-params">system</span>ctl enable docker<br></code></pre></td></tr></table></figure><p>6.启动onlyoffice，使用本地的8000端口</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker <span class="hljs-built_in">run</span> -i -t -d -p8000:80 <span class="hljs-attribute">--restart</span>=always onlyoffice/documentserver<br></code></pre></td></tr></table></figure><p>启动onlyoffice服务后，在浏览器中访问<a href="http://ip:8000查看是否可以正常使用，如果出现如下界面，则为正常">http://ip:8000查看是否可以正常使用，如果出现如下界面，则为正常</a><br>√ Document Server is running</p><p>请输入OnlyOffice Document Server API地址:<br><a href="http://dzzoffice_ip:8000/">http://DZZOFFICE_IP:8000</a></p><p>填写您的onlyoffice Document Server API地址，如:<a href="http://192.168.0.2:90/">http://192.168.0.2:90/</a> 根据你的文档服务器填写<br>请输入文件服务器(dzzoffice服务器)地址:</p><p>填写您的文件服务器地址，如:<a href="http://dzzoffice.com:90/,%E6%A0%B9%E6%8D%AE%E4%BD%A0%E7%9A%84dzzoffice%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9C%B0%E5%9D%80%E5%A1%AB%E5%86%99,%E7%95%99%E7%A9%BA%E4%BD%BF%E7%94%A8%E5%BD%93%E5%89%8D%E5%9C%B0%E5%9D%80%E3%80%82tips:%E8%AE%BE%E7%BD%AE%E5%86%85%E7%BD%91%E5%9C%B0%E5%9D%80%E5%8F%AF%E4%BB%A5%E6%8F%90%E9%AB%98%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E9%80%9F%E5%BA%A6">http://dzzoffice.com:90/,根据你的dzzoffice服务器地址填写,留空使用当前地址。tips:设置内网地址可以提高文件传输速度</a></p><p>缩略图后缀列表:<br>支持生成缩略图的后缀列表，用小写字母。多个用英文逗号隔开，如：pdf,doc,docx,ppt,pptx,xls,xlsx<br>点击保存，然后启动应用</p><p>然后在文档，excel应用中，就可以直接点击在线浏览和编辑啦。</p>]]></content>
    
    
    <categories>
      
      <category>工具</category>
      
    </categories>
    
    
    <tags>
      
      <tag>工具</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CTF中Reverse介绍</title>
    <link href="/2020/05/20/other/ctf_reverse/"/>
    <url>/2020/05/20/other/ctf_reverse/</url>
    
    <content type="html"><![CDATA[<h2 id="CTF中Reverse介绍"><a href="#CTF中Reverse介绍" class="headerlink" title="CTF中Reverse介绍"></a>CTF中Reverse介绍</h2><h3 id="什么是逆向？"><a href="#什么是逆向？" class="headerlink" title="什么是逆向？"></a>什么是逆向？</h3><p>广义的逆向：</p><ul><li>从目标代码反推源代码</li><li>从源代码理解开发者行为和目的</li><li>应用：软件破解、漏洞挖掘、恶意代码分析</li></ul><p>CTF逆向-侠义的逆向：<br>与Crypto结合</p><ul><li>CrackMe（破解密码，不修改程序）</li><li>KeygenMe（生成注册码）<br>与隐写取证结合</li><li>Recover（恢复文件）<br>与Pwn结合</li><li>Reverse（interface，struct，format，protocol）</li><li>Bypass auth，Patch bin</li></ul><p>逆向的基本流程</p><ul><li>程序预处理，去混淆合过反调试</li><li>代码逆向，找到验证函数</li><li>验证函数逆向，找到验证算法</li><li>破解验证算法，得到flag<br>其中，80%的题目都与crypto结合，<br>通过找到一个key过掉所有关卡。<br>同时可能有一量与恢复文件有关。</li></ul><h3 id="逆向的核心"><a href="#逆向的核心" class="headerlink" title="逆向的核心"></a>逆向的核心</h3><p>逆向的核心是破解验证算法（过算法关）<br>验证算法简化如下：</p><ul><li>输入：key</li><li>验证：<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-keyword">if</span> <span class="hljs-built_in">H</span>(<span class="hljs-built_in">key</span>) == Secret:<br>&#123;<br>    flag = <span class="hljs-built_in">O</span>(<span class="hljs-built_in">key</span>);<br>    <span class="hljs-keyword">print</span> flag;<br>&#125;<br></code></pre></td></tr></table></figure></li><li>输出：flag<br>验证算法分类：</li><li>简单比较验证</li><li>密码算法验证</li><li>算法求解验证</li></ul><p>也就是说，想成为一个优秀的逆向手，你要成为一个优秀的码农，算法大佬。</p><h3 id="算法举例："><a href="#算法举例：" class="headerlink" title="算法举例："></a>算法举例：</h3><p>算法1 key直接比较<br>算法2 key简单变换<br>算法3 key编码转换<br>算法4 key散列计算<br>算法5 key密钥加密<br>算法6 key算法求解<br>算法7 flag直接输出<br>算法8 密钥空间过短<br>算法9 伪随机算法 -&gt; 爆破</p><h3 id="验证算法逆向思路"><a href="#验证算法逆向思路" class="headerlink" title="验证算法逆向思路"></a>验证算法逆向思路</h3><p>简单变换验证：</p><ul><li>人工逆向，找到可逆运算，按位分步破解（算法1-3）</li></ul><p>密码算法验证：</p><ul><li>识别密码算法（有限），针对性解密（算法4-5）</li></ul><p>解题算法验证：</p><ul><li>理解算法原理，针对性解题（算法6）</li></ul><p>验证常见漏洞：</p><ul><li>直接输出flag（算法7）</li><li>密钥空间过短（算法8）</li><li>伪随机算法（算法9）</li></ul><p>现实竞赛：</p><ul><li>分段、嵌套验证</li></ul><p>爆破神技：</p><ul><li>简单验证（按位破解）</li><li>密码算法（密钥部分已知）</li><li>解题算法（暴力搜索）</li><li>双刃剑（100亿次以内，位数与取值都有关）</li></ul><h3 id="逆向的基础"><a href="#逆向的基础" class="headerlink" title="逆向的基础"></a>逆向的基础</h3><p>逆向的基础是理解目标代码（过语言关）<br>必备知识</p><ul><li>汇编，C语言</li><li>操作系统原理与核心编程，程序加载</li><li>反汇编与调试等</li></ul><p>常用工具</p><ul><li>1.PE与ELF编辑、帧壳、脱壳工具</li><li><ul><li>O1Oeditor、winhex</li></ul></li><li><ul><li>peid、upx、resource hacker</li></ul></li><li><ul><li>sysinternals</li></ul></li><li>2.反汇编与反编译工具</li><li><ul><li>IDA Pro、Hopper</li></ul></li><li>3.调试器</li><li><ul><li>OBydbg、gdb、windbg</li></ul></li></ul><p>分析方法</p><ul><li>静态分析方法：反汇编、反编译</li><li>动态分析方法：调试、模拟</li></ul>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CTF中Crypto题目的常见题型</title>
    <link href="/2020/05/20/other/ctf_crypto/"/>
    <url>/2020/05/20/other/ctf_crypto/</url>
    
    <content type="html"><![CDATA[<p><strong>CTF中Crypto题目的常见题型</strong></p><ul><li>BugKu 提供了很多加解密工具，链接：<a href="http://tool.bugku.com/">http://tool.bugku.com/</a></li><li>SSL在线工具网址提供了很多工具，链接：<a href="http://www.ssleye.com/">http://www.ssleye.com/</a></li><li>text bin hex base64 dec 转码工具：<a href="https://conv.darkbyte.ru/">https://conv.darkbyte.ru/</a></li></ul><h3 id="1-摩斯密码-Morse编码"><a href="#1-摩斯密码-Morse编码" class="headerlink" title="1. 摩斯密码 &#x2F; Morse编码"></a>1. 摩斯密码 &#x2F; Morse编码</h3><p>摩尔斯电码(Morse code)是一种时通时断的信号代码，通过不同的排列 顺序来表达不同的英文字母、数字和标点符号。是由美国人艾尔菲德·维 尔(Alfred Lewis Vail)与萨缪尔·摩尔斯(Samuel Finley Breese Morse) 在1836年发明。由点（·）和划（-）组成。</p><p>特征：点和横的组合。</p><p>在线工具：<br><a href="http://www.zhongguosou.com/zonghe/moErSiCodeConverter.aspx">http://www.zhongguosou.com/zonghe/moErSiCodeConverter.aspx</a><br><a href="http://tool.bugku.com/mosi/">http://tool.bugku.com/mosi/</a></p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">例如：-… -<span class="hljs-string">.-</span> -<span class="hljs-string">.-.</span> - <span class="hljs-string">..-.</span> – <span class="hljs-string">..</span> … -<span class="hljs-string">.-.</span><br></code></pre></td></tr></table></figure><p>解密结果：BKCTFMISC</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">–<span class="hljs-regexp">/—/</span>.-.<span class="hljs-regexp">/…/</span>.<br></code></pre></td></tr></table></figure><p>解密结果：MORSE</p><h3 id="2-ASCII编码"><a href="#2-ASCII编码" class="headerlink" title="2.ASCII编码"></a>2.ASCII编码</h3><p>ASCII(American Standard Code for Information Interchange，美国信息交换标准代码)是基于拉丁字母的一套 电脑编码系统，主要用于显示现代英语和其他西欧语言。它是现今最通用的单字节编码系统，并等同于国际标准ISO&#x2F;IEC 646。</p><p>例如：72 105 65 115 99 105 105<br>解密结果：H i A s c i i</p><p>特点：一般常用字符为0-9（48-57）、A-Z（65-90）、a-z（97-122）、空格（32）</p><p>在线工具：<a href="http://www.ab126.com/goju/1711.html">http://www.ab126.com/goju/1711.html</a></p><h3 id="3-Tap-Code敲击码"><a href="#3-Tap-Code敲击码" class="headerlink" title="3.Tap Code敲击码"></a>3.Tap Code敲击码</h3><p>敲击码(Tap code)是一种以非常简单的方式对文本信息进行 编码的方法。因该编码对信息通过使用一系列的点击声音来编 码而命名，敲击码是基于 5 ×5 方格波利比奥斯方阵来实现的， 不同点是是用 K 字母被整合到 C 中。</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span><br><span class="hljs-number">1</span> <span class="hljs-variable">A</span> <span class="hljs-variable">B</span> <span class="hljs-built_in">C</span><span class="hljs-operator">/</span><span class="hljs-built_in">K</span> <span class="hljs-built_in">D</span> <span class="hljs-built_in">E</span><br><span class="hljs-number">2</span> <span class="hljs-variable">F</span> <span class="hljs-variable">G</span> <span class="hljs-variable">H</span> <span class="hljs-built_in">I</span> <span class="hljs-variable">J</span><br><span class="hljs-number">3</span> <span class="hljs-variable">L</span> <span class="hljs-variable">M</span> <span class="hljs-built_in">N</span> <span class="hljs-built_in">O</span> <span class="hljs-variable">P</span><br><span class="hljs-number">4</span> <span class="hljs-variable">Q</span> <span class="hljs-variable">R</span> <span class="hljs-variable">S</span> <span class="hljs-variable">T</span> <span class="hljs-variable">U</span><br><span class="hljs-number">5</span> <span class="hljs-variable">V</span> <span class="hljs-variable">W</span> <span class="hljs-variable">X</span> <span class="hljs-variable">Y</span> <span class="hljs-variable">Z</span><br><br>例如：<span class="hljs-number">2</span><span class="hljs-operator">,</span><span class="hljs-number">3</span> <span class="hljs-number">1</span><span class="hljs-operator">,</span><span class="hljs-number">5</span> <span class="hljs-number">3</span><span class="hljs-operator">,</span><span class="hljs-number">1</span> <span class="hljs-number">3</span><span class="hljs-operator">,</span><span class="hljs-number">1</span> <span class="hljs-number">3</span><span class="hljs-operator">,</span><span class="hljs-number">4</span><br><span class="hljs-operator">..</span> …<span class="hljs-operator">/.</span> …<span class="hljs-operator">../</span>… <span class="hljs-operator">./</span>… <span class="hljs-operator">./</span>… …<span class="hljs-operator">./</span><br>解密结果：<span class="hljs-variable">H</span> <span class="hljs-built_in">E</span> <span class="hljs-variable">L</span> <span class="hljs-variable">L</span> <span class="hljs-built_in">O</span><br></code></pre></td></tr></table></figure><p>ps. 当出现1,3时，对比C&#x2F;K，选择更合适的结果</p><h3 id="4-Base编码"><a href="#4-Base编码" class="headerlink" title="4.Base编码"></a>4.Base编码</h3><p>Base64是网络上最常见的用于传输8Bit字节码的编码方式之一，Base64 就是一种基于64(65)个可打印字符来表示二进制数据的方法。 a-z、A-Z、0-9、符号“+”、“&#x2F;”（再加上作为补位的”&#x3D;”，实际上是 65个字符） 。</p><p>Base xx 中的 xx 表示的是采用多少个字符进行编码，比如说 base64 就是采用 64 个字符编码，由于 2 的 6 次方等于 64，所以每 6 个比特 为一个单元，对应某个可打印字符。</p><p>例如：d2VsY29tZQ&#x3D;&#x3D;<br>解密结果：welcome</p><p>特点：base64 结尾可能会有&#x3D;号，但最多有2个 。 base32 结尾可能会有&#x3D;号,最多有 3 个等号。<br>根据 base 的不同，字符集会有所限制 。 有可能需要自己加等号。</p><p>在线工具：<a href="http://tool.chinaz.com/tools/base64.aspx">http://tool.chinaz.com/tools/base64.aspx</a></p><h3 id="5-URL编码"><a href="#5-URL编码" class="headerlink" title="5.URL编码"></a>5.URL编码</h3><p>URL编码,又叫百分号编码，是统一资源定位(URL)编码方式。URL地址（常说网址）规定了常用地数字，字母可以直接使用，另外一批作为特殊用户字符也可以直接用（&#x2F;,:@等），剩下的其它所有字符必须通过%xx编码 处理。现在已经成为一种规范了，基本所有程序语言都有这种编码，如js： 有encodeURI、encodeURIComponent，PHP有urlencode、urldecode等。编 码方法很简单，在该字节ascii码的的16进制字符前面加%.<br>如空格字符， ascii码是32，对应16进制是‘20’，那么urlencode编码结果是:%20。</p><p>例如：URL%E7%BC%96%E7%A0%81<br>解密结果：URL编码</p><p>特点：存在大量的%<br>在线工具：<a href="https://tool.oschina.net/encode?type=4">https://tool.oschina.net/encode?type=4</a></p><h3 id="6-Unicode编码"><a href="#6-Unicode编码" class="headerlink" title="6.Unicode编码"></a>6.Unicode编码</h3><p>Unicode（统一码、万国码、单一码）是计算机科学领域里的一项业界 标准,包括字符集、编码方案等。Unicode是为了解决传统的字符编码方案的局限而产生的，它为每种语言中的每个字符设定了统一并且唯一的二进制编码，以满足跨语言、跨平台进行文本转换、处理的要求。1990年开始研发，1994年正式公布。</p><p>例如：HelloCTF<br>解密结果：HelloCTF<br>在线工具：<a href="https://tool.oschina.net/encode">https://tool.oschina.net/encode</a></p><h3 id="7-jsfuck"><a href="#7-jsfuck" class="headerlink" title="7.jsfuck"></a>7.jsfuck</h3><p>JSFuck 可以让你只用6个字符 !+来编写 JavaScript 程序<br>在线工具：<a href="https://www.bugku.com/tools/jsfuck/">https://www.bugku.com/tools/jsfuck/</a></p><h3 id="8-brainfuck"><a href="#8-brainfuck" class="headerlink" title="8.brainfuck"></a>8.brainfuck</h3><p>Brainfuck 是一种极小化的计算机语言，按照”Turing complete(完整图灵机) “思想设计的语言，它的主要设计思路是:用最小的概念实现一种“简单”的语 言，BrainFXXk语言只有八种符号，<br>所有的操作都由这八种符号 &gt; &lt; + - . , [ ] 的组合来完成。</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">例如：</span><span class="hljs-literal">+++++</span> <span class="hljs-literal">+++++</span> <span class="hljs-title">[</span><span class="hljs-literal">-</span>&gt;<span class="hljs-literal">++</span> <span class="hljs-literal">+++++</span> <span class="hljs-literal">+++</span>&lt;<span class="hljs-title">]</span> &gt;<span class="hljs-literal">++++</span> <span class="hljs-string">.</span><span class="hljs-comment">—</span><span class="hljs-string">.</span> <span class="hljs-literal">+++++</span> <span class="hljs-literal">++</span><span class="hljs-string">.</span><span class="hljs-string">.</span><span class="hljs-literal">+</span> <span class="hljs-literal">++</span><span class="hljs-string">.</span>&lt;<span class="hljs-literal">+</span> <span class="hljs-literal">+++++</span> <span class="hljs-literal">++</span><span class="hljs-title">[</span><span class="hljs-literal">-</span>&gt;<br><span class="hljs-comment">—– —</span>&lt;<span class="hljs-title">]</span> &gt;<span class="hljs-comment">—</span><span class="hljs-string">.</span> &lt;<span class="hljs-literal">++++</span> <span class="hljs-literal">++++</span><span class="hljs-title">[</span> <span class="hljs-literal">-</span>&gt;<span class="hljs-literal">+++</span> <span class="hljs-literal">+++++</span> &lt;<span class="hljs-title">]</span>&gt;<span class="hljs-literal">++</span> <span class="hljs-literal">+++++</span> <span class="hljs-literal">++++</span><span class="hljs-string">.</span> <span class="hljs-comment">—– —</span><span class="hljs-string">.</span><span class="hljs-literal">+</span><br><span class="hljs-literal">++</span><span class="hljs-string">.</span><span class="hljs-comment">– —</span><span class="hljs-literal">-</span><span class="hljs-string">.</span> <span class="hljs-comment">—– —</span><span class="hljs-string">.</span>&lt;<br></code></pre></td></tr></table></figure><p>解密结果：hello,world<br>在线工具：<a href="https://www.splitbrain.org/services/ook">https://www.splitbrain.org/services/ook</a></p><h3 id="9-凯撒密码"><a href="#9-凯撒密码" class="headerlink" title="9.凯撒密码"></a>9.凯撒密码</h3><p>凯撒密码（Caesar）加密时会将明文中的每个字母都按照其在字母表中的顺序向后（或向前）移动固定数目（循环移动）作为密文。例如，当偏移量是左移 3 的时候（解密时 的密钥就是 3）。<br>使用时，加密者查找明文字母表中需要加密的消息中的每一个字母所在位置，并且写下密文字母表中对应的字母。需要解密的人则根据事先已知的密钥反过来操作，得到原来的明文。</p><p>根据偏移量的不同，还存在若干特定的恺撒密码名称：<br>偏移量为 10：Avocat （A→K）<br>偏移量为 13：ROT13<br>偏移量为 -5：Cassis （K 6）<br>偏移量为 -6：Cassette （K 7）</p><p>例如：Uryyb,Jrypbzr<br>解密结果：Hello,Welcome<br>在线工具：<a href="http://www.mxcz.net/tools/rot13.aspx">http://www.mxcz.net/tools/rot13.aspx</a></p><h3 id="10-栅栏密码"><a href="#10-栅栏密码" class="headerlink" title="10.栅栏密码"></a>10.栅栏密码</h3><p>特征：大小写和字符，其实就是分组替换加密</p><p>例如：一只小羊翻过了2个栅栏</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">KYsd3js2E</span><span class="hljs-template-variable">&#123;a2jda&#125;</span><br></code></pre></td></tr></table></figure><p>解密结果：KEY{sad23jjdsa2}<br>在线工具：<a href="http://tool.bugku.com/jiemi/">http://tool.bugku.com/jiemi/</a></p><h3 id="11-Ook-密码"><a href="#11-Ook-密码" class="headerlink" title="11.Ook 密码"></a>11.Ook 密码</h3><p>特征：Brainfuck 类型密码，密文由 Ook 和 三种标点 . ! ? 构成，不见得都得用上，有的是Ook，有的没有Ook只有标点。</p><p>在线工具：<a href="https://tool.bugku.com/brainfuck/">https://tool.bugku.com/brainfuck/</a></p><h3 id="12-类栅栏密码"><a href="#12-类栅栏密码" class="headerlink" title="12.类栅栏密码"></a>12.类栅栏密码</h3><p>特征：会给你一串乱序的密文 C，同时给你从1 到 n 的一串乱序的数，找下 C 对于 n 的最大公约数，然后将他们重新排序。<br>动手画一画就出来了</p><p>BugKu中的一道题：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">lf5</span>&#123;ag024c483549d7fd@@<span class="hljs-number">1</span>&#125; ， 一张纸条上凌乱的写着<span class="hljs-number">2</span> <span class="hljs-number">1</span> <span class="hljs-number">6</span> <span class="hljs-number">5</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span><br><br><span class="hljs-attribute">2</span> <span class="hljs-number">1</span> <span class="hljs-number">6</span> <span class="hljs-number">5</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span><br><span class="hljs-attribute">l</span> f <span class="hljs-number">5</span> &#123; a g<br><span class="hljs-attribute">0</span> <span class="hljs-number">2</span> <span class="hljs-number">4</span> c <span class="hljs-number">4</span> <span class="hljs-number">8</span><br><span class="hljs-attribute">3</span> <span class="hljs-number">5</span> <span class="hljs-number">4</span> <span class="hljs-number">9</span> d <span class="hljs-number">7</span><br><span class="hljs-attribute">f</span> d @ @ <span class="hljs-number">1</span> &#125;<br></code></pre></td></tr></table></figure><p>再按照123456的顺序数从第一行排到最后一行</p><p>flag{52048c453d794df1}@@</p><p>提交 flag发现不对，这两个@@有点奇怪，去掉@就成功了，那么一般这种字符都是迷惑人的。</p><h3 id="13-由0和1组成的摩斯密码"><a href="#13-由0和1组成的摩斯密码" class="headerlink" title="13.由0和1组成的摩斯密码"></a>13.由0和1组成的摩斯密码</h3><p>特征：密文由0和1构成，可能由空格、tab或则其他字符分割，去掉这些分割后，0和1的总数是5的倍数<br>将 0 和 1 替换为 . 或 - ，多试几次就可能有发现。</p><p>BugKu中的一道题：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0010</span> <span class="hljs-number">0100</span> <span class="hljs-number">01</span> <span class="hljs-number">110</span> <span class="hljs-number">1111011</span> <span class="hljs-number">11</span> <span class="hljs-number">11111</span> <span class="hljs-number">010</span> <span class="hljs-number">000</span> <span class="hljs-number">0</span> <span class="hljs-number">001101</span> <span class="hljs-number">1010</span> <span class="hljs-number">111</span> <span class="hljs-number">100</span> <span class="hljs-number">0</span> <span class="hljs-number">001101</span> <span class="hljs-number">01111</span> <span class="hljs-number">000</span> <span class="hljs-number">001101</span> <span class="hljs-number">00</span> <span class="hljs-number">10</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">010</span> <span class="hljs-number">0</span> <span class="hljs-number">000</span> <span class="hljs-number">1</span> <span class="hljs-number">01111</span> <span class="hljs-number">10</span> <span class="hljs-number">11110</span> <span class="hljs-number">101011</span> <span class="hljs-number">1111101</span><br></code></pre></td></tr></table></figure><p>把0换成点 . 1换成 - 后：</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">..-.</span> <span class="hljs-string">.-..</span> <span class="hljs-string">.-</span> –. —-.– – —– <span class="hljs-string">.-.</span> … . <span class="hljs-string">..</span>–<span class="hljs-string">.-</span> -<span class="hljs-string">.-.</span> — -<span class="hljs-string">..</span> . <span class="hljs-string">..</span>–<span class="hljs-string">.-</span> .—- … <span class="hljs-string">..</span>–<span class="hljs-string">.-</span> <span class="hljs-string">..</span> -. - . <span class="hljs-string">.-.</span> . … - .—- -. —-. -<span class="hljs-string">.-.</span>– —–<span class="hljs-string">.-</span><br></code></pre></td></tr></table></figure><p>在线工具解密一下，得到：</p><p>FLAG%u7bM0RSE_CODE_1S_INTEREST1N9!%u7d</p><p>结果有点奇怪，但八九不离十了。把%u7b 换成 { 把%u7d 换成 }，然后大小写切换</p><p>flag{m0rse_code_1s_interest1n9!}</p><h3 id="14-键盘格子密码"><a href="#14-键盘格子密码" class="headerlink" title="14.键盘格子密码"></a>14.键盘格子密码</h3><p>特征：由三到四个英文字母或数字为一组。</p><p>在键盘上找对应的键位，中间围起来的就是密文（这能能想得出。。。）</p><p>例如：r5yG lp9I BjM tFhBT6uh y7iJ QsZ bhM<br>解密结果：t o n g y u a n</p><h3 id="15-托马斯杰斐逊-转轮密码"><a href="#15-托马斯杰斐逊-转轮密码" class="headerlink" title="15.托马斯杰斐逊 转轮密码"></a>15.托马斯杰斐逊 转轮密码</h3><p>特征：给你一个密码表，n行的26个字母，key是 1 - n 的数列， 密文是 n 个英文字母<br>根据 key 找对应行的密码表，然后在密码表上找密文字母，以这个字母为开头，重新排序。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>： &lt;ZWAXJGDLUBVIQHKYPNTCRMOSFE &lt; <span class="hljs-number">2</span>： &lt;KPBELNACZDTRXMJQOYHGVSFUWI &lt; <span class="hljs-number">3</span>： &lt;BDMAIZVRNSJUWFHTEQGYXPLOCK &lt; <span class="hljs-number">4</span>： &lt;RPLNDVHGFCUKTEBSXQYIZMJWAO &lt; <span class="hljs-number">5</span>： &lt;IHFRLABEUOTSGJVDKCPMNZQWXY &lt; <span class="hljs-number">6</span>： &lt;AMKGHIWPNYCJBFZDRUSLOQXVET &lt; <span class="hljs-number">7</span>： &lt;GWTHSPYBXIZULVKMRAFDCEONJQ &lt; <span class="hljs-number">8</span>： &lt;NOZUTWDCVRJLXKISEFAPMYGHBQ &lt; <span class="hljs-number">9</span>： &lt;QWATDSRFHENYVUBMCOIKZGJXPL &lt; <span class="hljs-number">10</span>： &lt;WABMCXPLTDSRJQZGOIKFHENYVU &lt; <span class="hljs-number">11</span>： &lt;XPLTDAOIKFZGHENYSRUBMCQWVJ &lt; <span class="hljs-number">12</span>： &lt;TDSWAYXPLVUBOIKZGJRFHENMCQ &lt; <span class="hljs-number">13</span>： &lt;BMCSRFHLTDENQWAOXPYVUIKZGJ &lt; <span class="hljs-number">14</span>： &lt;XPHKZGJTDSENYVUBMLAOIRFCQW &lt;<br></code></pre></td></tr></table></figure><p>密钥： 2,5,1,3,6,4,9,7,8,14,10,13,11,12<br>密文：HCBTSXWCRQGL ES</p><p>在第 2 行密码表中找H开头的字母，然后以H开头再到尾过一遍，以此类推，整理出另一个密码表：</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">HGVSFUWIKPBELNACZDTR X MJQOY<br>CPMNZQWXYIHFRLABEUOT S GJVDK<br><span class="hljs-keyword">BVIQHKYPNTCRMOSFEZWA </span>X <span class="hljs-keyword">JGDLU</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">TEQGYXPLOCKBDMAIZVRN </span>S <span class="hljs-keyword">JUWFH</span><br><span class="hljs-keyword"></span>SLOQXVETAMKGHIWPNYCJ <span class="hljs-keyword">B </span>FZDRU<br>XQYIZMJWAORPLNDVHGFC U KTEBS<br>WATDSRFHENYVUBMCOIKZ G <span class="hljs-keyword">JXPLQ</span><br><span class="hljs-keyword"></span>CEONJQGWTHSPYBXIZULV K MRAFD<br>RJLXKISEFAPMYGHBQNOZ U TWDCV<br>QWXPHKZGJTDSENYVUBML A OIRFC<br>GOIKFHENYVUWABMCXPLT D SRJQZ<br>LTDENQWAOXPYVUIKZGJB M CSRFH<br>ENYSRUBMCQWVJXPLTDAO I KFZGH<br><span class="hljs-keyword">SWAYXPLVUBOIKZGJRFHE </span>N MCQTD<br></code></pre></td></tr></table></figure><p>然后在这里找一些比较明显的（语句通顺的）话，就是flag。</p><p>XSXSBUGKUADMIN<br>提交不对的话就大小写换一下：xsxsbugkuadmin</p><p>这个其实可以写个程序出来，遍历密码表即可。</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs prolog"># <span class="hljs-symbol">Rotor</span> cipher decoder<br># parameter input<br>rotor = [<br>    <span class="hljs-string">&quot;ZWAXJGDLUBVIQHKYPNTCRMOSFE&quot;</span>, <span class="hljs-string">&quot;KPBELNACZDTRXMJQOYHGVSFUWI&quot;</span>,<br>    <span class="hljs-string">&quot;BDMAIZVRNSJUWFHTEQGYXPLOCK&quot;</span>, <span class="hljs-string">&quot;RPLNDVHGFCUKTEBSXQYIZMJWAO&quot;</span>,<br>    <span class="hljs-string">&quot;IHFRLABEUOTSGJVDKCPMNZQWXY&quot;</span>, <span class="hljs-string">&quot;AMKGHIWPNYCJBFZDRUSLOQXVET&quot;</span>,<br>    <span class="hljs-string">&quot;GWTHSPYBXIZULVKMRAFDCEONJQ&quot;</span>, <span class="hljs-string">&quot;NOZUTWDCVRJLXKISEFAPMYGHBQ&quot;</span>,<br>    <span class="hljs-string">&quot;QWATDSRFHENYVUBMCOIKZGJXPL&quot;</span>, <span class="hljs-string">&quot;WABMCXPLTDSRJQZGOIKFHENYVU&quot;</span>,<br>    <span class="hljs-string">&quot;XPLTDAOIKFZGHENYSRUBMCQWVJ&quot;</span>, <span class="hljs-string">&quot;TDSWAYXPLVUBOIKZGJRFHENMCQ&quot;</span>,<br>    <span class="hljs-string">&quot;BMCSRFHLTDENQWAOXPYVUIKZGJ&quot;</span>, <span class="hljs-string">&quot;XPHKZGJTDSENYVUBMLAOIRFCQW&quot;</span><br>]<br>cipher = <span class="hljs-string">&quot;HCBTSXWCRQGLES&quot;</span><br><br>key = [<span class="hljs-number">2</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">4</span>, <span class="hljs-number">9</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">14</span>, <span class="hljs-number">10</span>, <span class="hljs-number">13</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span>]<br><br>tmp_list=[]<br><br>for i in range(<span class="hljs-number">0</span>, len(rotor)):<br>    tmp=<span class="hljs-string">&quot;&quot;</span><br>    k = key[i] - <span class="hljs-number">1</span><br>    for j in range(<span class="hljs-number">0</span>, len(rotor[k])):<br>        if cipher[i] == rotor[k][j]:<br>            if j == <span class="hljs-number">0</span>:<br>                tmp=rotor[k]<br>                break<br>            else:<br>                tmp=rotor[k][j:] + rotor[k][<span class="hljs-number">0</span>:j]<br>                break<br>    tmp_list.append(tmp)<br># print(tmp_list)<br><br>message_list = []<br>for i in range(<span class="hljs-number">0</span>, len(tmp_list[i])):<br>    tmp = <span class="hljs-string">&quot;&quot;</span><br>    for j in range(<span class="hljs-number">0</span>, len(tmp_list)):<br>        tmp += tmp_list[j][i]<br>    message_list.append(tmp)<br>print(message_list)<br></code></pre></td></tr></table></figure><h3 id="16-Base91编码"><a href="#16-Base91编码" class="headerlink" title="16.Base91编码"></a>16.Base91编码</h3><p>特征：基本上是键盘上所有可打印的 ASC II 字符</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">（<span class="hljs-number">0</span>x21-<span class="hljs-number">0</span>x7E），A-Z、a-z、<span class="hljs-number">1</span> - <span class="hljs-number">9</span>、 !@#$<span class="hljs-comment">%^&amp;*()_+-=&#123;&#125;[]|\:;&quot;&#x27;&lt;,&gt;.?/~·</span><br></code></pre></td></tr></table></figure><p>之类的。</p><p>参考： <a href="http://base91.sourceforge.net/">http://base91.sourceforge.net/</a> （里面有工具源码）<br>在线工具：<a href="http://ctf.ssleye.com/base91.html">http://ctf.ssleye.com/base91.html</a></p><h3 id="17-Linux系统的-shadow-文件格式"><a href="#17-Linux系统的-shadow-文件格式" class="headerlink" title="17.Linux系统的 shadow 文件格式"></a>17.Linux系统的 shadow 文件格式</h3><p>特征：就是Linux的shadow文件格式<br>工具：Kali Linux 中的 John<br>root:$6$HRMJoyGA$26FIgg6CU0bGUOfqFB0Qo9AE2LRZxG8N3H.3BK8t49wGlYbkFbxVFtGOZqVIq3q<br>Q6k0oetDbn2aVzdhuVQ6US.:17770:0:99999:7:::<br>Linux的 &#x2F;etc&#x2F;shadow 文件存储了该系统下所有用户口令相关信息，只有 root 权限可以查看，用户口令是以 Hash + Salt 的形式保护的。<br>每个字段都用 “$” 或“:”符号分割；<br>第一个字段是用户名，如root ；<br>第二个字段是哈希算法，比如 6 代表SHA-512，1 代表 MD5；<br>第三个字段是盐，比如上面的 HRMJoyGA<br>第四个字段是口令+盐加密后的哈希值<br>后面分别是密码最后一次修改日期、密码的两次修改间隔时间（和第三个字段相比）、密码的有效期(和第三个字段相比）、密码修改到期前的警告天数（和第五个字段相比）、密码过期后的宽限天数（和第五个字段相比）、账号失效时间，这里不太重要要；</p><p>直接跑 John 试试<br>john shadow<br>如果解开了，加 –show 查看解密口令<br>john –show shadow</p><h3 id="18-ZIP-伪加密"><a href="#18-ZIP-伪加密" class="headerlink" title="18.ZIP 伪加密"></a>18.ZIP 伪加密</h3><p>特征：一个ZIP压缩包，建议先读一下Zip文件解析与利用，里面提到：<br>一格zip文件有三个部分组成：压缩源文件数据区 + 压缩源文件目录区 + 压缩源文件目录结束标志；<br>每一部分都由明文 PK （50 4B）开始；<br>这是三个头标记，主要看第二个；<br>压缩源文件数据区：<br>50 4B 03 04：这是头文件标记<br>压缩源文件目录区：<br>50 4B 01 02：目录中文件文件头标记<br>后面两位（如 1F 00 或 3F 00）：压缩使用的 pkware 版本<br>再后面两位（如 14 00）：解压文件所需 pkware 版本<br>再后面两位：全局方式位标记（有无加密，这个更改这里进行伪加密，00 00 是无密码，改为09 00打开就会提示有密码了）<br>压缩源文件目录结束标志 ：<br>50 4B 05 06：目录结束标记<br>工具：ZipCenOp.jar 或 WinHex<br>e.g. BugKu 上的一道题 <a href="https://ctf.bugku.com/challenges#zip%E4%BC%AA%E5%8A%A0%E5%AF%86">https://ctf.bugku.com/challenges#zip%E4%BC%AA%E5%8A%A0%E5%AF%86</a></p><p>使用 ZipCenOp.jar<br>链接：<a href="https://pan.baidu.com/s/1yDcWWhY0lSlBArEJ4S6qUw">https://pan.baidu.com/s/1yDcWWhY0lSlBArEJ4S6qUw</a><br>提取码：g3it<br>（需要java环境）windows下在cmd中输入：<br>java -jar ZipCenOp.jar r xxx.zip<br>直接破解ZIP包；</p><p>使用 WinHex<br>我们用winhex打开压缩包，搜索504B，点击第二个504B，从后面找第七、八位，发现是 09 00，改为 00 00 即可。<br>这种方式只适用于ZIP的伪加密，真加密了此方法不适用。</p><h3 id="19-RSA-加解密"><a href="#19-RSA-加解密" class="headerlink" title="19.RSA 加解密"></a>19.RSA 加解密</h3><p>特征：给一些 RSA 算法的参数，然后加密\解密消息获取 flag。<br>说一下 RSA 算法模式：<br>分三部分，密钥生成、加密、解密：<br>a) 密钥生成</p><ul><li><ol><li>选取两个长度为 K 的素数 P 和 Q，计算 N &#x3D; P * Q；</li></ol></li><li><ol start="2"><li>计算 phi(N) &#x3D; (P-1) * (Q-1)， 其中 phi(N) 是 Z_(N^*) 的阶；</li></ol></li><li><ol start="3"><li>随机选取一个int整数 e ∈ [ 1, phi(N) - 1 ]，使得 gcd( e, phi(N)) &#x3D; 1；</li></ol></li><li><ol start="4"><li>计算它的逆 d，使得 [ e * d mod phi(N) ] &#x3D; 1；</li></ol></li><li><ol start="5"><li>输出私钥和公钥 sk &#x3D; ( N, d ), pk &#x3D; ( N, e )；<br>b) 加密<br>c &#x3D; m^e mod(N)<br>c) 解密<br>m &#x3D; c^d mod(N)<br>工具：RsaCtfTool （用于输出RSA参数） libnum （用于密文的计算）<br>具体参考Bugku-加密-rsa(WriteUp)</li></ol></li></ul><h3 id="20-仿射密码-affine-cipher"><a href="#20-仿射密码-affine-cipher" class="headerlink" title="20.仿射密码 affine cipher"></a>20.仿射密码 affine cipher</h3><p>特征：可能会提示你是放射密码 affine，公式： y &#x3D; k * x + b mod 26 （跟一元一次函数似的）<br>后面的取模，如果都是英文字母的话是26，不排除有其他形式，比如ASC II 什么的，取模可能会换。</p><p>工具：python代码</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># Q: y = 17x-8 flag&#123;szzyfimhyzd&#125;</span><br><span class="hljs-attribute">flag</span> = <span class="hljs-string">&quot;szzyfimhyzd&quot;</span><br><br><span class="hljs-attribute">flaglist</span> =<span class="hljs-meta"> []</span><br><br><span class="hljs-attribute">for</span> i in flag:<br>    <span class="hljs-attribute">flaglist</span>.append(ord(i)-<span class="hljs-number">97</span>)<br><br><span class="hljs-attribute">flags</span> = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">for</span> i in flaglist:<br>    <span class="hljs-attribute">for</span> j in range(<span class="hljs-number">0</span>,<span class="hljs-number">26</span>):<br>        <span class="hljs-attribute">c</span> = (<span class="hljs-number">17</span> * j - <span class="hljs-number">8</span>) % <span class="hljs-number">26</span><br>        <span class="hljs-attribute">if</span>(c == i):<br>            <span class="hljs-attribute">flags</span> += chr(j+<span class="hljs-number">97</span>)<br><span class="hljs-attribute">print</span>(&#x27;flag&#123;&#x27;+ flags + &#x27;&#125;&#x27;)<br></code></pre></td></tr></table></figure><h3 id="21-进制转换"><a href="#21-进制转换" class="headerlink" title="21.进制转换"></a>21.进制转换</h3><p>特征：二进制 b开头，八进制 o开头，十进制 d开头，十六进制 x开头</p><p>BugKu里的一道题：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs stylus">d87 x65 x6c x63 o157 d109 o145 b100000 d116 b1101111 o40 x6b b1100101 b1101100 o141 d105 x62 d101 b1101001 d46 o40 d71 x69 d118 x65 x20 b1111001 o157 b1110101 d32 o141 d32 d102 o154 x61 x67 b100000 o141 d115 b100000 b1100001 d32 x67 o151 x66 d116 b101110 b100000 d32 d102 d108 d97 o147 d123 x31 b1100101 b110100 d98 d102 b111000 d49 b1100001 d54 b110011 x39 o64 o144 o145 d53 x61 b1100010 b1100011 o60 d48 o65 b1100001 x63 b110110 d101 o63 b111001 d97 d51 o70 d55 b1100010 d125 x20 b101110 x20 b1001000 d97 d118 o145 x20 d97 o40 d103 d111 d111 x64 d32 o164 b1101001 x6d o145 x7e<br><br>s = <span class="hljs-string">&#x27;d87 x65 x6c x63 o157 d109 o145 b100000 d116 b1101111 o40 x6b b1100101 b1101100 o141 d105 x62 d101 b1101001 d46 o40 d71 x69 d118 x65 x20 b1111001 o157 b1110101 d32 o141 d32 d102 o154 x61 x67 b100000 o141 d115 b100000 b1100001 d32 x67 o151 x66 d116 b101110 b100000 d32 d102 d108 d97 o147 d123 x31 b1100101 b110100 d98 d102 b111000 d49 b1100001 d54 b110011 x39 o64 o144 o145 d53 x61 b1100010 b1100011 o60 d48 o65 b1100001 x63 b110110 d101 o63 b111001 d97 d51 o70 d55 b1100010 d125 x20 b101110 x20 b1001000 d97 d118 o145 x20 d97 o40 d103 d111 d111 x64 d32 o164 b1101001 x6d o145 x7e&#x27;</span><br>ss = s<span class="hljs-selector-class">.split</span>()<br>sss = <span class="hljs-selector-attr">[]</span><br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(ss)</span></span><br><span class="hljs-keyword">for</span> <span class="hljs-selector-tag">i</span> <span class="hljs-keyword">in</span> ss:<br>    <span class="hljs-keyword">if</span> <span class="hljs-selector-tag">i</span><span class="hljs-selector-attr">[0]</span> == <span class="hljs-string">&#x27;d&#x27;</span>:<br>        <span class="hljs-selector-tag">i</span> = <span class="hljs-selector-tag">i</span><span class="hljs-selector-attr">[1:]</span><br>        <span class="hljs-selector-tag">i</span> = <span class="hljs-built_in">int</span>(<span class="hljs-selector-tag">i</span>,<span class="hljs-number">10</span>)<br>        <span class="hljs-selector-tag">i</span> = <span class="hljs-built_in">chr</span>(i)<br>        sss<span class="hljs-selector-class">.append</span>(i)<br>    elif <span class="hljs-selector-tag">i</span><span class="hljs-selector-attr">[0]</span> == <span class="hljs-string">&#x27;x&#x27;</span>:<br>        <span class="hljs-selector-tag">i</span> = <span class="hljs-selector-tag">i</span><span class="hljs-selector-attr">[1:]</span><br>        <span class="hljs-selector-tag">i</span> = <span class="hljs-built_in">int</span>(<span class="hljs-selector-tag">i</span>,<span class="hljs-number">16</span>)<br>        <span class="hljs-selector-tag">i</span> = <span class="hljs-built_in">chr</span>(i)<br>        sss<span class="hljs-selector-class">.append</span>(i)<br>    elif <span class="hljs-selector-tag">i</span><span class="hljs-selector-attr">[0]</span> == <span class="hljs-string">&#x27;o&#x27;</span>:<br>        <span class="hljs-selector-tag">i</span> = <span class="hljs-selector-tag">i</span><span class="hljs-selector-attr">[1:]</span><br>        <span class="hljs-selector-tag">i</span> = <span class="hljs-built_in">int</span>(<span class="hljs-selector-tag">i</span>,<span class="hljs-number">8</span>)<br>        <span class="hljs-selector-tag">i</span> = <span class="hljs-built_in">chr</span>(i)<br>        sss<span class="hljs-selector-class">.append</span>(i)<br>    elif <span class="hljs-selector-tag">i</span><span class="hljs-selector-attr">[0]</span> == <span class="hljs-string">&#x27;b&#x27;</span>:<br>        <span class="hljs-selector-tag">i</span> = <span class="hljs-selector-tag">i</span><span class="hljs-selector-attr">[1:]</span><br>        <span class="hljs-selector-tag">i</span> = <span class="hljs-built_in">int</span>(<span class="hljs-selector-tag">i</span>,<span class="hljs-number">2</span>)<br>        <span class="hljs-selector-tag">i</span> = <span class="hljs-built_in">chr</span>(i)<br>        sss<span class="hljs-selector-class">.append</span>(i)<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(sss)</span></span><br>flag = <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-selector-class">.join</span>(sss)<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(flag)</span></span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CTF中Web题目的常见题型及解题技巧</title>
    <link href="/2020/05/19/other/ctf_web/"/>
    <url>/2020/05/19/other/ctf_web/</url>
    
    <content type="html"><![CDATA[<h2 id="基础知识类题目"><a href="#基础知识类题目" class="headerlink" title="基础知识类题目"></a>基础知识类题目</h2><p>考察基本的查看网页源代码、HTTP请求、修改页面元素等。<br>这些题很简单，比较难的比赛应该不会单独出，就算有应该也是Web的签到题。<br>实际做题的时候基本都是和其他更复杂的知识结合起来出现。</p><h3 id="查看网页源代码"><a href="#查看网页源代码" class="headerlink" title="查看网页源代码"></a>查看网页源代码</h3><p>按F12就都看到了，flag一般都在注释里，有时候注释里也会有一条hint或者是对解题有用的信息。</p><ul><li>Bugku web2: <a href="http://123.206.87.240:8002/web2/">http://123.206.87.240:8002/web2/</a></li><li>Bugku web3: <a href="http://123.206.87.240:8002/web3/">http://123.206.87.240:8002/web3/</a></li></ul><h3 id="发送HTTP请求"><a href="#发送HTTP请求" class="headerlink" title="发送HTTP请求"></a>发送HTTP请求</h3><p>可以用hackbar，有的也可以写脚本。</p><ul><li>Bugku web基础$_GET: <a href="http://123.206.87.240:8002/get/">http://123.206.87.240:8002/get/</a></li><li>Bugku web基础$_POST: <a href="http://123.206.87.240:8002/post/">http://123.206.87.240:8002/post/</a></li><li>Bugku 点击一百万次: <a href="http://123.206.87.240:9001/test/">http://123.206.87.240:9001/test/</a></li></ul><p>举个写脚本的例子，（题目是Bugku web基础$POST）：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">import requests<br>r = requests<span class="hljs-selector-class">.post</span>(<span class="hljs-string">&#x27;http://123.206.87.240:8002/post/&#x27;</span>, data=&#123;<span class="hljs-string">&#x27;what&#x27;</span> : <span class="hljs-string">&#x27;flag&#x27;</span>&#125;)<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(r.text)</span></span><br></code></pre></td></tr></table></figure><h3 id="不常见类型的请求发送"><a href="#不常见类型的请求发送" class="headerlink" title="不常见类型的请求发送"></a>不常见类型的请求发送</h3><p>考OPTIONS请求，如果要发送这类请求，写一个脚本应该就能解决了。</p><h3 id="HTTP头相关的题目"><a href="#HTTP头相关的题目" class="headerlink" title="HTTP头相关的题目"></a>HTTP头相关的题目</h3><p>主要是查看和修改HTTP头。<br>目前做过的Web题目有很大一部分都是与HTTP头相关的，而且这种题目也相当常见，不和其他知识结合的情况下也算是属于基础题的范畴吧。<br>技巧：不同的类型有不同的利用方法，基本都离不开抓包改包，有些简单的也可以利用浏览器F12的网络标签解决。 但是最根本的应对策略，是熟悉一些常见请求头的格式、作用等，这样题目考到的时候就很容易知道要怎样做了。</p><h3 id="查看响应头"><a href="#查看响应头" class="headerlink" title="查看响应头"></a>查看响应头</h3><p>有时候响应头里会有hint或者题目的关键信息，也有的时候会直接把flag放在响应头里给你，但是直接查看响应头拿flag的题目并不多，因为太简单了。<br>只是查看的话，可以不用抓包，用F12的“网络”标签就可以解决了。<br>Bugku 头等舱: <a href="http://123.206.87.240:9009/hd.php">http://123.206.87.240:9009/hd.php</a></p><h3 id="修改请求头、伪造Cookie"><a href="#修改请求头、伪造Cookie" class="headerlink" title="修改请求头、伪造Cookie"></a>修改请求头、伪造Cookie</h3><p>常见的有set-cookie、XFF和Referer，总之考法很灵活，做法比较固定，知道一些常见的请求头再根据题目随机应变就没问题了。<br>有些题目还需要伪造Cookie，根据题目要求做就行了。<br>可以用BurpSuite抓包，也可以直接在浏览器的F12“网络”标签里改。</p><ul><li>实验吧 头有点大： <a href="http://ctf5.shiyanbar.com/sHeader/">http://ctf5.shiyanbar.com/sHeader/</a></li><li>Bugku 程序员本地网站： <a href="http://123.206.87.240:8002/localhost/">http://123.206.87.240:8002/localhost/</a></li><li>Bugku 管理员系统： <a href="http://123.206.31.85:1003/">http://123.206.31.85:1003/</a></li><li>XCTF xff_referer： <a href="https://adworld.xctf.org.cn/task/answer?type=web&number=3&grade=0&id=5068">https://adworld.xctf.org.cn/task/answer?type=web&amp;number=3&amp;grade=0&amp;id=5068</a></li></ul><h3 id="Git源码泄露"><a href="#Git源码泄露" class="headerlink" title="Git源码泄露"></a>Git源码泄露</h3><p>flag一般在源码的某个文件里，但也有和其他知识结合、需要进一步利用的情况，比如XCTF社区的mfw这道题。<br>技巧：GitHack一把梭<br>XCTF mfw: <a href="https://adworld.xctf.org.cn/task/answer?type=web&number=3&grade=1&id=5002">https://adworld.xctf.org.cn/task/answer?type=web&amp;number=3&amp;grade=1&amp;id=5002</a></p><h3 id="Python爬虫信息处理"><a href="#Python爬虫信息处理" class="headerlink" title="Python爬虫信息处理"></a>Python爬虫信息处理</h3><p>这类题目一般都是给一个页面，页面中有算式或者是一些数字，要求在很短的时间内求出结果并提交，如果结果正确就可以返回flag。</p><p>因为所给时间一般都很短而且计算比较复杂，所以只能写脚本。这种题目的脚本一般都需要用到requests库和BeautifulSoup库（或者re库（正则表达式）），个人感觉使用BeautifulSoup简单一些。</p><p>技巧：requests库和BeautifulSoup库熟练掌握后，再多做几道题或者写几个爬虫的项目，一般这类题目就没有什么问题了。主要还是对BeautifulSoup的熟练掌握，另外还需要一点点web前端（HTML）的知识。</p><ul><li>Bugku 秋名山老司机： <a href="http://123.206.87.240:8002/qiumingshan/">http://123.206.87.240:8002/qiumingshan/</a></li></ul><p>#这道题的脚本如下，还可以继续优化<br>#经常出现执行了但是不弹flag的情况，多试几次就行了</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs stylus">from bs4 import BeautifulSoup<br>import requests<br><br>r = requests<span class="hljs-selector-class">.Session</span>()<br>s = r<span class="hljs-selector-class">.get</span>(<span class="hljs-string">&quot;http://123.206.87.240:8002/qiumingshan/&quot;</span>)<br>s<span class="hljs-selector-class">.encoding</span> = <span class="hljs-string">&#x27;utf-8&#x27;</span><br>text = s<span class="hljs-selector-class">.text</span><br>soup = <span class="hljs-built_in">BeautifulSoup</span>(text)<br>tag = soup<span class="hljs-selector-class">.div</span><br>express = <span class="hljs-built_in">str</span>(tag.string)<br>express = express<span class="hljs-selector-attr">[0 : -3]</span><br>answer = <span class="hljs-built_in">eval</span>(express)<br>ans = &#123;<span class="hljs-string">&quot;value&quot;</span> : answer&#125;<br>flag = r<span class="hljs-selector-class">.post</span>(<span class="hljs-string">&#x27;http://123.206.87.240:8002/qiumingshan/&#x27;</span>, data = ans)<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(flag.text)</span></span><br></code></pre></td></tr></table></figure><ul><li>实验吧 速度爆破： <a href="http://www.shiyanbar.com/ctf/1841">http://www.shiyanbar.com/ctf/1841</a><br>HGAME2019的部分题目似乎还出现了反爬虫措施。</li></ul><h3 id="PHP代码审计"><a href="#PHP代码审计" class="headerlink" title="PHP代码审计"></a>PHP代码审计</h3><p>代码审计覆盖面特别广，分类也很多，而且几乎什么样的比赛都会有，算是比较重要的题目类型之一吧。<br>技巧：具体问题具体分析，归根结底还是要熟练掌握PHP这门语言，了解一些常见的会造成漏洞的函数及利用方法等。</p><h2 id="hash加密相关"><a href="#hash加密相关" class="headerlink" title="hash加密相关"></a>hash加密相关</h2><h3 id="PHP弱类型hash比较缺陷"><a href="#PHP弱类型hash比较缺陷" class="headerlink" title="PHP弱类型hash比较缺陷"></a>PHP弱类型hash比较缺陷</h3><p>这是代码审计最基础的题目了，也比较常见。<br>典型代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a</span>) == <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$b</span>)) &#123;    <span class="hljs-comment">//注意两个等号“==”</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>加密函数也有可能是sha1或者其他的，但是原理都是不变的。<br>这个漏洞的原理如下：<br>&#x3D;&#x3D; 在进行比较的时候，会先将两边的变量类型转化成相同的，再进行比较。<br>0e在比较的时候会将其视作为科学计数法，所以无论0e后面是什么，0的多少次方还是0。<br>所以只要让b在经过相应的函数加密之后都是以0e开头就可以。</p><p>以下是一些md5加密后开头为0e的字符串：</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs dns">QNKCDZO<br><span class="hljs-number">0</span>e830400451993494058<span class="hljs-number">024219903391</span><br><br>s878926199a<br><span class="hljs-number">0</span>e5459932745177090343<span class="hljs-number">28855841020</span><br><br>s155964671a<br><span class="hljs-number">0</span>e342768416822451524<span class="hljs-number">974117254469</span><br><br>s214587387a<br><span class="hljs-number">0</span>e8482404488305379244<span class="hljs-number">65865611904</span><br><br>s214587387a<br><span class="hljs-number">0</span>e8482404488305379244<span class="hljs-number">65865611904</span><br><br>s878926199a<br><span class="hljs-number">0</span>e5459932745177090343<span class="hljs-number">28855841020</span><br><br>s1091221200a<br><span class="hljs-number">0</span>e9406242178565615578<span class="hljs-number">16327384675</span><br><br>s1885207154a<br><span class="hljs-number">0</span>e5093672134182067008<span class="hljs-number">42008763514</span><br><br>aabg7XSs<br></code></pre></td></tr></table></figure><p>另外，这个也可以用数组绕过，这个方法在下面会详细说。</p><h3 id="数组返回NULL绕过"><a href="#数组返回NULL绕过" class="headerlink" title="数组返回NULL绕过"></a>数组返回NULL绕过</h3><p>PHP绝大多数函数无法处理数组，向md5函数传入数组类型的参数会使md5()函数返回NULL（转换后为False），进而绕过某些限制。<br>如果上面的代码变成：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a</span>) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$b</span>)) &#123;       <span class="hljs-comment">//两个等号变成三个</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>那么利用弱类型hash比较缺陷将无法绕过，这时可以使用数组绕过。</p><p>传入?a[]&#x3D;1&amp;b[]&#x3D;2就可以成功绕过判断。</p><p>这样的方法也可以用来绕过sha1()等hash加密函数相关的判断，也可以绕过正则判断，可以根据具体情况来灵活运用。</p><h2 id="正则表达式相关"><a href="#正则表达式相关" class="headerlink" title="正则表达式相关"></a>正则表达式相关</h2><h3 id="ereg正则-00截断"><a href="#ereg正则-00截断" class="headerlink" title="ereg正则%00截断"></a>ereg正则%00截断</h3><p>ereg函数存在NULL截断漏洞，使用NULL可以截断过滤，所以可以使用%00截断正则匹配。</p><ul><li>Bugku ereg正则%00截断：<a href="http://123.206.87.240:9009/5.php">http://123.206.87.240:9009/5.php</a></li></ul><h3 id="数组绕过"><a href="#数组绕过" class="headerlink" title="数组绕过"></a>数组绕过</h3><p>正则表达式相关的函数也可以使用数组绕过过滤，绕过方法详见数组返回NULL绕过。</p><p>上面那道题也可以用数组绕过。</p><h3 id="单引号绕过preg-match-正则匹配"><a href="#单引号绕过preg-match-正则匹配" class="headerlink" title="单引号绕过preg_match()正则匹配"></a>单引号绕过preg_match()正则匹配</h3><p>在每一个字符前加上单引号可以绕过preg_match的匹配，原理暂时不明。</p><p>例如有如下代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$p</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;p&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[0-9a-zA-Z]&#123;2&#125;/&#x27;</span>,<span class="hljs-variable">$p</span>) === <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;False&#x27;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$pp</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$p</span>));<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$pp</span> === <span class="hljs-string">&#x27;flag.php&#x27;</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;success&#x27;</span>;<br>        &#125;<br>    &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">payload：p=<span class="hljs-string">&#x27;Z&#x27;</span>m<span class="hljs-string">&#x27;x&#x27;</span><span class="hljs-built_in">h</span><span class="hljs-string">&#x27;Z&#x27;</span>y<span class="hljs-string">&#x27;5&#x27;</span>w<span class="hljs-string">&#x27;a&#x27;</span><span class="hljs-built_in">H</span><span class="hljs-string">&#x27;A&#x27;</span>=<br></code></pre></td></tr></table></figure><h3 id="不含数字与字母的WebShell"><a href="#不含数字与字母的WebShell" class="headerlink" title="不含数字与字母的WebShell"></a>不含数字与字母的WebShell</h3><p>如果题目使用preg_match()过滤掉了所有的数字和字母，但是没有过滤PHP的变量符号$，可以考虑使用这种方法。</p><p>典型代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">include</span><span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>]))&#123;<br>   <span class="hljs-variable">$code</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>];<br>   <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$code</span>)&gt;<span class="hljs-number">50</span>)&#123;<br>       <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Too Long.&quot;</span>);<br>  &#125;<br>   <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[A-Za-z0-9_]+/&quot;</span>,<span class="hljs-variable">$code</span>))&#123;<br>       <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Not Allowed.&quot;</span>);<br>  &#125;<br>   @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$code</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>   <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-comment">//$hint = &quot;php function getFlag() to get flag&quot;;</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>这种方法的核心是字符串的异或操作。</p><p>爆破脚本：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus">chr1 = <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;@&#x27;</span>, <span class="hljs-string">&#x27;!&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;$&#x27;</span>, <span class="hljs-string">&#x27;%&#x27;</span>, <span class="hljs-string">&#x27;&amp;&#x27;</span>, <span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;(&#x27;</span>, <span class="hljs-string">&#x27;)&#x27;</span>, <span class="hljs-string">&#x27;*&#x27;</span>, <span class="hljs-string">&#x27;+&#x27;</span>, <span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-string">&#x27;;&#x27;</span>, <span class="hljs-string">&#x27;&lt;&#x27;</span>, <span class="hljs-string">&#x27;=&#x27;</span>, <span class="hljs-string">&#x27;&gt;&#x27;</span>, <span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-string">&#x27;[&#x27;</span>, <span class="hljs-string">&#x27;\\&#x27;</span>, <span class="hljs-string">&#x27;]&#x27;</span>, <span class="hljs-string">&#x27;^&#x27;</span>, <span class="hljs-string">&#x27;_&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;&#123;&#x27;</span>, <span class="hljs-string">&#x27;|&#x27;</span>, <span class="hljs-string">&#x27;&#125;&#x27;</span>, <span class="hljs-string">&#x27;~&#x27;</span>]</span><br>chr2 = <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;@&#x27;</span>, <span class="hljs-string">&#x27;!&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;$&#x27;</span>, <span class="hljs-string">&#x27;%&#x27;</span>, <span class="hljs-string">&#x27;&amp;&#x27;</span>, <span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;(&#x27;</span>, <span class="hljs-string">&#x27;)&#x27;</span>, <span class="hljs-string">&#x27;*&#x27;</span>, <span class="hljs-string">&#x27;+&#x27;</span>, <span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-string">&#x27;;&#x27;</span>, <span class="hljs-string">&#x27;&lt;&#x27;</span>, <span class="hljs-string">&#x27;=&#x27;</span>, <span class="hljs-string">&#x27;&gt;&#x27;</span>, <span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-string">&#x27;[&#x27;</span>, <span class="hljs-string">&#x27;\\&#x27;</span>, <span class="hljs-string">&#x27;]&#x27;</span>, <span class="hljs-string">&#x27;^&#x27;</span>, <span class="hljs-string">&#x27;_&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;&#123;&#x27;</span>, <span class="hljs-string">&#x27;|&#x27;</span>, <span class="hljs-string">&#x27;&#125;&#x27;</span>, <span class="hljs-string">&#x27;~&#x27;</span>]</span><br><br><span class="hljs-keyword">for</span> <span class="hljs-selector-tag">i</span> <span class="hljs-keyword">in</span> chr1 :<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> chr2 :<br>        <span class="hljs-built_in">print</span>(<span class="hljs-selector-tag">i</span> + <span class="hljs-string">&#x27;xor&#x27;</span> + j + <span class="hljs-string">&#x27;=&#x27;</span> + (<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(i) ^ <span class="hljs-built_in">ord</span>(j))))<br></code></pre></td></tr></table></figure><p>根据题目的要求，用异或出来的字符串拼出合适的Payload，并放在PHP变量中执行。变量名可以用中文。</p><p>比如这道题的</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-title class_">Payload</span>：<span class="hljs-string">?c</span>ode=<span class="hljs-variable">$啊</span>=<span class="hljs-string">&quot;@@^|@@@&quot;</span>^<span class="hljs-string">&quot;&#x27;%*:,!&#x27;&quot;</span>;<span class="hljs-variable">$啊</span>();<br></code></pre></td></tr></table></figure><h3 id="Linux通配符绕过正则匹配"><a href="#Linux通配符绕过正则匹配" class="headerlink" title="Linux通配符绕过正则匹配"></a>Linux通配符绕过正则匹配</h3><p>典型代码如下，与前一种题目非常相似，但也不大一样：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>]))&#123;<br>   <span class="hljs-variable">$code</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>];<br>   <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$code</span>)&gt;<span class="hljs-number">50</span>)&#123;<br>       <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Too Long.&quot;</span>);<br>  &#125;<br>   <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[A-Za-z0-9_$]+/&quot;</span>,<span class="hljs-variable">$code</span>))&#123;<br>       <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Not Allowed.&quot;</span>);<br>  &#125;<br>   @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$code</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>   <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-comment">//flag in /</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>最主要的区别就是过滤了$和_，也就是说无法使用变量符号$了。</p><p>这时候可以考虑采用通配符绕过。</p><p>通配符有点像正则表达式，有自己的匹配规则：</p><table><thead><tr><th>字符</th><th>解释</th></tr></thead><tbody><tr><td>*</td><td>匹配任意长度任意字符</td></tr><tr><td>?</td><td>匹配任意单个字符</td></tr><tr><td>[list]</td><td>匹配指定范围内(list)任意单个字符，也可以是单个字符组成的集合</td></tr><tr><td>[^list]</td><td>匹配指定范围外的任意单个字符或字符集合</td></tr><tr><td>[!list]</td><td>同[^list]</td></tr><tr><td>{str1,str2,…}</td><td>匹配str1或者str2或者更多字符串，也可以是集合</td></tr></tbody></table><p>所以构造一下通配符就是</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">/<span class="hljs-string">??</span><span class="hljs-string">?/</span><span class="hljs-string">??</span>? <span class="hljs-regexp">/*</span><br></code></pre></td></tr></table></figure><p>因为过滤了变量符号，没法通过上面那种方法来执行了。但是，可以通过闭合PHP标记来执行，<br>也就是：<code>?&gt;（/bin/cat /*）。</code></p><p>所以本题的</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">payload为：<span class="hljs-string">?c</span>ode=<span class="hljs-string">?&gt;</span>&lt;<span class="hljs-string">?=</span>/<span class="hljs-string">??</span><span class="hljs-string">?/</span><span class="hljs-string">??</span>? <span class="hljs-regexp">/*?&gt;</span><br></code></pre></td></tr></table></figure><p>具体解法可以参照此篇文章的前两道题目：<br><a href="https://www.jianshu.com/p/ecc2414ec110">https://www.jianshu.com/p/ecc2414ec110</a></p><h2 id="命令执行漏洞"><a href="#命令执行漏洞" class="headerlink" title="命令执行漏洞"></a>命令执行漏洞</h2><h3 id="assert-函数引起的命令执行"><a href="#assert-函数引起的命令执行" class="headerlink" title="assert()函数引起的命令执行"></a>assert()函数引起的命令执行</h3><p>assert函数的参数为字符串时，会将字符串当做PHP命令来执行。</p><p>例如：assert(‘phpinfo()’)相当于执行<br>以一道题目为例：</p><p>本题目中题目文件夹下放置了一个隐藏的flag文件。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>] === <span class="hljs-string">&quot;flag&quot;</span>)&#123;<br>        <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$page</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    &#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$page</span> = <span class="hljs-string">&quot;./flag.php&quot;</span>;<br>&#125;<br><br><span class="hljs-title function_ invoke__">assert</span>(<span class="hljs-string">&quot;file_exists(&#x27;<span class="hljs-subst">$page</span>&#x27;)&quot;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>解法：<br>构造闭合 file_exists()函数，并使assert()执行恶意代码。<br>Linux命令ls -a可用于查看该目录下所有文件，包括隐藏文件。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs csharp">payload：<br>?file=<span class="hljs-number">123&#x27;</span>) <span class="hljs-function"><span class="hljs-keyword">or</span> <span class="hljs-title">system</span>(<span class="hljs-params"><span class="hljs-string">&#x27;ls -a&#x27;</span></span>)</span>;<span class="hljs-meta">#</span><br>?file=<span class="hljs-number">123&#x27;</span>) <span class="hljs-function"><span class="hljs-keyword">or</span> <span class="hljs-title">system</span>(<span class="hljs-params"><span class="hljs-string">&#x27;cat .ffll44gg&#x27;</span></span>)</span>;<span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure><h3 id="XSS题目"><a href="#XSS题目" class="headerlink" title="XSS题目"></a>XSS题目</h3><p>这类题目会涉及到三种XSS类型，具体类型要根据题目来判断。一般都是向后台发送一个带有XSS Payload的文本，在返回的Cookie中含有flag，解法是在XSS Payload。<br>这类题目一般都会带有过滤和各种限制，需要了解一些常用的绕过方法。<br>技巧：XSS归根结底还是JavaScript，JavaScript的威力有多大，XSS的威力就有多大。要知道一些常用的XSS Payload，还要把三类XSS的原理弄明白。做题时需要用到XSS平台，网上有公用的，也可以自己在VPS上搭一个。</p><ul><li>JavisOJ babyxss：<a href="http://web.jarvisoj.com:32800/">http://web.jarvisoj.com:32800/</a></li></ul><h3 id="绕过waf"><a href="#绕过waf" class="headerlink" title="绕过waf"></a>绕过waf</h3><p>其实绝大多数比较难的题目多多少都会对输入有过滤，毕竟在现实的网络中肯定是会对输入进行限制的，但是这里还是把过滤单独列出来了。<br>技巧：多掌握一些不同的绕过方法。</p><h3 id="长度限制"><a href="#长度限制" class="headerlink" title="长度限制"></a>长度限制</h3><p>有些题目会要求输入较长的文本，但对文本的长度进行了限制。<br>对于这种题目，既可以用BurpSuite抓包改包绕过，也可以直接在F12里改页面源代码。</p><ul><li>Bugku 计算器（修改页面源代码）：<a href="http://123.206.87.240:8002/yanzhengma/">http://123.206.87.240:8002/yanzhengma/</a></li></ul><p>DVWA 存储型XSS的标题栏会对长度进行限制，使用BurpSuite抓包绕过。</p><h3 id="双写"><a href="#双写" class="headerlink" title="双写"></a>双写</h3><p>双写可以绕过对输入内容过滤的单次判断，在XSS、SQL注入和PHP代码审计的题目中比较常见。<br>双写顾名思义就是将被过滤的关键字符写两遍，比如，如果要添加XSS Payload，又需要插入script标签，就可以构造如下的</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">Payload：&lt;scr<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>ipt&gt;<br></code></pre></td></tr></table></figure><p>来绕过对script标签的单次过滤限制。<br>这样的方法不仅对XSS有用，也可以用于代码审计和SQL注入。<br>HGAME2019有一道XSS题目就是过滤了script标签，可以用双写绕过。</p><h3 id="等价替代"><a href="#等价替代" class="headerlink" title="等价替代"></a>等价替代</h3><p>就是不用被过滤的字符，而使用没有被过滤却会产生相同效果的字符。<br>比如，如果SQL注入题目中过滤了空格，可以用</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-comment">/**/</span><br></code></pre></td></tr></table></figure><p>绕过对空格的限制；XSS题目如果过滤了script标签，可以使用其他类型的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">payload；如果需要使用<span class="hljs-built_in">cat</span>命令却被过滤，可以使用<span class="hljs-built_in">tac</span>、more、less命令来替代等。<br></code></pre></td></tr></table></figure><ul><li>实验吧 简单的SQL注入：<a href="http://www.shiyanbar.com/ctf/1875">http://www.shiyanbar.com/ctf/1875</a></li></ul><h3 id="URL编码绕过"><a href="#URL编码绕过" class="headerlink" title="URL编码绕过"></a>URL编码绕过</h3><p>如果过滤了某个必须要用的字符串，输入的内容是以GET方式获取的（也就是直接在地址栏中输入），可以采用url编码绕过的方式。比如，过滤了 cat，可以使用 c%61t来绕过。</p><h3 id="Linux命令使用反斜杠绕过"><a href="#Linux命令使用反斜杠绕过" class="headerlink" title="Linux命令使用反斜杠绕过"></a>Linux命令使用反斜杠绕过</h3><p>在Linux下，命令中加入反斜杠与原命令完全等价。例如，cat与 ca\t两条命令等价，效果完全相同。<br>可以利用这个特性来进行一些绕过操作（当然，这个仅限于命令执行漏洞）。</p><h3 id="URL二次解码绕过"><a href="#URL二次解码绕过" class="headerlink" title="URL二次解码绕过"></a>URL二次解码绕过</h3><p>这个类型本来应该放在代码审计里面，但是既然是一种绕过过滤的姿势，就写在这里了。<br>如果源码中出现了urldecode()函数，可以利用url二次解码来绕过。</p><p>以下是一些常用的HTML URL编码：</p><table><thead><tr><th>ASCII Value</th><th>URL-encode</th><th>ASCII Value</th><th>URL-encode</th><th>ASCII Value</th><th>URL-encode</th></tr></thead><tbody><tr><td>æ</td><td>%00</td><td>0</td><td>%30</td><td>&#96;</td><td>%60</td></tr><tr><td></td><td>%01</td><td>1</td><td>%31</td><td>a</td><td>%61</td></tr><tr><td></td><td>%02</td><td>2</td><td>%32</td><td>b</td><td>%62</td></tr><tr><td></td><td>%03</td><td>3</td><td>%33</td><td>c</td><td>%63</td></tr><tr><td></td><td>%04</td><td>4</td><td>%34</td><td>d</td><td>%64</td></tr><tr><td></td><td>%05</td><td>5</td><td>%35</td><td>e</td><td>%65</td></tr><tr><td></td><td>%06</td><td>6</td><td>%36</td><td>f</td><td>%66</td></tr><tr><td></td><td>%07</td><td>7</td><td>%37</td><td>g</td><td>%67</td></tr><tr><td>backspace</td><td>%08</td><td>8</td><td>%38</td><td>h</td><td>%68</td></tr><tr><td>tab</td><td>%09</td><td>9</td><td>%39</td><td>i</td><td>%69</td></tr><tr><td>linefeed</td><td>%0a</td><td>:</td><td>%3a</td><td>j</td><td>%6a</td></tr><tr><td></td><td>%0b</td><td>;</td><td>%3b</td><td>k</td><td>%6b</td></tr><tr><td></td><td>%0c</td><td>&lt;</td><td>%3c</td><td>l</td><td>%6c</td></tr><tr><td>c return</td><td>%0d</td><td>&#x3D;</td><td>%3d</td><td>m</td><td>%6d</td></tr><tr><td></td><td>%0e</td><td>&gt;</td><td>%3e</td><td>n</td><td>%6e</td></tr><tr><td></td><td>%0f</td><td>?</td><td>%3f</td><td>o</td><td>%6f</td></tr><tr><td></td><td>%10</td><td>@</td><td>%40</td><td>p</td><td>%70</td></tr><tr><td></td><td>%11</td><td>A</td><td>%41</td><td>q</td><td>%71</td></tr><tr><td></td><td>%12</td><td>B</td><td>%42</td><td>r</td><td>%72</td></tr><tr><td></td><td>%13</td><td>C</td><td>%43</td><td>s</td><td>%73</td></tr><tr><td></td><td>%14</td><td>D</td><td>%44</td><td>t</td><td>%74</td></tr><tr><td></td><td>%15</td><td>E</td><td>%45</td><td>u</td><td>%75</td></tr><tr><td></td><td>%16</td><td>F</td><td>%46</td><td>v</td><td>%76</td></tr><tr><td></td><td>%17</td><td>G</td><td>%47</td><td>w</td><td>%77</td></tr><tr><td></td><td>%18</td><td>H</td><td>%48</td><td>x</td><td>%78</td></tr><tr><td></td><td>%19</td><td>I</td><td>%49</td><td>y</td><td>%79</td></tr><tr><td></td><td>%1a</td><td>J</td><td>%4a</td><td>z</td><td>%7a</td></tr><tr><td></td><td>%1b</td><td>K</td><td>%4b</td><td>{</td><td>%7b</td></tr><tr><td></td><td>%1c</td><td>L</td><td>%4c</td><td></td><td></td></tr><tr><td></td><td>%1d</td><td>M</td><td>%4d</td><td>}</td><td>%7d</td></tr><tr><td></td><td>%1e</td><td>N</td><td>%4e</td><td>~</td><td>%7e</td></tr><tr><td></td><td>%1f</td><td>O</td><td>%4f</td><td></td><td>%7f</td></tr><tr><td>space</td><td>%20</td><td>P</td><td>%50</td><td>€</td><td>%80</td></tr><tr><td>!</td><td>%21</td><td>Q</td><td>%51</td><td></td><td>%81</td></tr><tr><td>“</td><td>%22</td><td>R</td><td>%52</td><td>‚</td><td>%82</td></tr><tr><td>#</td><td>%23</td><td>S</td><td>%53</td><td>ƒ</td><td>%83</td></tr><tr><td>$</td><td>%24</td><td>T</td><td>%54</td><td>„</td><td>%84</td></tr><tr><td>%</td><td>%25</td><td>U</td><td>%55</td><td>…</td><td>%85</td></tr><tr><td>&amp;</td><td>%26</td><td>V</td><td>%56</td><td>†</td><td>%86</td></tr><tr><td>‘</td><td>%27</td><td>W</td><td>%57</td><td>‡</td><td>%87</td></tr><tr><td>(</td><td>%28</td><td>X</td><td>%58</td><td>ˆ</td><td>%88</td></tr><tr><td>)</td><td>%29</td><td>Y</td><td>%59</td><td>‰</td><td>%89</td></tr><tr><td>*</td><td>%2a</td><td>Z</td><td>%5a</td><td>Š</td><td>%8a</td></tr><tr><td>+</td><td>%2b</td><td>[</td><td>%5b</td><td>‹</td><td>%8b</td></tr><tr><td>,</td><td>%2c</td><td>\</td><td>%5c</td><td>Œ</td><td>%8c</td></tr><tr><td>-</td><td>%2d</td><td>]</td><td>%5d</td><td></td><td>%8d</td></tr><tr><td>.</td><td>%2e</td><td>^</td><td>%5e</td><td>Ž</td><td>%8e</td></tr><tr><td>&#x2F;</td><td>%2f</td><td>_</td><td>%5f</td><td></td><td>%8f</td></tr></tbody></table><ul><li>Bugku urldecode二次编码绕过：<a href="http://123.206.87.240:9009/10.php">http://123.206.87.240:9009/10.php</a></li></ul><h3 id="数组绕过-1"><a href="#数组绕过-1" class="headerlink" title="数组绕过"></a>数组绕过</h3><p>详见PHP代码审计的“数组返回NULL”绕过。<br>数组绕过的应用很广，很多题目都可以用数组绕过。</p><h3 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h3><p>SQL注入是一种灵活而复杂的攻击方式，归根结底还是考察对SQL语言的了解和根据输入不同数据网页的反应对后台语句的判断，当然也有sqlmap这样的自动化工具可以使用。</p><p>技巧：如果不用sqlmap或者是用不了，就一定要把SQL语言弄明白，sqlmap这样的自动化工具也可以使用。</p><h3 id="使用sqlmap"><a href="#使用sqlmap" class="headerlink" title="使用sqlmap"></a>使用sqlmap</h3><p>sqlmap的应用范围还不大明确，我都是如果sqlmap没法注入就手工注入。</p><ul><li>sqlmap的使用：<a href="https://www.jianshu.com/p/4509bdf5e3d0">https://www.jianshu.com/p/4509bdf5e3d0</a></li><li>一些sqlmap的命令，留着备用：<a href="https://www.freebuf.com/sectool/164608.html">https://www.freebuf.com/sectool/164608.html</a></li><li>感觉这篇教程也不错：<a href="https://www.cnblogs.com/im404/p/3505894.html">https://www.cnblogs.com/im404/p/3505894.html</a></li><li>命令合集：<a href="https://www.jianshu.com/p/fa77f2ed788b">https://www.jianshu.com/p/fa77f2ed788b</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CTF常见的题型</title>
    <link href="/2020/05/19/other/ctf_type/"/>
    <url>/2020/05/19/other/ctf_type/</url>
    
    <content type="html"><![CDATA[<p><strong>CTF常见的题型</strong><br>CTF比赛通常包含的题目类型有七种，包括<strong>MISC、PPC、CRYPTO、PWN、REVERSE、WEB、STEGA。</strong></p><p>1.MISC(Miscellaneous)√ 类型，即安全杂项，题目或涉及流量分析、电子取证、人肉搜索、数据分析等等。<br>杂项介绍<br>Miscellaneous简称MISC，意思是杂项，混杂的意思。<br>杂项大致有几种类型：</p><ul><li>1.隐写，包括图片&#x2F;音频&#x2F;视频&#x2F;其他等</li><li>2.压缩包处理，包括zip&#x2F;rar等</li><li>3.流量分析，包括协议&#x2F;文件&#x2F;usb&#x2F;wifi等</li><li>4.攻击取证，包括日志分析&#x2F;内存分析&#x2F;文件镜像等</li><li>5.基础</li><li>6.其它</li></ul><p>处理方法：<br>1.查看文件类型：</p><ul><li>file、 010Editor<br>2.文件分离：</li><li>Binwalk、 foremost、 dd、 010Editor<br>3.文件合并：</li><li>linux环境、 windows环境、 python脚本</li></ul><p>2.PPC(Professionally Program Coder)类型，即编程类题目，题目涉及到编程算法，相比ACM较为容易。</p><p>3.CRYPTO(Cryptography)√ 类型，即密码学，题目考察各种加解密技术，包括古典加密技术、现代加密技术甚至出题者自创加密技术。</p><ul><li>Morse编码</li><li>ASCII编码</li><li>Tap Code敲击码</li><li>Base编码</li><li>URL编码</li><li>Unicode编码</li><li>凯撒密码</li><li>RSA 加解密</li></ul><p>4.PWN√ 类型，PWN在黑客俚语中代表着攻破、取得权限，多为溢出类题目。</p><p>Pwn 是其中的一类重要题型，主要考查选手二进制逆向分析、漏洞挖掘以及 Exploit 编写的能力。<br>PWN是一个黑客语法的俚语词，自”own”这个字引申出来的，这个词的含意在于，玩家在整个游戏对战中处在胜利的优势，或是说明竞争对手处在完全惨败的 情形下，这个词习惯上在网络游戏文化主要用于嘲笑竞争对手在整个游戏对战中已经完全被击败（例如：”You just got pwned!”）。有一个非常著名的国际赛事叫做Pwn2Own，相信你现在已经能够理解这个名字的含义了，即通过打败对手来达到拥有的目的。<br>CTF中PWN题型通常会直接给定一个已经编译好的二进制程序（Windows下的EXE或者Linux下的ELF文件等），然后参赛选手通过对二进制程 序进行逆向分析和调试来找到利用漏洞，并编写利用代码，通过远程代码执行来达到溢出攻击的效果，最终拿到目标机器的shell夺取flag</p><p>5.REVERSE√ 类型，即逆向工程，题目涉及到软件逆向、破解技术。<br>通过Ollydbg&#x2F;IDA Pro&#x2F;PEiD等工具在逆向分析中的基本使用方法，并通过动态调试和静态分析两种方法来找到程序密码。</p><p>6.STEGA(Steganography)类型，即隐写术，题目的Flag会隐藏到图片、音频、视频等各类数据载体中供参赛者获取。</p><p>7.WEB√ 类型，即题目会涉及到常见的Web漏洞，诸如注入、XSS、文件包含、代码执行等漏洞。<br>工具集</p><ul><li>基础工具：Burpsuite，python，firefox(hackbar，foxyproxy，user-agent，swither等)</li><li>扫描工具：nmap，nessus，openvas</li><li>sql注入工具：sqlmap等</li><li>xss平台：xssplatfrom，beef</li><li>文件上传工具：cknife</li><li>文件包含工具：LFlsuite</li><li>暴力破解工具：burp暴力破解模块，md5Crack，hydra</li></ul><p>常用套路总结<br>直接查看网页源码，即可找到flag<br>查看http请求&#x2F;响应，使用burp查看http头部信息，修改或添加http请求头（referer–来源伪造，x-forwarded-for–ip伪造，user-agent–用户浏览器，cookie–维持登陆状态，用户身份识别）<br>web源码泄漏：vim源码泄漏(线上CTF常见)，如果发现页面上有提示vi或vim，说明存在swp文件泄漏，地址：&#x2F;.index.php.swp或index.php~<br>恢复文件 vim -r index.php。<br>备份文件泄漏，地址：index.php.bak，<a href="http://www.zip,htdocs.zip,可以是zip,rar,tar.gz,7z等/">www.zip，htdocs.zip，可以是zip，rar，tar.gz，7z等</a><br>.git源码泄漏，地址：<a href="http://www.xxx.com/.git/config%EF%BC%8C%E5%B7%A5%E5%85%B7%EF%BC%9AGitHack%EF%BC%8Cdvcs-ripper">http://www.xxx.com/.git/config，工具：GitHack，dvcs-ripper</a><br>svn导致文件泄漏，地址：<a href="http://www/xxx/com/.svn/entries%EF%BC%8C%E5%B7%A5%E5%85%B7%EF%BC%9Advcs-ripper%EF%BC%8Cseay-svn">http://www/xxx/com/.svn/entries，工具：dvcs-ripper，seay-svn</a><br>编码和加解密，各类编码和加密，可以使用在线工具解密，解码<br>windows特性，短文件名，利用～字符猜解暴露短文件&#x2F;文件夹名，如backup-81231sadasdasasfa.sql的长文件，<br>其短文件是backup1.sql，iis解析漏洞，绕过文件上传检测<br>php弱类型<br>绕waf，大小写混合，使用编码，使用注释，使用空字节</p><p>当前我们环境中的题型为：</p><p>1.CRYPTO：<br>字符串(可能很长) 或 上传一个文件</p><p>2.PWN：<br>每一道题Docker container对外开放一个端口映射</p><p>3.MISC:<br>全部为 上传一个文件</p><p>4.Reserve：<br>全部为 上传一个文件</p><p>5.Web：<br>每一道题Docker container对外开放一个端口映射</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NFS 详解</title>
    <link href="/2020/05/08/linux/nfs/"/>
    <url>/2020/05/08/linux/nfs/</url>
    
    <content type="html"><![CDATA[<p><strong>NFS客户端卡住问题</strong><br>碰到nfs客户端卡住的情况，umount -f &#x2F;mnt提示device is busy，并且尝试访问挂载目录、df -h等操作都会使终端卡住，ctrl+c也不能强行退出。</p><p>造成这种现象的原因是nfs服务器&#x2F;网络挂了，nfs客户端默认采用hard-mount选项，而不是soft-mount。他们的区别是<br>soft-mount: 当客户端加载NFS不成功时，重试retrans设定的次数.如果retrans次都不成功，则放弃此操作，返回错误信息 “Connect time out”<br>hard-mount: 当客户端加载NFS不成功时,一直重试，直到NFS服务器有响应。hard-mount 是系统的缺省值。在选定hard-mount 时，最好同时选 intr , 允许中断系统的调用请求，避免引起系统的挂起。当NFS服务器不能响应NFS客户端的 hard-mount请求时， NFS客户端会显示<br>“NFS server hostname not responding, still trying”</p><p><strong>nfs参数介绍</strong><br>下面列出mount关于nfs相关的参数<br>（1）-a：把&#x2F;etc&#x2F;fstab中列出的路径全部挂载。<br>（2）-t：需要mount的类型，如nfs等。<br>（3）-r：将mount的路径定为read only。<br>（4）-v mount：过程的每一个操作都有message传回到屏幕上。<br>（5）rsize&#x3D;n：在NFS服务器读取文件时NFS使用的字节数，默认值是4096个字节。<br>（6）wsize&#x3D;n：向NFS服务器写文件时NFS使用的字节数，默认值是4096个字节。<br>（7）timeo&#x3D;n：从超时后到第1次重新传送占用的1&#x2F;7秒的数目，默认值是7&#x2F;7秒。<br>（8）retry&#x3D;n：在放弃后台mount操作之前可以尝试的次数，默认值是7 000次。<br>（9）soft：使用软挂载的方式挂载系统，若Client的请求得不到回应，则重新请求并传回错误信息。<br>（10）hard：使用硬挂载的方式挂载系统，该值是默认值，重复请求直到NFS服务器回应。<br>（11）intr：允许NFS中断文件操作和向调用它的程序返回值，默认不允许文件操作被中断。<br>（12）fg：一直在提示符下执行重复挂载。<br>（13）bg：如果第1次挂载文件系统失败，继续在后台尝试执行挂载，默认值是失败后不在后台处理。<br>（14）tcp：对文件系统的挂载使用TCP，而不是默认的UDP。</p><p>如#mount -t nfs -o soft 192.168.1.2:&#x2F;home&#x2F;nfs &#x2F;mnt</p><p><strong>nfs传输尺寸</strong><br>至于传输尺寸的选择，可以进行实际测试：<br>time dd if&#x3D;&#x2F;dev&#x2F;zero of&#x3D;&#x2F;mnt&#x2F;nfs.dat bs&#x3D;16k count&#x3D;16384<br>即向nfs服务器上的nfs.dat文件里写入16384个16KB的块（也有经验说文件大小可以设定为nfs服务器内存的2倍）。<br>得到输出如：<br>输出了 16384+0 个块<br>user 0m0.200s<br>输出了 66535+0 个块<br>user 0m0.420s<br>192.168.1.4:&#x2F;mnt &#x2F;home&#x2F;nfs nfs rsize&#x3D;8192,wsize&#x3D;8192,timeo&#x3D;10,intr<br>重新挂载nfs服务器，调整读写块大小后重复上述过程，可以找到最佳传输尺寸。</p><p><strong>NFS服务器的故障排除</strong><br>故障排除思路:<br>NFS出现了故障，可以从以下几个方面着手检查。<br>（1）NFS客户机和服务器的负荷是否太高，服务器和客户端之间的网络是否正常。<br>（2）&#x2F;etc&#x2F;exports文件的正确性。<br>（3）必要时重新启动NFS或portmap服务。<br>运行下列命令重新启动portmap和NFS：<br>service portmap restart<br>service nfs start<br>（4）检查客户端中的mount命令或&#x2F;etc&#x2F;fstab的语法是否正确。<br>（5）查看内核是否支持NFS和RPC服务。<br>普通的内核应有的选项为CONFIG_NFS_FS&#x3D;m、CONFIG_NFS_V3&#x3D;y、CONFIG_ NFSD&#x3D;m、CONFIG_NFSD_V3&#x3D;y和CONFIG_SUNRPC&#x3D;m。<br>我们可以使用常见的网络连接和测试工具ping及tracerroute来测试网络连接及速度是否正常，网络连接正常是NFS作用的基础。rpcinfo命令用于显示系统的RPC信息<br>，一般使用-p参数列出某台主机的RPC服务。用rpcinfo-p命令检查服务器时，应该能看到portmapper、status、mountd nfs和nlockmgr。用该命令检查客户端时，应<br>该至少能看到portmapper服务。</p><p><strong>使用nfsstat命令查看NFS服务器状态</strong><br>nfsstat命令显示关于NFS和到内核的远程过程调用（RPC）接口的统计信息，也可以使用该命令重新初始化该信息。如果未给定标志，默认是nfsstat -csnr命令。使用该命令显示每条信息，但不能重新初始化任何信息。</p><p>nfsstat命令的主要参数如下。</p><ul><li>（1）-b：显示NFS V4服务器的其他统计信息。</li><li>（2）c ：只显示客户机端的NFS和RPC信息，允许用户仅查看客户机数据的报告。nfsstat命令提供关于被客户机发送和拒绝的RPC和NFS调用数目的信息。<br>要只显示客户机NFS或者RPC信息，将该参数与-n或者-r参数结合。</li><li>（3）-d ：显示与NFS V4授权相关的信息。</li><li>（4）-g ：显示RPCSEC_GSS信息。</li><li>（5）-m ：显示每个NFS文件系统的统计信息，该文件系统和服务器名称、地址、安装标志、当前读和写大小，以及重新传输计数</li><li>（6）-n ：为客户机和服务器显示NFS信息。要只显示NFS客户机或服务器信息，将该参数与-c和-s参数结合。</li><li>（7）-r ：显示RPC信息。</li><li>（8）-s ：显示服务器信息。</li><li>（9）-t ：显示与NFS标识映射子系统的转换请求相关的统计信息，要只显示NFS客户机或服务器信息，将-c和-s选项结合。</li><li>（10）-4 ：当与-c、-n、-s或-z参数组合使用时，将包含NFS V4客户机或服务器的信息，以及现有的NFS V2和V3数据。</li><li>（11）-z ：重新初始化统计信息。该参数仅供root用户使用，并且在显示上面的标志后可以和那些标志中的任何一个组合到统计信息的零特殊集合。</li></ul><p>要显示关于客户机发送和拒绝的RPC和NFS调用数目的信息，输入：<br>nfsstat -c<br>要显示和打印与客户机NFS调用相关的信息，输入如下命令：<br>nfsstat -cn<br>要显示和打印客户机和服务器的与RPC调用相关的信息，输入如下命令：<br>nfsstat -r<br>要显示关于服务器接收和拒绝的RPC和NFS调用数目的信息，输入如下命令：<br>nfsstat –s</p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Openstack凝思系统虚拟桌面鼠标漂移的问题</title>
    <link href="/2020/05/06/openstack/graphic_mouse/"/>
    <url>/2020/05/06/openstack/graphic_mouse/</url>
    
    <content type="html"><![CDATA[<p><strong>问题描述</strong><br>在OpenstackQueens环境下分别安装Windows，Kali及凝思图型界面操作系统，发现凝思操作系统出现鼠标漂移的问题。<br>经调查，默认情况下有图型界面的实例使用的输入设备类型为usbtablet，<br>Windows，Kali在usbtablet下没有问题，凝思操作系统鼠标漂移。<br>凝思在使用ps2mouse下没有问题，而ps2mouse下Windows，Kali鼠标出现漂移。</p><p><strong>解决办法</strong><br>镜像定制化:<br>在制作除凝思操作系统的镜像时，使用定制属性:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">hw_pointer_model</span>=<span class="hljs-string">&#x27;usbtablet&#x27;</span><br></code></pre></td></tr></table></figure><p>即使用glanceClient创建镜像时，</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">glanceClient.images.create(<br>    <span class="hljs-attribute">name</span>=imageName, <span class="hljs-attribute">container_format</span>=<span class="hljs-string">&#x27;bare&#x27;</span>, <span class="hljs-attribute">disk_format</span>=<span class="hljs-string">&#x27;qcow2&#x27;</span>, <span class="hljs-attribute">hw_pointer_model</span>=<span class="hljs-string">&#x27;usbtablet&#x27;</span>)<br></code></pre></td></tr></table></figure><p>或者镜像创建后，修改镜像信息:</p><p>glance image-update –property hw_pointer_model&#x3D;usbtablet [IMAGE-ID]<br>然后在nova配置文件中[DEFAULT]中增加:</p><figure class="highlight node-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs node-repl">[DEFAULT]<br><span class="hljs-meta prompt_">...</span><br>pointer_model=ps2mouse<br></code></pre></td></tr></table></figure><p>更新后重启计算节点的Nova-compute服务:</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">systemctl restart openstack-nova-<span class="hljs-built_in">compute</span>.service<br></code></pre></td></tr></table></figure><p>这时，使用hw_pointer_model属性的镜像默认仍使用镜像定制的usbtablet，<br>而凝思系统则使用ps2mouse的输入方式。</p>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Openstack虚拟桌面协议SPICE代替vnc</title>
    <link href="/2020/05/06/openstack/spice/"/>
    <url>/2020/05/06/openstack/spice/</url>
    
    <content type="html"><![CDATA[<p><strong>题记</strong><br>VNC是OpenStack的Nova默认的连接协议，面对一些简单的管理工作表现也不错，但是如果用户经常使用Windows桌面，VNC就显得能力不足。一般情况下，使用Spice协议来代替VNC。</p><p><strong>VNC</strong><br>VNC (Virtual Network Computing)是虚拟网络计算机的缩写。VNC 是一款优秀的远程控制工具软件，由著名的 AT&amp;T 的欧洲研究实验室开发的。VNC 是在基于 UNIX 和 Linux 操作系统的免费的开源软件，远程控制能力强大，高效实用，其性能可以和 Windows 和 MAC 中的任何远程控制软件媲美。 在 Linux 中，VNC 包括以下四个命令：vncserver，vncviewer，vncpasswd，和 vncconnect。大多数情况下我只需要其中的两个命令：vncserver 和 vncviewer。</p><p><strong>SPICE 已经支持和即将支持的功能</strong><br>当前支持功能:<br>• 图形界面 - processes and transmits 2D graphic commands<br>• 视频流 - heuristically identifies video streams and transmits M-JPEG video streams<br>• 图片压缩 - offers verios compression algorithm that were built specifically for Spice, including QUIC (based on SFALIC), LZ, GLZ (history-based global dictionary), and auto (heuristic compression choice per image)<br>• 硬件鼠标- processes and transmits cursor-specific commands<br>• 图像,颜色,鼠标缓存 - manages client caches to reduce bandwidth requirements<br>• 在线切换 - supports clients while migrating Spice servers to new hosts, thus avoiding interruptions<br>• Windows 驱动 - Windows drivers for QXL display device and VDI-port<br>• 多监视器<br>• 客户端支持linux和windows - can be easily ported to additional platforms.<br>• 立体声音频 - supports audio playback and captures; audio data stream is optionally compressed using CELT<br>• 加密 - using OpenSSL<br>• 两种鼠标模式- provides client (more user-friendly) and server (increased accuracy and fully synchronized) modes<br>• 音频视频同步 - synchronizes video streams with audio clocks<br>• Spice 代理 - running on the guest and performs tasks for the client<br>• 剪切板共享 - allows copy paste between clients and the virtual machine</p><p>未来将支持的新功能:<br>• 网络隧道 (in progress) - using virtual network interface to enable sharing of network resources. Currently the focus is on printer sharing but is not limited to that.<br>• Off-screen surfaces (in progress) - supports off-screen surfaces as infrastructure for future DirectDraw, video acceleration and 3D acceleration. GDI and X11 will also benefit from this feature. It will also lay foundation for multi-head support<br>• 共享usb (in progress) - allows clients to share their USB devices with Spice servers<br>• Direct Draw<br>• 客户端GUI - Enables user-friendly configuration<br>• 屏幕管理 - add support for enabling selection of the screen used by the client<br>• 配置文件 - enables persistent user and administrative settings<br>• 共享光驱 - share your CD with Spice server<br>• 视频加速<br>• 3D加速<br>• 支持Aero<br>• Linux features parity<br>• OSX client<br>• Simultaneous clients connection</p><p><strong>Openstack启用SPICE协议</strong></p><p>安装软件包</p><p>控制节点:</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta">yum install spice-<span class="hljs-keyword">server</span> spice-protocol openstack-nova-spicehtml5proxy spice-html5<br></code></pre></td></tr></table></figure><p>计算节点:</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta">yum install spice-<span class="hljs-keyword">server</span> spice-protocol spice-html5<br></code></pre></td></tr></table></figure><p>spice-html5来自epel源，spice-server，spice-protocol来自CentOS官方源<br>如果找不到spice-html5，添加epel源</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget http:<span class="hljs-regexp">//</span>dl.fedoraproject.org<span class="hljs-regexp">/pub/</span>epel/epel-release-latest-<span class="hljs-number">7</span>.noarch.rpm<br>rpm -ivh epel-release-latest-<span class="hljs-number">7</span>.noarch.rpm<br>yum repolist      <span class="hljs-comment">##检查是否已添加至源列表)</span><br></code></pre></td></tr></table></figure><p>如果离线安装:<br>需安装epel-release-latest-7.noarch,openstack-nova-spicehtml5proxy-17.0.10-1.el7.noarch,spice-html5-0.1.7-1.el7.noarch,spice-protocol-0.12.14-1.el7.noarch,spice-server-0.14.0-9.el7.x86_64的RPM包<br>修改配置文件<br>控制节点:</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">vi</span>  /etc/nova/nova.<span class="hljs-keyword">conf</span><br></code></pre></td></tr></table></figure><p>这里明确两点：<br>指定vnc_enabled&#x3D;false，否则即使配置了spice，系统也仍然使用vnc<br>一定要注释掉原vnc配置</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[default]</span><br><span class="hljs-attr">vnc_enabled</span>=<span class="hljs-literal">false</span><br><br><span class="hljs-section">[spice]</span><br><span class="hljs-attr">html5proxy_host</span>=<span class="hljs-number">192.100</span>.<span class="hljs-number">200.140</span><br><span class="hljs-attr">html5proxy_port</span>=<span class="hljs-number">6082</span><br><span class="hljs-attr">keymap</span>=en-us<br></code></pre></td></tr></table></figure><p>计算节点:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs routeros">vi /etc/nova/nova.conf<br><br>[default]<br><span class="hljs-attribute">vnc_enabled</span>=<span class="hljs-literal">false</span><br><br>[spice]<br><span class="hljs-attribute">html5proxy_base_url</span>=http://192.100.200.140:6082/spice_auto.html<br><span class="hljs-attribute">server_listen</span>=0.0.0.0<br><span class="hljs-comment">#server_proxyclient_address=192.100.200.150</span><br><span class="hljs-attribute">enabled</span>=<span class="hljs-literal">true</span><br><span class="hljs-attribute">keymap</span>=en-us<br></code></pre></td></tr></table></figure><p>重启服务<br>控制节点:</p><p>停止novncproxy并取消自启动</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gauss">systemctl <span class="hljs-keyword">stop</span> openstack-nova-novncproxy.service<br>systemctl <span class="hljs-keyword">disable</span> openstack-nova-novncproxy.service<br></code></pre></td></tr></table></figure><p>启用spicehtml5proxy开机自启动并启动它</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-params">system</span>ctl enable openstack-nova-spicehtml5proxy.service<br><span class="hljs-params">system</span>ctl start openstack-nova-spicehtml5proxy.service<br></code></pre></td></tr></table></figure><p>计算节点:</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">systemctl restart openstack-nova-<span class="hljs-built_in">compute</span>.service<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Openstack控制节点删除计算节点的方法</title>
    <link href="/2020/04/14/openstack/delete_compute_node/"/>
    <url>/2020/04/14/openstack/delete_compute_node/</url>
    
    <content type="html"><![CDATA[<p>在控制节点Controller的操作：删除计算节点名称为compute5：</p><p><strong>1. 查看计算主机及服务相关：</strong></p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">[root<span class="hljs-meta">@controller</span> ~]<span class="hljs-comment"># openstack host list</span><br>+------------+-------------+----------+<br>|<span class="hljs-string"> Host Name  </span>|<span class="hljs-string"> Service     </span>|<span class="hljs-string"> Zone     </span>|<br>+------------+-------------+----------+<br>|<span class="hljs-string"> controller </span>|<span class="hljs-string"> consoleauth </span>|<span class="hljs-string"> internal </span>|<br>|<span class="hljs-string"> controller </span>|<span class="hljs-string"> scheduler   </span>|<span class="hljs-string"> internal </span>|<br>|<span class="hljs-string"> controller </span>|<span class="hljs-string"> conductor   </span>|<span class="hljs-string"> internal </span>|<br>|<span class="hljs-string"> compute4   </span>|<span class="hljs-string"> compute     </span>|<span class="hljs-string"> nova     </span>|<br>|<span class="hljs-string"> compute6   </span>|<span class="hljs-string"> compute     </span>|<span class="hljs-string"> nova     </span>|<br>|<span class="hljs-string"> compute5   </span>|<span class="hljs-string"> compute     </span>|<span class="hljs-string"> nova     </span>|<br>+------------+-------------+----------+<br></code></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">[root<span class="hljs-meta">@controller</span> ~]<span class="hljs-comment"># nova service-list</span><br>+--------------------------------------+------------------+------------+----------+---------+-------+----------------------------+-----------------+-------------+<br>|<span class="hljs-string"> Id                                   </span>|<span class="hljs-string"> Binary           </span>|<span class="hljs-string"> Host       </span>|<span class="hljs-string"> Zone     </span>|<span class="hljs-string"> Status  </span>|<span class="hljs-string"> State </span>|<span class="hljs-string"> Updated_at                 </span>|<span class="hljs-string"> Disabled Reason </span>|<span class="hljs-string"> Forced down </span>|<br>+--------------------------------------+------------------+------------+----------+---------+-------+----------------------------+-----------------+-------------+<br>|<span class="hljs-string"> 936a4177-d08d-4f62-bb8c-7da7047ab6f8 </span>|<span class="hljs-string"> nova-consoleauth </span>|<span class="hljs-string"> controller </span>|<span class="hljs-string"> internal </span>|<span class="hljs-string"> enabled </span>|<span class="hljs-string"> up    </span>|<span class="hljs-string"> 2020-04-14T05:59:07.000000 </span>|<span class="hljs-string"> -               </span>|<span class="hljs-string"> False       </span>|<br>|<span class="hljs-string"> c1395bf8-47dd-47b0-bc8c-e10fc083ad40 </span>|<span class="hljs-string"> nova-scheduler   </span>|<span class="hljs-string"> controller </span>|<span class="hljs-string"> internal </span>|<span class="hljs-string"> enabled </span>|<span class="hljs-string"> up    </span>|<span class="hljs-string"> 2020-04-14T05:59:11.000000 </span>|<span class="hljs-string"> -               </span>|<span class="hljs-string"> False       </span>|<br>|<span class="hljs-string"> 28958175-5745-4b9f-b71d-e431168f6119 </span>|<span class="hljs-string"> nova-conductor   </span>|<span class="hljs-string"> controller </span>|<span class="hljs-string"> internal </span>|<span class="hljs-string"> enabled </span>|<span class="hljs-string"> up    </span>|<span class="hljs-string"> 2020-04-14T05:59:10.000000 </span>|<span class="hljs-string"> -               </span>|<span class="hljs-string"> False       </span>|<br>|<span class="hljs-string"> c586b1d2-f326-4e7e-8a3a-fead78a151c0 </span>|<span class="hljs-string"> nova-compute     </span>|<span class="hljs-string"> compute4   </span>|<span class="hljs-string"> nova     </span>|<span class="hljs-string"> enabled </span>|<span class="hljs-string"> up    </span>|<span class="hljs-string"> 2020-04-14T05:59:11.000000 </span>|<span class="hljs-string"> -               </span>|<span class="hljs-string"> False       </span>|<br>|<span class="hljs-string"> b6f3a4e3-a0ec-4f41-b47d-976bd45581b6 </span>|<span class="hljs-string"> nova-compute     </span>|<span class="hljs-string"> compute6   </span>|<span class="hljs-string"> nova     </span>|<span class="hljs-string"> enabled </span>|<span class="hljs-string"> up    </span>|<span class="hljs-string"> 2020-04-14T05:59:03.000000 </span>|<span class="hljs-string"> -               </span>|<span class="hljs-string"> False       </span>|<br>|<span class="hljs-string"> bb93240f-58f4-4d3c-a040-a66a9b2f0ea9 </span>|<span class="hljs-string"> nova-compute     </span>|<span class="hljs-string"> compute5   </span>|<span class="hljs-string"> nova     </span>|<span class="hljs-string"> enabled </span>|<span class="hljs-string"> down  </span>|<span class="hljs-string"> 2020-04-14T05:59:12.000000 </span>|<span class="hljs-string"> -               </span>|<span class="hljs-string"> False       </span>|<br>+--------------------------------------+------------------+------------+----------+---------+-------+----------------------------+-----------------+-------------+<br></code></pre></td></tr></table></figure><p>计算节点compute的State状态是down，但Status状态还是enabled可用。</p><p><strong>2. 修改compute5为不可用状态。</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@controller</span> ~]<span class="hljs-meta"># nova service-disable bb93240f-58f4-4d3c-a040-a66a9b2f0ea9</span><br></code></pre></td></tr></table></figure><p>查看是否修改成功</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">[root<span class="hljs-meta">@controller</span> ~]<span class="hljs-comment"># nova service-list</span><br>+--------------------------------------+------------------+------------+----------+---------+-------+----------------------------+-----------------+-------------+<br>|<span class="hljs-string"> Id                                   </span>|<span class="hljs-string"> Binary           </span>|<span class="hljs-string"> Host       </span>|<span class="hljs-string"> Zone     </span>|<span class="hljs-string"> Status  </span>|<span class="hljs-string"> State </span>|<span class="hljs-string"> Updated_at                 </span>|<span class="hljs-string"> Disabled Reason </span>|<span class="hljs-string"> Forced down </span>|<br>+--------------------------------------+------------------+------------+----------+---------+-------+----------------------------+-----------------+-------------+<br>|<span class="hljs-string"> 936a4177-d08d-4f62-bb8c-7da7047ab6f8 </span>|<span class="hljs-string"> nova-consoleauth </span>|<span class="hljs-string"> controller </span>|<span class="hljs-string"> internal </span>|<span class="hljs-string"> enabled </span>|<span class="hljs-string"> up    </span>|<span class="hljs-string"> 2020-04-14T05:59:07.000000 </span>|<span class="hljs-string"> -               </span>|<span class="hljs-string"> False       </span>|<br>|<span class="hljs-string"> c1395bf8-47dd-47b0-bc8c-e10fc083ad40 </span>|<span class="hljs-string"> nova-scheduler   </span>|<span class="hljs-string"> controller </span>|<span class="hljs-string"> internal </span>|<span class="hljs-string"> enabled </span>|<span class="hljs-string"> up    </span>|<span class="hljs-string"> 2020-04-14T05:59:11.000000 </span>|<span class="hljs-string"> -               </span>|<span class="hljs-string"> False       </span>|<br>|<span class="hljs-string"> 28958175-5745-4b9f-b71d-e431168f6119 </span>|<span class="hljs-string"> nova-conductor   </span>|<span class="hljs-string"> controller </span>|<span class="hljs-string"> internal </span>|<span class="hljs-string"> enabled </span>|<span class="hljs-string"> up    </span>|<span class="hljs-string"> 2020-04-14T05:59:10.000000 </span>|<span class="hljs-string"> -               </span>|<span class="hljs-string"> False       </span>|<br>|<span class="hljs-string"> c586b1d2-f326-4e7e-8a3a-fead78a151c0 </span>|<span class="hljs-string"> nova-compute     </span>|<span class="hljs-string"> compute4   </span>|<span class="hljs-string"> nova     </span>|<span class="hljs-string"> enabled </span>|<span class="hljs-string"> up    </span>|<span class="hljs-string"> 2020-04-14T05:59:11.000000 </span>|<span class="hljs-string"> -               </span>|<span class="hljs-string"> False       </span>|<br>|<span class="hljs-string"> b6f3a4e3-a0ec-4f41-b47d-976bd45581b6 </span>|<span class="hljs-string"> nova-compute     </span>|<span class="hljs-string"> compute6   </span>|<span class="hljs-string"> nova     </span>|<span class="hljs-string"> enabled </span>|<span class="hljs-string"> up    </span>|<span class="hljs-string"> 2020-04-14T05:59:03.000000 </span>|<span class="hljs-string"> -               </span>|<span class="hljs-string"> False       </span>|<br>|<span class="hljs-string"> bb93240f-58f4-4d3c-a040-a66a9b2f0ea9 </span>|<span class="hljs-string"> nova-compute     </span>|<span class="hljs-string"> compute5   </span>|<span class="hljs-string"> nova     </span>|<span class="hljs-string"> disabled</span>|<span class="hljs-string"> down  </span>|<span class="hljs-string"> 2020-04-14T05:59:12.000000 </span>|<span class="hljs-string"> -               </span>|<span class="hljs-string"> False       </span>|<br>+--------------------------------------+------------------+------------+----------+---------+-------+----------------------------+-----------------+-------------+<br></code></pre></td></tr></table></figure><p><strong>3. 在数据库（nova）中清理</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@controller</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>p<br>Enter password:<br>Welcome <span class="hljs-keyword">to</span> the MariaDB monitor. Commands <span class="hljs-keyword">end</span> <span class="hljs-keyword">with</span> ; <span class="hljs-keyword">or</span> g.<br>Your MariaDB connection id <span class="hljs-keyword">is</span> <span class="hljs-number">980</span><br>Server version: <span class="hljs-number">10.1</span><span class="hljs-number">.20</span><span class="hljs-operator">-</span>MariaDB MariaDB Server<br>Copyright (c) <span class="hljs-number">2000</span>, <span class="hljs-number">2016</span>, Oracle, MariaDB Corporation Ab <span class="hljs-keyword">and</span> others.<br>Type <span class="hljs-string">&#x27;help;&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;h&#x27;</span> <span class="hljs-keyword">for</span> help. Type <span class="hljs-string">&#x27;c&#x27;</span> <span class="hljs-keyword">to</span> clear the <span class="hljs-keyword">current</span> input statement.<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> use nova<br>Reading <span class="hljs-keyword">table</span> information <span class="hljs-keyword">for</span> completion <span class="hljs-keyword">of</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">column</span> names<br>You can turn off this feature <span class="hljs-keyword">to</span> <span class="hljs-keyword">get</span> a quicker startup <span class="hljs-keyword">with</span> <span class="hljs-operator">-</span>A<br>Database changed<br>MariaDB [nova]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> nova.services <span class="hljs-keyword">where</span> host<span class="hljs-operator">=</span>&quot;compute5&quot;;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.01</span> sec)<br>MariaDB [nova]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> compute_nodes <span class="hljs-keyword">where</span> hypervisor_hostname<span class="hljs-operator">=</span>&quot;compute5&quot;;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>MariaDB [nova]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> host <span class="hljs-keyword">from</span> nova.services;<br><br>MariaDB [nova]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> hypervisor_hostname <span class="hljs-keyword">from</span> compute_nodes;<br></code></pre></td></tr></table></figure><p><strong>4. 校验</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@controller</span> ~]<span class="hljs-meta"># openstack host list</span><br></code></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@controller</span> ~]<span class="hljs-meta"># nova service-list</span><br></code></pre></td></tr></table></figure><p>再次查看计算节点，就发现compute已经被删除了。</p>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Openstack创建实例报错：No valid host was found.</title>
    <link href="/2020/04/14/openstack/no_valid_host/"/>
    <url>/2020/04/14/openstack/no_valid_host/</url>
    
    <content type="html"><![CDATA[<p><strong>错误原因：</strong><br>UUID冲突，nova_api数据库中resource_providers表与nova.compute_nodes表中host的UUID不一致引起的，导致原因可能为删除计算节点时没有清空resource_providers表中的数据。</p><p><strong>解决办法：</strong></p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">[root@controller]#  nova-manage cell_v2 list_hosts<br><span class="hljs-code">+-----------+</span>--------------------------------------<span class="hljs-code">+----------+</span><br><span class="hljs-section">| Cell Name |              Cell UUID               | Hostname |</span><br><span class="hljs-section">+-----------+--------------------------------------+----------+</span><br>|   cell1   | 9abb6c5c-25e2-440c-8295-4826d055298c | compute4 |<br>|   cell1   | 9abb6c5c-25e2-440c-8295-4826d055298c | compute5 |<br><span class="hljs-section">|   cell1   | 9abb6c5c-25e2-440c-8295-4826d055298c | compute6 |</span><br><span class="hljs-section">+-----------+--------------------------------------+----------+</span><br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sql">MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> use nova_api;<br>Reading <span class="hljs-keyword">table</span> information <span class="hljs-keyword">for</span> completion <span class="hljs-keyword">of</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">column</span> names<br>You can turn off this feature <span class="hljs-keyword">to</span> <span class="hljs-keyword">get</span> a quicker startup <span class="hljs-keyword">with</span> <span class="hljs-operator">-</span>A<br><br>Database changed<br>MariaDB [nova_api]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> uuid,name <span class="hljs-keyword">from</span> resource_providers <span class="hljs-keyword">where</span> name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;compute5&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------+----------+</span><br><span class="hljs-operator">|</span> uuid                                 <span class="hljs-operator">|</span> name     <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------+----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">305</span>cc2a4<span class="hljs-number">-75e8</span><span class="hljs-number">-496</span>f<span class="hljs-operator">-</span>b843<span class="hljs-number">-152400257</span>c35 <span class="hljs-operator">|</span> compute5 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------+----------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>MariaDB [nova_api]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> uuid,host <span class="hljs-keyword">from</span> nova.compute_nodes <span class="hljs-keyword">where</span> host<span class="hljs-operator">=</span><span class="hljs-string">&#x27;compute5&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------+----------+</span><br><span class="hljs-operator">|</span> uuid                                 <span class="hljs-operator">|</span> host     <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------+----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">924</span>c0d27<span class="hljs-number">-1952</span><span class="hljs-number">-4663</span><span class="hljs-number">-8</span>f01<span class="hljs-operator">-</span>e8cecc67f964 <span class="hljs-operator">|</span> compute5 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------+----------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>可以看到，UUID为compute5的计算节点在resource_providers表中与nova.compute_nodes表中数据不一致，将resource_providers表中数据修改：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">MariaDB [nova_api]<span class="hljs-operator">&gt;</span>  <span class="hljs-keyword">update</span> resource_providers <span class="hljs-keyword">set</span> uuid<span class="hljs-operator">=</span><span class="hljs-string">&#x27;924c0d27-1952-4663-8f01-e8cecc67f964&#x27;</span> <span class="hljs-keyword">where</span> name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;compute5&#x27;</span> <span class="hljs-keyword">and</span> uuid<span class="hljs-operator">=</span><span class="hljs-string">&#x27;305cc2a4-75e8-496f-b843-152400257c35&#x27;</span>;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.01</span> sec)<br><span class="hljs-keyword">Rows</span> matched: <span class="hljs-number">1</span>  Changed: <span class="hljs-number">1</span>  Warnings: <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>修改后，compute5上实例可以成功创建。</p>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>交换机端口开启巨帧功能</title>
    <link href="/2020/04/14/tools/switch_jumbo/"/>
    <url>/2020/04/14/tools/switch_jumbo/</url>
    
    <content type="html"><![CDATA[<p><strong>命令功能：</strong><br>开启&#x2F;关闭端口巨帧功能。</p><p><strong>命令模式：</strong><br>全局配置模式</p><p><strong>命令格式：</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">set</span> jumbo<span class="hljs-built_in"> port </span>&lt;portlist&gt;&#123;<span class="hljs-built_in">enable</span> | disable&#125;<br></code></pre></td></tr></table></figure><p><strong>命令参数解释：</strong></p><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>portlist</td><td>端口列表</td></tr><tr><td>enable</td><td>开启端口巨帧功能</td></tr><tr><td>disable</td><td>关闭端口巨帧功能</td></tr></tbody></table><p><strong>使用说明：</strong><br>ZXR10 2950设备可以转发10k大小的巨帧。</p><p><strong>缺省：</strong><br>巨帧功能默认为disable状态。</p>]]></content>
    
    
    <categories>
      
      <category>工具</category>
      
    </categories>
    
    
    <tags>
      
      <tag>工具</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Centos7断电导致generating /run/initramfs/rdsosreport.txt 问题</title>
    <link href="/2020/04/14/linux/rdsosreport/"/>
    <url>/2020/04/14/linux/rdsosreport/</url>
    
    <content type="html"><![CDATA[<p>开机就进入命令窗口，窗口提示信息如下：</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">generating <span class="hljs-string">&quot;/run/initramfs/rdsosreport.txt&quot;</span><br>entering emergencymode. exit <span class="hljs-keyword">the</span> <span class="hljs-built_in">shell</span> <span class="hljs-built_in">to</span> continue<br>type <span class="hljs-string">&quot;journalctl&quot;</span> <span class="hljs-built_in">to</span> view <span class="hljs-keyword">system</span> logs.<br>you might want <span class="hljs-built_in">to</span> save <span class="hljs-string">&quot;/run/initramfs/rdsosreport.txt&quot;</span> <span class="hljs-built_in">to</span> <span class="hljs-keyword">a</span> usb stick <span class="hljs-keyword">or</span> /boot <span class="hljs-keyword">after</span> mounting them <span class="hljs-keyword">and</span> attach <span class="hljs-keyword">it</span> <span class="hljs-built_in">to</span> <span class="hljs-keyword">a</span> bug report.<br></code></pre></td></tr></table></figure><p>解决办法：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">xfs_repair <span class="hljs-regexp">/dev/m</span>apper/centos-root -L<br><br>reboot<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Openstack 安全组规则不生效</title>
    <link href="/2020/02/14/openstack/security_group/"/>
    <url>/2020/02/14/openstack/security_group/</url>
    
    <content type="html"><![CDATA[<p>编辑 &#x2F;etc&#x2F;sysctl.conf 文件</p><p>这里强调，安全组主要是依靠计算节点的iptables的forward链来生效的，每加一条规则就会根据网卡作为匹配条件，来生成一条iptables的规则。 如果没有任何规则，默认是丢弃所有的包。 猜测到的原因是因为，没有开启包转发功能，所以修改</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">net.ipv4.ip_forward</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">net.ipv4.conf.default.rp_filter</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">net.bridge.bridge-nf-call-ip6tables</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">net.bridge.bridge-nf-call-iptables</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">net.bridge.bridge-nf-call-arptables</span>=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>重启网络</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-regexp">/etc/</span><span class="hljs-keyword">init</span>.d<span class="hljs-operator">/</span>network restart<br></code></pre></td></tr></table></figure><p>编辑 &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;openvswitch_agent.ini 文件<br>增加或修改项，包括控制节点和计算节点</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[securitygroup]</span><br><span class="hljs-attr">enable_security_group</span> = <span class="hljs-literal">true</span><br><span class="hljs-attr">firewall_driver</span> = neutron.agent.linux.iptables_firewall.OVSHybridIptablesFirewallDriver<br></code></pre></td></tr></table></figure><p>控制节点重启所有网络服务，计算节点重启Openvswitch服务。</p><p>注：<br>neutron 也提供两种安全组的实现：IptablesFirewallDriver 和 OVSHybridIptablesFirewallDriver<br>neutron.agent.linux.iptables_firewall.IptablesFirewallDriver iptables-based FirewallDriver implementation<br>neutron.agent.linux.iptables_firewall.OVSHybridIptablesFirewallDriver: subclass of IptablesFirewallDriver with additional bridge<br>默认值是 neutron.agent.firewall.NoopFirewallDriver，表示不使用 neutron security group。</p>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kafka集群管理工具kafka-manager的安装使用</title>
    <link href="/2019/11/21/linux/kdfka_manager/"/>
    <url>/2019/11/21/linux/kdfka_manager/</url>
    
    <content type="html"><![CDATA[<p><strong>kafka-manager简介</strong></p><p>kafka-manager是目前最受欢迎的kafka集群管理工具，最早由雅虎开源，用户可以在Web界面执行一些简单的集群管理操作。具体支持以下内容：</p><p>管理多个集群<br>轻松检查集群状态（主题，消费者，偏移，代理，副本分发，分区分发）<br>运行首选副本选举<br>使用选项生成分区分配以选择要使用的代理<br>运行分区重新分配（基于生成的分配）<br>使用可选主题配置创建主题（0.8.1.1具有与0.8.2+不同的配置）<br>删除主题（仅支持0.8.2+并记住在代理配​​置中设置delete.topic.enable &#x3D; true）<br>主题列表现在指示标记为删除的主题（仅支持0.8.2+）<br>批量生成多个主题的分区分配，并可选择要使用的代理<br>批量运行重新分配多个主题的分区<br>将分区添加到现有主题<br>更新现有主题的配置<br>kafka-manager 项目地址：<a href="https://github.com/yahoo/kafka-manager">https://github.com/yahoo/kafka-manager</a></p><p><strong>kafka-manager安装</strong></p><p>下载安装包<br>使用Git或者直接从Releases中下载，这里我们下载 2.0.0.2<br>版本：<a href="https://github.com/yahoo/kafka-manager/releases">https://github.com/yahoo/kafka-manager/releases</a></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/yahoo/</span>kafka-manager<span class="hljs-regexp">/archive/</span><span class="hljs-number">2.0</span>.<span class="hljs-number">0.2</span>.tar.gz<br></code></pre></td></tr></table></figure><p>解压安装包</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">tar</span> zxvf <span class="hljs-number">2.0.0.2</span>.tar.gz<br>cd kafka-manager-<span class="hljs-number">2.0.0.2</span><br></code></pre></td></tr></table></figure><p>sbt编译<br>yum安装sbt(因为kafka-manager需要sbt编译)</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">curl https:<span class="hljs-regexp">//</span>bintray.com<span class="hljs-regexp">/sbt/</span>rpm/rpm &gt; bintray-sbt-rpm.repo<br>mv bintray-sbt-rpm.repo <span class="hljs-regexp">/etc/yum</span>.repos.d/<br>yum install sbt<br></code></pre></td></tr></table></figure><p>验证：检查sbt是否安装成功</p><p>sbt<br>[info] [launcher] getting org.scala-sbt sbt 1.3.3  (this may take some time)…</p><p>编译kafka-manager</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./sbt clean dist<br></code></pre></td></tr></table></figure><p>安装<br>将编译好的&#x2F;root&#x2F;kafka-manager-2.0.0.2&#x2F;target&#x2F;universal&#x2F;kafka-manager-2.0.0.zip文件解压</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">unzip</span> /root/kafka-manager-<span class="hljs-number">2.0.0.2</span>/target/universal/kafka-manager-<span class="hljs-number">2</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.zip<br></code></pre></td></tr></table></figure><p>启动服务<br>启动zk集群，kafka集群，再启动kafka-manager服务。<br>bin&#x2F;kafka-manager 默认的端口是9000，可通过 -Dhttp.port，指定端口;<br>-Dconfig.file&#x3D;conf&#x2F;application.conf指定配置文件:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">nohup bin/kafka-manager -Dconfig.<span class="hljs-attribute">file</span>=conf/application.conf -Dhttp.<span class="hljs-attribute">port</span>=9000 &amp;<br></code></pre></td></tr></table></figure><p>WebUI查看：<a href="http://kafka_ip:9000/">http://KAFKA_IP:9000/</a> 出现如下界面则启动成功。</p>]]></content>
    
    
    <categories>
      
      <category>Kafka</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kafka</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JMX开启kafka</title>
    <link href="/2019/11/21/linux/jmx_kafka/"/>
    <url>/2019/11/21/linux/jmx_kafka/</url>
    
    <content type="html"><![CDATA[<p><strong>开启JMX</strong></p><p>kafka开启JMX的2种方式：<br>1.启动kafka时增加JMX_PORT&#x3D;9988，即</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">JMX_PORT=<span class="hljs-number">9988</span> bin/kafka-<span class="hljs-keyword">server</span>-<span class="hljs-keyword">start</span>.sh -daemon config/<span class="hljs-keyword">server</span>.properties<br></code></pre></td></tr></table></figure><p>2.修改kafka-run-class.sh脚本，第一行增加JMX_PORT&#x3D;9988即可。</p><p>事实上这两种配置方式背后的原理是一样的，<br>我们看一下kafka的启动脚本kafka-server-start.sh的最后一行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">exec</span> <span class="hljs-variable">$base_dir</span>/kafka-run-class.sh <span class="hljs-variable">$EXTRA_ARGS</span> kafka.Kafka<span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span><br></code></pre></td></tr></table></figure><p>实际上就是调用kafka-run-class.sh脚本，其中有一段这样的内容：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># JMX port to use</span><br><span class="hljs-attribute">if</span> [  <span class="hljs-variable">$JMX_PORT</span> ]; <span class="hljs-attribute">then</span><br>  KAFKA_JMX_OPTS=<span class="hljs-string">&quot;<span class="hljs-variable">$KAFKA_JMX_OPTS</span> -Dcom.sun.management.jmxremote.port=<span class="hljs-variable">$JMX_PORT</span> &quot;</span><br>fi<br></code></pre></td></tr></table></figure><p>所以，本质是给参数JMX_PORT赋值，第二种方式在脚本的第一行增加JMX_PORT&#x3D;9988，$JMX_PORT就能取到值；而第一种方式有点逼格，本质是设置环境变量然后执行启动脚本，类似下面这种方式给JMX_PORT赋值：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">[root@kafka]$ </span><span class="language-bash"><span class="hljs-built_in">export</span> JMX_PORT=9988</span><br><span class="hljs-meta prompt_">[root@kafka]$ </span><span class="language-bash">bin/kafka-server-start.sh -daemon config/server.properties</span><br></code></pre></td></tr></table></figure><p>jmx所有相关参数都在脚本kafka-run-class.sh中，如下所示：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># JMX settings</span><br><span class="hljs-attribute">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$KAFKA_JMX_OPTS</span>&quot;</span> ]; <span class="hljs-attribute">then</span><br>  KAFKA_JMX_OPTS=<span class="hljs-string">&quot;-Dcom.sun.management.jmxremote -Djava.rmi.server.hostname=10.0.55.229 -Dcom.sun.management.jmxremote.authenticate=false  -Dcom.sun.management.jmxremote.ssl=false &quot;</span><br>fi<br><br><span class="hljs-comment"># JMX port to use</span><br>if [  <span class="hljs-variable">$JMX_PORT</span> ]; <span class="hljs-attribute">then</span><br>  KAFKA_JMX_OPTS=<span class="hljs-string">&quot;<span class="hljs-variable">$KAFKA_JMX_OPTS</span> -Dcom.sun.management.jmxremote.port=<span class="hljs-variable">$JMX_PORT</span> &quot;</span><br>fi<br></code></pre></td></tr></table></figure><p>某些服务器可能无法正确绑定ip，这时候我们需要显示指定绑定的host：-</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">Djava.rmi.server.hostname</span>=<span class="hljs-number">192.100</span>.<span class="hljs-number">200.46</span><br></code></pre></td></tr></table></figure><p><strong>jconsole连接</strong></p><p>配置好jmx并启动kafka后，可以启动jconsole验证jmx配置是否正确（连接远程进程的host就是参数java.rmi.server.hostname指定的值，port就是参数JMX_PORT指定的值）：</p><p>JMX开启远程访问（包括kafka启动）：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">sudo  KAFKA_JMX_OPTS=&quot;-Dcom.sun.management.jmxremote=true -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=192.100.200.46 -Djava.net.preferIPv4Stack=true -Dcom.sun.management.jmxremote.port=9988&quot; bin/kafka-<span class="hljs-keyword">server</span>-<span class="hljs-keyword">start</span>.sh config/<span class="hljs-keyword">server</span>.properties<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Kafka</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kafka</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CentOS7安装kafka</title>
    <link href="/2019/11/19/linux/kafka/"/>
    <url>/2019/11/19/linux/kafka/</url>
    
    <content type="html"><![CDATA[<h3 id="安装准备"><a href="#安装准备" class="headerlink" title="安装准备"></a>安装准备</h3><p><strong>基于Centos7.5 1804 minimal</strong></p><h3 id="安装JDK1-8"><a href="#安装JDK1-8" class="headerlink" title="安装JDK1.8"></a>安装JDK1.8</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">yum</span> -y install java-<span class="hljs-number">1</span>.<span class="hljs-number">8</span>.<span class="hljs-number">0</span>-openjdk*<br></code></pre></td></tr></table></figure><h3 id="安装kafka"><a href="#安装kafka" class="headerlink" title="安装kafka"></a>安装kafka</h3><p>下载kafka</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">wget</span> http://mirrors.tuna.tsinghua.edu.cn/apache/kafka/<span class="hljs-number">2</span>.<span class="hljs-number">3</span>.<span class="hljs-number">0</span>/kafka_2.<span class="hljs-number">12</span>-<span class="hljs-number">2</span>.<span class="hljs-number">3</span>.<span class="hljs-number">0</span>.tgz<br></code></pre></td></tr></table></figure><p>解压</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">tar</span> -zxvf kafka_2.<span class="hljs-number">12</span>-<span class="hljs-number">2</span>.<span class="hljs-number">3</span>.<span class="hljs-number">0</span>.tgz<br></code></pre></td></tr></table></figure><p>修改配置，使kafka远程访问</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs arduino">vi config/server.properties<br><br><span class="hljs-meta"># listeners=PLAINTEXT:<span class="hljs-comment">//:9092</span></span><br>-&gt;<br>listeners=PLAINTEXT:<span class="hljs-comment">//KAFKA_IP:9092</span><br></code></pre></td></tr></table></figure><h3 id="启动kafka"><a href="#启动kafka" class="headerlink" title="启动kafka"></a>启动kafka</h3><p>进入kafka目录</p><p><code>cd kafka_2.12-2.3.0</code></p><p>启动zookeeper</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bin/zookeeper-server-start.sh -daemon config/zookeeper.properties<br></code></pre></td></tr></table></figure><p>检查zookeeper端口2181是否正常监听</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">netstat</span> -an|grep <span class="hljs-number">2181</span><br><span class="hljs-attribute">tcp6</span>       <span class="hljs-number">0</span>      <span class="hljs-number">0</span> :::<span class="hljs-number">2181</span>                 :::*                    LISTEN<br></code></pre></td></tr></table></figure><p>检查kafka默认的JVM参数配置是否需要修改</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Kafka</span>默认设置<span class="hljs-number">1</span>G，即”-Xmx1G -Xms1G”。<br></code></pre></td></tr></table></figure><p>如果你的测试机内存较低，需要修改才能成功启动。<br>参数配置位于：bin&#x2F;kafka-server-start.sh</p><p>启动Kafka</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">bin/kafka-<span class="hljs-keyword">server</span>-<span class="hljs-keyword">start</span>.sh config/<span class="hljs-keyword">server</span>.properties<br></code></pre></td></tr></table></figure><p>如果一切顺利，就会看到如下启动成功的日志：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs elixir">[<span class="hljs-number">2019</span><span class="hljs-number">-11</span><span class="hljs-number">-18</span> <span class="hljs-number">21</span><span class="hljs-symbol">:</span><span class="hljs-number">42</span><span class="hljs-symbol">:</span><span class="hljs-number">37</span>,<span class="hljs-number">067</span>] <span class="hljs-title class_">INFO</span> [<span class="hljs-title class_">KafkaServer</span> id=<span class="hljs-number">0</span>] started (kafka.server.<span class="hljs-title class_">KafkaServer</span>)<br>检查<span class="hljs-title class_">Kafka</span>的端口<span class="hljs-number">9092</span>监听是否正常<br><br>[root<span class="hljs-variable">@localhost</span> kafka_2.<span class="hljs-number">12</span><span class="hljs-number">-2.3</span>.<span class="hljs-number">0</span>]<span class="hljs-comment"># netstat -an|grep 9092</span><br>tcp6       <span class="hljs-number">0</span>      <span class="hljs-number">0</span> ::<span class="hljs-symbol">:</span><span class="hljs-number">9092</span>                 ::<span class="hljs-symbol">:*</span>                    <span class="hljs-title class_">LISTEN</span><br></code></pre></td></tr></table></figure><h3 id="测试kafka"><a href="#测试kafka" class="headerlink" title="测试kafka"></a>测试kafka</h3><p>创建一个测试主题</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">cd</span> kafka_2.<span class="hljs-number">12</span>-<span class="hljs-number">2</span>.<span class="hljs-number">3</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">bin</span>/kafka-topics.sh --create --zookeeper localhost:<span class="hljs-number">2181</span> --replication-factor <span class="hljs-number">1</span> --partitions <span class="hljs-number">1</span> --topic test<br><br><span class="hljs-attribute">Created</span> topic <span class="hljs-string">&quot;test&quot;</span>.<br></code></pre></td></tr></table></figure><p>查看刚刚创建的test主题</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">bin/kafka-topics<span class="hljs-selector-class">.sh</span> <span class="hljs-attr">--list</span> <span class="hljs-attr">--zookeeper</span> localhost:<span class="hljs-number">2181</span><br><br>test<br></code></pre></td></tr></table></figure><p>向刚刚创建的test主题中写入数据</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">bin/kafka-console-producer<span class="hljs-selector-class">.sh</span> <span class="hljs-attr">--broker-list</span> localhost:<span class="hljs-number">9092</span> <span class="hljs-attr">--topic</span> test<br>&gt;Hello, World!<br>&gt;<br>“Hello World!”为写入的数据。<br></code></pre></td></tr></table></figure><p>查看刚刚写入的数据<br>另外开一个ssh tab连接，然后执行如下命令</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">bin/kafka-console-consumer.sh <span class="hljs-comment">--zookeeper localhost:2181 --topic test --from-beginning</span><br><span class="hljs-keyword">Using</span> the ConsoleConsumer <span class="hljs-keyword">with</span> <span class="hljs-built_in">old</span> consumer <span class="hljs-keyword">is</span> deprecated <span class="hljs-keyword">and</span> will be removed <span class="hljs-keyword">in</span> a future major <span class="hljs-keyword">release</span>. Consider <span class="hljs-keyword">using</span> the <span class="hljs-built_in">new</span> consumer <span class="hljs-keyword">by</span> <span class="hljs-keyword">passing</span> [bootstrap-<span class="hljs-keyword">server</span>] <span class="hljs-keyword">instead</span> <span class="hljs-keyword">of</span> [zookeeper].<br><br>Hello, World!<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CentOS网卡配置文件设置为网桥模式</title>
    <link href="/2019/11/08/linux/ovs_bridge/"/>
    <url>/2019/11/08/linux/ovs_bridge/</url>
    
    <content type="html"><![CDATA[<p>原eth0配置文件</p><p><em><strong>&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-eth0</strong></em></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">TYPE</span>=Ethernet<br><span class="hljs-attr">PROXY_METHOD</span>=none<br><span class="hljs-attr">BROWSER_ONLY</span>=<span class="hljs-literal">no</span><br><span class="hljs-attr">BOOTPROTO</span>=static<br><span class="hljs-attr">DEFROUTE</span>=<span class="hljs-literal">no</span><br><span class="hljs-attr">IPV4_FAILURE_FATAL</span>=<span class="hljs-literal">no</span><br><span class="hljs-attr">NAME</span>=eth0<br><span class="hljs-attr">UUID</span>=<span class="hljs-number">63754</span>cd8-<span class="hljs-number">9152</span>-<span class="hljs-number">44</span>a4-b051-ea88c0182bd4<br><span class="hljs-attr">DEVICE</span>=eth0<br><span class="hljs-attr">ONBOOT</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attr">IPADDR</span>=<span class="hljs-number">191.100</span>.<span class="hljs-number">200.30</span><br><span class="hljs-attr">NETMASK</span>=<span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-attr">GATEWAY</span>=<span class="hljs-number">192.100</span>.<span class="hljs-number">10.161</span><br></code></pre></td></tr></table></figure><p>改成网桥配置后,eth0配置文件及br-provider网桥配置文件</p><p><em><strong>&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-eth0</strong></em></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">TYPE</span>=OVSPort<br><span class="hljs-attr">DEVICETYPE</span>=ovs<br><span class="hljs-attr">NAME</span>=eth0<br><span class="hljs-attr">UUID</span>=<span class="hljs-number">63754</span>cd8-<span class="hljs-number">9152</span>-<span class="hljs-number">44</span>a4-b051-ea88c0182bd4<br><span class="hljs-attr">DEVICE</span>=eth0<br><span class="hljs-attr">ONBOOT</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attr">IPADDR</span>=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><br><span class="hljs-attr">NETMASK</span>=<span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-attr">OVS_BRIDGE</span>=br-provider<br></code></pre></td></tr></table></figure><p><em><strong>&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-br-provider</strong></em></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">DEVICE</span>=br-provider<br><span class="hljs-attr">DEVICETYPE</span>=ovs<br><span class="hljs-attr">TYPE</span>=OVSBridge<br><span class="hljs-attr">BOOTPROTO</span>=static<br><br><span class="hljs-attr">IPADDR</span>=<span class="hljs-number">192.100</span>.<span class="hljs-number">200.30</span><br><span class="hljs-attr">NETMASK</span>=<span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-attr">GATEWAY</span>=<span class="hljs-number">192.100</span>.<span class="hljs-number">10.161</span><br><span class="hljs-attr">ONBOOT</span>=<span class="hljs-literal">yes</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>构建openstack Queens版本本地yum源</title>
    <link href="/2019/10/24/openstack/yum/"/>
    <url>/2019/10/24/openstack/yum/</url>
    
    <content type="html"><![CDATA[<p>选择一台CentOS服务器，安装以下软件：</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> yum-utils createrepo yum-plugin-priorities httpd<br></code></pre></td></tr></table></figure><p>开启httpd服务</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">systemctl <span class="hljs-literal">start</span> httpd<br></code></pre></td></tr></table></figure><p>获取repo文件并使用reposync同步源</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">yum install -y https:<span class="hljs-regexp">//</span>repos.fedorapeople.org<span class="hljs-regexp">/repos/</span>openstack<span class="hljs-regexp">/openstack-queens/</span>rdo-release-queens-<span class="hljs-number">2</span>.noarch.rpm<br></code></pre></td></tr></table></figure><p>查看源ID列表</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">yum repolist</span><br></code></pre></td></tr></table></figure><p>同步openstack-queens这个repo</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-keyword">cd</span> <span class="hljs-string">/var/www/html/</span><br>reposync <span class="hljs-params">--repoid=openstack-queens</span><br></code></pre></td></tr></table></figure><p>第一次同步时间较长，同步结束后，执行</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">createrepo –update <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>openstack-queens<br></code></pre></td></tr></table></figure><p>创建完成后，就可以使用web测试：<br>http:&#x2F;&#x2F;[ip]&#x2F;openstack-queens&#x2F;<br>选择另外一台服务器作为客户机</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">cd /etc/yum<span class="hljs-selector-class">.repos</span><span class="hljs-selector-class">.d</span><br>mv CentOS-Base<span class="hljs-selector-class">.repo</span> CentOS-Base<span class="hljs-selector-class">.repo_bak</span><br>cp CentOS-Media<span class="hljs-selector-class">.repo</span> CentOS-Media.repo_bak<br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">vim CentOS-Media.repo<br><br>[openstack-queens]<br><span class="hljs-attribute">name</span>=OpenStack Queens Repository<br><span class="hljs-attribute">baseurl</span>=http://47.98.122.105/openstack-queens/<br><span class="hljs-attribute">enabled</span>=1<br><span class="hljs-attribute">gpgcheck</span>=0<br></code></pre></td></tr></table></figure><p>配置完成，清除缓存并查看软件包</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">yum clean <span class="hljs-keyword">all</span><br></code></pre></td></tr></table></figure><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">yum list</span><br></code></pre></td></tr></table></figure><p><strong>问题</strong></p><p>客户端yum安装报错：</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs subunit"><span class="hljs-keyword">Error </span>downloading packages:<br>  glusterfs-libs<span class="hljs-string">-7</span>.5<span class="hljs-string">-1</span>.el7.x86_64: failed to retrieve Packages/g/glusterfs-libs<span class="hljs-string">-7</span>.5<span class="hljs-string">-1</span>.el7.x86_64.rpm from centos7-gluster<br><span class="hljs-keyword">error </span>was [Errno 2] Local file does not exist: /etc/yum.repos.d/pdate/Packages/g/glusterfs-libs<span class="hljs-string">-7</span>.5<span class="hljs-string">-1</span>.el7.x86_64.rpm<br>  glusterfs<span class="hljs-string">-7</span>.5<span class="hljs-string">-1</span>.el7.x86_64: failed to retrieve Packages/g/glusterfs<span class="hljs-string">-7</span>.5<span class="hljs-string">-1</span>.el7.x86_64.rpm from centos7-gluster<br><span class="hljs-keyword">error </span>was [Errno 2] Local file does not exist: /etc/yum.repos.d/pdate/Packages/g/glusterfs<span class="hljs-string">-7</span>.5<span class="hljs-string">-1</span>.el7.x86_64.rpm<br></code></pre></td></tr></table></figure><p>问题解决：<br>YUM服务器删除对应的repodata文件夹，使用如下命令</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">createrepo -pdo <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>kdpa<span class="hljs-regexp">/ /</span><span class="hljs-keyword">var</span><span class="hljs-regexp">/www/</span>html<span class="hljs-regexp">/kdpa/</span><br></code></pre></td></tr></table></figure><p>重新生成repo链接，问题解决</p>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Openstack 扩大 RabbitMQ Socket Limit 方法</title>
    <link href="/2019/10/15/openstack/rabbitmq_socket/"/>
    <url>/2019/10/15/openstack/rabbitmq_socket/</url>
    
    <content type="html"><![CDATA[<p>在RabbitMQ中，Socket descriptors 是 File descriptors 的子集，它们也是一对此消彼长的关系。<br>然而，它们的默认配额并不大，File descriptors 默认值为“1024”，而 Socket descriptors 的默认值也只有“829”，同时，File descriptors 所能打开的最大文件数也受限于操作系统的配额。<br>因此，如果要调整 File descriptors 文件句柄数，就需要同时调整操作系统和RabbitMQ参数。</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">[root@controller ~]# rabbitmqctl status</span><br><span class="language-xml">Status of node rabbit@controller</span><br><span class="language-xml">[</span><span class="hljs-template-variable">&#123;pid,3407&#125;</span><span class="language-xml">,</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;running_applications,</span><br><span class="hljs-template-variable">     [&#123;rabbit,&quot;RabbitMQ&quot;,&quot;3.6.16&quot;&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;rabbit_common,</span><br><span class="hljs-template-variable">          &quot;Modules shared by rabbitmq-server and rabbitmq-erlang-client&quot;,</span><br><span class="hljs-template-variable">          &quot;3.6.16&quot;&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;xmerl,&quot;XML parser&quot;,&quot;1.3.14&quot;&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;ranch,&quot;Socket acceptor pool for TCP protocols.&quot;,&quot;1.3.2&quot;&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.14.3&quot;&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;syntax_tools,&quot;Syntax tools&quot;,&quot;2.1.1&quot;&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;ssl,&quot;Erlang/OTP SSL application&quot;,&quot;8.1.3.1&quot;&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;os_mon,&quot;CPO  CXC 138 46&quot;,&quot;2.4.2&quot;&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;public_key,&quot;Public key infrastructure&quot;,&quot;1.4&quot;&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;crypto,&quot;CRYPTO&quot;,&quot;3.7.4&quot;&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;asn1,&quot;The Erlang ASN1 compiler version 4.0.4&quot;,&quot;4.0.4&quot;&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;recon,&quot;Diagnostic tools for production use&quot;,&quot;2.3.2&quot;&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;compiler,&quot;ERTS  CXC 138 10&quot;,&quot;7.0.4.1&quot;&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;sasl,&quot;SASL  CXC 138 11&quot;,&quot;3.0.3&quot;&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;stdlib,&quot;ERTS  CXC 138 10&quot;,&quot;3.3&quot;&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;kernel,&quot;ERTS  CXC 138 10&quot;,&quot;5.2&quot;&#125;</span><span class="language-xml">]&#125;,</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;os,&#123;unix,linux&#125;</span><span class="language-xml">&#125;,</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;erlang_version,</span><br><span class="hljs-template-variable">     &quot;Erlang/OTP 19 [erts-8.3.5.3] [source] [64-bit] [smp:96:96] [async-threads:1024] [hipe] [kernel-poll:true]\n&quot;&#125;</span><span class="language-xml">,</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;memory,</span><br><span class="hljs-template-variable">     [&#123;connection_readers,20241544&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;connection_writers,1200000&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;connection_channels,4846312&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;connection_other,53785896&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;queue_procs,6683888&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;queue_slave_procs,0&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;plugins,0&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;other_proc,23512680&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;metrics,2466240&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;mgmt_db,0&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;mnesia,847160&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;other_ets,3015688&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;binary,1999169528&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;msg_index,176072&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;code,21467691&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;atom,891849&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;other_system,75976100&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;allocated_unused,483082808&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;reserved_unallocated,0&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;total,766799872&#125;</span><span class="language-xml">]&#125;,</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;alarms,[]&#125;</span><span class="language-xml">,</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;listeners,[&#123;clustering,25672,&quot;::&quot;&#125;</span><span class="language-xml">,</span><span class="hljs-template-variable">&#123;amqp,5672,&quot;::&quot;&#125;</span><span class="language-xml">]&#125;,</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;vm_memory_calculation_strategy,rss&#125;</span><span class="language-xml">,</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;vm_memory_high_watermark,0.4&#125;</span><span class="language-xml">,</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;vm_memory_limit,53742133248&#125;</span><span class="language-xml">,</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;disk_free_limit,50000000&#125;</span><span class="language-xml">,</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;disk_free,996377710592&#125;</span><span class="language-xml">,</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;file_descriptors,</span><br><span class="hljs-template-variable">     [&#123;total_limit,878&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;total_used,776&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;sockets_limit,829&#125;</span><span class="language-xml">,</span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;sockets_used,774&#125;</span><span class="language-xml">]&#125;,</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;processes,[&#123;limit,1048576&#125;</span><span class="language-xml">,</span><span class="hljs-template-variable">&#123;used,9483&#125;</span><span class="language-xml">]&#125;,</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;run_queue,0&#125;</span><span class="language-xml">,</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;uptime,161034&#125;</span><span class="language-xml">,</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;kernel,&#123;net_ticktime,60&#125;</span><span class="language-xml">&#125;]</span><br></code></pre></td></tr></table></figure><h3 id="修改系统内核参数"><a href="#修改系统内核参数" class="headerlink" title="修改系统内核参数"></a>修改系统内核参数</h3><p><strong>系统级别</strong></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">vim</span> /etc/sysctl.<span class="hljs-keyword">conf</span><br><br>fs.<span class="hljs-keyword">file</span>-<span class="hljs-built_in">max</span>=<span class="hljs-number">655350</span><br>sysctl -<span class="hljs-keyword">p</span> | <span class="hljs-keyword">grep</span> <span class="hljs-keyword">file</span>-<span class="hljs-built_in">max</span><br></code></pre></td></tr></table></figure><p><strong>用户级别</strong></p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stata">vim /etc/security/limits.<span class="hljs-keyword">conf</span><br><br><span class="hljs-comment">* soft nofile 65535</span><br><span class="hljs-comment">* hard nofile 65535</span><br><span class="hljs-comment">* soft nproc 65535</span><br><span class="hljs-comment">* hard nproc 65535</span><br></code></pre></td></tr></table></figure><h3 id="修改rabbitmq配置"><a href="#修改rabbitmq配置" class="headerlink" title="修改rabbitmq配置"></a>修改rabbitmq配置</h3><p>如果是以systemd方式管理rabbitmq服务，则需要修改rabbitmq的service文件。</p><p>vim &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;rabbitmq-server.service<br>添加如下参数，其值请根据实际情况进行调整：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Service]</span><br><span class="hljs-attr">LimitNOFILE</span>=<span class="hljs-number">16384</span><br></code></pre></td></tr></table></figure><p>重启rabbitmq即可：</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-params">system</span>ctl daemon-reload<br><span class="hljs-params">system</span>ctl restart rabbitmq-server<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>rabbitmq</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rabbitmq</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Chrony - 一步搞定NTP时间同步问题</title>
    <link href="/2019/09/24/linux/chrony/"/>
    <url>/2019/09/24/linux/chrony/</url>
    
    <content type="html"><![CDATA[<h2 id="什么是chrony？"><a href="#什么是chrony？" class="headerlink" title="什么是chrony？"></a>什么是chrony？</h2><p>A client&#x2F;server for the Network Time Protocol, this program keeps your computer’s clock accurate. It was specially designed to support systems with intermittent internet connections, but it also works well in permanently connected environments. It can use also hardware reference clocks, system real-time clock or manual input as time references.<br>chrony是一个ntp协议的实现程序，既可以当做服务端，也可以充当客户端；它专为间歇性互联网连接的系统而设计，当然也能良好应用于持久互联网连接的环境；chrony有三个时间参考：硬件时钟、实时时钟以及手动同步。</p><h2 id="chrony的程序环境"><a href="#chrony的程序环境" class="headerlink" title="chrony的程序环境"></a>chrony的程序环境</h2><p>主配置文件：&#x2F;etc&#x2F;chrony.conf<br>客户端程序：&#x2F;usr&#x2F;bin&#x2F;chronyc<br>服务端程序：&#x2F;usr&#x2F;sbin&#x2F;chronyd</p><h2 id="为本地服务器配置一个时间服务器"><a href="#为本地服务器配置一个时间服务器" class="headerlink" title="为本地服务器配置一个时间服务器"></a>为本地服务器配置一个时间服务器</h2><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><p>时间服务器：192.168.1.10<br>允许本网段192.168.1.0&#x2F;24同步时间。</p><h3 id="配置服务端"><a href="#配置服务端" class="headerlink" title="配置服务端"></a>配置服务端</h3><p>在编辑配置文件之前，我一般习惯于备份一下，以备重新调整。<br>网络时间服务器可以自行查找，网上很多资料，下边配置两个个国内常用的时间服务器：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">]# </span><span class="language-bash"><span class="hljs-built_in">cd</span> /etc/</span><br><span class="hljs-meta prompt_">etc]# </span><span class="language-bash"><span class="hljs-built_in">cp</span> chrony.conf&#123;,.bak&#125;</span><br><span class="hljs-meta prompt_">etc]# </span><span class="language-bash">vim chrony.conf</span><br>…<br></code></pre></td></tr></table></figure><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-comment">#  iburst为固定格式，记住就可以，没有深究。</span><br>server cn.pool.ntp.org iburst<br>server tw.pool.ntp.org iburst<br><span class="hljs-string">...</span><br><span class="hljs-comment"># 允许指定网络的主机同步时间，不指定就是允许所有，默认不开启。</span><br>allow 192.168.1.0/24<br><span class="hljs-string">...</span><br><span class="hljs-comment"># 还有一个默认不开启的选项，意思是，即使服务端没有同步到精确的网络时间，也允许向客户端同步不精确的时间。可以视情况而定。</span><br><span class="hljs-comment"># Serve time even if not synchronized to any NTP server.</span><br><span class="hljs-comment">#local stratum 10</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">~]# </span><span class="language-bash">systemctl start chronyd.service</span><br><span class="hljs-meta prompt_">~]# </span><span class="language-bash">systemctl <span class="hljs-built_in">enable</span> chronyd.service</span><br></code></pre></td></tr></table></figure><h3 id="客户端同步"><a href="#客户端同步" class="headerlink" title="客户端同步"></a>客户端同步</h3><p>配置192.168.1.10作为时间服务器</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs axapta">etc]<span class="hljs-meta"># vim chrony.conf</span><br>…<br><span class="hljs-keyword">server</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.10</span> iburst<br>…<br>~]<span class="hljs-meta"># systemctl start chronyd.service</span><br>~]<span class="hljs-meta"># systemctl enable chronyd.service</span><br></code></pre></td></tr></table></figure><p>进入chronyc客户端交互式模式：<br><code>~]# chronyc</code></p><p>查看现有的时间服务器</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">chronyc&gt; sources<br>210 Number of sources = 1<br><br><span class="hljs-section">MS Name/IP address         Stratum Poll Reach LastRx Last sample</span><br><span class="hljs-section">===============================================================================</span><br>^* 192.168.1.10               10   6   377    53  -4546ns[-5000ns] +/-  234us<br></code></pre></td></tr></table></figure><p>查看时间服务器状态</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">chronyc&gt; sourcestats<br><span class="hljs-number">210</span> Number of sources = <span class="hljs-number">1</span><br><br>    Name/IP Address            NP  NR  Span  Frequency  Freq Skew  Offset  Std Dev<br>    ==============================================================================<br>    <span class="hljs-number">192.168</span>.<span class="hljs-number">1.10</span>               <span class="hljs-number">10</span>   <span class="hljs-number">6</span>   <span class="hljs-number">584</span>     +<span class="hljs-number">0.001</span>      <span class="hljs-number">0.828</span>    +<span class="hljs-number">35</span>ns    <span class="hljs-number">74</span>us<br><br>chronyc&gt;<span class="hljs-keyword">exit</span><br></code></pre></td></tr></table></figure><p>也可以直接在命令行使用：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">~]<span class="hljs-comment"># chronyc sources</span><br>~]<span class="hljs-comment"># chronyc sourcestats</span><br></code></pre></td></tr></table></figure><p>chrony兼容ntpdate，客户端可以使用ntpdate手动同步时间</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">~]<span class="hljs-comment"># ntpdate 192.168.1.10</span><br> <span class="hljs-number">9</span> Nov <span class="hljs-number">02</span>:<span class="hljs-number">54</span>:<span class="hljs-number">30</span> ntpdate[<span class="hljs-number">39551</span>]: adjust <span class="hljs-built_in">time</span> server <span class="hljs-number">192.168</span><span class="hljs-number">.43</span><span class="hljs-number">.101</span> <span class="hljs-built_in">offset</span> <span class="hljs-number">-0.000003</span> <span class="hljs-built_in">sec</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>collectd + influxDB + Grafana 搭建监控平台</title>
    <link href="/2019/08/06/other/monitor/"/>
    <url>/2019/08/06/other/monitor/</url>
    
    <content type="html"><![CDATA[<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>常用配置：<br>influxdb + grafana安装在一台机器负责监控数据收集及展示<br>collectd安装在一台或多台被监控服务端,跟监控端的25826端口对接，上传本地监控的数据<br>influxdb监控25826端口以获得数据，自身处于8086端口，grafana从8086获得数据进行展示</p><ul><li>InfluxDB 是 Go 语言开发的一个开源分布式时序数据库，非常适合存储指标、事件、分析等数据</li><li>collectd C 语言写的一个系统性能采集工具</li><li>Grafana 是纯 Javascript 开发的前端工具，用于访问 InfluxDB，自定义报表、显示图表等</li></ul><p>本次安装版本</p><ul><li>collectd 5.8.1</li><li>influxDB 1.7.7</li><li>Grafana 6.2.5</li></ul><h2 id="Collectd"><a href="#Collectd" class="headerlink" title="Collectd"></a>Collectd</h2><p>collectd是一个守护(daemon)进程，用来收集系统性能和提供各种存储方式来存储不同值的机制。比如以RRD 文件形式，当系统运行和存储信息的时候，Collectd会周期性统计系统的相关统计信息。那些信息可以用来找到当前系统性能瓶颈。（如作为性能分析 performance analysis）和预测系统未来的load（如能力部署capacity planning）</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># yum install -y collectd</span><br></code></pre></td></tr></table></figure><h3 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><span class="hljs-comment"># vim /etc/collectd.conf</span><br><span class="hljs-comment">#更改以下内容，前面的#记得删除掉 没有就使用find / -name collectd.conf 查找在哪里</span><br><br>  FQDNLookup   true<br>  Hostname    <span class="hljs-string">&quot;localhost&quot;</span> <span class="hljs-comment">#直接使用hostname命令查看</span><br>  BaseDir     <span class="hljs-string">&quot;/var/lib/collectd&quot;</span><br>  PIDFile     <span class="hljs-string">&quot;/var/run/collectd.pid&quot;</span><br>  PluginDir   <span class="hljs-string">&quot;/usr/lib64/collectd&quot;</span><br>  TypesDB     <span class="hljs-string">&quot;/usr/share/collectd/types.db&quot;</span><br>  LoadPlugin  syslog<br>  LoadPlugin rrdtool<br>  LoadPlugin disk<br>  LoadPlugin interface<br>  LoadPlugin load<br>  LoadPlugin memory<br>  LoadPlugin network<br>  LoadPlugin processes<br>  LoadPlugin users<br>  <span class="hljs-variable">&lt;Plugin interface&gt;</span><br>          Interface <span class="hljs-string">&quot;eth0&quot;</span><br>          IgnoreSelected false<br>  <span class="hljs-variable">&lt;/Plugin&gt;</span><br>  <span class="hljs-variable">&lt;Plugin network&gt;</span><br>          Server <span class="hljs-string">&quot;127.0.0.1&quot;</span> <span class="hljs-string">&quot;25826&quot;</span> <span class="hljs-comment">#这里填写的是influxDB安装的服务器ip</span><br>  <span class="hljs-variable">&lt;Plugin rrdtool&gt;</span><br>          DataDir <span class="hljs-string">&quot;/usr/var/lib/collectd/rrd&quot;</span> <span class="hljs-comment">#如果你是使用下载安装前面应该会多出一个$&#123;prefix&#125;,未尝试是否有影响</span><br>  <span class="hljs-variable">&lt;/Plugin&gt;</span><br></code></pre></td></tr></table></figure><h3 id="安装rrdtool插及依赖包"><a href="#安装rrdtool插及依赖包" class="headerlink" title="安装rrdtool插及依赖包"></a>安装rrdtool插及依赖包</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># yum install collectd-rrdtool rrdtool rrdtool-devel</span><br></code></pre></td></tr></table></figure><h3 id="启动collectd"><a href="#启动collectd" class="headerlink" title="启动collectd"></a>启动collectd</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl start collectd.service <span class="hljs-comment">#启动</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl <span class="hljs-built_in">enable</span> collectd.service <span class="hljs-comment">#配置开机自启</span></span><br></code></pre></td></tr></table></figure><h3 id="确认配置是否成功"><a href="#确认配置是否成功" class="headerlink" title="确认配置是否成功"></a>确认配置是否成功</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">cd</span> /var/lib/collectd</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">ls</span></span><br>rrd<br></code></pre></td></tr></table></figure><p>如果&#x2F;var&#x2F;lib&#x2F;collectd目录下生成rrd文件，说明有数据了，如果没有应该是配置问题</p><h2 id="Influxdb"><a href="#Influxdb" class="headerlink" title="Influxdb"></a>Influxdb</h2><h3 id="配置yum源"><a href="#配置yum源" class="headerlink" title="配置yum源"></a>配置yum源</h3><p>配置yum(此方法为最新版本InfluxDB)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF | sudo tee /etc/yum.repos.d/influxdb.repo</span></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash"><span class="hljs-string">[influxdb]</span></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash"><span class="hljs-string">name = InfluxDB Repository - RHEL \$releasever</span></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash"><span class="hljs-string">baseurl = https://repos.influxdata.com/rhel/\$releasever/\$basearch/stable</span></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash"><span class="hljs-string">enabled = 1</span></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash"><span class="hljs-string">gpgcheck = 1</span></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash"><span class="hljs-string">gpgkey = https://repos.influxdata.com/influxdb.key</span></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash"><span class="hljs-string">EOF</span></span><br></code></pre></td></tr></table></figure><h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># yum install -y influxdb</span><br></code></pre></td></tr></table></figure><h3 id="启动InfluxDB"><a href="#启动InfluxDB" class="headerlink" title="启动InfluxDB"></a>启动InfluxDB</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl start influxdb.service<span class="hljs-comment">#启动</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl <span class="hljs-built_in">enable</span> influxdb.service <span class="hljs-comment">#配置influxdb开机自启</span></span><br></code></pre></td></tr></table></figure><p>启动后TCP端口:8083 为InfluxDB 管理控制台<br>TCP端口:8086 为客户端和InfluxDB通信时的HTTP API<br>启动后InfluxDB用户认证默认是关闭的，先创建用户:geekwolf geekwolf<br>命令行输入influx</p><h3 id="配置数据库"><a href="#配置数据库" class="headerlink" title="配置数据库"></a>配置数据库</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-comment"># influx #进入InfluxDB</span><br>Connected <span class="hljs-built_in">to</span> <span class="hljs-keyword">http</span>://localhost:<span class="hljs-number">8086</span> <span class="hljs-built_in">version</span> <span class="hljs-number">1.7</span><span class="hljs-number">.7</span><br>InfluxDB <span class="hljs-built_in">shell</span> <span class="hljs-built_in">version</span>: <span class="hljs-number">1.7</span><span class="hljs-number">.7</span><br>&gt; <span class="hljs-built_in">create</span> database collectdb <span class="hljs-comment">#创建数据库</span><br>&gt; show databases <span class="hljs-comment">#查看数据库</span><br>name: databases<br>\<span class="hljs-comment">------</span><br>name<br>collectdb<br>&gt; <span class="hljs-built_in">create</span> user matianxin <span class="hljs-keyword">with</span> password <span class="hljs-string">&#x27;matianxin&#x27;</span> <span class="hljs-comment">#创建一个用户和密码</span><br>&gt; show users <span class="hljs-comment">#查看所有用户</span><br>user            admin<br>matianxin        <span class="hljs-literal">false</span><br>&gt; grant all <span class="hljs-keyword">on</span> <span class="hljs-title">collectdb</span> <span class="hljs-title">to</span> <span class="hljs-title">matianxin</span> #把上面创建的数据库的所有权限赋给<span class="hljs-title">geekwolf</span>用户<br>&gt; help show<br>Usage:<br>    connect &lt;host:port&gt;   connects <span class="hljs-built_in">to</span> another node specified <span class="hljs-keyword">by</span> host:port<br>    auth                  prompts <span class="hljs-keyword">for</span> username <span class="hljs-keyword">and</span> password<br>    pretty                toggles pretty print <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> json <span class="hljs-built_in">format</span><br>    use &lt;db_name&gt;         sets current database<br>    <span class="hljs-built_in">format</span> &lt;<span class="hljs-built_in">format</span>&gt;       specifies <span class="hljs-keyword">the</span> <span class="hljs-built_in">format</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> server responses: json, csv, <span class="hljs-keyword">or</span> column<br>    precision &lt;/<span class="hljs-built_in">format</span>&gt;&lt;<span class="hljs-built_in">format</span>&gt;    specifies <span class="hljs-keyword">the</span> <span class="hljs-built_in">format</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> timestamp: rfc3339, h, m, s, ms, u <span class="hljs-keyword">or</span> ns<br>    consistency &lt;level&gt;   sets <span class="hljs-built_in">write</span> consistency level: <span class="hljs-keyword">any</span>, <span class="hljs-literal">one</span>, quorum, <span class="hljs-keyword">or</span> all<br>    history               displays <span class="hljs-keyword">command</span> <span class="hljs-title">history</span><br>    settings              outputs <span class="hljs-keyword">the</span> current settings <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">shell</span><br>    exit/quit/ctrl+d      quits <span class="hljs-keyword">the</span> influx <span class="hljs-built_in">shell</span><br>    show databases        show database names<br>    show series           show series information<br>    show measurements     show measurement information<br>    show tag <span class="hljs-built_in">keys</span>         show tag key information<br>    show field <span class="hljs-built_in">keys</span>       show field key information<br>    A full list <span class="hljs-keyword">of</span> influxql commands can be found <span class="hljs-keyword">at</span>:<br>    <span class="hljs-keyword">https</span>://docs.influxdata.com/influxdb/v0<span class="hljs-number">.10</span>/query_language/spec<br>&gt; quit <span class="hljs-comment">#退出</span><br></code></pre></td></tr></table></figure><h3 id="启用认证"><a href="#启用认证" class="headerlink" title="启用认证"></a>启用认证</h3><p>修改配置文件启用认证</p><figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs leaf"><span class="hljs-punctuation">#</span> sed -i &#x27;s<span class="hljs-punctuation">#</span><span class="hljs-keyword">auth</span>-enabled = false<span class="hljs-punctuation">#</span><span class="hljs-keyword">auth</span>-enabled = true<span class="hljs-punctuation">#</span><span class="hljs-keyword">g</span>&#x27; /etc/influxdb/influxdb.conf<br><span class="hljs-punctuation">#</span> systemctl restart influxdb.service <span class="hljs-punctuation">#</span>重启influxdb<br></code></pre></td></tr></table></figure><h3 id="配置InfluxDB支持Collectd"><a href="#配置InfluxDB支持Collectd" class="headerlink" title="配置InfluxDB支持Collectd"></a>配置InfluxDB支持Collectd</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># vim /etc/influxdb/influxdb.conf</span><br>  <span class="hljs-section">[collectd]</span><br>  <span class="hljs-attr">enabled</span> = <span class="hljs-literal">true</span><br>  <span class="hljs-attr">bind-address</span> = <span class="hljs-string">&quot;127.0.0.1:25826&quot;</span><br>  <span class="hljs-attr">database</span> = <span class="hljs-string">&quot;collectdb&quot;</span><br>  <span class="hljs-attr">typesdb</span> = <span class="hljs-string">&quot;/usr/share/collectd/types.db&quot;</span> <span class="hljs-comment">#查找一下types.db文件不一定在这个路径，如果路径配置错误就不能监听成功</span><br>  <span class="hljs-attr">batch-size</span> = <span class="hljs-number">5000</span><br>  <span class="hljs-attr">batch-pending</span> = <span class="hljs-number">10</span><br>  <span class="hljs-attr">batch-timeout</span> = <span class="hljs-string">&quot;10s&quot;</span><br>  <span class="hljs-attr">read-buffer</span> = <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clean"># systemctl restart influxdb.service #重启influxdb<br></code></pre></td></tr></table></figure><p>查看25826这个端口是否已经监听，如果有，则代表启动正常</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># netstat -anp| grep 25826</span><br><span class="hljs-attribute">udp</span>    <span class="hljs-number">0</span>   <span class="hljs-number">0</span> <span class="hljs-number">127.0.0.1:25826</span>    <span class="hljs-number">0.0.0.0</span>:*       <span class="hljs-number">2950</span>/influxd<br></code></pre></td></tr></table></figure><h3 id="确认数据"><a href="#确认数据" class="headerlink" title="确认数据"></a>确认数据</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[root@localhost ~]# influx<br>Connected <span class="hljs-keyword">to</span> http://localhost:<span class="hljs-number">8086</span> <span class="hljs-keyword">version</span> <span class="hljs-number">1.7</span><span class="hljs-number">.7</span><br>InfluxDB shell <span class="hljs-keyword">version</span>: <span class="hljs-number">1.7</span><span class="hljs-number">.7</span><br>&gt; use collectdb<br><span class="hljs-keyword">Using</span> <span class="hljs-keyword">database</span> collectdb<br>&gt; <span class="hljs-keyword">show</span> field keys<br><span class="hljs-type">name</span>: cpu_value<br>fieldKey fieldType<br><span class="hljs-comment">-------- ---------</span><br><span class="hljs-keyword">value</span>    <span class="hljs-type">float</span><br><br><span class="hljs-type">name</span>: disk_io_time<br>fieldKey fieldType<br><span class="hljs-comment">-------- ---------</span><br><span class="hljs-keyword">value</span>    <span class="hljs-type">float</span><br><br><span class="hljs-type">name</span>: disk_read<br>fieldKey fieldType<br><span class="hljs-comment">-------- ---------</span><br><span class="hljs-keyword">value</span>    <span class="hljs-type">float</span><br><br><span class="hljs-type">name</span>: disk_value<br>fieldKey fieldType<br><span class="hljs-comment">-------- ---------</span><br><span class="hljs-keyword">value</span>    <span class="hljs-type">float</span><br><br><span class="hljs-type">name</span>: disk_weighted_io_time<br>fieldKey fieldType<br><span class="hljs-comment">-------- ---------</span><br><span class="hljs-keyword">value</span>    <span class="hljs-type">float</span><br><br><span class="hljs-type">name</span>: disk_write<br>fieldKey fieldType<br><span class="hljs-comment">-------- ---------</span><br><span class="hljs-keyword">value</span>    <span class="hljs-type">float</span><br><br><span class="hljs-type">name</span>: interface_rx<br>fieldKey fieldType<br><span class="hljs-comment">-------- ---------</span><br><span class="hljs-keyword">value</span>    <span class="hljs-type">float</span><br><br><span class="hljs-type">name</span>: interface_tx<br>fieldKey fieldType<br><span class="hljs-comment">-------- ---------</span><br><span class="hljs-keyword">value</span>    <span class="hljs-type">float</span><br><br><span class="hljs-type">name</span>: load_longterm<br>fieldKey fieldType<br><span class="hljs-comment">-------- ---------</span><br><span class="hljs-keyword">value</span>    <span class="hljs-type">float</span><br><br><span class="hljs-type">name</span>: load_midterm<br>fieldKey fieldType<br><span class="hljs-comment">-------- ---------</span><br><span class="hljs-keyword">value</span>    <span class="hljs-type">float</span><br><br><span class="hljs-type">name</span>: load_shortterm<br>fieldKey fieldType<br><span class="hljs-comment">-------- ---------</span><br><span class="hljs-keyword">value</span>    <span class="hljs-type">float</span><br><br><span class="hljs-type">name</span>: memory_value<br>fieldKey fieldType<br><span class="hljs-comment">-------- ---------</span><br><span class="hljs-keyword">value</span>    <span class="hljs-type">float</span><br><br><span class="hljs-type">name</span>: processes_value<br>fieldKey fieldType<br><span class="hljs-comment">-------- ---------</span><br><span class="hljs-keyword">value</span>    <span class="hljs-type">float</span><br><br><span class="hljs-type">name</span>: users_value<br>fieldKey fieldType<br><span class="hljs-comment">-------- ---------</span><br><span class="hljs-keyword">value</span>    <span class="hljs-type">float</span><br>&gt;  <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> cpu_value <span class="hljs-keyword">limit</span> <span class="hljs-number">10</span>;<br><span class="hljs-type">name</span>: cpu_value<br><span class="hljs-type">time</span>                host      instance <span class="hljs-keyword">type</span> type_instance <span class="hljs-keyword">value</span><br><span class="hljs-comment">----                ----      -------- ---- ------------- -----</span><br><span class="hljs-number">1565060949576064259</span> localhost <span class="hljs-number">0</span>        cpu  <span class="hljs-keyword">user</span>          <span class="hljs-number">2663</span><br><span class="hljs-number">1565060949576080440</span> localhost <span class="hljs-number">0</span>        cpu  <span class="hljs-keyword">system</span>        <span class="hljs-number">2952</span><br><span class="hljs-number">1565060949576087737</span> localhost <span class="hljs-number">0</span>        cpu  wait          <span class="hljs-number">89</span><br><span class="hljs-number">1565060949576094319</span> localhost <span class="hljs-number">0</span>        cpu  nice          <span class="hljs-number">0</span><br><span class="hljs-number">1565060949576100786</span> localhost <span class="hljs-number">0</span>        cpu  interrupt     <span class="hljs-number">0</span><br><span class="hljs-number">1565060949576106664</span> localhost <span class="hljs-number">0</span>        cpu  softirq       <span class="hljs-number">160</span><br><span class="hljs-number">1565060949576108568</span> localhost <span class="hljs-number">0</span>        cpu  steal         <span class="hljs-number">0</span><br><span class="hljs-number">1565060949576110126</span> localhost <span class="hljs-number">0</span>        cpu  idle          <span class="hljs-number">248067</span><br><span class="hljs-number">1565060959576531164</span> localhost <span class="hljs-number">0</span>        cpu  <span class="hljs-keyword">user</span>          <span class="hljs-number">2664</span><br><span class="hljs-number">1565060959576547037</span> localhost <span class="hljs-number">0</span>        cpu  <span class="hljs-keyword">system</span>        <span class="hljs-number">2955</span><br>&gt;<br></code></pre></td></tr></table></figure><h2 id="Grafana"><a href="#Grafana" class="headerlink" title="Grafana"></a>Grafana</h2><h3 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h3><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs subunit"># wget https://dl.grafana.com/oss/release/grafana<span class="hljs-string">-6</span>.2.5<span class="hljs-string">-1</span>.x86_64.rpm<br># yum localinstall grafana<span class="hljs-string">-6</span>.2.5<span class="hljs-string">-1</span>.x86_64.rpm<br></code></pre></td></tr></table></figure><h3 id="启动grafana"><a href="#启动grafana" class="headerlink" title="启动grafana"></a>启动grafana</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl start grafana-server.service <span class="hljs-comment">#启动</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl <span class="hljs-built_in">enable</span> grafana-server.service <span class="hljs-comment">#配置开机自启</span></span><br></code></pre></td></tr></table></figure><h3 id="配置Grafana"><a href="#配置Grafana" class="headerlink" title="配置Grafana"></a>配置Grafana</h3><p>访问地址:<a href="http://127.0.0.1:3000/">http://127.0.0.1:3000</a> 默认账号为admin 密码 admin</p><h3 id="配置Data-Source"><a href="#配置Data-Source" class="headerlink" title="配置Data Source"></a>配置Data Source</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-type">Name</span>: InfluxDB -&gt; <span class="hljs-keyword">default</span><br>URL: http://localhost:<span class="hljs-number">8086</span><br><span class="hljs-keyword">Access</span>: <span class="hljs-keyword">Server</span>(<span class="hljs-keyword">Default</span>)<br>Basic Auth: √<br>Basic Auth Details<br><span class="hljs-keyword">User</span>: matianxin<br><span class="hljs-keyword">Password</span>: matianxin<br>InfluxDB Details<br><span class="hljs-keyword">Database</span>: collectdb<br>…<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>监控</category>
      
    </categories>
    
    
    <tags>
      
      <tag>监控</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Openstack Queens 环境搭建（十）Ceilometer + Gnocchi</title>
    <link href="/2019/08/02/openstack/queens/openstack_queens_install_10/"/>
    <url>/2019/08/02/openstack/queens/openstack_queens_install_10/</url>
    
    <content type="html"><![CDATA[<h2 id="ceilometer概述"><a href="#ceilometer概述" class="headerlink" title="ceilometer概述"></a>ceilometer概述</h2><hr><h3 id="什么是ceilometer"><a href="#什么是ceilometer" class="headerlink" title="什么是ceilometer"></a>什么是ceilometer</h3><p>Ceilometer是OpenStack中的一个子项目，它像一个漏斗一样，能把OpenStack内部发生的几乎所有的事件都收集起来，然后为计费和监控以及其它服务提供数据支撑。</p><p><strong>Ceilometer服务主要功能：</strong></p><p>有效地轮询与OpenStack服务相关的计量数据。<br>通过监视从服务发送的通知来收集事件和计量数据。<br>将收集的数据发布到各种目标，包括数据存储和消息队列。</p><h3 id="ceilometer如何进行监控"><a href="#ceilometer如何进行监控" class="headerlink" title="ceilometer如何进行监控"></a>ceilometer如何进行监控</h3><p>Ceilometer监控通过在计算节点部署Compute服务，轮询其计算节点上的instance，获取各自的CPU、网络、磁盘等监控信息，发送到RabbitMQ，Collector服务负责接收信息进行持久化存储，也可通过libvirt和openstack服务的API采集数据。</p><h3 id="监控信息存储"><a href="#监控信息存储" class="headerlink" title="监控信息存储"></a>监控信息存储</h3><p>Ceilometer以前提供了存储和API解决方案。截至N版本，此功能已被正式弃用并且不鼓励。<br>为了有效存储和统计分析ceilometer数据，建议使用Gnocchi。<br>采集信息的存储可以有多种，如文件，数据库等，openstack queens版本默认采用gnocchi+文件形式存储。</p><h2 id="gnocchi概述"><a href="#gnocchi概述" class="headerlink" title="gnocchi概述"></a>gnocchi概述</h2><hr><h3 id="gnocchi是什么"><a href="#gnocchi是什么" class="headerlink" title="gnocchi是什么"></a>gnocchi是什么</h3><p>Gnocchi是一个多租户时间序列，计量和资源数据库。<br>提供了HTTP REST接口来创建和操作数据。<br>Gnocchi设计用于超大规模计量数据的存储，同时向操作者和用户提供对度量和资源信息的访问。<br>Gnocchi是OpenStack项目的一部分。因此它支持OpenStack，但也能完全独立的工作。</p><h3 id="gnocchi项目起源"><a href="#gnocchi项目起源" class="headerlink" title="gnocchi项目起源"></a>gnocchi项目起源</h3><p>早期的openstack各类资源的计量数据(measurement) 存储在SQL数据库中的sample表中。随着云环境中需要被监控的资源增多和时间的推移，计量数据的增长变得难以预测；计量数据的使用方面，查询操作首先要从巨大的sample单表中过滤所需条目，然后还会涉及到相关的聚合计算；可想而知，由此带来的性能开销绝对是无法忍受的，并且随着时间的推移这个瓶颈会愈加明显直至奔溃。要解决上述问题方法有很多，比如分表：每个监控指标（Metirc）一张表，那么一个资源可能会有多张表（比如一个instance至少会有cpu，cpu.util，memory，memory.usage，disk.* 等监控指标metrics）；这似乎有点夸张，即使这样都可以接受的话，那么查询时对计量数据的聚合操作也还是个问题。<br>为解决以上问题，红帽的Julien Danjou，发起了Gnocchi项目来解决这类问题。其总体思路是：把各个计量指标Metric的计量数据measurement直接写入后端存储中；并在measurement写入之前根据预先设定的归档策略进行聚合操作；查询时直接读取对应的文件即可获得聚合后的监控信息点；gnocchi提供资源索引，这样能更快的找到每个资源的基础信息metadata和其相关的metrics信息。<br>注：数据存储分级：(资源项)resource-&gt;(资源指标条目)metric-&gt;(实际数据)measure</p><h3 id="为什么使用gnocchi"><a href="#为什么使用gnocchi" class="headerlink" title="为什么使用gnocchi"></a>为什么使用gnocchi</h3><p>Gnocchi已能够具备在云计算环境中提供可用的时间序列数据库的需要，提供存储大量度量数据并且易于扩展的能力。<br>Gnocchi项目于2014年开始，作为OpenStack Ceilometer项目的分支，以解决Ceilometer在将标准数据库用作计量数据的存储后端时遇到的性能问题。<br>Gnocchi使用各种技术压缩存储数据，降低了数据存储的空间。</p><h2 id="ceilometer-gnocchi环境搭建"><a href="#ceilometer-gnocchi环境搭建" class="headerlink" title="ceilometer+gnocchi环境搭建"></a>ceilometer+gnocchi环境搭建</h2><hr><p>安装部署ceilometer服务前，主机必须已经正确安装keystone、nova、neutron、image服务。部署过程须用到uwsgi和redis。</p><h3 id="Compute节点安装"><a href="#Compute节点安装" class="headerlink" title="Compute节点安装"></a>Compute节点安装</h3><h4 id="安装ceilometer相关包："><a href="#安装ceilometer相关包：" class="headerlink" title="安装ceilometer相关包："></a>安装ceilometer相关包：</h4><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># yum install openstack-ceilometer-compute</span><br><span class="hljs-meta"># yum install openstack-ceilometer-ipmi (optional)</span><br></code></pre></td></tr></table></figure><ul><li><p>编辑&#x2F;etc&#x2F;ceilometer&#x2F;ceilometer.conf文件并完成以下操作<br>在该[DEFAULT]部分中，配置RabbitMQ 消息队列访问</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-string">[DEFAULT]</span><br>...<br>transport_url  =  rabbit:<span class="hljs-comment">//openstack:123456@controller</span><br></code></pre></td></tr></table></figure></li><li><p>在该[service_credentials]部分中，配置服务凭据：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[service_credentials]</span><br><span class="hljs-attr">auth_url</span> = http://controller:<span class="hljs-number">5000</span><br><span class="hljs-attr">project_domain_id</span> = default<br><span class="hljs-attr">user_domain_id</span> = default<br><span class="hljs-attr">auth_type</span> = password<br><span class="hljs-attr">username</span> = ceilometer<br><span class="hljs-attr">project_name</span> = service<br><span class="hljs-attr">password</span> = <span class="hljs-number">123456</span><br><span class="hljs-attr">interface</span> = internalURL<br><span class="hljs-attr">region_name</span> = RegionOne<br></code></pre></td></tr></table></figure></li><li><p>配置计算服务，编辑&#x2F;etc&#x2F;nova&#x2F;nova.conf文件并在以下[DEFAULT]部分配置通知：</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs abnf">[DEFAULT]<br>...<br>instance_usage_audit  <span class="hljs-operator">=</span>  True<br>instance_usage_audit_period  <span class="hljs-operator">=</span>  hour<br>notify_on_state_change  <span class="hljs-operator">=</span>  vm_and_task_state<br>[oslo_messaging_notifications]<br>...<br><span class="hljs-attribute">driver</span>  <span class="hljs-operator">=</span>  messagingv2<br></code></pre></td></tr></table></figure></li><li><p>配置计算以轮询IPMI，编辑&#x2F;etc&#x2F;sudoers文件并添加包含：</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dts">ceilometer ALL = (root) NOPASSWD: <span class="hljs-keyword">/usr/</span>bin/ceilometer-rootwrap <span class="hljs-keyword">/etc/</span>ceilometer/rootwrap.conf *<br>编辑<span class="hljs-keyword">/etc/</span>ceilometer/polling.yaml以包含所需：<br><br>- name: ipmi<br><span class="hljs-symbol">      interval:</span> <span class="hljs-number">300</span><br><span class="hljs-symbol">      meters:</span><br>        - hardware.ipmi.temperature<br></code></pre></td></tr></table></figure></li></ul><h4 id="完成安装"><a href="#完成安装" class="headerlink" title="完成安装"></a>完成安装</h4><p>启动代理并将其配置为在系统引导时启动：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl <span class="hljs-built_in">enable</span> openstack-ceilometer-compute.service</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl start openstack-ceilometer-compute.service</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl <span class="hljs-built_in">enable</span> openstack-ceilometer-ipmi.service (optional)</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl start openstack-ceilometer-ipmi.service (optional)</span><br></code></pre></td></tr></table></figure><h4 id="重新启动Compute服务"><a href="#重新启动Compute服务" class="headerlink" title="重新启动Compute服务"></a>重新启动Compute服务</h4><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># systemctl restart openstack-nova-compute.service</span><br></code></pre></td></tr></table></figure><h3 id="Controller节点安装"><a href="#Controller节点安装" class="headerlink" title="Controller节点安装"></a>Controller节点安装</h3><p>获取admin凭据来访问仅管理员CLI命令<br><code>$ . admin-openrc</code></p><p>要创建服务凭据，请完成以下步骤：</p><h4 id="创建ceilometer用户："><a href="#创建ceilometer用户：" class="headerlink" title="创建ceilometer用户："></a>创建ceilometer用户：</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">openstack user create --domain default --password-prompt ceilometer<br>User Password:123456<br><span class="hljs-section">Repeat User Password:123456</span><br><span class="hljs-section">+-----------+----------------------------------+</span><br><span class="hljs-section">| Field     | Value                            |</span><br><span class="hljs-section">+-----------+----------------------------------+</span><br>| domain_id | e0353a670a9e496da891347c589539e9 |<br>| enabled   | True                             |<br>| id        | c859c96f57bd4989a8ea1a0b1d8ff7cd |<br><span class="hljs-section">| name      | ceilometer                       |</span><br><span class="hljs-section">+-----------+----------------------------------+</span><br></code></pre></td></tr></table></figure><h4 id="将admin角色添加到ceilometer用户。"><a href="#将admin角色添加到ceilometer用户。" class="headerlink" title="将admin角色添加到ceilometer用户。"></a>将admin角色添加到ceilometer用户。</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">$ openstack <span class="hljs-keyword">role</span> <span class="hljs-title">add</span> --project service --<span class="hljs-keyword">user</span> <span class="hljs-title">ceilometer</span> admin<br></code></pre></td></tr></table></figure><p>在Keystone注册Gnocchi服务</p><h4 id="创建gnocchi用户："><a href="#创建gnocchi用户：" class="headerlink" title="创建gnocchi用户："></a>创建gnocchi用户：</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">$ openstack user create --domain default --password-prompt gnocchi<br>User Password:123456<br><span class="hljs-section">Repeat User Password:123456</span><br><span class="hljs-section">+-----------+----------------------------------+</span><br><span class="hljs-section">| Field     | Value                            |</span><br><span class="hljs-section">+-----------+----------------------------------+</span><br>| domain_id | e0353a670a9e496da891347c589539e9 |<br>| enabled   | True                             |<br>| id        | 8bacd064f6434ef2b6bbfbedb79b0318 |<br><span class="hljs-section">| name      | gnocchi                          |</span><br><span class="hljs-section">+-----------+----------------------------------+</span><br></code></pre></td></tr></table></figure><h4 id="创建gnocchi服务实体"><a href="#创建gnocchi服务实体" class="headerlink" title="创建gnocchi服务实体"></a>创建gnocchi服务实体</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">$ openstack service create --name gnocchi \<br><span class="hljs-section">  --description &quot;Metric Service&quot; metric</span><br><span class="hljs-section">+-------------+----------------------------------+</span><br><span class="hljs-section">| Field       | Value                            |</span><br><span class="hljs-section">+-------------+----------------------------------+</span><br>| description | Metric Service                   |<br>| enabled     | True                             |<br>| id          | 205978b411674e5a9990428f81d69384 |<br>| name        | gnocchi                          |<br><span class="hljs-section">| type        | metric                           |</span><br><span class="hljs-section">+-------------+----------------------------------+</span><br></code></pre></td></tr></table></figure><h4 id="将admin角色添加到gnocchi用户"><a href="#将admin角色添加到gnocchi用户" class="headerlink" title="将admin角色添加到gnocchi用户"></a>将admin角色添加到gnocchi用户</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">$ openstack <span class="hljs-keyword">role</span> <span class="hljs-title">add</span> --project service --<span class="hljs-keyword">user</span> <span class="hljs-title">gnocchi</span> admin<br></code></pre></td></tr></table></figure><h4 id="创建Ceilometer服务API端点"><a href="#创建Ceilometer服务API端点" class="headerlink" title="创建Ceilometer服务API端点"></a>创建Ceilometer服务API端点</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">$ openstack endpoint create --region RegionOne \<br><span class="hljs-section">  metric public http://controller:8041</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br><span class="hljs-section">| Field        | Value                            |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br>| enabled      | True                             |<br>| id           | b808b67b848d443e9eaaa5e5d796970c |<br>| interface    | public                           |<br>| region       | RegionOne                        |<br>| region<span class="hljs-emphasis">_id    | RegionOne                        |</span><br><span class="hljs-emphasis">| service_id   | 205978b411674e5a9990428f81d69384 |</span><br><span class="hljs-emphasis">| service_name | gnocchi                          |</span><br><span class="hljs-emphasis">| service_</span>type | metric                           |<br><span class="hljs-section">| url          | http://controller:8041           |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">$ openstack endpoint create --region RegionOne \<br><span class="hljs-section">  metric internal http://controller:8041</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br><span class="hljs-section">| Field        | Value                            |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br>| enabled      | True                             |<br>| id           | c7009b1c2ee54b71b771fa3d0ae4f948 |<br>| interface    | internal                         |<br>| region       | RegionOne                        |<br>| region<span class="hljs-emphasis">_id    | RegionOne                        |</span><br><span class="hljs-emphasis">| service_id   | 205978b411674e5a9990428f81d69384 |</span><br><span class="hljs-emphasis">| service_name | gnocchi                          |</span><br><span class="hljs-emphasis">| service_</span>type | metric                           |<br><span class="hljs-section">| url          | http://controller:8041           |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">$ openstack endpoint create --region RegionOne \<br><span class="hljs-section">  metric admin http://controller:8041</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br><span class="hljs-section">| Field        | Value                            |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br>| enabled      | True                             |<br>| id           | b2c00566d0604551b5fe1540c699db3d |<br>| interface    | admin                            |<br>| region       | RegionOne                        |<br>| region<span class="hljs-emphasis">_id    | RegionOne                        |</span><br><span class="hljs-emphasis">| service_id   | 205978b411674e5a9990428f81d69384 |</span><br><span class="hljs-emphasis">| service_name | gnocchi                          |</span><br><span class="hljs-emphasis">| service_</span>type | metric                           |<br><span class="hljs-section">| url          | http://controller:8041           |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br></code></pre></td></tr></table></figure><h3 id="安装Gnocchi"><a href="#安装Gnocchi" class="headerlink" title="安装Gnocchi"></a>安装Gnocchi</h3><h4 id="安装服务组件"><a href="#安装服务组件" class="headerlink" title="安装服务组件"></a>安装服务组件</h4><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># yum install openstack-gnocchi-api openstack-gnocchi-metricd python-gnocchiclient</span><br></code></pre></td></tr></table></figure><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs nsis">新建文件 /etc/httpd/conf.d/<span class="hljs-number">10</span>-gnocchi_wsgi.conf<br><br>Listen <span class="hljs-number">8041</span><br>&lt;VirtualHost *:<span class="hljs-number">8041</span>&gt;<br>  ServerName controller<br>  <span class="hljs-comment">## Vhost docroot</span><br>  DocumentRoot <span class="hljs-string">&quot;/var/www/cgi-bin/gnocchi&quot;</span><br>  <span class="hljs-comment">## Directories, there should at least be a declaration for /var/www/cgi-bin/gnocchi</span><br>  &lt;<span class="hljs-literal">Directory</span> <span class="hljs-string">&quot;/var/www/cgi-bin/gnocchi&quot;</span>&gt;<br>    Options Indexes FollowSymLinks MultiViews<br>    AllowOverride <span class="hljs-literal">None</span><br>    Require <span class="hljs-literal">all</span> granted<br>  &lt;/<span class="hljs-literal">Directory</span>&gt;<br>  <span class="hljs-comment">## Logging</span><br>  ErrorLog <span class="hljs-string">&quot;/var/log/httpd/gnocchi_wsgi_error.log&quot;</span><br>  ServerSignature <span class="hljs-literal">Off</span><br>  CustomLog <span class="hljs-string">&quot;/var/log/httpd/gnocchi_wsgi_access.log&quot;</span> combined<br>  SetEnvIf X-Forwarded-Proto https HTTPS=<span class="hljs-number">1</span><br>  WSGIApplicationGroup %&#123;GLOBAL&#125;<br>  WSGIDaemonProcess gnocchi display-<span class="hljs-keyword">name</span>=gnocchi_wsgi group=gnocchi processes=<span class="hljs-number">8</span> threads=<span class="hljs-number">8</span> <span class="hljs-literal">user</span>=gnocchi<br>  WSGIProcessGroup gnocchi<br>  WSGIScriptAlias / <span class="hljs-string">&quot;/var/www/cgi-bin/gnocchi/app&quot;</span><br>&lt;/VirtualHost&gt;<br></code></pre></td></tr></table></figure><h4 id="创建文件夹路径下app文件"><a href="#创建文件夹路径下app文件" class="headerlink" title="创建文件夹路径下app文件"></a>创建文件夹路径下app文件</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">mkdir <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/cgi-bin/g</span>nocchi/<br>vim <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/cgi-bin/g</span>nocchi/app<br></code></pre></td></tr></table></figure><p>app文件如下：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="hljs-comment"># you may not use this file except in compliance with the License.</span><br><span class="hljs-comment"># You may obtain a copy of the License at</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#    http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Unless required by applicable law or agreed to in writing, software</span><br><span class="hljs-comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="hljs-comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or</span><br><span class="hljs-comment"># implied.</span><br><span class="hljs-comment"># See the License for the specific language governing permissions and</span><br><span class="hljs-comment"># limitations under the License.</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    import sys<br>    from gnocchi.cli import api<br>    sys.<span class="hljs-keyword">exit</span>(api.api())<br><span class="hljs-keyword">else</span>:<br>    from gnocchi.cli import api<br>    from gnocchi.rest import app<br>    application = app.load_app(api.prepare_service())<br></code></pre></td></tr></table></figure><h4 id="文件夹修改权限"><a href="#文件夹修改权限" class="headerlink" title="文件夹修改权限"></a>文件夹修改权限</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">chown</span> -R gnocchi.gnocchi /var/www/cgi-bin/gnocchi</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">chmod</span> +777 /var/www/cgi-bin/gnocchi</span><br></code></pre></td></tr></table></figure><h4 id="重启httpd服务"><a href="#重启httpd服务" class="headerlink" title="重启httpd服务"></a>重启httpd服务</h4><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># systemctl restart httpd</span><br></code></pre></td></tr></table></figure><h4 id="为Gnocchi的索引器创建数据库"><a href="#为Gnocchi的索引器创建数据库" class="headerlink" title="为Gnocchi的索引器创建数据库"></a>为Gnocchi的索引器创建数据库</h4><p>使用数据库访问客户端以root用户身份连接到数据库服务器</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">$ mysql <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p<br><span class="hljs-keyword">CREATE</span> DATABASE gnocchi;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> gnocchi.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;gnocchi&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> gnocchi.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;gnocchi&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br></code></pre></td></tr></table></figure><p>编辑&#x2F;etc&#x2F;gnocchi&#x2F;gnocchi.conf文件并添加Keystone选项</p><ul><li><p>在[api]中，配置gnocchi以使用keystone：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[api]</span><br><span class="hljs-attr">auth_mode</span> = keystone<br></code></pre></td></tr></table></figure></li><li><p>在[keystone_authtoken]部分中，配置keystone身份验证：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-string">[keystone_authtoken]</span><br>...<br>auth_type = password<br>auth_url = http:<span class="hljs-comment">//controller:5000/v3</span><br>project_domain_name = Default<br>user_domain_name = Default<br>project_name = service<br>username = gnocchi<br>password = <span class="hljs-number">123456</span><br><span class="hljs-keyword">interface</span> = <span class="hljs-symbol">internalURL</span><br><span class="hljs-symbol">region_name</span> = <span class="hljs-symbol">RegionOne</span><br>[<span class="hljs-symbol">indexer</span>]<br><span class="hljs-symbol">url</span> = <span class="hljs-symbol">mysql</span>+<span class="hljs-symbol">pymysql</span>://<span class="hljs-symbol">gnocchi</span>:<span class="hljs-symbol">GNOCCHI_DBPASS</span>@<span class="hljs-symbol">controller</span>/<span class="hljs-symbol">gnocchi</span><br></code></pre></td></tr></table></figure></li><li><p>在[storage]部分中，配置位置以存储度量标准数据。在这种情况下，我们将它存储到本地文件系统。有关更耐用和高性能驱动程序的列表，<br>请参阅Gnocchi文档：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[storage]</span><br><span class="hljs-comment"># coordination_url is not required but specifying one will improve</span><br><span class="hljs-comment"># performance with better workload division across workers.</span><br><span class="hljs-attr">coordination_url</span> = redis://controller:<span class="hljs-number">6379</span><br><span class="hljs-attr">file_basepath</span> = /var/lib/gnocchi<br><span class="hljs-attr">driver</span> = file<br></code></pre></td></tr></table></figure></li></ul><h4 id="初始化Gnocchi："><a href="#初始化Gnocchi：" class="headerlink" title="初始化Gnocchi："></a>初始化Gnocchi：</h4><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">gnocchi-upgrade</span><br></code></pre></td></tr></table></figure><h4 id="完成Gnocchi安装"><a href="#完成Gnocchi安装" class="headerlink" title="完成Gnocchi安装"></a>完成Gnocchi安装</h4><p>启动Gnocchi服务并将其配置为在系统引导时启动</p><figure class="highlight thrift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs thrift"># systemctl enable openstack-gnocchi-api.<span class="hljs-keyword">service</span> openstack-gnocchi-metricd.<span class="hljs-keyword">service</span><br># systemctl start openstack-gnocchi-api.<span class="hljs-keyword">service</span>  openstack-gnocchi-metricd.<span class="hljs-keyword">service</span><br></code></pre></td></tr></table></figure><h3 id="安装Ceilometer包"><a href="#安装Ceilometer包" class="headerlink" title="安装Ceilometer包"></a>安装Ceilometer包</h3><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># yum install openstack-ceilometer-notification openstack-ceilometer-central</span><br></code></pre></td></tr></table></figure><p>编辑&#x2F;etc&#x2F;ceilometer&#x2F;pipeline.yaml文件并完成以下部分，配置Gnocchi连接：</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">publishers</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-comment"># set address of Gnocchi</span><br>    <span class="hljs-comment"># + filter out Gnocchi-related activity meters (Swift driver)</span><br>    <span class="hljs-comment"># + set default archive policy</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">gnocchi://?filter_project=service&amp;archive_policy=low</span><br></code></pre></td></tr></table></figure><p>编辑&#x2F;etc&#x2F;ceilometer&#x2F;ceilometer.conf文件并完成以下操作</p><ul><li><p>在该[DEFAULT]部分中，配置RabbitMQ消息队列访问：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-string">[DEFAULT]</span><br>...<br>transport_url  =  rabbit:<span class="hljs-comment">//openstack:123456@controller</span><br></code></pre></td></tr></table></figure></li><li><p>在该[service_credentials]部分中，配置服务凭据：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs makefile">[service_credentials]<br>...<br>auth_type = password<br>auth_url = http://controller:5000/v3<br>project_domain_id = default<br>user_domain_id = default<br>project_name = service<br>username = ceilometer<br>password = 123456<br>interface = internalURL<br>region_name = RegionOne<br></code></pre></td></tr></table></figure></li></ul><p>在Gnocchi创建Ceilometer资源。Gnocchi应该在这个阶段运行：</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># ceilometer-upgrade</span><br></code></pre></td></tr></table></figure><p>完成安装<br>启动Ceilometer服务并将其配置为在系统引导时启动：</p><figure class="highlight thrift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs thrift"># systemctl enable openstack-ceilometer-notification.<span class="hljs-keyword">service</span> \<br>  openstack-ceilometer-central.<span class="hljs-keyword">service</span><br># systemctl start openstack-ceilometer-notification.<span class="hljs-keyword">service</span> \<br>  openstack-ceilometer-central.<span class="hljs-keyword">service</span><br></code></pre></td></tr></table></figure><h3 id="glance-neutron服务配置"><a href="#glance-neutron服务配置" class="headerlink" title="glance neutron服务配置"></a>glance neutron服务配置</h3><p>Image</p><p>编辑&#x2F;etc&#x2F;glance&#x2F;glance-api.conf文件并完成以下操作：</p><ul><li>在[DEFAULT]，[oslo_messaging_notifications]部分中，配置通知和RabbitMQ消息代理访问：<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[DEFAULT]</span><br><span class="hljs-attr">transport_url</span> = rabbit://openstack:<span class="hljs-number">123456</span>@controller<br><span class="hljs-section">[oslo_messaging_notifications]</span><br><span class="hljs-attr">driver</span> = messagingv2<br></code></pre></td></tr></table></figure></li></ul><p>编辑&#x2F;etc&#x2F;glance&#x2F;glance-registry.conf文件并完成以下操作：</p><ul><li>在[DEFAULT]，[oslo_messaging_notifications]部分中，配置通知和RabbitMQ消息代理访问：<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[DEFAULT]</span><br><span class="hljs-attr">transport_url</span> = rabbit://openstack:<span class="hljs-number">123456</span>@controller<br><span class="hljs-section">[oslo_messaging_notifications]</span><br><span class="hljs-attr">driver</span> = messagingv2<br></code></pre></td></tr></table></figure></li></ul><p>完成安装<br>重新启动Image服务：</p><figure class="highlight thrift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs thrift"># systemctl restart openstack-glance-api.<span class="hljs-keyword">service</span> openstack-glance-registry.<span class="hljs-keyword">service</span><br></code></pre></td></tr></table></figure><p>Neutron</p><p>配置网络服务以使用Ceilometer</p><p>编辑&#x2F;etc&#x2F;neutron&#x2F;neutron.conf并完成以下操作：<br>在这些[oslo_messaging_notifications]部分中，启用通知：<br>[oslo_messaging_notifications]<br>…<br>driver  &#x3D;  messagingv2<br>完成安装</p><p>重启网络服务：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># systemctl <span class="hljs-keyword">restart</span> neutron-<span class="hljs-keyword">server</span>.service<br></code></pre></td></tr></table></figure><p>配置环境变量及gnocchi文件夹权限<br>更改目录权限，否则gnocchi存储文件数据时报错，没有权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">chmod</span> +777 /var/lib/gnocchi</span><br></code></pre></td></tr></table></figure><p>&#x2F;root&#x2F;admin-openrc添加gnocchi相关环境变量</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clean"># <span class="hljs-keyword">export</span> OS_AUTH_TYPE=password<br></code></pre></td></tr></table></figure><h2 id="监控项列表"><a href="#监控项列表" class="headerlink" title="监控项列表"></a>监控项列表</h2><p>注意：使用ceilometer监控虚拟机的memory.usage，要求libvirt版本1.1.1+，qemu版本1.5+。并且需要镜像支持balloon，即镜像中安装有balloon的driver。（一般linux镜像都默认包含，但是windows镜像需要另行安装）<br>虚拟机的Cpu：使用时间（cpu）,使用率（cpu_util），分配vcpu个数（vcpus）<br>虚拟机的硬盘：分配总大小（disk.root.size），占用宿主机大小（disk.usage）<br>虚拟机的内存：总大小（memory），使用大小（memory.usage）<br>虚拟机的网络：网络流量（bandwidth），网络下ip个数（ip.floating）<br>虚拟机的镜像：镜像大小（image.download）<br>节点的cpu、硬盘、内存等使用信息可通过linux常用命令监视</p><p><strong>nova实例监控项</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Unit</th><th>Resource</th><th>Origin</th><th>Support Note</th><th>翻译</th></tr></thead><tbody><tr><td>memory</td><td>Gauge</td><td>MB</td><td>instance ID</td><td>Notification</td><td>Libvirt, Hyper-V</td><td>Volume of RAM allocated to the instance</td></tr><tr><td>memory.usage</td><td>Gauge</td><td>MB</td><td>instance ID Pollster</td><td>Libvirt, Hyper-V, vSphere, XenAPI</td><td>Volume of RAM used by the instance</td><td>from the amount of its allocated memory</td></tr><tr><td>…</td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><p>参考：<a href="https://docs.openstack.org/ceilometer/latest/admin/telemetry-measurements.html">https://docs.openstack.org/ceilometer/latest/admin/telemetry-measurements.html</a></p><h2 id="详细监控方法介绍"><a href="#详细监控方法介绍" class="headerlink" title="详细监控方法介绍"></a>详细监控方法介绍</h2><p><strong>采集信息查询方法</strong></p><p>此方案中采集信息以gnocchi+文件方式存储。获取采集信息有两种方式，分别为 gnocchi-api和gnocchi 命令。以下采用gnocchi命令做详细介绍：<br>注：数据存储分级：(资源项)resource-&gt;(资源指标条目)metric-&gt;(实际数据)measure</p><p><strong>获取权限</strong></p><p><code># . admin-openrc</code></p><p><strong>获取监控资源列表</strong></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># gnocchi resource list</span><br></code></pre></td></tr></table></figure><p><strong>获取实例监控资源对象信息列表</strong><br>获取某一instance下所有监控条目</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">[root<span class="hljs-meta">@controller</span> ~]<span class="hljs-comment"># gnocchi resource show 8bb00e90-7e3f-5ef6-bee5-00e7c6bbc5fc</span><br>+-----------------------+-------------------------------------------------------------------+<br>|<span class="hljs-string"> Field                 </span>|<span class="hljs-string"> Value                                                             </span>|<br>+-----------------------+-------------------------------------------------------------------+<br>|<span class="hljs-string"> created_by_project_id </span>|<span class="hljs-string"> e06fb4ce67a24aa687dffb9d8dcc6b1e                                  </span>|<br>|<span class="hljs-string"> created_by_user_id    </span>|<span class="hljs-string"> 4895e340408e42c383ea8d82e459b182                                  </span>|<br>|<span class="hljs-string"> creator               </span>|<span class="hljs-string"> 4895e340408e42c383ea8d82e459b182:e06fb4ce67a24aa687dffb9d8dcc6b1e </span>|<br>|<span class="hljs-string"> ended_at              </span>|<span class="hljs-string"> None                                                              </span>|<br>|<span class="hljs-string"> id                    </span>|<span class="hljs-string"> 8bb00e90-7e3f-5ef6-bee5-00e7c6bbc5fc                              </span>|<br>|<span class="hljs-string"> metrics               </span>|<span class="hljs-string"> disk.device.allocation: 427a316e-1ef9-4054-8253-604b80e8f003      </span>|<br>|<span class="hljs-string">                       </span>|<span class="hljs-string"> disk.device.capacity: 6915cd9b-1346-46db-8e86-438fd1884b49        </span>|<br>|<span class="hljs-string">                       </span>|<span class="hljs-string"> disk.device.latency: fcfbc2ae-eddf-4ff9-bda9-33b9a2ba9c3d         </span>|<br>|<span class="hljs-string">                       </span>|<span class="hljs-string"> disk.device.read.bytes: 6df3416c-ad02-401e-84e4-5ac0b75febf2      </span>|<br>|<span class="hljs-string">                       </span>|<span class="hljs-string"> disk.device.read.latency: 4014d3c6-51ea-4e24-b8e6-649ed6ee896d    </span>|<br>|<span class="hljs-string">                       </span>|<span class="hljs-string"> disk.device.usage: 7cd08e21-a0e1-4fce-8dc8-0e8b96d711d4           </span>|<br>|<span class="hljs-string">                       </span>|<span class="hljs-string"> disk.device.write.bytes: b29abf7c-a9c4-4afc-89a5-ef766739028b     </span>|<br>|<span class="hljs-string">                       </span>|<span class="hljs-string"> disk.device.write.latency: f82d69ec-98d6-45e8-bc13-cd040f8cc2ef   </span>|<br>|<span class="hljs-string"> original_resource_id  </span>|<span class="hljs-string"> 86d618b5-aadc-4346-b620-7f44fc35c7ad-vda                          </span>|<br>|<span class="hljs-string"> project_id            </span>|<span class="hljs-string"> 40026f6973464ee9a19ad04f6221e213                                  </span>|<br>|<span class="hljs-string"> revision_end          </span>|<span class="hljs-string"> None                                                              </span>|<br>|<span class="hljs-string"> revision_start        </span>|<span class="hljs-string"> 2019-05-07T05:08:10.450142+00:00                                  </span>|<br>|<span class="hljs-string"> started_at            </span>|<span class="hljs-string"> 2019-05-07T05:08:10.450123+00:00                                  </span>|<br>|<span class="hljs-string"> type                  </span>|<span class="hljs-string"> instance_disk                                                     </span>|<br>|<span class="hljs-string"> user_id               </span>|<span class="hljs-string"> 5a4da861d8e84cbdabd98b9804bc1547                                  </span>|<br>+-----------------------+-------------------------------------------------------------------+<br></code></pre></td></tr></table></figure><p><strong>获取实例监控条目详细信息</strong></p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs subunit"># gnocchi measures show 897356e6-d0bb<span class="hljs-string">-43</span>cd<span class="hljs-string">-9</span>cbd<span class="hljs-string">-43</span>ab2808384d<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Openstack Queens 环境搭建（九）Cinder服务</title>
    <link href="/2019/08/01/openstack/queens/openstack_queens_install_9/"/>
    <url>/2019/08/01/openstack/queens/openstack_queens_install_9/</url>
    
    <content type="html"><![CDATA[<h3 id="存储服务概念"><a href="#存储服务概念" class="headerlink" title="存储服务概念"></a>存储服务概念</h3><hr><p>OpenStack块存储服务(Cinder)将持久性存储添加到一个虚拟机。块存储提供了管理卷的基础设施，并与OpenStack计算交互，为实例提供卷。该服务还支持卷快照和卷类型的管理。<br>块存储服务由以下组件组成:<br><strong>cinder-api</strong><br>接收API请求，并将其路由到cinders -volume以进行操作。<br><strong>cinder-volume</strong><br>直接与块存储服务和进程(如cinders -scheduler)交互。它还可以通过消息队列与这些进程进行交互。cinders -volume服务响应发送到块存储服务的读写请求，以维护状态。它可以通过驱动程序体系结构与各种存储提供者交互。<br><strong>cinder-scheduler daemon</strong><br>选择要在其上创建卷的最佳存储提供程序节点。与nova-scheduler类似的组件。<br><strong>cinder-backup daemon</strong><br>Cinder-backup服务向备份存储提供程序提供任何类型的备份卷。与cinders -volume服务一样，它可以通过驱动程序体系结构与各种存储提供者交互。<br><strong>Messaging queue</strong><br>在块存储进程之间路由信息。</p><h3 id="Controller节点"><a href="#Controller节点" class="headerlink" title="Controller节点"></a>Controller节点</h3><hr><h4 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h4><p>在安装和配置块存储服务之前，必须创建数据库、服务凭据和API端点。</p><h4 id="创建数据库，为cinder数据库授权"><a href="#创建数据库，为cinder数据库授权" class="headerlink" title="创建数据库，为cinder数据库授权"></a>创建数据库，为cinder数据库授权</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"># mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>p123456<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> database cinder;<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> privileges <span class="hljs-keyword">on</span> cinder.<span class="hljs-operator">*</span> <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;cinder&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> privileges <span class="hljs-keyword">on</span> cinder.<span class="hljs-operator">*</span> <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;cinder&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br></code></pre></td></tr></table></figure><h4 id="创建服务凭据"><a href="#创建服务凭据" class="headerlink" title="创建服务凭据"></a>创建服务凭据</h4><p>生成管理凭证，以获得访问只有管理CLI命令:</p><p><code># . admin-openrc</code></p><h4 id="创建cinder用户"><a href="#创建cinder用户" class="headerlink" title="创建cinder用户"></a>创建cinder用户</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># openstack <span class="hljs-keyword">user</span> <span class="hljs-keyword">create</span> <span class="hljs-comment">--domain default --password-prompt cinder</span><br></code></pre></td></tr></table></figure><h4 id="添加admin角色到cinder用户中"><a href="#添加admin角色到cinder用户中" class="headerlink" title="添加admin角色到cinder用户中"></a>添加admin角色到cinder用户中</h4><p>（无返回值）</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># openstack <span class="hljs-keyword">role</span> <span class="hljs-keyword">add</span> <span class="hljs-comment">--project service --user cinder admin</span><br></code></pre></td></tr></table></figure><h4 id="创建cinder2和cinderv3服务实体"><a href="#创建cinder2和cinderv3服务实体" class="headerlink" title="创建cinder2和cinderv3服务实体"></a>创建cinder2和cinderv3服务实体</h4><p>注：块存储服务需要两个服务实体。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># openstack service create --name cinderv2 \</span><br>   --description <span class="hljs-string">&quot;OpenStack Block Storage&quot;</span> volumev2<br><span class="hljs-comment"># openstack service create --name cinderv3 \</span><br>   --description <span class="hljs-string">&quot;OpenStack Block Storage&quot;</span> volumev3<br><span class="hljs-comment"># openstack endpoint create --region RegionOne \</span><br>   volumev3 public http:<span class="hljs-regexp">//</span>controller:<span class="hljs-number">8776</span><span class="hljs-regexp">/v3/</span>%\(project_id\)s<br><span class="hljs-comment"># openstack endpoint create --region RegionOne \</span><br>   volumev3 internal http:<span class="hljs-regexp">//</span>controller:<span class="hljs-number">8776</span><span class="hljs-regexp">/v3/</span>%\(project_id\)s<br><span class="hljs-comment"># openstack endpoint create --region RegionOne \</span><br>  volumev3 admin http:<span class="hljs-regexp">//</span>controller:<span class="hljs-number">8776</span><span class="hljs-regexp">/v3/</span>%\(project_id\)s<br></code></pre></td></tr></table></figure><h4 id="安装配置组件"><a href="#安装配置组件" class="headerlink" title="安装配置组件"></a>安装配置组件</h4><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># yum install -y openstack-cinder</span><br></code></pre></td></tr></table></figure><p><strong>编辑 &#x2F;etc&#x2F;cinder&#x2F;cinder.conf文件</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">vi  /etc/cinder/cinder.conf</span><br></code></pre></td></tr></table></figure><ul><li><p>在[database]选项，配置数据库访问:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[database]</span><br><span class="hljs-attr">connection</span> = mysql+pymysql://cinder:<span class="hljs-number">123456</span>@controller/cinder<br></code></pre></td></tr></table></figure></li><li><p>在[DEFAULT]部分，配置RabbitMQ消息队列访问:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[DEFAULT]</span><br><span class="hljs-attr">transport_url</span> = rabbit://openstack:<span class="hljs-number">123456</span>@controller<br></code></pre></td></tr></table></figure></li><li><p>在[DEFAULT]和[keystone_authtoken]选项，配置身份服务访问:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[DEFAULT]</span><br><span class="hljs-attr">auth_strategy</span> = keystone<br><span class="hljs-section">[keystone_authtoken]</span><br><span class="hljs-attr">auth_uri</span> = http://controller:<span class="hljs-number">5000</span><br><span class="hljs-attr">auth_url</span> = http://controller:<span class="hljs-number">5000</span><br><span class="hljs-attr">memcached_servers</span> = controller:<span class="hljs-number">11211</span><br><span class="hljs-attr">auth_type</span> = password<br><span class="hljs-attr">project_domain_id</span> = default<br><span class="hljs-attr">user_domain_id</span> = default<br><span class="hljs-attr">project_name</span> = service<br><span class="hljs-attr">username</span> = cinder<br><span class="hljs-attr">password</span> = <span class="hljs-number">123456</span><br></code></pre></td></tr></table></figure></li><li><p>在[DEFAULT]选项，配置my_ip选项，使用Controller节点的管理接口IP地址:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[DEFAULT]</span><br><span class="hljs-attr">my_ip</span> = <span class="hljs-number">192.100</span>.<span class="hljs-number">200.68</span><br></code></pre></td></tr></table></figure></li><li><p>在[oslo_concurrency]选项，配置lock路径:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[oslo_concurrency]</span><br><span class="hljs-attr">lock_path</span> = /var/lib/cinder/tmp<br></code></pre></td></tr></table></figure></li><li><p>同步块存储数据（忽略此输出中的任何弃用消息。）</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">su -s /bin//sh -c <span class="hljs-string">&quot;cinder-manage db sync&quot;</span> cinder</span><br></code></pre></td></tr></table></figure><ul><li>配置计算服务以使用块存储<br>编辑 &#x2F;etc&#x2F;nova&#x2F;nova.conf 文件<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># vi /etc/nova/nova.conf</span><br><span class="hljs-section">[cinder]</span><br><span class="hljs-attr">os_regioon_name</span> = RegionOne<br></code></pre></td></tr></table></figure></li></ul><h4 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h4><figure class="highlight thrift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs thrift"># systemctl restart openstack-nova-api.<span class="hljs-keyword">service</span><br># systemctl enable openstack-cinder-api.<span class="hljs-keyword">service</span> openstack-cinder-scheduler.<span class="hljs-keyword">service</span><br># systemctl start openstack-cinder-api.<span class="hljs-keyword">service</span> openstack-cinder-scheduler.<span class="hljs-keyword">service</span><br></code></pre></td></tr></table></figure><h3 id="存储节点"><a href="#存储节点" class="headerlink" title="存储节点"></a>存储节点</h3><hr><h4 id="安装LVM包"><a href="#安装LVM包" class="headerlink" title="安装LVM包"></a>安装LVM包</h4><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># yum install -y lvm2</span><br></code></pre></td></tr></table></figure><h4 id="启动LVM元数据服务，并将其配置为在系统启动时启动"><a href="#启动LVM元数据服务，并将其配置为在系统启动时启动" class="headerlink" title="启动LVM元数据服务，并将其配置为在系统启动时启动"></a>启动LVM元数据服务，并将其配置为在系统启动时启动</h4><p>注：一些发行版默认安装LVM。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl <span class="hljs-built_in">enable</span> lvm2-lvmetad.service</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl start lvm2-lvmetad.service</span><br></code></pre></td></tr></table></figure><h4 id="创建LVM物理卷-dev-sdb"><a href="#创建LVM物理卷-dev-sdb" class="headerlink" title="创建LVM物理卷&#x2F;dev&#x2F;sdb:"></a>创建LVM物理卷&#x2F;dev&#x2F;sdb:</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># pvcreate /dev/sdb</span><br>  Physical <span class="hljs-keyword">volume</span><span class="language-bash"> <span class="hljs-string">&quot;/dev/sdb&quot;</span> successfully created.</span><br></code></pre></td></tr></table></figure><h4 id="创建LVM卷组cinder-volmes"><a href="#创建LVM卷组cinder-volmes" class="headerlink" title="创建LVM卷组cinder-volmes"></a>创建LVM卷组cinder-volmes</h4><p>注：块存储服务在此卷组中创建逻辑卷。</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-comment"># vgcreate cinder-volumes /dev/sdb</span><br>  Volume <span class="hljs-keyword">group</span> <span class="hljs-title">&quot;cinder-volumes</span><span class="hljs-string">&quot; successfully created</span><br></code></pre></td></tr></table></figure><p>只有实例可以访问块存储卷。然而，底层操作系统管理与卷相关联的设备。默认情况下，LVM卷扫描工具扫描&#x2F;dev目录中包含卷的块存储设备。如果项目在其卷上使用LVM，那么扫描工具将检测这些卷并试图缓存它们，这会导致底层操作系统和项目卷出现各种问题。必须重新配置LVM，以便只扫描包含cinder-volume卷组的设备。</p><h4 id="编辑-etc-lvm-lvm-conf文件"><a href="#编辑-etc-lvm-lvm-conf文件" class="headerlink" title="编辑 &#x2F;etc&#x2F;lvm&#x2F;lvm.conf文件"></a>编辑 &#x2F;etc&#x2F;lvm&#x2F;lvm.conf文件</h4><p>在devices选项，添加一个接受&#x2F;dev&#x2F;sdb设备并拒绝所有其他设备的过滤器:<br>注：filter数组中的每个项都以for accept或r for reject开头，并包含一个用于设备名称的正则表达式。数组必须以r&#x2F;结束。<br>*&#x2F; 拒绝任何剩余设备。您可以使用vgs -vvvv命令来测试过滤器。</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">devices &#123;<br><span class="hljs-string">...</span><br>filter = [ <span class="hljs-string">&quot;a/sdb/&quot;</span>, <span class="hljs-string">&quot;r/.*/&quot;</span>]<br><span class="hljs-string">...</span>&#125;<br></code></pre></td></tr></table></figure><h4 id="安装配置组件-1"><a href="#安装配置组件-1" class="headerlink" title="安装配置组件"></a>安装配置组件</h4><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># yum install -y openstack-cinder targetcli python-keystone</span><br></code></pre></td></tr></table></figure><h4 id="编辑-etc-cinder-cinder-conf-文件"><a href="#编辑-etc-cinder-cinder-conf-文件" class="headerlink" title="编辑&#x2F;etc&#x2F;cinder&#x2F;cinder.conf 文件"></a>编辑&#x2F;etc&#x2F;cinder&#x2F;cinder.conf 文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">vi /etc/cinder/cinder.conf</span><br></code></pre></td></tr></table></figure><ul><li>在[database]选项，配置数据库访问</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[database]</span><br><span class="hljs-attr">connection</span> = mysql+pymysql://cinder:<span class="hljs-number">123456</span>@controller/cinder<br></code></pre></td></tr></table></figure><ul><li>在[DEFAULT]选项，配置RabbitMQ消息队列访问:</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[DEFAULT]</span><br><span class="hljs-attr">transport_url</span> = rabbit://openstack:<span class="hljs-number">123456</span>@controller<br></code></pre></td></tr></table></figure><ul><li>在[DEFAULT]和[keystone_authtoken]选项，配置身份服务访问:</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[DEFAULT]</span><br><span class="hljs-attr">auth_strategy</span> = keystone<br><span class="hljs-section">[keystone_authtoken]</span><br><span class="hljs-attr">auth_uri</span> = http://controller:<span class="hljs-number">5000</span><br><span class="hljs-attr">auth_url</span> = http://controller:<span class="hljs-number">5000</span><br><span class="hljs-attr">memcached_servers</span> = controller:<span class="hljs-number">11211</span><br><span class="hljs-attr">auth_type</span> = password<br><span class="hljs-attr">project_domain_id</span> = default<br><span class="hljs-attr">user_domain_id</span> = default<br><span class="hljs-attr">project_name</span> = service<br><span class="hljs-attr">username</span> = cinder<br><span class="hljs-attr">password</span> = <span class="hljs-number">123456</span><br></code></pre></td></tr></table></figure><ul><li>在[DEFAULT]部分，配置my_ip选项:</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">my_ip</span> = <span class="hljs-number">192.168</span>.<span class="hljs-number">100.69</span><br></code></pre></td></tr></table></figure><ul><li>在[DEFAULT]选项，配置映像服务API的位置:</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">glance_api_servers</span> = http://controller:<span class="hljs-number">9292</span><br></code></pre></td></tr></table></figure><ul><li>在[lvm]选项，使用lvm驱动程序、Cinder卷组、iSCSI协议和iSCSI服务配置lvm后端。如果[lvm]部分不存在，则添加它:</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[lvm]</span><br><span class="hljs-attr">volume_driver</span> = cinder.volume.drivers.lvm.LVMVolumeDriver<br><span class="hljs-attr">volume_group</span> = cinder-volumes<br><span class="hljs-attr">iscsi_protocol</span> = iscsi<br><span class="hljs-attr">iscsi_helper</span> = lioadm<br></code></pre></td></tr></table></figure><ul><li>在[DEFAULT]部分，启用LVM后端:</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[DEFAULT]</span><br><span class="hljs-attr">enabled_backends</span> = lvm<br></code></pre></td></tr></table></figure><ul><li>在[oslo_concurrency]节中，配置lock路径</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[oslo_concurrency]</span><br><span class="hljs-attr">lock_path</span> = /var/lib/cinder/tmp<br></code></pre></td></tr></table></figure><h4 id="开启服务"><a href="#开启服务" class="headerlink" title="开启服务"></a>开启服务</h4><p>启动块存储卷服务，包括它的依赖项，并配置它们在系统启动时启动:</p><figure class="highlight thrift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs thrift"># systemctl enable openstack-cinder-volume.<span class="hljs-keyword">service</span> target.<span class="hljs-keyword">service</span><br># systemctl restart openstack-cinder-volume.<span class="hljs-keyword">service</span> target.<span class="hljs-keyword">service</span><br></code></pre></td></tr></table></figure><h4 id="校验操作"><a href="#校验操作" class="headerlink" title="校验操作"></a>校验操作</h4><p>生成临时环境变量</p><p><code># . admin-openrc</code><br>列出服务组件以验证每个流程的成功启动:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># openstack volume service list</span><br></code></pre></td></tr></table></figure><p>创建一个1G的卷，并查看其状态</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># cinder create --display-name myVolume 1</span><br><span class="hljs-meta"># cinder list</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Openstack Queens 环境搭建（八）计算节点实例首次孵化优化</title>
    <link href="/2019/07/29/openstack/queens/openstack_queens_install_8/"/>
    <url>/2019/07/29/openstack/queens/openstack_queens_install_8/</url>
    
    <content type="html"><![CDATA[<p><strong>Controller节点</strong></p><p>创建镜像缓存目录，并调整权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> -p /var/lib/glance/imagecache</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">chmod</span> -R 777 /var/lib/glance/images</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">chmod</span> -R 777 /var/lib/glance/imagecache</span><br></code></pre></td></tr></table></figure><p>配置共享文件夹，将与控制节点管理网卡同网段的CIDR配置入文件，并赋读写权限</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># vim /etc/exports</span><br><br><span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/glance/im</span>agecache <span class="hljs-number">192.100</span>.<span class="hljs-number">10.0</span>/<span class="hljs-number">24</span>(rw)<br></code></pre></td></tr></table></figure><p>加载刚才的配置文件</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># exportfs -e</span><br></code></pre></td></tr></table></figure><p>注意控制节点的iptables，要放开111（rpc）、2049(nfs)和892(nfs挂载)端口，一般在OpenStack中这几个端口都是默认放开的。<br>设置nfs服务开机启动，并启动nfs</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl <span class="hljs-built_in">enable</span> rpcbind</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl <span class="hljs-built_in">enable</span> nfs</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl restart rpcbind</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl restart nfs</span><br></code></pre></td></tr></table></figure><p>确认本地共享目录是否正确（showmount -e）</p><p><strong>计算节点</strong></p><p>计算节点配置nfs挂载以及系统开机自动挂载有脚本实现<br>在计算节点创建文件夹，并将项目源码中的脚本拷贝上去</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> -p /var/www/kdpa/bin</span><br></code></pre></td></tr></table></figure><p>将项目源码中&#x2F;kdpa&#x2F;bin&#x2F;目录下的sed_rclocal.sh、mount_nfs.sh脚本拷贝到计算节点新创建的目录下</p><p><strong>sed_rclocal.sh</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/usr/bin/env bash</span><br><br>rc_local_file=<span class="hljs-string">&quot;/etc/rc.d/rc.local&quot;</span><br><span class="hljs-built_in">chmod</span> 755 <span class="hljs-variable">$&#123;rc_local_file&#125;</span><br><br><span class="hljs-comment"># add mount nfs shell in rc.local</span><br>mount_nfs_sh=<span class="hljs-string">&quot;/var/www/kdpa/bin/mount_nfs.sh&quot;</span><br><span class="hljs-built_in">chmod</span> 755 <span class="hljs-variable">$&#123;mount_nfs_sh&#125;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/usr/bin/sh <span class="hljs-variable">$&#123;mount_nfs_sh&#125;</span>&quot;</span>&gt;&gt;<span class="hljs-variable">$&#123;rc_local_file&#125;</span><br><br><br><span class="hljs-comment"># add ovs set-manager shell in rc.local</span><br>ovs_set_manager_sh=<span class="hljs-string">&quot;/var/www/kdpa/bin/ovs_set_manager.sh&quot;</span><br><span class="hljs-built_in">chmod</span> 755 <span class="hljs-variable">$&#123;ovs_set_manager_sh&#125;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/usr/bin/sh <span class="hljs-variable">$&#123;ovs_set_manager_sh&#125;</span>&quot;</span>&gt;&gt;<span class="hljs-variable">$&#123;rc_local_file&#125;</span><br></code></pre></td></tr></table></figure><p><strong>mount_nfs.sh</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/usr/bin/env bash</span><br><br>nfs_service_image_cache_path=<span class="hljs-string">&quot;/var/lib/glance/imagecache&quot;</span><br>local_image_cache_path=<span class="hljs-string">&quot;/var/lib/nova/instances/_base&quot;</span><br>controller_host=$(<span class="hljs-built_in">cat</span> /etc/hosts | grep controller | awk <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span>)<br><br><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$&#123;local_image_cache_path&#125;</span><br><span class="hljs-built_in">chmod</span> -R 777 <span class="hljs-variable">$&#123;local_image_cache_path&#125;</span><br><br>mount -t nfs4 <span class="hljs-variable">$&#123;controller_host&#125;</span>:<span class="hljs-variable">$&#123;nfs_service_image_cache_path&#125;</span>  <span class="hljs-variable">$&#123;local_image_cache_path&#125;</span><br></code></pre></td></tr></table></figure><p>执行脚本mount_nfs.sh挂载控制节点nfs共享目录</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata"># <span class="hljs-keyword">sh</span> /<span class="hljs-keyword">var</span>/www/kdpa/bin/mount_nfs.<span class="hljs-keyword">sh</span><br></code></pre></td></tr></table></figure><p>验证挂载是否成功</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># mount -l | grep 服务端IP</span><br></code></pre></td></tr></table></figure><p>执行脚本sed_rclocal.sh调整系统开机启动脚本</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata"># <span class="hljs-keyword">sh</span> /<span class="hljs-keyword">var</span>/www/kdpa/bin/sed_rclocal.<span class="hljs-keyword">sh</span><br></code></pre></td></tr></table></figure><p>最终查看&#x2F;etc&#x2F;rc.d&#x2F;rc.local文件是否添加成功</p>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SQLAlchemy 中的 Engine 是什么</title>
    <link href="/2019/07/17/other/sqlalchemy_engine/"/>
    <url>/2019/07/17/other/sqlalchemy_engine/</url>
    
    <content type="html"><![CDATA[<p>连接池很重要，因为每次发送sql查询的时候都需要先建立连接，如果程序启动的时候事先就初始化一批连接放在连接池，每次用完后又放回连接池给其它请求使用，就能大大提高查询的效率。</p><p><strong>Engine 初始化</strong><br>Engine 的初始化非常简单，通过工厂函数 create_engine 就可以创建。</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lisp">from sqlalchemy import create_engine<br><br>engine = create_engine(&#x27;mysql<span class="hljs-symbol">://user</span><span class="hljs-symbol">:password</span>@localhost:<span class="hljs-number">3306</span>/test?charset=utf8&#x27;)<br></code></pre></td></tr></table></figure><p>构建好 Engine 对象的同时，连接池和Dialect也创建好了，但是这时候并不会立马与数据库建立真正的连接，只有你调用 Engine.connect() 或者 Engine.execute(sql) 执行SQL请求的时候，才会建立真正的连接。<br>因此 Engine 和 Pool 的行为称之为延迟初始化，等真正要派上用场的时候才去建立连接。</p><p>需要注意的是，创建引擎时，如果数据库的密码含有特殊字符，需要先编码处理</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">import</span> urllib.parse</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">urllib.parse.quote_plus(<span class="hljs-string">&quot;kx%jj5/g&quot;</span>)</span><br>&#x27;kx%25jj5%2Fg&#x27;<br></code></pre></td></tr></table></figure><p>其它数据库方言初始化 engine 的方式可参考官方文档：</p><ul><li><a href="https://docs.sqlalchemy.org/en/14/core/engines.html#database-urls">https://docs.sqlalchemy.org/en/14/core/engines.html#database-urls</a></li></ul><p>create_engine 还有很多可选参数，这里介绍几个重要的参数。</p><pre><code class="hljs">engine = create_engine(&#39;mysql://user:password@localhost:3306/test?charset=utf8&#39;,                       echo=False                       pool_size=100,                       pool_recycle=3600,                       pool_pre_ping=True)</code></pre><p><strong>echo</strong> ：为 True 时候会把sql语句打印出来，当然，你可以通过配置logger来控制输出，这里不做讨论。<br><strong>pool_size</strong> ： 是连接池的大小，默认为5个，0表示连接数无限制<br><strong>pool_recycle</strong> ： MySQL 默认情况下如果一个连接8小时内容没有任何动作（查询请求）就会自动断开链接，出现 MySQL has gone away的错误。设置了 pool_recycle 后 SQLAlchemy 就会在指定时间内回收连接。如果设置为3600 就表示 1小时后该连接会被自动回收。<br><strong>pool_pre_ping</strong> ： 这是1.2新增的参数，如果值为True，那么每次从连接池中拿连接的时候，都会向数据库发送一个类似 select 1 的测试查询语句来判断服务器是否正常运行。当该连接出现 disconnect 的情况时，该连接连同pool中的其它连接都会被回收。</p><p>参考链接：</p><ul><li><a href="https://docs.sqlalchemy.org/en/14/core/engines.html#database-urls">https://docs.sqlalchemy.org/en/14/core/engines.html#database-urls</a></li><li><a href="https://stackoverflow.com/questions/34322471/sqlalchemy-engine-connection-and-session-difference">https://stackoverflow.com/questions/34322471/sqlalchemy-engine-connection-and-session-difference</a></li><li><a href="https://docs.sqlalchemy.org/en/13/core/pooling.html#dealing-with-disconnects">https://docs.sqlalchemy.org/en/13/core/pooling.html#dealing-with-disconnects</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>其它</category>
      
    </categories>
    
    
    <tags>
      
      <tag>其它</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Openstack命令行</title>
    <link href="/2019/07/11/openstack/openstack_terminal/"/>
    <url>/2019/07/11/openstack/openstack_terminal/</url>
    
    <content type="html"><![CDATA[<p><strong>Keystone</strong><br><strong>列出所有的用户</strong></p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">$ openstack user list</span><br><span class="hljs-section">+----------------------------------+-----------+</span><br><span class="hljs-section">| ID                               | Name      |</span><br><span class="hljs-section">+----------------------------------+-----------+</span><br>| 2ac5fe07105a43518ae444a37640222b | demo      |<br>| 5bc73e84451b4e71906232bd3849422d | neutron   |<br>| 84b0b75df69f4413a1380c9efc249b2d | placement |<br>| 87bf7fb4671f4524a6fa64ad75856594 | admin     |<br>| 9aaa5aa26b414d35b37b851ccf749a55 | nova      |<br><span class="hljs-section">| eee2818e703e47c5a434e5926c90e7fb | glance    |</span><br><span class="hljs-section">+----------------------------------+-----------+</span><br></code></pre></td></tr></table></figure><p><strong>列出认证服务目录</strong></p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">$ openstack catalog list<br>+-----------+-----------+-----------------------------------------+<br>|<span class="hljs-string"> Name      </span>|<span class="hljs-string"> Type      </span>|<span class="hljs-string"> Endpoints                               </span>|<br>+-----------+-----------+-----------------------------------------+<br>|<span class="hljs-string"> placement </span>|<span class="hljs-string"> placement </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   internal: http://controller:8778      </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   public: http://controller:8778        </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   admin: http://controller:8778         </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">                                         </span>|<br>|<span class="hljs-string"> keystone  </span>|<span class="hljs-string"> identity  </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   internal: http://controller:5000/v3/  </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   public: http://controller:5000/v3/    </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   admin: http://controller:5000/v3/     </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">                                         </span>|<br>|<span class="hljs-string"> neutron   </span>|<span class="hljs-string"> network   </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   public: http://controller:9696        </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   admin: http://controller:9696         </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   internal: http://controller:9696      </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">                                         </span>|<br>|<span class="hljs-string"> glance    </span>|<span class="hljs-string"> image     </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   admin: http://controller:9292         </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   internal: http://controller:9292      </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   public: http://controller:9292        </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">                                         </span>|<br>|<span class="hljs-string"> nova      </span>|<span class="hljs-string"> compute   </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   internal: http://controller:8774/v2.1 </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   admin: http://controller:8774/v2.1    </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   public: http://controller:8774/v2.1   </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">                                         </span>|<br>+-----------+-----------+-----------------------------------------+<br></code></pre></td></tr></table></figure><p><strong>Glance</strong><br><strong>列出您可以访问的镜像</strong></p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">$ openstack image list<br>+--------------------------------------+---------------------+--------+<br>|<span class="hljs-string"> ID                                   </span>|<span class="hljs-string"> Name                </span>|<span class="hljs-string"> Status </span>|<br>+--------------------------------------+---------------------+--------+<br>|<span class="hljs-string"> 70d455f6-1a00-48f5-9b21-5f8fca019014 </span>|<span class="hljs-string"> centos7-mini        </span>|<span class="hljs-string"> active </span>|<br>|<span class="hljs-string"> 1a7e4d60-3c26-41bb-be0c-34c467b2d3c3 </span>|<span class="hljs-string"> pstunnel            </span>|<span class="hljs-string"> active </span>|<br>|<span class="hljs-string"> b2464312-8acb-4ff9-ba20-75560e5577f4 </span>|<span class="hljs-string"> pstunnelA           </span>|<span class="hljs-string"> active </span>|<br>|<span class="hljs-string"> 705c7007-8a28-49e8-8df7-61bbfbf41bbd </span>|<span class="hljs-string"> pstunnelB           </span>|<span class="hljs-string"> active </span>|<br>|<span class="hljs-string"> ad02946e-9c1f-42f0-9a9e-235ae7012bc3 </span>|<span class="hljs-string"> router              </span>|<span class="hljs-string"> active </span>|<br>|<span class="hljs-string"> ae8c618d-3c6e-449c-9d2a-3f08bf84cc5e </span>|<span class="hljs-string"> router22            </span>|<span class="hljs-string"> active </span>|<br>|<span class="hljs-string"> b54361d4-bc24-46cb-94b2-b1f672b01c2a </span>|<span class="hljs-string"> sw-f-in-centos7_ext </span>|<span class="hljs-string"> active </span>|<br>|<span class="hljs-string"> 3a1adf75-c82e-4540-91e0-2167cb921612 </span>|<span class="hljs-string"> sw-f-in-centos7_int </span>|<span class="hljs-string"> active </span>|<br>|<span class="hljs-string"> ebfc7c40-4ac3-42ab-96ae-65e3c17af194 </span>|<span class="hljs-string"> sw-z-in-centos7_ext </span>|<span class="hljs-string"> active </span>|<br>|<span class="hljs-string"> 7355a66c-3f05-4ed5-9088-540faf71ebf8 </span>|<span class="hljs-string"> sw-z-in-centos7_int </span>|<span class="hljs-string"> active </span>|<br>|<span class="hljs-string"> 3b19c8ad-6012-406a-9e7f-e66416deeb1e </span>|<span class="hljs-string"> testforimage        </span>|<span class="hljs-string"> active </span>|<br>|<span class="hljs-string"> 436c5ab5-14e7-4eb8-95b9-e47d85e60e83 </span>|<span class="hljs-string"> win7                </span>|<span class="hljs-string"> active </span>|<br>+--------------------------------------+---------------------+--------+<br></code></pre></td></tr></table></figure><p><strong>查看一个指定的镜像</strong><br><code>$ openstack image show [IMAGE-ID/IMAGE-Name]</code></p><figure class="highlight plaintext"><figcaption><span>openstack image show 70d455f6-1a00-48f5-9b21-5f8fca019014</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs $">+------------------+------------------------------------------------------+<br>| Field            | Value                                                |<br>+------------------+------------------------------------------------------+<br>| checksum         | f3ab346b3ca2b88d1347c24adf0b234b                     |<br>| container_format | bare                                                 |<br>| created_at       | 2019-06-26T09:08:51Z                                 |<br>| disk_format      | qcow2                                                |<br>| file             | /v2/images/70d455f6-1a00-48f5-9b21-5f8fca019014/file |<br>| id               | 70d455f6-1a00-48f5-9b21-5f8fca019014                 |<br>| min_disk         | 0                                                    |<br>| min_ram          | 0                                                    |<br>| name             | centos7-mini                                         |<br>| owner            | 2e69bc10ab5f427bbbd6d40148d96309                     |<br>| protected        | False                                                |<br>| schema           | /v2/schemas/image                                    |<br>| size             | 3758882816                                           |<br>| status           | active                                               |<br>| tags             |                                                      |<br>| updated_at       | 2019-06-26T09:09:32Z                                 |<br>| virtual_size     | None                                                 |<br>| visibility       | public                                               |<br>+------------------+------------------------------------------------------+<br><br></code></pre></td></tr></table></figure><p><strong>上传QCOW2镜像</strong></p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">$ openstack image create <span class="hljs-string">&quot;centos7-mini2&quot;</span> --file centos7-mini.qcow2 --disk-format qcow2 --container-format bare --public<br><br>+------------------+------------------------------------------------------+<br>|<span class="hljs-string"> Field            </span>|<span class="hljs-string"> Value                                                </span>|<br>+------------------+------------------------------------------------------+<br>|<span class="hljs-string"> checksum         </span>|<span class="hljs-string"> f3ab346b3ca2b88d1347c24adf0b234b                     </span>|<br>|<span class="hljs-string"> container_format </span>|<span class="hljs-string"> bare                                                 </span>|<br>|<span class="hljs-string"> created_at       </span>|<span class="hljs-string"> 2019-07-11T07:56:51Z                                 </span>|<br>|<span class="hljs-string"> disk_format      </span>|<span class="hljs-string"> qcow2                                                </span>|<br>|<span class="hljs-string"> file             </span>|<span class="hljs-string"> /v2/images/4072bdfb-f727-4e3f-a1f5-c3467b12a15e/file </span>|<br>|<span class="hljs-string"> id               </span>|<span class="hljs-string"> 4072bdfb-f727-4e3f-a1f5-c3467b12a15e                 </span>|<br>|<span class="hljs-string"> min_disk         </span>|<span class="hljs-string"> 0                                                    </span>|<br>|<span class="hljs-string"> min_ram          </span>|<span class="hljs-string"> 0                                                    </span>|<br>|<span class="hljs-string"> name             </span>|<span class="hljs-string"> centos7-mini2                                        </span>|<br>|<span class="hljs-string"> owner            </span>|<span class="hljs-string"> 2e69bc10ab5f427bbbd6d40148d96309                     </span>|<br>|<span class="hljs-string"> protected        </span>|<span class="hljs-string"> False                                                </span>|<br>|<span class="hljs-string"> schema           </span>|<span class="hljs-string"> /v2/schemas/image                                    </span>|<br>|<span class="hljs-string"> size             </span>|<span class="hljs-string"> 3758882816                                           </span>|<br>|<span class="hljs-string"> status           </span>|<span class="hljs-string"> active                                               </span>|<br>|<span class="hljs-string"> tags             </span>|<span class="hljs-string">                                                      </span>|<br>|<span class="hljs-string"> updated_at       </span>|<span class="hljs-string"> 2019-07-11T07:57:54Z                                 </span>|<br>|<span class="hljs-string"> virtual_size     </span>|<span class="hljs-string"> None                                                 </span>|<br>|<span class="hljs-string"> visibility       </span>|<span class="hljs-string"> public                                               </span>|<br>+------------------+------------------------------------------------------+<br></code></pre></td></tr></table></figure><p><strong>删除指定的镜像</strong></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">$ openstack image <span class="hljs-keyword">delete</span> [IMAGE-ID/IMAGE-Name]<br></code></pre></td></tr></table></figure><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">$ openstack image <span class="hljs-keyword">delete</span> <span class="hljs-number">4072b</span>dfb-f727<span class="hljs-number">-4e3</span>f-a1f5-c3467b12a15e<br></code></pre></td></tr></table></figure><p><strong>Nova</strong><br><strong>列出实例</strong></p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">$ openstack server list<br>+--------------------------------------+-------------------------+---------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------+---------------------+<br>|<span class="hljs-string"> ID                                   </span>|<span class="hljs-string"> Name                    </span>|<span class="hljs-string"> Status  </span>|<span class="hljs-string"> Networks                                                                                                                                                                         </span>|<span class="hljs-string"> Image               </span>|<span class="hljs-string"> Flavor              </span>|<br>+--------------------------------------+-------------------------+---------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------+---------------------+<br>|<span class="hljs-string"> 2ec1ace1-ef83-4d30-837e-f7f2df344a6c </span>|<span class="hljs-string"> n-UDYIQCS6              </span>|<span class="hljs-string"> SHUTOFF </span>|<span class="hljs-string"> network_5261=192.168.1.3                                                                                                                                                         </span>|<span class="hljs-string"> win7                </span>|<span class="hljs-string"> win7                </span>|<br>|<span class="hljs-string"> 88a7d91d-3c29-461e-8d07-a0d272697a61 </span>|<span class="hljs-string"> n-L9QGOHRE              </span>|<span class="hljs-string"> SHUTOFF </span>|<span class="hljs-string"> network_12177=192.168.1.19                                                                                                                                                       </span>|<span class="hljs-string"> win7                </span>|<span class="hljs-string"> win7                </span>|<br>|<span class="hljs-string"> 274543b3-7890-4446-a5d0-1c6acfb9e1f4 </span>|<span class="hljs-string"> vm_n-4ejn7bk2c9o@28     </span>|<span class="hljs-string"> ACTIVE  </span>|<span class="hljs-string"> network_10888=192.168.1.18                                                                                                                                                       </span>|<span class="hljs-string"> win7                </span>|<span class="hljs-string"> win7                </span>|<br>|<span class="hljs-string"> c2cb7d6c-4f3e-4f32-bbd5-19639d415481 </span>|<span class="hljs-string"> sw_n-pf6p66vh4f_ext@33  </span>|<span class="hljs-string"> SHUTOFF </span>|<span class="hljs-string"> network_10360=192.168.1.3; n-XH29F3CG-net=8.8.8.9; network_21065=192.168.1.6; network_16174=192.168.1.5                                                                          </span>|<span class="hljs-string"> sw-z-in-centos7_ext </span>|<span class="hljs-string"> sw-z-in-centos7_ext </span>|<br>|<span class="hljs-string"> 5e009b71-4a8b-478a-9f17-349153a26ad4 </span>|<span class="hljs-string"> n-UE0N48YS              </span>|<span class="hljs-string"> SHUTOFF </span>|<span class="hljs-string"> network_11645=192.168.1.4; network_14835=192.168.1.13; network_20101=192.168.1.9; internal=20.0.0.23, 192.100.200.225; network_18377=192.168.1.3; network_8075=192.168.1.10      </span>|<span class="hljs-string"> pstunnel            </span>|<span class="hljs-string"> pstunnel            </span>|<br>|<span class="hljs-string"> 374aedbe-d7c3-4f89-a66d-020401a257dc </span>|<span class="hljs-string"> n-MF9XYLTQ_int          </span>|<span class="hljs-string"> SHUTOFF </span>|<span class="hljs-string"> network_23143=192.168.1.7; network_14693=192.168.1.7; network_13651=192.168.1.11                                                                                                 </span>|<span class="hljs-string"> sw-z-in-centos7_int </span>|<span class="hljs-string"> sw-z-in-centos7_int </span>|<br>|<span class="hljs-string"> acd8efcb-9350-4e19-a105-a1bcfb529697 </span>|<span class="hljs-string"> rt_n-une1ph6cts@20      </span>|<span class="hljs-string"> SHUTOFF </span>|<span class="hljs-string"> Rnet_n-une1ph6cts_0=192.168.3.1; Rnet_n-une1ph6cts_1=192.168.2.1                                                                                                                 </span>|<span class="hljs-string"> router              </span>|<span class="hljs-string"> router              </span>|<br>|<span class="hljs-string"> 1efe6a9a-d005-4b32-926f-bb94fb702a05 </span>|<span class="hljs-string"> vm_n-vp0eo8lm0c@20      </span>|<span class="hljs-string"> SHUTOFF </span>|<span class="hljs-string"> network_14083=192.168.1.10                                                                                                                                                       </span>|<span class="hljs-string">                     </span>|<span class="hljs-string">                     </span>|<br>+--------------------------------------+-------------------------+---------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------+---------------------+<br></code></pre></td></tr></table></figure><p><strong>显示实例详细信息</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ openstack <span class="hljs-keyword">server</span> <span class="hljs-keyword">show</span> [<span class="hljs-keyword">SERVER</span>-ID/<span class="hljs-keyword">SERVER</span>-<span class="hljs-type">Name</span>]<br></code></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">$ openstack server show 2ec1ace1-ef83-4d30-837e-f7f2df344a6c<br>+-------------------------------------+----------------------------------------------------------+<br>|<span class="hljs-string"> Field                               </span>|<span class="hljs-string"> Value                                                    </span>|<br>+-------------------------------------+----------------------------------------------------------+<br>|<span class="hljs-string"> OS-DCF:diskConfig                   </span>|<span class="hljs-string"> MANUAL                                                   </span>|<br>|<span class="hljs-string"> OS-EXT-AZ:availability_zone         </span>|<span class="hljs-string"> nova                                                     </span>|<br>|<span class="hljs-string"> OS-EXT-SRV-ATTR:host                </span>|<span class="hljs-string"> compute                                                  </span>|<br>|<span class="hljs-string"> OS-EXT-SRV-ATTR:hypervisor_hostname </span>|<span class="hljs-string"> compute                                                  </span>|<br>|<span class="hljs-string"> OS-EXT-SRV-ATTR:instance_name       </span>|<span class="hljs-string"> instance-00000294                                        </span>|<br>|<span class="hljs-string"> OS-EXT-STS:power_state              </span>|<span class="hljs-string"> Shutdown                                                 </span>|<br>|<span class="hljs-string"> OS-EXT-STS:task_state               </span>|<span class="hljs-string"> None                                                     </span>|<br>|<span class="hljs-string"> OS-EXT-STS:vm_state                 </span>|<span class="hljs-string"> stopped                                                  </span>|<br>|<span class="hljs-string"> OS-SRV-USG:launched_at              </span>|<span class="hljs-string"> 2019-07-11T06:30:19.000000                               </span>|<br>|<span class="hljs-string"> OS-SRV-USG:terminated_at            </span>|<span class="hljs-string"> None                                                     </span>|<br>|<span class="hljs-string"> accessIPv4                          </span>|<span class="hljs-string">                                                          </span>|<br>|<span class="hljs-string"> accessIPv6                          </span>|<span class="hljs-string">                                                          </span>|<br>|<span class="hljs-string"> addresses                           </span>|<span class="hljs-string"> network_5261=192.168.1.3                                 </span>|<br>|<span class="hljs-string"> config_drive                        </span>|<span class="hljs-string">                                                          </span>|<br>|<span class="hljs-string"> created                             </span>|<span class="hljs-string"> 2019-07-11T06:30:12Z                                     </span>|<br>|<span class="hljs-string"> flavor                              </span>|<span class="hljs-string"> win7 (fd8297ef-d7ac-4b4f-8c1e-1c90fcce488c)              </span>|<br>|<span class="hljs-string"> hostId                              </span>|<span class="hljs-string"> 37f71a5ebb11ac3ed0f0496a313bb9246829f1da1839c8fd3dc4f98b </span>|<br>|<span class="hljs-string"> id                                  </span>|<span class="hljs-string"> 2ec1ace1-ef83-4d30-837e-f7f2df344a6c                     </span>|<br>|<span class="hljs-string"> image                               </span>|<span class="hljs-string"> win7 (436c5ab5-14e7-4eb8-95b9-e47d85e60e83)              </span>|<br>|<span class="hljs-string"> key_name                            </span>|<span class="hljs-string"> None                                                     </span>|<br>|<span class="hljs-string"> name                                </span>|<span class="hljs-string"> n-UDYIQCS6                                               </span>|<br>|<span class="hljs-string"> project_id                          </span>|<span class="hljs-string"> 2e69bc10ab5f427bbbd6d40148d96309                         </span>|<br>|<span class="hljs-string"> properties                          </span>|<span class="hljs-string">                                                          </span>|<br>|<span class="hljs-string"> security_groups                     </span>|<span class="hljs-string"> name=&#x27;default&#x27;                                           </span>|<br>|<span class="hljs-string"> status                              </span>|<span class="hljs-string"> SHUTOFF                                                  </span>|<br>|<span class="hljs-string"> updated                             </span>|<span class="hljs-string"> 2019-07-11T06:31:30Z                                     </span>|<br>|<span class="hljs-string"> user_id                             </span>|<span class="hljs-string"> 87bf7fb4671f4524a6fa64ad75856594                         </span>|<br>|<span class="hljs-string"> volumes_attached                    </span>|<span class="hljs-string">                                                          </span>|<br>+-------------------------------------+----------------------------------------------------------+<br></code></pre></td></tr></table></figure><p><strong>Neutron</strong><br><strong>列出所有网络</strong></p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">$ openstack network list<br><br><span class="hljs-code">+--------------------------------------+</span>----------------------<span class="hljs-code">+--------------------------------------+</span><br><span class="hljs-section">| ID                                   | Name                 | Subnets                              |</span><br><span class="hljs-section">+--------------------------------------+----------------------+--------------------------------------+</span><br>| 01e6c390-1d5e-4140-9ea3-98754bd0c58f | network_29287        | 8ed09dee-0e16-4514-8821-9a8e1f77c43a |<br><span class="hljs-section">| 030f303e-e3d3-46e1-a85a-5ea6cea4d3ba | n-69PSABRW-net       | e2ea53d0-1b29-43d3-910b-3296d96d004f |</span><br><span class="hljs-section">+--------------------------------------+----------------------+--------------------------------------+</span><br></code></pre></td></tr></table></figure><p><strong>查看网络</strong></p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><span class="hljs-variable">$ </span>openstack network show NETWORK-ID<br></code></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">$ openstack network show 01e6c390-1d5e-4140-9ea3-98754bd0c58f<br>+---------------------------+--------------------------------------+<br>|<span class="hljs-string"> Field                     </span>|<span class="hljs-string"> Value                                </span>|<br>+---------------------------+--------------------------------------+<br>|<span class="hljs-string"> admin_state_up            </span>|<span class="hljs-string"> UP                                   </span>|<br>|<span class="hljs-string"> availability_zone_hints   </span>|<span class="hljs-string">                                      </span>|<br>|<span class="hljs-string"> availability_zones        </span>|<span class="hljs-string"> nova                                 </span>|<br>|<span class="hljs-string"> created_at                </span>|<span class="hljs-string"> 2019-06-19T02:16:06Z                 </span>|<br>|<span class="hljs-string"> description               </span>|<span class="hljs-string">                                      </span>|<br>|<span class="hljs-string"> dns_domain                </span>|<span class="hljs-string"> None                                 </span>|<br>|<span class="hljs-string"> id                        </span>|<span class="hljs-string"> 01e6c390-1d5e-4140-9ea3-98754bd0c58f </span>|<br>|<span class="hljs-string"> ipv4_address_scope        </span>|<span class="hljs-string"> None                                 </span>|<br>|<span class="hljs-string"> ipv6_address_scope        </span>|<span class="hljs-string"> None                                 </span>|<br>|<span class="hljs-string"> is_default                </span>|<span class="hljs-string"> None                                 </span>|<br>|<span class="hljs-string"> is_vlan_transparent       </span>|<span class="hljs-string"> None                                 </span>|<br>|<span class="hljs-string"> mtu                       </span>|<span class="hljs-string"> 1500                                 </span>|<br>|<span class="hljs-string"> name                      </span>|<span class="hljs-string"> network_29287                        </span>|<br>|<span class="hljs-string"> port_security_enabled     </span>|<span class="hljs-string"> True                                 </span>|<br>|<span class="hljs-string"> project_id                </span>|<span class="hljs-string"> 2e69bc10ab5f427bbbd6d40148d96309     </span>|<br>|<span class="hljs-string"> provider:network_type     </span>|<span class="hljs-string"> vxlan                                </span>|<br>|<span class="hljs-string"> provider:physical_network </span>|<span class="hljs-string"> None                                 </span>|<br>|<span class="hljs-string"> provider:segmentation_id  </span>|<span class="hljs-string"> 29287                                </span>|<br>|<span class="hljs-string"> qos_policy_id             </span>|<span class="hljs-string"> None                                 </span>|<br>|<span class="hljs-string"> revision_number           </span>|<span class="hljs-string"> 3                                    </span>|<br>|<span class="hljs-string"> router:external           </span>|<span class="hljs-string"> Internal                             </span>|<br>|<span class="hljs-string"> segments                  </span>|<span class="hljs-string"> None                                 </span>|<br>|<span class="hljs-string"> shared                    </span>|<span class="hljs-string"> True                                 </span>|<br>|<span class="hljs-string"> status                    </span>|<span class="hljs-string"> ACTIVE                               </span>|<br>|<span class="hljs-string"> subnets                   </span>|<span class="hljs-string"> 8ed09dee-0e16-4514-8821-9a8e1f77c43a </span>|<br>|<span class="hljs-string"> tags                      </span>|<span class="hljs-string">                                      </span>|<br>|<span class="hljs-string"> updated_at                </span>|<span class="hljs-string"> 2019-06-19T02:16:07Z                 </span>|<br>+---------------------------+--------------------------------------+<br></code></pre></td></tr></table></figure><p><strong>列出所有子网</strong></p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">$ openstack subnet list<br><br>+--------------------------------------+-----------------------+--------------------------------------+------------------+<br>|<span class="hljs-string"> ID                                   </span>|<span class="hljs-string"> Name                  </span>|<span class="hljs-string"> Network                              </span>|<span class="hljs-string"> Subnet           </span>|<br>+--------------------------------------+-----------------------+--------------------------------------+------------------+<br>|<span class="hljs-string"> 00414731-ab21-4ee8-8bf2-86d960cc4339 </span>|<span class="hljs-string"> network_sub_18721     </span>|<span class="hljs-string"> 84d6ee39-77b3-4a0b-80f8-67922b63079a </span>|<span class="hljs-string"> 192.168.1.0/24   </span>|<br>|<span class="hljs-string"> 014cb2e2-bdbe-4849-aec7-5fe0581e3b67 </span>|<span class="hljs-string"> network_sub_20494     </span>|<span class="hljs-string"> 6eb235c5-798c-49de-8fd3-08aa64f9abaa </span>|<span class="hljs-string"> 192.168.1.0/24   </span>|<br>+--------------------------------------+-----------------------+--------------------------------------+------------------+<br></code></pre></td></tr></table></figure><p><strong>查看子网</strong></p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">$ openstack <span class="hljs-keyword">subnet </span><span class="hljs-keyword">show </span><span class="hljs-keyword">SUBNET-ID</span><br></code></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">$ openstack subnet show 00414731-ab21-4ee8-8bf2-86d960cc4339<br>+-------------------+--------------------------------------+<br>|<span class="hljs-string"> Field             </span>|<span class="hljs-string"> Value                                </span>|<br>+-------------------+--------------------------------------+<br>|<span class="hljs-string"> allocation_pools  </span>|<span class="hljs-string"> 192.168.1.2-192.168.1.254            </span>|<br>|<span class="hljs-string"> cidr              </span>|<span class="hljs-string"> 192.168.1.0/24                       </span>|<br>|<span class="hljs-string"> created_at        </span>|<span class="hljs-string"> 2019-07-11T02:09:49Z                 </span>|<br>|<span class="hljs-string"> description       </span>|<span class="hljs-string">                                      </span>|<br>|<span class="hljs-string"> dns_nameservers   </span>|<span class="hljs-string">                                      </span>|<br>|<span class="hljs-string"> enable_dhcp       </span>|<span class="hljs-string"> True                                 </span>|<br>|<span class="hljs-string"> gateway_ip        </span>|<span class="hljs-string"> 192.168.1.1                          </span>|<br>|<span class="hljs-string"> host_routes       </span>|<span class="hljs-string">                                      </span>|<br>|<span class="hljs-string"> id                </span>|<span class="hljs-string"> 00414731-ab21-4ee8-8bf2-86d960cc4339 </span>|<br>|<span class="hljs-string"> ip_version        </span>|<span class="hljs-string"> 4                                    </span>|<br>|<span class="hljs-string"> ipv6_address_mode </span>|<span class="hljs-string"> None                                 </span>|<br>|<span class="hljs-string"> ipv6_ra_mode      </span>|<span class="hljs-string"> None                                 </span>|<br>|<span class="hljs-string"> name              </span>|<span class="hljs-string"> network_sub_18721                    </span>|<br>|<span class="hljs-string"> network_id        </span>|<span class="hljs-string"> 84d6ee39-77b3-4a0b-80f8-67922b63079a </span>|<br>|<span class="hljs-string"> project_id        </span>|<span class="hljs-string"> 2e69bc10ab5f427bbbd6d40148d96309     </span>|<br>|<span class="hljs-string"> revision_number   </span>|<span class="hljs-string"> 0                                    </span>|<br>|<span class="hljs-string"> segment_id        </span>|<span class="hljs-string"> None                                 </span>|<br>|<span class="hljs-string"> service_types     </span>|<span class="hljs-string">                                      </span>|<br>|<span class="hljs-string"> subnetpool_id     </span>|<span class="hljs-string"> None                                 </span>|<br>|<span class="hljs-string"> tags              </span>|<span class="hljs-string">                                      </span>|<br>|<span class="hljs-string"> updated_at        </span>|<span class="hljs-string"> 2019-07-11T02:09:49Z                 </span>|<br>+-------------------+--------------------------------------+<br></code></pre></td></tr></table></figure><p><strong>列出所有port</strong></p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">$ openstack port list<br><br>+--------------------------------------+------+-------------------+--------------------------------------------------------------------------------+--------+<br>|<span class="hljs-string"> ID                                   </span>|<span class="hljs-string"> Name </span>|<span class="hljs-string"> MAC Address       </span>|<span class="hljs-string"> Fixed IP Addresses                                                             </span>|<span class="hljs-string"> Status </span>|<br>+--------------------------------------+------+-------------------+--------------------------------------------------------------------------------+--------+<br>|<span class="hljs-string"> 01f86921-016b-4df8-b526-ec81418b5df5 </span>|<span class="hljs-string">      </span>|<span class="hljs-string"> fa:16:3e:b9:c8:a8 </span>|<span class="hljs-string"> ip_address=&#x27;20.0.0.2&#x27;, subnet_id=&#x27;c00a64e4-8921-427c-aa71-74f7a2c55954&#x27;        </span>|<span class="hljs-string"> ACTIVE </span>|<br>|<span class="hljs-string"> 0280ba23-7a51-483c-a7a4-2351f277f739 </span>|<span class="hljs-string">      </span>|<span class="hljs-string"> fa:16:3e:ab:63:69 </span>|<span class="hljs-string"> ip_address=&#x27;192.168.2.1&#x27;, subnet_id=&#x27;c4b84a4b-ce15-49e8-ae6b-72566224682c&#x27;     </span>|<span class="hljs-string"> DOWN   </span>|<br>+--------------------------------------+------+-------------------+--------------------------------------------------------------------------------+--------+<br></code></pre></td></tr></table></figure><p><strong>查看port</strong></p><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vhdl">$ openstack <span class="hljs-keyword">port</span> show <span class="hljs-keyword">PORT</span>-ID<br></code></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">$ openstack port show 01f86921-016b-4df8-b526-ec81418b5df5<br>+-----------------------+-------------------------------------------------------------------------------+<br>|<span class="hljs-string"> Field                 </span>|<span class="hljs-string"> Value                                                                         </span>|<br>+-----------------------+-------------------------------------------------------------------------------+<br>|<span class="hljs-string"> admin_state_up        </span>|<span class="hljs-string"> UP                                                                            </span>|<br>|<span class="hljs-string"> allowed_address_pairs </span>|<span class="hljs-string">                                                                               </span>|<br>|<span class="hljs-string"> binding_host_id       </span>|<span class="hljs-string"> controller                                                                    </span>|<br>|<span class="hljs-string"> binding_profile       </span>|<span class="hljs-string">                                                                               </span>|<br>|<span class="hljs-string"> binding_vif_details   </span>|<span class="hljs-string"> datapath_type=&#x27;system&#x27;, ovs_hybrid_plug=&#x27;True&#x27;, port_filter=&#x27;True&#x27;            </span>|<br>|<span class="hljs-string"> binding_vif_type      </span>|<span class="hljs-string"> ovs                                                                           </span>|<br>|<span class="hljs-string"> binding_vnic_type     </span>|<span class="hljs-string"> normal                                                                        </span>|<br>|<span class="hljs-string"> created_at            </span>|<span class="hljs-string"> 2019-06-19T01:41:33Z                                                          </span>|<br>|<span class="hljs-string"> data_plane_status     </span>|<span class="hljs-string"> None                                                                          </span>|<br>|<span class="hljs-string"> description           </span>|<span class="hljs-string">                                                                               </span>|<br>|<span class="hljs-string"> device_id             </span>|<span class="hljs-string"> dhcpd3377d3c-a0d1-5d71-9947-f17125c357bb-361f196b-154a-4e51-bc34-7162d043be1b </span>|<br>|<span class="hljs-string"> device_owner          </span>|<span class="hljs-string"> network:dhcp                                                                  </span>|<br>|<span class="hljs-string"> dns_assignment        </span>|<span class="hljs-string"> None                                                                          </span>|<br>|<span class="hljs-string"> dns_name              </span>|<span class="hljs-string"> None                                                                          </span>|<br>|<span class="hljs-string"> extra_dhcp_opts       </span>|<span class="hljs-string">                                                                               </span>|<br>|<span class="hljs-string"> fixed_ips             </span>|<span class="hljs-string"> ip_address=&#x27;20.0.0.2&#x27;, subnet_id=&#x27;c00a64e4-8921-427c-aa71-74f7a2c55954&#x27;       </span>|<br>|<span class="hljs-string"> id                    </span>|<span class="hljs-string"> 01f86921-016b-4df8-b526-ec81418b5df5                                          </span>|<br>|<span class="hljs-string"> ip_address            </span>|<span class="hljs-string"> None                                                                          </span>|<br>|<span class="hljs-string"> mac_address           </span>|<span class="hljs-string"> fa:16:3e:b9:c8:a8                                                             </span>|<br>|<span class="hljs-string"> name                  </span>|<span class="hljs-string">                                                                               </span>|<br>|<span class="hljs-string"> network_id            </span>|<span class="hljs-string"> 361f196b-154a-4e51-bc34-7162d043be1b                                          </span>|<br>|<span class="hljs-string"> option_name           </span>|<span class="hljs-string"> None                                                                          </span>|<br>|<span class="hljs-string"> option_value          </span>|<span class="hljs-string"> None                                                                          </span>|<br>|<span class="hljs-string"> port_security_enabled </span>|<span class="hljs-string"> False                                                                         </span>|<br>|<span class="hljs-string"> project_id            </span>|<span class="hljs-string"> 2e69bc10ab5f427bbbd6d40148d96309                                              </span>|<br>|<span class="hljs-string"> qos_policy_id         </span>|<span class="hljs-string"> None                                                                          </span>|<br>|<span class="hljs-string"> revision_number       </span>|<span class="hljs-string"> 6                                                                             </span>|<br>|<span class="hljs-string"> security_group_ids    </span>|<span class="hljs-string">                                                                               </span>|<br>|<span class="hljs-string"> status                </span>|<span class="hljs-string"> ACTIVE                                                                        </span>|<br>|<span class="hljs-string"> subnet_id             </span>|<span class="hljs-string"> None                                                                          </span>|<br>|<span class="hljs-string"> tags                  </span>|<span class="hljs-string">                                                                               </span>|<br>|<span class="hljs-string"> trunk_details         </span>|<span class="hljs-string"> None                                                                          </span>|<br>|<span class="hljs-string"> updated_at            </span>|<span class="hljs-string"> 2019-06-19T01:41:35Z                                                          </span>|<br>+-----------------------+-------------------------------------------------------------------------------+<br></code></pre></td></tr></table></figure><p>摘自：Openstack官方文档 <a href="https://docs.openstack.org/zh_CN/user-guide/cli-cheat-sheet.html">https://docs.openstack.org/zh_CN/user-guide/cli-cheat-sheet.html</a></p>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux top 命令详解</title>
    <link href="/2019/07/11/linux/top/"/>
    <url>/2019/07/11/linux/top/</url>
    
    <content type="html"><![CDATA[<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs tap">$ top<br><br>top - 10:14:44 up<span class="hljs-number"> 15 </span>days, 20:18, <span class="hljs-number"> 8 </span>users,  load average: 6.99, 3.36, 2.62<br>Tasks:<span class="hljs-number"> 985 </span>total,  <span class="hljs-number"> 2 </span>running,<span class="hljs-number"> 983 </span>sleeping,  <span class="hljs-number"> 0 </span>stopped,  <span class="hljs-number"> 0 </span>zombie<br>%Cpu(s):  0.7 us, 13.2 sy,  7.2 ni, 78.7 id,  0.1 wa,  0.0 hi,  0.0 si,  0.0 st<br>KiB Mem :<span class="hljs-number"> 16142800 </span>total, <span class="hljs-number"> 1201456 </span>free,<span class="hljs-number"> 14020500 </span>used,  <span class="hljs-number"> 920844 </span>buff/cache<br>KiB Swap: <span class="hljs-number"> 8191996 </span>total, <span class="hljs-number"> 6339272 </span>free, <span class="hljs-number"> 1852724 </span>used. <span class="hljs-number"> 1396492 </span>avail Mem<br><br>  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND<br>22195 root     <span class="hljs-number"> 20 </span> <span class="hljs-number"> 0 </span>4995348<span class="hljs-number"> 264576 </span><span class="hljs-number"> 18712 </span>S   7.9  1.6  26:02.20 gnome-shell<br>28393 root     <span class="hljs-number"> 26 </span> <span class="hljs-number"> 6 </span><span class="hljs-number"> 438932 </span><span class="hljs-number"> 95064 </span> <span class="hljs-number"> 6416 </span>S   3.3  0.6  16:52.90 python<br>25155 root     <span class="hljs-number"> 20 </span> <span class="hljs-number"> 0 </span><span class="hljs-number"> 163096 </span> <span class="hljs-number"> 3436 </span> <span class="hljs-number"> 1684 </span>S   1.7  0.0   0:22.93 top<br><span class="hljs-number"> 4092 </span>root     <span class="hljs-number"> 20 </span> <span class="hljs-number"> 0 </span><span class="hljs-number"> 413152 </span><span class="hljs-number"> 96096 </span> <span class="hljs-number"> 4812 </span>S   1.3  0.6  33:59.19 Xvnc<br>23570 nova     <span class="hljs-number"> 26 </span> <span class="hljs-number"> 6 </span><span class="hljs-number"> 456196 </span><span class="hljs-number"> 29632 </span> <span class="hljs-number"> 4524 </span>S   1.3  0.2 131:28.54 nova-conductor<br>23724 nova     <span class="hljs-number"> 26 </span> <span class="hljs-number"> 6 </span><span class="hljs-number"> 513364 </span><span class="hljs-number"> 42712 </span> <span class="hljs-number"> 4908 </span>S   1.3  0.3 135:03.59 nova-api<br>12833 neutron  <span class="hljs-number"> 26 </span> <span class="hljs-number"> 6 </span><span class="hljs-number"> 497996 </span>135052  <span class="hljs-number"> 4608 </span>S   1.0  0.8  59:59.61 neutron-dhcp-ag<br>20537 nobody   <span class="hljs-number"> 20 </span> <span class="hljs-number"> 0 </span><span class="hljs-number"> 254952 </span><span class="hljs-number"> 10144 </span> <span class="hljs-number"> 4152 </span>S   1.0  0.1   0:01.45 php-fpm<br>28987 root     <span class="hljs-number"> 20 </span> <span class="hljs-number"> 0 </span><span class="hljs-number"> 162940 </span> <span class="hljs-number"> 3248 </span> <span class="hljs-number"> 1620 </span>R   1.0  0.0   0:00.22 top<br><span class="hljs-number"> 5016 </span>root     <span class="hljs-number"> 20 </span> <span class="hljs-number"> 0 </span><span class="hljs-number"> 527732 </span> <span class="hljs-number"> 3760 </span> <span class="hljs-number"> 1500 </span>S   0.7  0.0   0:34.49 ibus-daemon<br><span class="hljs-number"> 7012 </span>root     <span class="hljs-number"> 20 </span> <span class="hljs-number"> 0 </span><span class="hljs-number"> 928104 </span><span class="hljs-number"> 26384 </span> <span class="hljs-number"> 8988 </span>S   0.7  0.2   9:19.03 gnome-terminal-<br><span class="hljs-number"> 8040 </span>openvsw+ <span class="hljs-number"> 26 </span> <span class="hljs-number"> 6 </span>1316280<span class="hljs-number"> 160352 </span><span class="hljs-number"> 12192 </span>S   0.7  1.0 170:13.54 ovs-vswitchd<br><span class="hljs-number"> 9408 </span>etcd     <span class="hljs-number"> 26 </span> <span class="hljs-number"> 6 </span>  11.6g  <span class="hljs-number"> 9896 </span> <span class="hljs-number"> 2052 </span>S   0.7  0.1 176:00.49 etcd<br>23586 glance   <span class="hljs-number"> 26 </span> <span class="hljs-number"> 6 </span><span class="hljs-number"> 502376 </span><span class="hljs-number"> 13540 </span> <span class="hljs-number"> 4984 </span>R   0.7  0.1  99:49.88 glance-api<br>   <span class="hljs-number"> 1 </span>root     <span class="hljs-number"> 26 </span> <span class="hljs-number"> 6 </span><span class="hljs-number"> 201696 </span> <span class="hljs-number"> 5700 </span> <span class="hljs-number"> 2100 </span>S   0.3  0.0   5:16.81 systemd<br>   <span class="hljs-number"> 3 </span>root     <span class="hljs-number"> 20 </span> <span class="hljs-number"> 0 </span>     <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 0 </span>S   0.3  0.0   1:49.34 ksoftirqd/0<br></code></pre></td></tr></table></figure><p><strong>统计信息区</strong><br>前五行是系统整体的统计信息。</p><p>第一行是任务队列信息，同 uptime。 命令的执行结果。其内容如下：</p><ul><li>10:14:44 系统当前时间</li><li>up 15 days, 20:18 系统运行时间，格式为时:分</li><li>8 users 当前登录用户数</li><li>load average: 6.99, 3.36, 2.62 系统负载，即任务队列的平均长度。<ul><li>三个数值分别为1分钟、5分钟、15分钟前到现在的平均值。</li></ul></li></ul><p>第二、三行为进程和CPU的信息。当有多个CPU时，这些内容可能会超过两行。内容如下：</p><p>Tasks:</p><ul><li>985 total 进程总数</li><li>2 running 正在运行的进程数</li><li>983 sleeping 睡眠的进程数</li><li>0 stopped 停止的进程数</li><li>0 zombie 僵尸进程数</li></ul><p>Cpu(s):</p><ul><li>0.7% us 用户空间占用CPU百分比</li><li>13.2% sy 内核空间占用CPU百分比</li><li>7.2% ni 用户进程空间内改变过优先级的进程占用CPU百分比</li><li>78.7% id 空闲CPU百分比</li><li>0.1% wa 等待输入输出的CPU时间百分比</li><li>0.0% hi</li><li>0.0% si</li></ul><p>最后两行为内存信息。内容如下：</p><p>Mem:</p><ul><li>16142800 total 物理内存总量</li><li>14020500 used 使用的物理内存总量</li><li>1201456 free 空闲内存总量</li><li>920844 buff&#x2F;cache 用作内核缓存的内存量</li></ul><p>Swap:</p><ul><li>8191996 total 交换区总量</li><li>1852724k used 使用的交换区总量</li><li>6339272 free 空闲交换区总量</li><li>1396492 avail Mem</li></ul><p>统计信息区域的下方显示了各个进程的详细信息。首先来认识一下各列的含义。</p><p>序号 列名 含义</p><ul><li>a PID 进程id</li><li>b PPID 父进程id</li><li>c RUSER Real user name</li><li>d UID 进程所有者的用户id</li><li>e USER 进程所有者的用户名</li><li>f GROUP 进程所有者的组名</li><li>g TTY 启动进程的终端名。不是从终端启动的进程则显示为 ?</li><li>h PR 优先级</li><li>i NI nice值。负值表示高优先级，正值表示低优先级</li><li>j P 最后使用的CPU，仅在多CPU环境下有意义</li><li>k %CPU 上次更新到现在的CPU时间占用百分比</li><li>l TIME 进程使用的CPU时间总计，单位秒</li><li>m TIME+ 进程使用的CPU时间总计，单位1&#x2F;100秒</li><li>n %MEM 进程使用的物理内存百分比</li><li>o VIRT 进程使用的虚拟内存总量，单位kb。VIRT&#x3D;SWAP+RES</li><li>p SWAP 进程使用的虚拟内存中，被换出的大小，单位kb。</li><li>q RES 进程使用的、未被换出的物理内存大小，单位kb。RES&#x3D;CODE+DATA</li><li>r CODE 可执行代码占用的物理内存大小，单位kb</li><li>s DATA 可执行代码以外的部分(数据段+栈)占用的物理内存大小，单位kb</li><li>t SHR 共享内存大小，单位kb</li><li>u nFLT 页面错误次数</li><li>v nDRT 最后一次写入到现在，被修改过的页面数。</li><li>w S 进程状态。</li><li>D&#x3D;不可中断的睡眠状态</li><li>R&#x3D;运行</li><li>S&#x3D;睡眠</li><li>T&#x3D;跟踪&#x2F;停止</li><li>Z&#x3D;僵尸进程</li><li>x COMMAND 命令名&#x2F;命令行</li><li>y WCHAN 若该进程在睡眠，则显示睡眠中的系统函数名</li><li>z Flags 任务标志，参考</li></ul><p>默认情况下仅显示比较重要的<br>PID、USER、PR、NI、VIRT、RES、SHR、S、%CPU、%MEM、TIME+、COMMAND列。<br>可以通过下面的快捷键来更改显示内容。<br>更改显示内容<br>通过 f 键可以选择显示的内容。<br>按 f 键之后会显示列的列表，<br>按 a-z 即可显示或隐藏对应的列，最后按回车键确定。<br>按 o 键可以改变列的显示顺序。<br>按小写的 a-z 可以将相应的列向右移动，<br>而大写的 A-Z可以将相应的列向左移动。最后按回车键确定。<br>按大写的 F 或 O 键，然后按 a-z 可以将进程按照相应的列进行排序。<br>而大写的 R 键可以将当前的排序倒转。</p><p><strong>命令使用</strong></p><p><strong>1. 工具（命令）名称</strong><br>top</p><p><strong>2. 工具（命令）作用</strong><br>显示系统当前的进程和其他状况；<br>top是一个动态显示过程,即可以通过用户按键来不断刷新当前状态.如果在前台执行该命令,它将独占前台,直到用户终止该程序为止.<br>比较准确的说,top命令提供了实时的对系统处理器的状态监视.它将显示系统中CPU最“敏感”的任务列表.该命令可以按CPU使用.内存使用和执行时间对任务进行排序；而且该命令的很多特性都可以通过交互式命令或者在个人定制文件中进行设定.</p><p><strong>3. 环境设置</strong><br>在Linux下使用。</p><p><strong>4. 使用方法</strong></p><p><strong>4.1 使用格式</strong><br>top [-][d][p][q][c][C][S][s][n]</p><p><strong>4.2 参数说明</strong></p><p>d 指定每两次屏幕信息刷新之间的时间间隔。当然用户可以使用s交互命令来改变之。<br>p 通过指定监控进程ID来仅仅监控某个进程的状态。<br>q 该选项将使top没有任何延迟的进行刷新。如果调用程序有超级用户权限，那么top将以尽可能高的优先级运行。<br>S 指定累计模式<br>s 使top命令在安全模式中运行。这将去除交互命令所带来的潜在危险。<br>i 使top不显示任何闲置或者僵死进程。<br>c 显示整个命令行而不只是显示命令名</p><p><strong>4.3 其他</strong><br>下面介绍在top命令执行过程中可以使用的一些交互命令。从使用角度来看，熟练的掌握这些命令比掌握选项还重要一些。这些命令都是单字母的，如果在命令行选项中使用了s选项，则可能其中一些命令会被屏蔽掉。</p><ul><li>Ctrl+L 擦除并且重写屏幕。</li><li>h或者? 显示帮助画面，给出一些简短的命令总结说明。</li><li>k 终止一个进程。系统将提示用户输入需要终止的进程PID，以及需要发送给该进程什么样的信号。一般的终止进程可以使用15信号；如果不能正常结束那就使用信号9强制结束该进程。默认值是信号15。在安全模式中此命令被屏蔽。</li><li>i 忽略闲置和僵死进程。这是一个开关式命令。</li><li>q 退出程序。</li><li>r 重新安排一个进程的优先级别。系统提示用户输入需要改变的进程PID以及需要设置的进程优先级值。输入一个正值将使优先级降低，反之则可以使该进程拥有更高的优先权。默认值是10。</li><li>S 切换到累计模式。</li><li>s 改变两次刷新之间的延迟时间。系统将提示用户输入新的时间，单位为s。如果有小数，就换算成ms。输入0值则系统将不断刷新，默认值是5s。需要注意的是如果设置太小的时间，很可能会引起不断刷新，从而根本来不及看清显示的情况，而且系统负载也会大大增加。</li><li>f或者F 从当前显示中添加或者删除项目。</li><li>o或者O 改变显示项目的顺序。</li><li>l 切换显示平均负载和启动时间信息。</li><li>m 切换显示内存信息。</li><li>t 切换显示进程和CPU状态信息。</li><li>c 切换显示命令名称和完整命令行。</li><li>M 根据驻留内存大小进行排序。</li><li>P 根据CPU使用百分比大小进行排序。</li><li>T 根据时间&#x2F;累计时间进行排序。</li><li>W 将当前设置写入~&#x2F;.toprc文件中。这是写top配置文件的推荐方法。</li></ul>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQL中InnoDB和MyISAM的存储引擎区别</title>
    <link href="/2019/07/10/mysql/mysql_engine/"/>
    <url>/2019/07/10/mysql/mysql_engine/</url>
    
    <content type="html"><![CDATA[<p><strong>InnoDB存储引擎：</strong></p><p>InnoDB存储引擎支持事务，其设计目标主要就是面向OLTP（On Line Transaction Processing 在线事务处理）的应用。特点为行锁设计、支持外键，并支持非锁定读。从5.5.8版本开始，InnoDB成为了MySQL的默认存储引擎。</p><p>InnoDB存储引擎采用聚集索引（clustered）的方式来存储数据，因此每个表都是按照主键的顺序进行存放，如果没有指定主键，InnoDB会为每行自动生成一个6字节的ROWID作为主键。</p><p><strong>MyISAM存储引擎：</strong><br>MyISAM存储引擎不支持事务、表锁设计，支持全文索引，主要面向OLAP（On Line Analytical Processing 联机分析处理）应用，适用于数据仓库等查询频繁的场景。在5.5.8版本之前，MyISAM是MySQL的默认存储引擎。该引擎代表着对海量数据进行查询和分析的需求。它强调性能，因此在查询的执行速度比InnoDB更快。</p><p>MyISAM存储引擎还有一个特点是只缓存索引文件，而不缓存数据文件，这点非常独特。</p><p><strong>InnoDB和MyISAM的区别:</strong><br><em><strong>事务</strong></em><br>为了数据库操作的原子性，我们需要事务。保证一组操作要么都成功，要么都失败，比如转账的功能。我们通常将多条SQL语句放在begin和commit之间，组成一个事务。</p><p>InnoDB支持，MyISAM不支持。</p><p><em><strong>主键</strong></em><br>由于InnoDB的聚集索引，其如果没有指定主键，就会自动生成主键。<br>MyISAM支持没有主键的表存在。</p><p><em><strong>外键</strong></em><br>为了解决复杂逻辑的依赖，我们需要外键。比如高考成绩的录入，必须归属于某位同学，我们就需要高考成绩数据库里有准考证号的外键。</p><p>InnoDB支持，MyISAM不支持。</p><p><em><strong>索引</strong></em><br>为了优化查询的速度，进行排序和匹配查找，我们需要索引。比如所有人的姓名从a-z首字母进行顺序存储，当我们查找zhangsan或者第44位的时候就可以很快的定位到我们想要的位置进行查找。</p><p>InnoDB是聚集索引，数据和主键的聚集索引绑定在一起，通过主键索引效率很高。如果通过其他列的辅助索引来进行查找，需要先查找到聚集索引，再查询到所有数据，需要两次查询。</p><p>MyISAM是非聚集索引，数据文件是分离的，索引保存的是数据的指针。</p><p>从InnoDB 1.2.x版本，MySQL5.6版本后，两者都支持全文索引。</p><p>auto_increment<br>对于自增数的字段，InnoDB要求必须有只有该字段的索引。但MyISAM可以将该字段与其他字段组成联合索引。</p><p><em><strong>表行数</strong></em><br>很常见的需求是看表中有多少条数据，此时我们需要</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> count(*) <span class="hljs-keyword">from</span> <span class="hljs-built_in">table_name</span>;<br></code></pre></td></tr></table></figure><p>InnoDB不保存表行数，需要进行全表扫描。MyISAM用一个变量保存，直接读取该值，更快。当时当带有where查询的时候，两者一样。</p><p><em><strong>存储</strong></em><br>数据库的文件都是需要在磁盘中进行存储，当应用需要时再读取到内存中。一般包含数据文件、索引文件。</p><p>InnoDB分为：<br>.frm表结构文件<br>.ibdata1共享表空间<br>.ibd表独占空间<br>.redo日志文件</p><p>MyISAM分为三个文件：<br>.frm存储表定义<br>.MYD存储表数据<br>.MYI存储表索引</p><p><em><strong>执行速度</strong></em><br>如果你的操作是大量的查询操作，如SELECT，使用MyISAM性能会更好。<br>如果大部分是删除和更改的操作，使用InnoDB。</p><p>delete<br>调用delete from table时，MyISAM会直接重建表，InnoDB会一行一行的删除，但是可以用truncate table代替。</p><p><em><strong>锁</strong></em><br>MyISAM仅支持表锁，每次操作锁定整张表。<br>InnoDB支持行锁，每次操作锁住最小数量的行数据。</p><p>表锁相比于行锁消耗的资源更少，且不会出现死锁，但同时并发性能差。行锁消耗更多的资源，速度较慢，且可能发生死锁，但是因为锁定的粒度小、数据少，并发性能好。如果InnoDB的一条语句无法确定要扫描的范围，也会锁定整张表。</p><p>当行锁发生死锁的时候，会计算每个事务影响的行数，然后回滚行数较少的事务。</p><p><em><strong>数据恢复</strong></em><br>MyISAM崩溃后无法快速的安全恢复。InnoDB有一套完善的恢复机制。</p><p><em><strong>数据缓存</strong></em><br>MyISAM仅缓存索引数据，通过索引查询数据。InnoDB不仅缓存索引数据，同时缓存数据信息，将数据按页读取到缓存池，按LRU（Latest Rare Use 最近最少使用）算法来进行更新。</p><p><em><strong>如何选择存储引擎</strong></em><br>创建表的语句都是相同的，只有最后的type来指定存储引擎。</p><p>MyISAM<br>1.大量查询总count<br>2.查询频繁，插入不频繁<br>3.没有事务操作</p><p>InnoDB<br>1.需要高可用性，或者需要事务<br>2.表更新频繁</p><p>摘自：<a href="https://segmentfault.com/a/1190000019713794">https://segmentfault.com/a/1190000019713794</a></p>]]></content>
    
    
    <categories>
      
      <category>Mysql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Openstack修改系统网络配额</title>
    <link href="/2019/07/10/openstack/neutron_quotas/"/>
    <url>/2019/07/10/openstack/neutron_quotas/</url>
    
    <content type="html"><![CDATA[<p><strong>前言</strong><br>neutron在安装配置完成之后，openstack为了实现对所有tenant对网络资源的使用，针对neutron设置有专门的配额，以防止租户使用过多的资源，而对其他的tenant造成影响。和nova的quota相类似，neutron也使用单独的一个驱动来实现网络neutron的配额控制。</p><p><strong>neutron默认的配额</strong><br>neutron默认的配额针对network，port，router，subnet，floatingip做了配额方面的限定，参考neutron的配置文件，获取quota的配额内容为:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[root@controller ~]</span><span class="hljs-comment"># vim /etc/neutron/neutron.conf</span><br><span class="hljs-section">[quotas]</span><br><span class="hljs-attr">quota_driver</span> = neutron.db.quota_db.DbQuotaDriver        配额驱动<br><span class="hljs-attr">quota_items</span> = network,subnet,port                       quota限定的范畴<br><span class="hljs-attr">default_quota</span> = -<span class="hljs-number">1</span>                                      默认的quota，-<span class="hljs-number">1</span>表示没有限制(未启用)<br><span class="hljs-attr">quota_network</span> = <span class="hljs-number">10</span>                                      建立的network个数<br><span class="hljs-attr">quota_subnet</span> = <span class="hljs-number">10</span>                                       建立的subnet个数<br><span class="hljs-attr">quota_port</span> = <span class="hljs-number">50</span>                                         允许的port个数<br><span class="hljs-attr">quota_security_group</span> = <span class="hljs-number">10</span>                               安全组的个数<br><span class="hljs-attr">quota_security_group_rule</span> = <span class="hljs-number">100</span>                         安全组规规则条数<br><span class="hljs-attr">quota_vip</span> = <span class="hljs-number">10</span>                                          vip个数，以下的quota_member和quota_health_monitors 都用于LBaaS场景<br><span class="hljs-attr">quota_pool</span> = <span class="hljs-number">10</span>                                         pool个数<br><span class="hljs-attr">quota_member</span> = -<span class="hljs-number">1</span>                                       member个数<br><span class="hljs-attr">quota_health_monitors</span> = -<span class="hljs-number">1</span>                              monitor个数<br><span class="hljs-attr">quota_router</span> = <span class="hljs-number">10</span>                                       router的个数<br><span class="hljs-attr">quota_floatingip</span> = <span class="hljs-number">50</span>                                   floating-ip个数<br></code></pre></td></tr></table></figure><p><strong>修改neutron的配额</strong><br>查看neutron默认的配额</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">[root<span class="hljs-meta">@controller</span> ~]<span class="hljs-comment"># keystone tenant-list</span><br>+----------------------------------+----------+---------+<br>|<span class="hljs-string">                id                </span>|<span class="hljs-string">   name   </span>|<span class="hljs-string"> enabled </span>|<br>+----------------------------------+----------+---------+<br>|<span class="hljs-string"> 842ab3268a2c47e6a4b0d8774de805ae </span>|<span class="hljs-string">  admin   </span>|<span class="hljs-string">   True  </span>|<br>|<span class="hljs-string"> 7ff1dfb5a6f349958c3a949248e56236 </span>|<span class="hljs-string"> companyA </span>|<span class="hljs-string">   True  </span>|<span class="hljs-string">        #得到tenant的uuid号</span><br><span class="hljs-string"></span>|<span class="hljs-string"> 10d1465c00d049fab88dec1af0f56b1b </span>|<span class="hljs-string">   demo   </span>|<span class="hljs-string">   True  </span>|<br>|<span class="hljs-string"> 3b57a14f7c354a979c9f62b60f31a331 </span>|<span class="hljs-string"> service  </span>|<span class="hljs-string">   True  </span>|<br>+----------------------------------+----------+---------+<br></code></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">[root<span class="hljs-meta">@controller</span> ~]<span class="hljs-comment"># neutron quota-show --tenant-id 7ff1dfb5a6f349958c3a949248e56236</span><br>+---------------------+-------+<br>|<span class="hljs-string"> Field               </span>|<span class="hljs-string"> Value </span>|<br>+---------------------+-------+<br>|<span class="hljs-string"> floatingip          </span>|<span class="hljs-string"> 50    </span>|<br>|<span class="hljs-string"> health_monitor      </span>|<span class="hljs-string"> -1    </span>|<br>|<span class="hljs-string"> member              </span>|<span class="hljs-string"> -1    </span>|<br>|<span class="hljs-string"> network             </span>|<span class="hljs-string"> 10    </span>|<br>|<span class="hljs-string"> pool                </span>|<span class="hljs-string"> 10    </span>|<br>|<span class="hljs-string"> port                </span>|<span class="hljs-string"> 50    </span>|<span class="hljs-string">          #port，每台虚拟机都需要一个ip，即一个port，很容易就超过配额</span><br><span class="hljs-string"></span>|<span class="hljs-string"> router              </span>|<span class="hljs-string"> 10    </span>|<br>|<span class="hljs-string"> security_group      </span>|<span class="hljs-string"> 10    </span>|<br>|<span class="hljs-string"> security_group_rule </span>|<span class="hljs-string"> 100   </span>|<br>|<span class="hljs-string"> subnet              </span>|<span class="hljs-string"> 10    </span>|<br>|<span class="hljs-string"> vip                 </span>|<span class="hljs-string"> 10    </span>|<br>+---------------------+-------+<br></code></pre></td></tr></table></figure><p>修改neutron配额</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">[root<span class="hljs-meta">@controller</span> ~]<span class="hljs-comment"># neutron quota-update --network 20 --subnet 20 --port 100  --router 5 --floatingip 100  --security-group 10 --security-group-rule 100 --tenant-id 7ff1dfb5a6f349958c3a949248e56236</span><br>+---------------------+-------+<br>|<span class="hljs-string"> Field               </span>|<span class="hljs-string"> Value </span>|<br>+---------------------+-------+<br>|<span class="hljs-string"> floatingip          </span>|<span class="hljs-string"> 100   </span>|<br>|<span class="hljs-string"> health_monitor      </span>|<span class="hljs-string"> -1    </span>|<br>|<span class="hljs-string"> member              </span>|<span class="hljs-string"> -1    </span>|<br>|<span class="hljs-string"> network             </span>|<span class="hljs-string"> 20    </span>|<br>|<span class="hljs-string"> pool                </span>|<span class="hljs-string"> 10    </span>|<br>|<span class="hljs-string"> port                </span>|<span class="hljs-string"> 100   </span>|<br>|<span class="hljs-string"> router              </span>|<span class="hljs-string"> 5     </span>|<br>|<span class="hljs-string"> security_group      </span>|<span class="hljs-string"> 10    </span>|<br>|<span class="hljs-string"> security_group_rule </span>|<span class="hljs-string"> 100   </span>|<br>|<span class="hljs-string"> subnet              </span>|<span class="hljs-string"> 20    </span>|<br>|<span class="hljs-string"> vip                 </span>|<span class="hljs-string"> 10    </span>|<br>+---------------------+-------+<br></code></pre></td></tr></table></figure><p>校验neutron的quota配置</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">[root<span class="hljs-meta">@controller</span> ~]<span class="hljs-comment"># neutron quota-show --tenant-id 7ff1dfb5a6f349958c3a949248e56236</span><br>+---------------------+-------+<br>|<span class="hljs-string"> Field               </span>|<span class="hljs-string"> Value </span>|<br>+---------------------+-------+<br>|<span class="hljs-string"> floatingip          </span>|<span class="hljs-string"> 100   </span>|<br>|<span class="hljs-string"> health_monitor      </span>|<span class="hljs-string"> -1    </span>|<br>|<span class="hljs-string"> member              </span>|<span class="hljs-string"> -1    </span>|<br>|<span class="hljs-string"> network             </span>|<span class="hljs-string"> 20    </span>|<br>|<span class="hljs-string"> pool                </span>|<span class="hljs-string"> 10    </span>|<br>|<span class="hljs-string"> port                </span>|<span class="hljs-string"> 100   </span>|<br>|<span class="hljs-string"> router              </span>|<span class="hljs-string"> 5     </span>|<br>|<span class="hljs-string"> security_group      </span>|<span class="hljs-string"> 10    </span>|<br>|<span class="hljs-string"> security_group_rule </span>|<span class="hljs-string"> 100   </span>|<br>|<span class="hljs-string"> subnet              </span>|<span class="hljs-string"> 20    </span>|<br>|<span class="hljs-string"> vip                 </span>|<span class="hljs-string"> 10    </span>|<br>+---------------------+-------+<br></code></pre></td></tr></table></figure><p>统计port的个数</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">[root<span class="hljs-meta">@controller</span> ~]<span class="hljs-comment"># neutron port-list</span><br>+--------------------------------------+------+-------------------+---------------------------------------------------------------------------------------+<br>|<span class="hljs-string"> id                                   </span>|<span class="hljs-string"> name </span>|<span class="hljs-string"> mac_address       </span>|<span class="hljs-string"> fixed_ips                                                                             </span>|<br>+--------------------------------------+------+-------------------+---------------------------------------------------------------------------------------+<br>|<span class="hljs-string"> 0060ec4a-957d-4571-b730-6b4a9bb3baf8 </span>|<span class="hljs-string">      </span>|<span class="hljs-string"> fa:16:3e:48:42:3d </span>|<span class="hljs-string"> &#123;&quot;subnet_id&quot;: &quot;9654a807-d4fa-49f1-abb6-2e45d776c69f&quot;, &quot;ip_address&quot;: &quot;10.16.4.19&quot;&#125;     </span>|<br>|<span class="hljs-string"> 00942be0-a3a9-471d-a4ba-336db0ee1539 </span>|<span class="hljs-string">      </span>|<span class="hljs-string"> fa:16:3e:73:75:03 </span>|<span class="hljs-string"> &#123;&quot;subnet_id&quot;: &quot;ad4a5ffc-3ccc-42c4-89a1-61e7b18632a3&quot;, &quot;ip_address&quot;: &quot;10.16.6.96&quot;&#125;     </span>|<br>|<span class="hljs-string"> 0119045c-8219-4744-bd58-a7e77294832c </span>|<span class="hljs-string">      </span>|<span class="hljs-string"> fa:16:3e:10:ed:7f </span>|<span class="hljs-string"> &#123;&quot;subnet_id&quot;: &quot;9654a807-d4fa-49f1-abb6-2e45d776c69f&quot;, &quot;ip_address&quot;: &quot;10.16.4.71&quot;&#125;     </span>|<br>|<span class="hljs-string"> 04f7d8ea-1849-4938-9ef7-e8114893132f </span>|<span class="hljs-string">      </span>|<span class="hljs-string"> fa:16:3e:50:86:1b </span>|<span class="hljs-string"> &#123;&quot;subnet_id&quot;: &quot;ad4a5ffc-3ccc-42c4-89a1-61e7b18632a3&quot;, &quot;ip_address&quot;: &quot;10.16.6.27&quot;&#125;     </span>|<br><br>[root<span class="hljs-meta">@controller</span> ~]<span class="hljs-comment"># neutron port-list |wc -l            #超过配额时，需要修改</span><br>194<br></code></pre></td></tr></table></figure><p><strong>总结</strong><br>随着时间的推移，当越来越多的instance加入到openstack中，port也会相应增加，一个ip对应一个port，所以当port达到配额时，openstack会组织用户继续分配虚拟机，此时，就需要修改neutron的配额了，关于neutron配额的报错，可以参考neutron的日志&#x2F;var&#x2F;log&#x2F;neutron&#x2F;neutron-server.log，可以根据日志的信息，定位到报错的原因，具体不赘述。</p><p><strong>附录</strong><br>neutron实现quota的代码解读</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><code class="hljs python">[root@controller ~]<span class="hljs-comment"># vim /usr/lib/python2.6/site-packages/neutron/db/quota_db.py</span><br><br><span class="hljs-keyword">import</span> sqlalchemy <span class="hljs-keyword">as</span> sa<br><br><span class="hljs-keyword">from</span> neutron.common <span class="hljs-keyword">import</span> exceptions<br><span class="hljs-keyword">from</span> neutron.db <span class="hljs-keyword">import</span> model_base<br><span class="hljs-keyword">from</span> neutron.db <span class="hljs-keyword">import</span> models_v2<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">quota数据库表的表结构，tenant默认集成的配额从这里获取</span><br><span class="hljs-string">mysql&gt; desc quotas;</span><br><span class="hljs-string">+-----------+--------------+------+-----+---------+-------+</span><br><span class="hljs-string">| Field     | Type         | Null | Key | Default | Extra |</span><br><span class="hljs-string">+-----------+--------------+------+-----+---------+-------+</span><br><span class="hljs-string">| id        | varchar(36)  | NO   | PRI | NULL    |       |</span><br><span class="hljs-string">| tenant_id | varchar(255) | YES  | MUL | NULL    |       |</span><br><span class="hljs-string">| resource  | varchar(255) | YES  |     | NULL    |       |</span><br><span class="hljs-string">| limit     | int(11)      | YES  |     | NULL    |       |</span><br><span class="hljs-string">+-----------+--------------+------+-----+---------+-------+</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Quota</span>(model_base.BASEV2, models_v2.HasId):<br>    <span class="hljs-string">&quot;&quot;&quot;Represent a single quota override for a tenant.</span><br><span class="hljs-string"></span><br><span class="hljs-string">    If there is no row for a given tenant id and resource, then the</span><br><span class="hljs-string">    default for the quota class is used.</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    tenant_id = sa.Column(sa.String(<span class="hljs-number">255</span>), index=<span class="hljs-literal">True</span>)<br>    resource = sa.Column(sa.String(<span class="hljs-number">255</span>))<br>    limit = sa.Column(sa.Integer)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">quota配额的具体实现，根据数据库的配置内容，实现quota的控制，即quota的增删改查方法</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DbQuotaDriver</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Driver to perform necessary checks to enforce quotas and obtain quota</span><br><span class="hljs-string">    information.</span><br><span class="hljs-string"></span><br><span class="hljs-string">    The default driver utilizes the local database.</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    得到租户tenant的quota，执行neutron quota-show --tenant-id uuid时调用的方法</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_tenant_quotas</span>(<span class="hljs-params">context, resources, tenant_id</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;Given a list of resources, retrieve the quotas for the given</span><br><span class="hljs-string">        tenant.</span><br><span class="hljs-string"></span><br><span class="hljs-string">        :param context: The request context, for access checks.</span><br><span class="hljs-string">        :param resources: A dictionary of the registered resource keys.</span><br><span class="hljs-string">        :param tenant_id: The ID of the tenant to return quotas for.</span><br><span class="hljs-string">        :return dict: from resource name to dict of name and limit</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br><br>        <span class="hljs-comment"># init with defaults    得到quota默认的配额项item，即所谓的network，subnet，port和router等，以及对应的值</span><br>        tenant_quota = <span class="hljs-built_in">dict</span>((key, resource.default)<br>                            <span class="hljs-keyword">for</span> key, resource <span class="hljs-keyword">in</span> resources.items())<br><br>        <span class="hljs-comment"># update with tenant specific limits    从数据库中获取最新的quota配置信息，并更新</span><br>        q_qry = context.session.query(Quota).filter_by(tenant_id=tenant_id)<br>        tenant_quota.update((q[<span class="hljs-string">&#x27;resource&#x27;</span>], q[<span class="hljs-string">&#x27;limit&#x27;</span>]) <span class="hljs-keyword">for</span> q <span class="hljs-keyword">in</span> q_qry)<br><br>        <span class="hljs-keyword">return</span> tenant_quota<br><br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    quota的删除，即执行neutron quota-delete 的方法，删除之后，tenant将会集成默认的的quota配置</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_tenant_quota</span>(<span class="hljs-params">context, tenant_id</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;Delete the quota entries for a given tenant_id.</span><br><span class="hljs-string"></span><br><span class="hljs-string">        Atfer deletion, this tenant will use default quota values in conf.</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment">#从neutron。quotas数据库中查询到所有的quota配置之后，过略某个具体的tenant的quota，之后执行delete()方法将其删除</span><br>        <span class="hljs-keyword">with</span> context.session.begin():<br>            tenant_quotas = context.session.query(Quota)<br>            tenant_quotas = tenant_quotas.filter_by(tenant_id=tenant_id)<br>            tenant_quotas.delete()<br><br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    得到所有租户tenant的配额资源，即执行neutron quota-list所查看的内容</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_all_quotas</span>(<span class="hljs-params">context, resources</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;Given a list of resources, retrieve the quotas for the all tenants.</span><br><span class="hljs-string"></span><br><span class="hljs-string">        :param context: The request context, for access checks.</span><br><span class="hljs-string">        :param resources: A dictionary of the registered resource keys.</span><br><span class="hljs-string">        :return quotas: list of dict of tenant_id:, resourcekey1:</span><br><span class="hljs-string">        resourcekey2: ...</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        tenant_default = <span class="hljs-built_in">dict</span>((key, resource.default)<br>                              <span class="hljs-keyword">for</span> key, resource <span class="hljs-keyword">in</span> resources.items())<br><br>        all_tenant_quotas = &#123;&#125;<br><br>        <span class="hljs-keyword">for</span> quota <span class="hljs-keyword">in</span> context.session.query(Quota):<br>            tenant_id = quota[<span class="hljs-string">&#x27;tenant_id&#x27;</span>]<br><br>            <span class="hljs-comment"># avoid setdefault() because only want to copy when actually req&#x27;d</span><br>            <span class="hljs-comment">#如果quotas表中，没有找到配置选项，说明使用默认的quota配置，直接用默认的copy过来即可，有配置则继承quotas表中的配置</span><br>            tenant_quota = all_tenant_quotas.get(tenant_id)<br>            <span class="hljs-keyword">if</span> tenant_quota <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>                tenant_quota = tenant_default.copy()<br>                tenant_quota[<span class="hljs-string">&#x27;tenant_id&#x27;</span>] = tenant_id<br>                all_tenant_quotas[tenant_id] = tenant_quota<br><br>            tenant_quota[quota[<span class="hljs-string">&#x27;resource&#x27;</span>]] = quota[<span class="hljs-string">&#x27;limit&#x27;</span>]<br><br>        <span class="hljs-keyword">return</span> all_tenant_quotas.values()<br><br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">                更新quota的配置，即执行neutron quota-update命令的具体实现</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_quota_limit</span>(<span class="hljs-params">context, tenant_id, resource, limit</span>):<br>        <span class="hljs-keyword">with</span> context.session.begin():<br>            tenant_quota = context.session.query(Quota).filter_by(<br>                tenant_id=tenant_id, resource=resource).first()<br><br>            <span class="hljs-comment">#有配置内容，则更新，没有则根据资源的配置内容，在数据库中添加对应的条目</span><br>            <span class="hljs-keyword">if</span> tenant_quota:<br>                tenant_quota.update(&#123;<span class="hljs-string">&#x27;limit&#x27;</span>: limit&#125;)<br>            <span class="hljs-keyword">else</span>:<br>                tenant_quota = Quota(tenant_id=tenant_id,<br>                                     resource=resource,<br>                                     limit=limit)<br>                context.session.add(tenant_quota)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_quotas</span>(<span class="hljs-params">self, context, tenant_id, resources, keys</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;Retrieves the quotas for specific resources.</span><br><span class="hljs-string"></span><br><span class="hljs-string">        A helper method which retrieves the quotas for the specific</span><br><span class="hljs-string">        resources identified by keys, and which apply to the current</span><br><span class="hljs-string">        context.</span><br><span class="hljs-string"></span><br><span class="hljs-string">        :param context: The request context, for access checks.</span><br><span class="hljs-string">        :param tenant_id: the tenant_id to check quota.</span><br><span class="hljs-string">        :param resources: A dictionary of the registered resources.</span><br><span class="hljs-string">        :param keys: A list of the desired quotas to retrieve.</span><br><span class="hljs-string"></span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        desired = <span class="hljs-built_in">set</span>(keys)<br>        sub_resources = <span class="hljs-built_in">dict</span>((k, v) <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> resources.items()<br>                             <span class="hljs-keyword">if</span> k <span class="hljs-keyword">in</span> desired)<br><br>        <span class="hljs-comment"># Make sure we accounted for all of them...</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(keys) != <span class="hljs-built_in">len</span>(sub_resources):<br>            unknown = desired - <span class="hljs-built_in">set</span>(sub_resources.keys())<br>            <span class="hljs-keyword">raise</span> exceptions.QuotaResourceUnknown(unknown=<span class="hljs-built_in">sorted</span>(unknown))<br><br>        <span class="hljs-comment"># Grab and return the quotas (without usages)</span><br>        quotas = DbQuotaDriver.get_tenant_quotas(<br>            context, sub_resources, tenant_id)<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">dict</span>((k, v) <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> quotas.items())<br><br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    neutron quota的校验，即在执行过程中，调用该方法，确认tenant的quota是否在合理的范围内</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">limit_check</span>(<span class="hljs-params">self, context, tenant_id, resources, values</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;Check simple quota limits.</span><br><span class="hljs-string"></span><br><span class="hljs-string">        For limits--those quotas for which there is no usage</span><br><span class="hljs-string">        synchronization function--this method checks that a set of</span><br><span class="hljs-string">        proposed values are permitted by the limit restriction.</span><br><span class="hljs-string"></span><br><span class="hljs-string">        This method will raise a QuotaResourceUnknown exception if a</span><br><span class="hljs-string">        given resource is unknown or if it is not a simple limit</span><br><span class="hljs-string">        resource.</span><br><span class="hljs-string"></span><br><span class="hljs-string">        If any of the proposed values is over the defined quota, an</span><br><span class="hljs-string">        OverQuota exception will be raised with the sorted list of the</span><br><span class="hljs-string">        resources which are too high.  Otherwise, the method returns</span><br><span class="hljs-string">        nothing.</span><br><span class="hljs-string"></span><br><span class="hljs-string">        :param context: The request context, for access checks.</span><br><span class="hljs-string">        :param tenant_id: The tenant_id to check the quota.</span><br><span class="hljs-string">        :param resources: A dictionary of the registered resources.</span><br><span class="hljs-string">        :param values: A dictionary of the values to check against the</span><br><span class="hljs-string">                       quota.</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br><br>        <span class="hljs-comment"># Ensure no value is less than zero    quota的配置值不能为负数</span><br>        unders = [key <span class="hljs-keyword">for</span> key, val <span class="hljs-keyword">in</span> values.items() <span class="hljs-keyword">if</span> val &lt; <span class="hljs-number">0</span>]<br>        <span class="hljs-keyword">if</span> unders:<br>            <span class="hljs-keyword">raise</span> exceptions.InvalidQuotaValue(unders=<span class="hljs-built_in">sorted</span>(unders))<br><br>        <span class="hljs-comment"># Get the applicable quotas</span><br>        quotas = self._get_quotas(context, tenant_id, resources, values.keys())<br><br>        <span class="hljs-comment"># Check the quotas and construct a list of the resources that</span><br>        <span class="hljs-comment"># would be put over limit by the desired values</span><br>        overs = [key <span class="hljs-keyword">for</span> key, val <span class="hljs-keyword">in</span> values.items()<br>                 <span class="hljs-keyword">if</span> quotas[key] &gt;= <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> quotas[key] &lt; val]<br>        <span class="hljs-keyword">if</span> overs:<br>            <span class="hljs-keyword">raise</span> exceptions.OverQuota(overs=<span class="hljs-built_in">sorted</span>(overs))<br></code></pre></td></tr></table></figure><p>摘自：<a href="https://segmentfault.com/a/1190000018750816">https://segmentfault.com/a/1190000018750816</a></p>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mysql 1040 Too many connections 错误与解决办法</title>
    <link href="/2019/07/01/mysql/too_many_connections/"/>
    <url>/2019/07/01/mysql/too_many_connections/</url>
    
    <content type="html"><![CDATA[<p>日志报如下错误:</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">Traceback (most recent <span class="hljs-keyword">call</span> last):<br>  File &quot;/var/www/kdpa/project/api/host.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">339</span>, <span class="hljs-keyword">in</span> showInstanceConsole<br>  File &quot;/var/www/kdpa/project/api/hostImpl.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">500</span>, <span class="hljs-keyword">in</span> showInstanceConsoleImpl<br>    opsVmId = self.hostDao.getOpsVmIdByUuid(<span class="hljs-type">uuid</span>)<br>  File &quot;/var/www/kdpa/project/core/modifier.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">46</span>, <span class="hljs-keyword">in</span> _dao<br>    <span class="hljs-keyword">return</span> daoFn(*args, **kwargs)<br>  File &quot;/var/www/kdpa/project/dao/host/hostDao.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">168</span>, <span class="hljs-keyword">in</span> getOpsVmIdByUuid<br>    host = <span class="hljs-keyword">session</span>.query(Host).<span class="hljs-keyword">filter</span>(Host.uuid == str(<span class="hljs-type">uuid</span>)).first()<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/orm/query.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">3222</span>, <span class="hljs-keyword">in</span> first<br>    ret = list(self[<span class="hljs-number">0</span>:<span class="hljs-number">1</span>])<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/orm/query.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">3012</span>, <span class="hljs-keyword">in</span> __getitem__<br>    <span class="hljs-keyword">return</span> list(res)<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/orm/query.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">3324</span>, <span class="hljs-keyword">in</span> __iter__<br>    <span class="hljs-keyword">return</span> self._execute_and_instances(context)<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/orm/query.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">3346</span>, <span class="hljs-keyword">in</span> _execute_and_instances<br>    querycontext, self._connection_from_session, close_with_result=<span class="hljs-keyword">True</span><br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/orm/query.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">3361</span>, <span class="hljs-keyword">in</span> _get_bind_args<br>    mapper=self._bind_mapper(), clause=querycontext.<span class="hljs-keyword">statement</span>, **kw<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/orm/query.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">3339</span>, <span class="hljs-keyword">in</span> _connection_from_session<br>    conn = self.<span class="hljs-keyword">session</span>.<span class="hljs-keyword">connection</span>(**kw)<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/orm/session.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">1124</span>, <span class="hljs-keyword">in</span> <span class="hljs-keyword">connection</span><br>    execution_options=execution_options,<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/orm/session.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">1130</span>, <span class="hljs-keyword">in</span> _connection_for_bind<br>    engine, execution_options<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/orm/session.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">431</span>, <span class="hljs-keyword">in</span> _connection_for_bind<br>    conn = bind._contextual_connect()<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/engine/base.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">2226</span>, <span class="hljs-keyword">in</span> _contextual_connect<br>    self._wrap_pool_connect(self.pool.<span class="hljs-keyword">connect</span>, <span class="hljs-keyword">None</span>),<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/engine/base.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">2266</span>, <span class="hljs-keyword">in</span> _wrap_pool_connect<br>    e, dialect, self<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/engine/base.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">1536</span>, <span class="hljs-keyword">in</span> _handle_dbapi_exception_noconnection<br>    util.raise_from_cause(sqlalchemy_exception, exc_info)<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/util/compat.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">399</span>, <span class="hljs-keyword">in</span> raise_from_cause<br>    reraise(<span class="hljs-keyword">type</span>(<span class="hljs-keyword">exception</span>), <span class="hljs-keyword">exception</span>, tb=exc_tb, cause=cause)<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/engine/base.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">2262</span>, <span class="hljs-keyword">in</span> _wrap_pool_connect<br>    <span class="hljs-keyword">return</span> fn()<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/pool/base.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">363</span>, <span class="hljs-keyword">in</span> <span class="hljs-keyword">connect</span><br>    <span class="hljs-keyword">return</span> _ConnectionFairy._checkout(self)<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/pool/base.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">760</span>, <span class="hljs-keyword">in</span> _checkout<br>    fairy = _ConnectionRecord.checkout(pool)<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/pool/base.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">492</span>, <span class="hljs-keyword">in</span> checkout<br>    rec = pool._do_get()<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/pool/impl.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">139</span>, <span class="hljs-keyword">in</span> _do_get<br>    self._dec_overflow()<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/util/langhelpers.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">68</span>, <span class="hljs-keyword">in</span> __exit__<br>    compat.reraise(exc_type, exc_value, exc_tb)<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/pool/impl.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">136</span>, <span class="hljs-keyword">in</span> _do_get<br>    <span class="hljs-keyword">return</span> self._create_connection()<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/pool/base.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">308</span>, <span class="hljs-keyword">in</span> _create_connection<br>    <span class="hljs-keyword">return</span> _ConnectionRecord(self)<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/pool/base.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">437</span>, <span class="hljs-keyword">in</span> __init__<br>    self.__connect(first_connect_check=<span class="hljs-keyword">True</span>)<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/pool/base.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">639</span>, <span class="hljs-keyword">in</span> __connect<br>    <span class="hljs-keyword">connection</span> = pool._invoke_creator(self)<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/engine/strategies.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">114</span>, <span class="hljs-keyword">in</span> <span class="hljs-keyword">connect</span><br>    <span class="hljs-keyword">return</span> dialect.<span class="hljs-keyword">connect</span>(*cargs, **cparams)<br>  File &quot;/usr/lib64/python2.7/site-packages/sqlalchemy/engine/default.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">451</span>, <span class="hljs-keyword">in</span> <span class="hljs-keyword">connect</span><br>    <span class="hljs-keyword">return</span> self.dbapi.<span class="hljs-keyword">connect</span>(*cargs, **cparams)<br>  File &quot;build/bdist.linux-x86_64/egg/MySQLdb/__init__.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">81</span>, <span class="hljs-keyword">in</span> <span class="hljs-keyword">Connect</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">Connection</span>(*args, **kwargs)<br>  File &quot;build/bdist.linux-x86_64/egg/MySQLdb/connections.py&quot;, <span class="hljs-type">line</span> <span class="hljs-number">187</span>, <span class="hljs-keyword">in</span> __init__<br>    super(<span class="hljs-keyword">Connection</span>, self).__init__(*args, **kwargs2)<br>OperationalError: (_mysql_exceptions.OperationalError) (<span class="hljs-number">1040</span>, <span class="hljs-string">&#x27;Too many connections&#x27;</span>)<br>(Background <span class="hljs-keyword">on</span> this error at: http://sqlalche.me/e/e3q8)<br></code></pre></td></tr></table></figure><p><em><strong>解决方式：</strong></em></p><p>查看当前数据库最大连接数：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> VARIABLE_VALUE <span class="hljs-keyword">from</span> information_schema.GLOBAL_VARIABLES <span class="hljs-keyword">where</span> VARIABLE_NAME<span class="hljs-operator">=</span><span class="hljs-string">&#x27;MAX_CONNECTIONS&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> VARIABLE_VALUE <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">214</span>            <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs abnf">vi /etc/systemd/system/mariadb.service.d/limits.conf<br><br>[Service]<br><span class="hljs-attribute">LimitNOFILE</span><span class="hljs-operator">=</span><span class="hljs-number">65535</span><br><span class="hljs-attribute">LimitNPROC</span><span class="hljs-operator">=</span><span class="hljs-number">65535</span><br></code></pre></td></tr></table></figure><p>保存，退出。</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-params">system</span>ctl daemon-reload<br><span class="hljs-params">system</span>ctl restart mariadb.service<br></code></pre></td></tr></table></figure><p>重启后查看：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> VARIABLE_VALUE <span class="hljs-keyword">from</span> information_schema.GLOBAL_VARIABLES <span class="hljs-keyword">where</span> VARIABLE_NAME<span class="hljs-operator">=</span><span class="hljs-string">&#x27;MAX_CONNECTIONS&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> VARIABLE_VALUE <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">4096</span>           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>4096配置在Openstack的mysql配置 &#x2F;etc&#x2F;my.cnf.d&#x2F;openstack.cnf中max_connections &#x3D; 4096。</p>]]></content>
    
    
    <categories>
      
      <category>Mysql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>压力测试工具ab使用方法</title>
    <link href="/2019/06/28/tools/ab/"/>
    <url>/2019/06/28/tools/ab/</url>
    
    <content type="html"><![CDATA[<p><em><strong>安装</strong></em><br>在CentOS7-mini环境下，ab运行需要依赖apr-util，httpd-tools包，安装命令为：</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> apr-util httpd-tools -y<br></code></pre></td></tr></table></figure><p><em><strong>执行测试</strong></em></p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gcode"><span class="hljs-attr">#vi post.txt</span><br><span class="hljs-attr">uuid=n-vp0</span>e<span class="hljs-meta">o8</span>l<span class="hljs-name">m0</span>c&amp;<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">ab -c <span class="hljs-number">10</span> -n <span class="hljs-number">10</span> -p <span class="hljs-string">&#x27;post.txt&#x27;</span> -T <span class="hljs-string">&#x27;application/x-www-form-urlencoded&#x27;</span>  http:<span class="hljs-regexp">//</span><span class="hljs-number">192.100</span>.<span class="hljs-number">200.140</span>:<span class="hljs-number">8000</span><span class="hljs-regexp">/api/i</span>nstance/show<br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">This</span> <span class="hljs-string">is</span> <span class="hljs-string">ApacheBench,</span> <span class="hljs-string">Version</span> <span class="hljs-number">2.3</span> <span class="hljs-string">&lt;$Revision:</span> <span class="hljs-number">1430300</span> <span class="hljs-string">$&gt;</span><br><span class="hljs-string">Copyright</span> <span class="hljs-number">1996 </span><span class="hljs-string">Adam</span> <span class="hljs-string">Twiss,</span> <span class="hljs-string">Zeus</span> <span class="hljs-string">Technology</span> <span class="hljs-string">Ltd,</span> <span class="hljs-string">http://www.zeustech.net/</span><br><span class="hljs-string">Licensed</span> <span class="hljs-string">to</span> <span class="hljs-string">The</span> <span class="hljs-string">Apache</span> <span class="hljs-string">Software</span> <span class="hljs-string">Foundation,</span> <span class="hljs-string">http://www.apache.org/</span><br><br><span class="hljs-string">Benchmarking</span> <span class="hljs-number">192.100</span><span class="hljs-number">.200</span><span class="hljs-number">.140</span> <span class="hljs-string">(be</span> <span class="hljs-string">patient).....done</span><br><br><br><span class="hljs-attr">Server Software:</span>        <span class="hljs-string">nginx/1.9.9</span><br><span class="hljs-attr">Server Hostname:</span>        <span class="hljs-number">192.100</span><span class="hljs-number">.200</span><span class="hljs-number">.140</span><br><span class="hljs-attr">Server Port:</span>            <span class="hljs-number">8000</span><br><br><span class="hljs-attr">Document Path:</span>          <span class="hljs-string">/api/instance/show</span><br><span class="hljs-attr">Document Length:</span>        <span class="hljs-number">23</span> <span class="hljs-string">bytes</span><br><br><span class="hljs-attr">Concurrency Level:</span>      <span class="hljs-number">10</span><br><span class="hljs-attr">Time taken for tests:</span>   <span class="hljs-number">1.378</span> <span class="hljs-string">seconds</span><br><span class="hljs-attr">Complete requests:</span>      <span class="hljs-number">10</span><br><span class="hljs-attr">Failed requests:</span>        <span class="hljs-number">6</span><br>   <span class="hljs-string">(Connect:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">Receive:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">Length:</span> <span class="hljs-number">6</span><span class="hljs-string">,</span> <span class="hljs-attr">Exceptions:</span> <span class="hljs-number">0</span><span class="hljs-string">)</span><br><span class="hljs-attr">Write errors:</span>           <span class="hljs-number">0</span><br><span class="hljs-attr">Non-2xx responses:</span>      <span class="hljs-number">3</span><br><span class="hljs-attr">Total transferred:</span>      <span class="hljs-number">3398 </span><span class="hljs-string">bytes</span><br><span class="hljs-attr">Total body sent:</span>        <span class="hljs-number">1940</span><br><span class="hljs-attr">HTML transferred:</span>       <span class="hljs-number">1787 </span><span class="hljs-string">bytes</span><br><span class="hljs-attr">Requests per second:</span>    <span class="hljs-number">7.26</span> [<span class="hljs-comment">#/sec] (mean)</span><br><span class="hljs-attr">Time per request:</span>       <span class="hljs-number">1377.853</span> [<span class="hljs-string">ms</span>] <span class="hljs-string">(mean)</span><br><span class="hljs-attr">Time per request:</span>       <span class="hljs-number">137.785</span> [<span class="hljs-string">ms</span>] <span class="hljs-string">(mean</span>, <span class="hljs-string">across</span> <span class="hljs-string">all</span> <span class="hljs-string">concurrent</span> <span class="hljs-string">requests)</span><br><span class="hljs-attr">Transfer rate:</span>          <span class="hljs-number">2.41</span> [<span class="hljs-string">Kbytes/sec</span>] <span class="hljs-string">received</span><br>                        <span class="hljs-number">1.37</span> <span class="hljs-string">kb/s</span> <span class="hljs-string">sent</span><br>                        <span class="hljs-number">3.78</span> <span class="hljs-string">kb/s</span> <span class="hljs-string">total</span><br><br><span class="hljs-string">Connection</span> <span class="hljs-string">Times</span> <span class="hljs-string">(ms)</span><br>              <span class="hljs-string">min</span>  <span class="hljs-string">mean</span>[<span class="hljs-string">+/-sd</span>] <span class="hljs-string">median</span>   <span class="hljs-string">max</span><br><span class="hljs-attr">Connect:</span>        <span class="hljs-number">0</span>    <span class="hljs-number">0</span>   <span class="hljs-number">0.1</span>      <span class="hljs-number">0</span>       <span class="hljs-number">1</span><br><span class="hljs-attr">Processing:</span>    <span class="hljs-number">68</span>  <span class="hljs-number">543</span> <span class="hljs-number">548.0</span>    <span class="hljs-number">246</span>    <span class="hljs-number">1256</span><br><span class="hljs-attr">Waiting:</span>       <span class="hljs-number">68</span>  <span class="hljs-number">543</span> <span class="hljs-number">548.0</span>    <span class="hljs-number">246</span>    <span class="hljs-number">1256</span><br><span class="hljs-attr">Total:</span>         <span class="hljs-number">69</span>  <span class="hljs-number">544</span> <span class="hljs-number">548.0</span>    <span class="hljs-number">247</span>    <span class="hljs-number">1257</span><br><br><span class="hljs-string">Percentage</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">requests</span> <span class="hljs-string">served</span> <span class="hljs-string">within</span> <span class="hljs-string">a</span> <span class="hljs-string">certain</span> <span class="hljs-string">time</span> <span class="hljs-string">(ms)</span><br>  <span class="hljs-number">50</span><span class="hljs-string">%</span>    <span class="hljs-number">247</span><br>  <span class="hljs-number">66</span><span class="hljs-string">%</span>   <span class="hljs-number">1095</span><br>  <span class="hljs-number">75</span><span class="hljs-string">%</span>   <span class="hljs-number">1157</span><br>  <span class="hljs-number">80</span><span class="hljs-string">%</span>   <span class="hljs-number">1196</span><br>  <span class="hljs-number">90</span><span class="hljs-string">%</span>   <span class="hljs-number">1257</span><br>  <span class="hljs-number">95</span><span class="hljs-string">%</span>   <span class="hljs-number">1257</span><br>  <span class="hljs-number">98</span><span class="hljs-string">%</span>   <span class="hljs-number">1257</span><br>  <span class="hljs-number">99</span><span class="hljs-string">%</span>   <span class="hljs-number">1257</span><br> <span class="hljs-number">100</span><span class="hljs-string">%</span>   <span class="hljs-number">1257</span> <span class="hljs-string">(longest</span> <span class="hljs-string">request)</span><br></code></pre></td></tr></table></figure><p><em><strong>参数说明：</strong></em></p><p>-n 10 表示请求总数为10</p><p>-c 10 表示并发用户数为10</p><p><a href="http://192.100.200.140:8000/api/instance/show">http://192.100.200.140:8000/api/instance/show</a> 表示这写请求的目标URL</p><p>测试结果也一目了然，测试出的吞吐率为：<br><strong>Requests per second</strong>: 2015.93 [#&#x2F;sec] (mean) 初次之外还有其他一些信息。</p><p><strong>Server Software</strong> 表示被测试的Web服务器软件名称</p><p><strong>Server Hostname</strong> 表示请求的URL主机名</p><p><strong>Server Port</strong> 表示被测试的Web服务器软件的监听端口</p><p><strong>Document Path</strong> 表示请求的URL中的根绝对路径，通过该文件的后缀名，我们一般可以了解该请求的类型</p><p><strong>Document Length</strong> 表示HTTP响应数据的正文长度</p><p><strong>Concurrency Level</strong> 表示并发用户数，这是我们设置的参数之一</p><p><strong>Time taken for tests</strong> 表示所有这些请求被处理完成所花费的总时间</p><p><strong>Complete requests</strong> 表示总请求数量，这是我们设置的参数之一</p><p><strong>Failed requests</strong> 表示失败的请求数量，这里的失败是指请求在连接服务器、发送数据等环节发生异常，以及无响应后超时的情况。如果接收到的HTTP响应数据的头信息中含有2XX以外的状态码，则会在测试结果中显示另一个名为 “Non-2xx responses”的统计项，用于统计这部分请求数，这些请求并不算在失败的请求中。</p><p><strong>Total transferred</strong> 表示所有请求的响应数据长度总和，包括每个HTTP响应数据的头信息和正文数据的长度。注意这里不包括HTTP请求数据的长度，仅仅为web服务器流向用户PC的应用层数据总长度。</p><p><strong>HTML transferred</strong> 表示所有请求的响应数据中正文数据的总和，也就是减去了Total transferred中HTTP响应数据中的头信息的长度。</p><p><strong>Requests per second</strong> 吞吐率，计算公式：Complete requests &#x2F; Time taken for tests</p><p><strong>Time per request</strong> 用户平均请求等待时间，计算公式：Time token for tests&#x2F;（Complete requests&#x2F;Concurrency Level）</p><p><strong>Time per requet(across all concurrent request)</strong> 服务器平均请求等待时间，计算公式：Time taken for tests&#x2F;Complete requests，正好是吞吐率的倒数。也可以这么统计：Time per request&#x2F;Concurrency Level</p><p><strong>Transfer rate</strong> 表示这些请求在单位时间内从服务器获取的数据长度，计算公式：Total trnasferred&#x2F; Time taken for tests，这个统计很好的说明服务器的处理能力达到极限时，其出口宽带的需求量。</p><p><strong>Percentage of requests served within a certain time（ms）</strong> 这部分数据用于描述每个请求处理时间的分布情况，比如以上测试，80%的请求处理时间都不超过6ms，这个处理时间是指前面的Time per request，即对于单个用户而言，平均每个请求的处理时间。</p>]]></content>
    
    
    <categories>
      
      <category>工具</category>
      
    </categories>
    
    
    <tags>
      
      <tag>工具</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Openstack Too many open files 错误与解决办法</title>
    <link href="/2019/06/20/openstack/too_many_open_files/"/>
    <url>/2019/06/20/openstack/too_many_open_files/</url>
    
    <content type="html"><![CDATA[<p>Openstack WebUI页面无法打开，页面报500错误，查看httpd-&gt;error_log日志报如下错误:</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs prolog">[<span class="hljs-symbol">Tue</span> <span class="hljs-symbol">Apr</span> <span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">01</span>:<span class="hljs-number">05.658276</span> <span class="hljs-number">2019</span>] [:error] [pid <span class="hljs-number">9245</span>]   <span class="hljs-symbol">File</span> <span class="hljs-string">&quot;/usr/lib/python2.7/site-packages/requests/sessions.py&quot;</span>, line <span class="hljs-number">518</span>, in request<br>[<span class="hljs-symbol">Tue</span> <span class="hljs-symbol">Apr</span> <span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">01</span>:<span class="hljs-number">05.658280</span> <span class="hljs-number">2019</span>] [:error] [pid <span class="hljs-number">9245</span>]   <span class="hljs-symbol">File</span> <span class="hljs-string">&quot;/usr/lib/python2.7/site-packages/requests/sessions.py&quot;</span>, line <span class="hljs-number">639</span>, in send<br>[<span class="hljs-symbol">Tue</span> <span class="hljs-symbol">Apr</span> <span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">01</span>:<span class="hljs-number">05.658284</span> <span class="hljs-number">2019</span>] [:error] [pid <span class="hljs-number">9245</span>]   <span class="hljs-symbol">File</span> <span class="hljs-string">&quot;/usr/lib/python2.7/site-packages/requests/adapters.py&quot;</span>, line <span class="hljs-number">438</span>, in send<br>[<span class="hljs-symbol">Tue</span> <span class="hljs-symbol">Apr</span> <span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">01</span>:<span class="hljs-number">05.658287</span> <span class="hljs-number">2019</span>] [:error] [pid <span class="hljs-number">9245</span>]   <span class="hljs-symbol">File</span> <span class="hljs-string">&quot;/usr/lib/python2.7/site-packages/requests/packages/urllib3/connectionpool.py&quot;</span>, line <span class="hljs-number">588</span>, in urlopen<br>[<span class="hljs-symbol">Tue</span> <span class="hljs-symbol">Apr</span> <span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">01</span>:<span class="hljs-number">05.658291</span> <span class="hljs-number">2019</span>] [:error] [pid <span class="hljs-number">9245</span>]   <span class="hljs-symbol">File</span> <span class="hljs-string">&quot;/usr/lib/python2.7/site-packages/requests/packages/urllib3/connectionpool.py&quot;</span>, line <span class="hljs-number">241</span>, in <span class="hljs-symbol">_get_conn</span><br>[<span class="hljs-symbol">Tue</span> <span class="hljs-symbol">Apr</span> <span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">01</span>:<span class="hljs-number">05.658296</span> <span class="hljs-number">2019</span>] [:error] [pid <span class="hljs-number">9245</span>]   <span class="hljs-symbol">File</span> <span class="hljs-string">&quot;/usr/lib/python2.7/site-packages/requests/packages/urllib3/util/connection.py&quot;</span>, line <span class="hljs-number">27</span>, in is_connection_dropped<br>[<span class="hljs-symbol">Tue</span> <span class="hljs-symbol">Apr</span> <span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">01</span>:<span class="hljs-number">05.658300</span> <span class="hljs-number">2019</span>] [:error] [pid <span class="hljs-number">9245</span>]   <span class="hljs-symbol">File</span> <span class="hljs-string">&quot;/usr/lib/python2.7/site-packages/requests/packages/urllib3/util/wait.py&quot;</span>, line <span class="hljs-number">33</span>, in wait_for_read<br>[<span class="hljs-symbol">Tue</span> <span class="hljs-symbol">Apr</span> <span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">01</span>:<span class="hljs-number">05.658304</span> <span class="hljs-number">2019</span>] [:error] [pid <span class="hljs-number">9245</span>]   <span class="hljs-symbol">File</span> <span class="hljs-string">&quot;/usr/lib/python2.7/site-packages/requests/packages/urllib3/util/wait.py&quot;</span>, line <span class="hljs-number">22</span>, in <span class="hljs-symbol">_wait_for_io_events</span><br>[<span class="hljs-symbol">Tue</span> <span class="hljs-symbol">Apr</span> <span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">01</span>:<span class="hljs-number">05.658308</span> <span class="hljs-number">2019</span>] [:error] [pid <span class="hljs-number">9245</span>]   <span class="hljs-symbol">File</span> <span class="hljs-string">&quot;/usr/lib/python2.7/site-packages/requests/packages/urllib3/util/selectors.py&quot;</span>, line <span class="hljs-number">581</span>, in <span class="hljs-symbol">DefaultSelector</span><br>[<span class="hljs-symbol">Tue</span> <span class="hljs-symbol">Apr</span> <span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">01</span>:<span class="hljs-number">05.658312</span> <span class="hljs-number">2019</span>] [:error] [pid <span class="hljs-number">9245</span>]   <span class="hljs-symbol">File</span> <span class="hljs-string">&quot;/usr/lib/python2.7/site-packages/requests/packages/urllib3/util/selectors.py&quot;</span>, line <span class="hljs-number">394</span>, in <span class="hljs-symbol">__init__</span><br>[<span class="hljs-symbol">Tue</span> <span class="hljs-symbol">Apr</span> <span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">01</span>:<span class="hljs-number">05.658316</span> <span class="hljs-number">2019</span>] [:error] [pid <span class="hljs-number">9245</span>] <span class="hljs-symbol">IOError</span>: [<span class="hljs-symbol">Errno</span> <span class="hljs-number">24</span>] <span class="hljs-symbol">Too</span> many open files<br></code></pre></td></tr></table></figure><p><em><strong>解决方式：</strong></em><br>修改操作系统打开的文件数；登录到Controller节点，执行:</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-selector-attr">[root@controller ~]</span># ulimit -<span class="hljs-selector-tag">a</span><br>core file size          (blocks, -c) <span class="hljs-number">0</span><br>data seg size           (kbytes, -d) unlimited<br>scheduling priority             (-e) <span class="hljs-number">0</span><br>file size               (blocks, -f) unlimited<br>pending signals                 (-i) <span class="hljs-number">60587</span><br>max locked memory       (kbytes, -l) <span class="hljs-number">64</span><br>max memory size         (kbytes, -m) unlimited<br>open files                      (-n) <span class="hljs-number">1024</span><br>pipe size            (<span class="hljs-number">512</span> bytes, -p) <span class="hljs-number">8</span><br>POSIX message queues     (bytes, -q) <span class="hljs-number">819200</span><br>real-<span class="hljs-selector-tag">time</span> priority              (-r) <span class="hljs-number">0</span><br>stack size              (kbytes, -s) <span class="hljs-number">8192</span><br>cpu <span class="hljs-selector-tag">time</span>               (seconds, -t) unlimited<br>max user processes              (-u) <span class="hljs-number">60587</span><br>virtual memory          (kbytes, -v) unlimited<br>file locks                      (-x) unlimited<br></code></pre></td></tr></table></figure><p>系统默认设置为1024。</p><p>使用命令查看当前打开文件数:</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@controller</span> ~]<span class="hljs-meta"># lsof | wc -l</span><br><span class="hljs-number">174911</span><br></code></pre></td></tr></table></figure><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stata">修改vim /etc/security/limits.<span class="hljs-keyword">conf</span>，在文件最后加入如下信息：<br><br><span class="hljs-comment">*               soft    nofile            1024000</span><br><span class="hljs-comment">*               hard    nofile            1024000</span><br></code></pre></td></tr></table></figure><p>*表示所有用户，<br>修改后重启服务器，配置生效。</p>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Openstack Queens 环境搭建（七）Horizon服务</title>
    <link href="/2019/03/19/openstack/queens/openstack_queens_install_7/"/>
    <url>/2019/03/19/openstack/queens/openstack_queens_install_7/</url>
    
    <content type="html"><![CDATA[<p><strong>Controller节点：</strong><br>安装及配置：</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># yum install openstack-dashboard</span><br></code></pre></td></tr></table></figure><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># vi /etc/openstack-dashboard/local_settings</span><br>OPENSTACK_HOST = <span class="hljs-string">&quot;controller&quot;</span><br>ALLOWED_HOSTS = [&#x27;*&#x27;]<br>SESSION_ENGINE = &#x27;django.contrib.sessions.backends.cache&#x27;<br>CACHES = &#123;<br>    &#x27;default&#x27;: &#123;<br>         &#x27;BACKEND&#x27;: &#x27;django.core.cache.backends.memcached.MemcachedCache&#x27;,<br>         &#x27;LOCATION&#x27;: &#x27;controller:11211&#x27;,<br>    &#125;<br>&#125;<br>OPENSTACK_KEYSTONE_URL = <span class="hljs-string">&quot;http://%s:5000/v3&quot;</span> % OPENSTACK_HOST<br>OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True<br>OPENSTACK_API_VERSIONS = &#123;<br>    <span class="hljs-string">&quot;identity&quot;</span>: 3,<br>    <span class="hljs-string">&quot;image&quot;</span>: 2,<br>    <span class="hljs-string">&quot;volume&quot;</span>: 2,<br>&#125;<br>OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = <span class="hljs-string">&quot;Default&quot;</span><br>OPENSTACK_KEYSTONE_DEFAULT_ROLE = <span class="hljs-string">&quot;user&quot;</span><br>TIME_ZONE = <span class="hljs-string">&quot;Asia/Shanghai&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stata"># vi /etc/httpd/<span class="hljs-keyword">conf</span>.<span class="hljs-keyword">d</span>/openstack-dashboard.<span class="hljs-keyword">conf</span>          在文件开头添加<br>WSGIApplicationGroup %&#123;<span class="hljs-keyword">GLOBAL</span>&#125;<br>...<br></code></pre></td></tr></table></figure><p>完成安装：</p><figure class="highlight thrift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs thrift"># systemctl restart httpd.<span class="hljs-keyword">service</span> memcached.<span class="hljs-keyword">service</span><br></code></pre></td></tr></table></figure><p>使用 <a href="http://controller/dashboard">http://controller/dashboard</a> 上的Web浏览器访问Dashboard。</p>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Openstack Queens 环境搭建（六）Neutron服务</title>
    <link href="/2019/03/19/openstack/queens/openstack_queens_install_6/"/>
    <url>/2019/03/19/openstack/queens/openstack_queens_install_6/</url>
    
    <content type="html"><![CDATA[<p><strong>Controller节点：</strong><br>Neutron服务安装网络类型：vxlan<br>Layer2 二层插件采用：openvswitch</p><p><em><strong>创建neutron数据库</strong></em>，授予权限：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">$ mysql <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p<br><br>MariaDB [(<span class="hljs-keyword">none</span>)] <span class="hljs-keyword">CREATE</span> DATABASE neutron;<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> neutron.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;neutron&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> neutron.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;neutron&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> exit;<br></code></pre></td></tr></table></figure><p><em><strong>创建neutron用户：</strong></em><br><code>$ . admin-openrc</code></p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">$ openstack user create --domain default --password-prompt neutron<br>User Password: 123456<br><span class="hljs-section">Repeat User Password: 123456</span><br><span class="hljs-section">+---------------------+----------------------------------+</span><br><span class="hljs-section">| Field               | Value                            |</span><br><span class="hljs-section">+---------------------+----------------------------------+</span><br>| domain<span class="hljs-emphasis">_id           | default                          |</span><br><span class="hljs-emphasis">| enabled             | True                             |</span><br><span class="hljs-emphasis">| id                  | 463fd14bf95b4cc49c0378623de56ffa |</span><br><span class="hljs-emphasis">| name                | neutron                          |</span><br><span class="hljs-emphasis">| options             | &#123;&#125;                               |</span><br><span class="hljs-emphasis">| password_expires_</span>at | None                             |<br><span class="hljs-code">+---------------------+</span>----------------------------------+<br></code></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">$ openstack <span class="hljs-keyword">role</span> <span class="hljs-title">add</span> --project service --<span class="hljs-keyword">user</span> <span class="hljs-title">neutron</span> admin<br></code></pre></td></tr></table></figure><p><em><strong>创建neutron服务实体：</strong></em></p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">$ openstack service create --name neutron --description &quot;OpenStack Networking&quot; network</span><br><span class="hljs-section">+-------------+----------------------------------+</span><br><span class="hljs-section">| Field       | Value                            |</span><br><span class="hljs-section">+-------------+----------------------------------+</span><br>| description | OpenStack Networking             |<br>| enabled     | True                             |<br>| id          | e10e48790ede425ea81e1a62250f124a |<br>| name        | neutron                          |<br><span class="hljs-section">| type        | network                          |</span><br><span class="hljs-section">+-------------+----------------------------------+</span><br></code></pre></td></tr></table></figure><p><em><strong>创建网络服务API端点：</strong></em></p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">$ openstack endpoint create --region RegionOne network public http://controller:9696</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br><span class="hljs-section">| Field        | Value                            |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br>| enabled      | True                             |<br>| id           | f688ed8f1bf340d78794b600fa512145 |<br>| interface    | public                           |<br>| region       | RegionOne                        |<br>| region<span class="hljs-emphasis">_id    | RegionOne                        |</span><br><span class="hljs-emphasis">| service_id   | e10e48790ede425ea81e1a62250f124a |</span><br><span class="hljs-emphasis">| service_name | neutron                          |</span><br><span class="hljs-emphasis">| service_</span>type | network                          |<br><span class="hljs-section">| url          | http://controller:9696           |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">$ openstack endpoint create --region RegionOne network internal http://controller:9696</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br><span class="hljs-section">| Field        | Value                            |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br>| enabled      | True                             |<br>| id           | 571a008230c54cf8bcb1e38a75787c3f |<br>| interface    | internal                         |<br>| region       | RegionOne                        |<br>| region<span class="hljs-emphasis">_id    | RegionOne                        |</span><br><span class="hljs-emphasis">| service_id   | e10e48790ede425ea81e1a62250f124a |</span><br><span class="hljs-emphasis">| service_name | neutron                          |</span><br><span class="hljs-emphasis">| service_</span>type | network                          |<br><span class="hljs-section">| url          | http://controller:9696           |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">$ openstack endpoint create --region RegionOne network admin http://controller:9696</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br><span class="hljs-section">| Field        | Value                            |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br>| enabled      | True                             |<br>| id           | a8d654c1c878423789aab3fa7cf634cb |<br>| interface    | admin                            |<br>| region       | RegionOne                        |<br>| region<span class="hljs-emphasis">_id    | RegionOne                        |</span><br><span class="hljs-emphasis">| service_id   | e10e48790ede425ea81e1a62250f124a |</span><br><span class="hljs-emphasis">| service_name | neutron                          |</span><br><span class="hljs-emphasis">| service_</span>type | network                          |<br><span class="hljs-section">| url          | http://controller:9696           |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br></code></pre></td></tr></table></figure><p>安装及配置：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># yum install openstack-neutron openstack-neutron-ml2 openstack-neutron-openvswitch ebtables</span><br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># vi /etc/neutron/neutron.conf</span><br><span class="hljs-section">[DEFAULT]</span><br><span class="hljs-attr">auth_strategy</span> = keystone<br><span class="hljs-attr">core_plugin</span> = ml2<br><span class="hljs-attr">service_plugins</span> = router<br><span class="hljs-attr">allow_overlapping_ips</span> = <span class="hljs-literal">True</span><br><span class="hljs-attr">transport_url</span> = rabbit://openstack:<span class="hljs-number">123456</span>@controller<br><span class="hljs-attr">notify_nova_on_port_status_changes</span> = <span class="hljs-literal">true</span><br><span class="hljs-attr">notify_nova_on_port_data_changes</span> = <span class="hljs-literal">true</span><br><span class="hljs-section">[database]</span><br><span class="hljs-attr">connection</span> = mysql+pymysql://neutron:<span class="hljs-number">123456</span>@controller/neutron<br><span class="hljs-section">[keystone_authtoken]</span><br><span class="hljs-attr">auth_uri</span> = http://controller:<span class="hljs-number">5000</span><br><span class="hljs-attr">auth_url</span> = http://controller:<span class="hljs-number">35357</span><br><span class="hljs-attr">memcached_servers</span> = controller:<span class="hljs-number">11211</span><br><span class="hljs-attr">auth_type</span> = password<br><span class="hljs-attr">project_domain_name</span> = default<br><span class="hljs-attr">user_domain_name</span> = default<br><span class="hljs-attr">project_name</span> = service<br><span class="hljs-attr">username</span> = neutron<br><span class="hljs-attr">password</span> = <span class="hljs-number">123456</span><br><span class="hljs-section">[nova]</span><br><span class="hljs-attr">auth_url</span> = http://controller:<span class="hljs-number">35357</span><br><span class="hljs-attr">auth_type</span> = password<br><span class="hljs-attr">project_domain_name</span> = default<br><span class="hljs-attr">user_domain_name</span> = default<br><span class="hljs-attr">region_name</span> = RegionOne<br><span class="hljs-attr">project_name</span> = service<br><span class="hljs-attr">username</span> = nova<br><span class="hljs-attr">password</span> = <span class="hljs-number">123456</span><br><span class="hljs-section">[oslo_concurrency]</span><br><span class="hljs-attr">lock_path</span> = /var/lib/neutron/tmp<br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># vi /etc/neutron/plugins/ml2/ml2_conf.ini</span><br><span class="hljs-section">[ml2]</span><br><span class="hljs-attr">type_drivers</span> = flat,vlan,vxlan<br><span class="hljs-attr">tenant_network_types</span> = vxlan<br><span class="hljs-attr">mechanism_drivers</span> = openvswitch,l2population<br><span class="hljs-attr">extension_drivers</span> = port_security<br><span class="hljs-section">[ml2_type_flat]</span><br><span class="hljs-attr">flat_networks</span> = provider<br><span class="hljs-section">[ml2_type_vlan]</span><br><span class="hljs-comment">#network_vlan_ranges = provider:1:1000</span><br><span class="hljs-section">[ml2_type_vxlan]</span><br><span class="hljs-attr">vni_ranges</span> = <span class="hljs-number">1</span>:<span class="hljs-number">1000</span><br><span class="hljs-section">[securitygroup]</span><br><span class="hljs-attr">enable_ipset</span> = <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># vi /etc/sysctl.conf</span><br><span class="hljs-attr">net.bridge.bridge-nf-call-ip6tables</span> = <span class="hljs-number">1</span><br><span class="hljs-attr">net.bridge.bridge-nf-call-iptables</span> = <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># vi /etc/neutron/l3_agent.ini</span><br>[DEFAULT]<br>interface_driver = openvswitch<br>external_network_bridge =<br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># vi /etc/neutron/dhcp_agent.ini</span><br><span class="hljs-section">[DEFAULT]</span><br><span class="hljs-attr">interface_driver</span> = openvswitch<br><span class="hljs-attr">dhcp_driver</span> = neutron.agent.linux.dhcp.Dnsmasq<br><span class="hljs-attr">enable_isolated_metadata</span> = <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># vi /etc/neutron/metadata_agent.ini</span><br><span class="hljs-section">[DEFAULT]</span><br><span class="hljs-attr">nova_metadata_host</span> = controller<br><span class="hljs-attr">metadata_proxy_shared_secret</span> = <span class="hljs-number">123456</span><br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># vi /etc/neutron/plugins/ml2/openvswitch_agent.ini</span><br><span class="hljs-section">[agent]</span><br><span class="hljs-attr">tunnel_types</span> = vxlan<br><span class="hljs-attr">l2_population</span> = <span class="hljs-literal">True</span><br><span class="hljs-section">[ovs]</span><br><span class="hljs-attr">bridge_mappings</span> = provider:br-provider<br><span class="hljs-attr">local_ip</span> = <span class="hljs-number">10.0</span>.<span class="hljs-number">0.11</span><br><span class="hljs-section">[securitygroup]</span><br><span class="hljs-attr">firewall_driver</span> = iptables_hybrid<br></code></pre></td></tr></table></figure><p>完成安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">ln</span> -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">su -s /bin/sh -c <span class="hljs-string">&quot;neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head&quot;</span> neutron</span><br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># systemctl <span class="hljs-keyword">restart</span> openstack-nova-api.service<br># systemctl <span class="hljs-keyword">start</span> neutron-<span class="hljs-keyword">server</span>.service<br># systemctl <span class="hljs-keyword">start</span> neutron-openvswitch-agent.service<br></code></pre></td></tr></table></figure><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs llvm"># ovs-vsctl <span class="hljs-keyword">add</span>-<span class="hljs-keyword">br</span> <span class="hljs-keyword">br</span>-provider<br># ifconfig eth<span class="hljs-number">0</span> <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><br># ifconfig <span class="hljs-keyword">br</span>-provider <span class="hljs-number">192.100</span>.<span class="hljs-number">10.160</span>/<span class="hljs-number">24</span><br># route <span class="hljs-keyword">add</span> <span class="hljs-keyword">default</span> gw <span class="hljs-number">192.100</span>.<span class="hljs-number">10.1</span><br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># systemctl <span class="hljs-keyword">restart</span> neutron-<span class="hljs-keyword">server</span>.service<br># systemctl <span class="hljs-keyword">restart</span> neutron-openvswitch-agent.service<br># systemctl <span class="hljs-keyword">enable</span> neutron-<span class="hljs-keyword">server</span>.service neutron-openvswitch-agent.service neutron-dhcp-agent.service neutron-metadata-agent.service<br># systemctl <span class="hljs-keyword">start</span> neutron-dhcp-agent.service neutron-metadata-agent.service<br># systemctl <span class="hljs-keyword">enable</span> neutron-l3-agent.service<br># systemctl <span class="hljs-keyword">start</span> neutron-l3-agent.service<br></code></pre></td></tr></table></figure><p><strong>Compute节点：</strong><br>安装及配置：</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># yum install openstack-neutron-openvswitch ebtables ipset</span><br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># vi /etc/neutron/neutron.conf</span><br><span class="hljs-section">[DEFAULT]</span><br><span class="hljs-attr">transport_url</span> = rabbit://openstack:<span class="hljs-number">123456</span>@controller<br><span class="hljs-attr">auth_strategy</span> = keystone<br><span class="hljs-section">[keystone_authtoken]</span><br><span class="hljs-attr">auth_uri</span> = http://controller:<span class="hljs-number">5000</span><br><span class="hljs-attr">auth_url</span> = http://controller:<span class="hljs-number">35357</span><br><span class="hljs-attr">memcached_servers</span> = controller:<span class="hljs-number">11211</span><br><span class="hljs-attr">auth_type</span> = password<br><span class="hljs-attr">project_domain_name</span> = default<br><span class="hljs-attr">user_domain_name</span> = default<br><span class="hljs-attr">project_name</span> = service<br><span class="hljs-attr">username</span> = neutron<br><span class="hljs-attr">password</span> = <span class="hljs-number">123456</span><br><span class="hljs-section">[oslo_concurrency]</span><br><span class="hljs-attr">lock_path</span> = /var/lib/neutron/tmp<br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># vi /etc/neutron/plugins/ml2/openvswitch_agent.ini</span><br><span class="hljs-section">[ovs]</span><br><span class="hljs-attr">local_ip</span> = <span class="hljs-number">10.0</span>.<span class="hljs-number">0.21</span><br><span class="hljs-section">[agent]</span><br><span class="hljs-attr">tunnel_types</span> = vxlan<br><span class="hljs-attr">l2_population</span> = <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># systemctl restart neutron-openvswitch-agent.service</span><br></code></pre></td></tr></table></figure><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># vi /etc/nova/nova.conf</span><br>...<br>[neutron]<br>url = http://controller:9696<br>auth_url = http://controller:35357<br>auth_type = password<br>project_domain_name = default<br>user_domain_name = default<br>region_name = RegionOne<br>project_name = service<br>username = neutron<br>password = 123456<br></code></pre></td></tr></table></figure><p>完成安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl restart openstack-nova-compute.service</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl <span class="hljs-built_in">enable</span> neutron-openvswitch-agent.service</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl start neutron-openvswitch-agent.service</span><br></code></pre></td></tr></table></figure><p><strong>Controller节点：</strong><br>验证操作：<br><code>$ . admin-openrc</code></p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">$ openstack extension list --network<br>+----------------------------------------------------------------------------------------------+---------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+<br>|<span class="hljs-string"> Name                                                                                         </span>|<span class="hljs-string"> Alias                     </span>|<span class="hljs-string"> Description                                                                                                                                              </span>|<br>+----------------------------------------------------------------------------------------------+---------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+<br>|<span class="hljs-string"> Default Subnetpools                                                                          </span>|<span class="hljs-string"> default-subnetpools       </span>|<span class="hljs-string"> Provides ability to mark and use a subnetpool as the default.                                                                                            </span>|<br>|<span class="hljs-string"> Availability Zone                                                                            </span>|<span class="hljs-string"> availability_zone         </span>|<span class="hljs-string"> The availability zone extension.                                                                                                                         </span>|<br>|<span class="hljs-string"> Network Availability Zone                                                                    </span>|<span class="hljs-string"> network_availability_zone </span>|<span class="hljs-string"> Availability zone support for network.                                                                                                                   </span>|<br>|<span class="hljs-string"> Auto Allocated Topology Services                                                             </span>|<span class="hljs-string"> auto-allocated-topology   </span>|<span class="hljs-string"> Auto Allocated Topology Services.                                                                                                                        </span>|<br>|<span class="hljs-string"> Neutron L3 Configurable external gateway mode                                                </span>|<span class="hljs-string"> ext-gw-mode               </span>|<span class="hljs-string"> Extension of the router abstraction for specifying whether SNAT should occur on the external gateway                                                     </span>|<br>|<span class="hljs-string"> Port Binding                                                                                 </span>|<span class="hljs-string"> binding                   </span>|<span class="hljs-string"> Expose port bindings of a virtual port to external application                                                                                           </span>|<br>|<span class="hljs-string"> agent                                                                                        </span>|<span class="hljs-string"> agent                     </span>|<span class="hljs-string"> The agent management extension.                                                                                                                          </span>|<br>|<span class="hljs-string"> Subnet Allocation                                                                            </span>|<span class="hljs-string"> subnet_allocation         </span>|<span class="hljs-string"> Enables allocation of subnets from a subnet pool                                                                                                         </span>|<br>|<span class="hljs-string"> L3 Agent Scheduler                                                                           </span>|<span class="hljs-string"> l3_agent_scheduler        </span>|<span class="hljs-string"> Schedule routers among l3 agents                                                                                                                         </span>|<br>|<span class="hljs-string"> Tag support                                                                                  </span>|<span class="hljs-string"> tag                       </span>|<span class="hljs-string"> Enables to set tag on resources.                                                                                                                         </span>|<br>|<span class="hljs-string"> Neutron external network                                                                     </span>|<span class="hljs-string"> external-net              </span>|<span class="hljs-string"> Adds external network attribute to network resource.                                                                                                     </span>|<br>|<span class="hljs-string"> Tag support for resources with standard attribute: trunk, policy, security_group, floatingip </span>|<span class="hljs-string"> standard-attr-tag         </span>|<span class="hljs-string"> Enables to set tag on resources with standard attribute.                                                                                                 </span>|<br>|<span class="hljs-string"> Neutron Service Flavors                                                                      </span>|<span class="hljs-string"> flavors                   </span>|<span class="hljs-string"> Flavor specification for Neutron advanced services.                                                                                                      </span>|<br>|<span class="hljs-string"> Network MTU                                                                                  </span>|<span class="hljs-string"> net-mtu                   </span>|<span class="hljs-string"> Provides MTU attribute for a network resource.                                                                                                           </span>|<br>|<span class="hljs-string"> Network IP Availability                                                                      </span>|<span class="hljs-string"> network-ip-availability   </span>|<span class="hljs-string"> Provides IP availability data for each network and subnet.                                                                                               </span>|<br>|<span class="hljs-string"> Quota management support                                                                     </span>|<span class="hljs-string"> quotas                    </span>|<span class="hljs-string"> Expose functions for quotas management per tenant                                                                                                        </span>|<br>|<span class="hljs-string"> If-Match constraints based on revision_number                                                </span>|<span class="hljs-string"> revision-if-match         </span>|<span class="hljs-string"> Extension indicating that If-Match based on revision_number is supported.                                                                                </span>|<br>|<span class="hljs-string"> HA Router extension                                                                          </span>|<span class="hljs-string"> l3-ha                     </span>|<span class="hljs-string"> Adds HA capability to routers.                                                                                                                           </span>|<br>|<span class="hljs-string"> Provider Network                                                                             </span>|<span class="hljs-string"> provider                  </span>|<span class="hljs-string"> Expose mapping of virtual networks to physical networks                                                                                                  </span>|<br>|<span class="hljs-string"> Multi Provider Network                                                                       </span>|<span class="hljs-string"> multi-provider            </span>|<span class="hljs-string"> Expose mapping of virtual networks to multiple physical networks                                                                                         </span>|<br>|<span class="hljs-string"> Quota details management support                                                             </span>|<span class="hljs-string"> quota_details             </span>|<span class="hljs-string"> Expose functions for quotas usage statistics per project                                                                                                 </span>|<br>|<span class="hljs-string"> Address scope                                                                                </span>|<span class="hljs-string"> address-scope             </span>|<span class="hljs-string"> Address scopes extension.                                                                                                                                </span>|<br>|<span class="hljs-string"> Neutron Extra Route                                                                          </span>|<span class="hljs-string"> extraroute                </span>|<span class="hljs-string"> Extra routes configuration for L3 router                                                                                                                 </span>|<br>|<span class="hljs-string"> Network MTU (writable)                                                                       </span>|<span class="hljs-string"> net-mtu-writable          </span>|<span class="hljs-string"> Provides a writable MTU attribute for a network resource.                                                                                                </span>|<br>|<span class="hljs-string"> Subnet service types                                                                         </span>|<span class="hljs-string"> subnet-service-types      </span>|<span class="hljs-string"> Provides ability to set the subnet service_types field                                                                                                   </span>|<br>|<span class="hljs-string"> Resource timestamps                                                                          </span>|<span class="hljs-string"> standard-attr-timestamp   </span>|<span class="hljs-string"> Adds created_at and updated_at fields to all Neutron resources that have Neutron standard attributes.                                                    </span>|<br>|<span class="hljs-string"> Neutron 服务类型管理                                                                         </span>|<span class="hljs-string"> service-type              </span>|<span class="hljs-string"> 用于为 Neutron 高级服务检索服务提供程序的 API                                                                                                            </span>|<br>|<span class="hljs-string"> Router Flavor Extension                                                                      </span>|<span class="hljs-string"> l3-flavors                </span>|<span class="hljs-string"> Flavor support for routers.                                                                                                                              </span>|<br>|<span class="hljs-string"> Port Security                                                                                </span>|<span class="hljs-string"> port-security             </span>|<span class="hljs-string"> Provides port security                                                                                                                                   </span>|<br>|<span class="hljs-string"> Neutron Extra DHCP options                                                                   </span>|<span class="hljs-string"> extra_dhcp_opt            </span>|<span class="hljs-string"> Extra options configuration for DHCP. For example PXE boot options to DHCP clients can be specified (e.g. tftp-server, server-ip-address, bootfile-name) </span>|<br>|<span class="hljs-string"> Resource revision numbers                                                                    </span>|<span class="hljs-string"> standard-attr-revisions   </span>|<span class="hljs-string"> This extension will display the revision number of neutron resources.                                                                                    </span>|<br>|<span class="hljs-string"> Pagination support                                                                           </span>|<span class="hljs-string"> pagination                </span>|<span class="hljs-string"> Extension that indicates that pagination is enabled.                                                                                                     </span>|<br>|<span class="hljs-string"> Sorting support                                                                              </span>|<span class="hljs-string"> sorting                   </span>|<span class="hljs-string"> Extension that indicates that sorting is enabled.                                                                                                        </span>|<br>|<span class="hljs-string"> security-group                                                                               </span>|<span class="hljs-string"> security-group            </span>|<span class="hljs-string"> The security groups extension.                                                                                                                           </span>|<br>|<span class="hljs-string"> DHCP Agent Scheduler                                                                         </span>|<span class="hljs-string"> dhcp_agent_scheduler      </span>|<span class="hljs-string"> Schedule networks among dhcp agents                                                                                                                      </span>|<br>|<span class="hljs-string"> Router Availability Zone                                                                     </span>|<span class="hljs-string"> router_availability_zone  </span>|<span class="hljs-string"> Availability zone support for router.                                                                                                                    </span>|<br>|<span class="hljs-string"> RBAC Policies                                                                                </span>|<span class="hljs-string"> rbac-policies             </span>|<span class="hljs-string"> Allows creation and modification of policies that control tenant access to resources.                                                                    </span>|<br>|<span class="hljs-string"> Tag support for resources: subnet, subnetpool, port, router                                  </span>|<span class="hljs-string"> tag-ext                   </span>|<span class="hljs-string"> Extends tag support to more L2 and L3 resources.                                                                                                         </span>|<br>|<span class="hljs-string"> standard-attr-description                                                                    </span>|<span class="hljs-string"> standard-attr-description </span>|<span class="hljs-string"> Extension to add descriptions to standard attributes                                                                                                     </span>|<br>|<span class="hljs-string"> IP address substring filtering                                                               </span>|<span class="hljs-string"> ip-substring-filtering    </span>|<span class="hljs-string"> Provides IP address substring filtering when listing ports                                                                                               </span>|<br>|<span class="hljs-string"> Neutron L3 Router                                                                            </span>|<span class="hljs-string"> router                    </span>|<span class="hljs-string"> Router abstraction for basic L3 forwarding between L2 Neutron networks and access to external networks via a NAT gateway.                                </span>|<br>|<span class="hljs-string"> Allowed Address Pairs                                                                        </span>|<span class="hljs-string"> allowed-address-pairs     </span>|<span class="hljs-string"> Provides allowed address pairs                                                                                                                           </span>|<br>|<span class="hljs-string"> project_id field enabled                                                                     </span>|<span class="hljs-string"> project-id                </span>|<span class="hljs-string"> Extension that indicates that project_id field is enabled.                                                                                               </span>|<br>|<span class="hljs-string"> Distributed Virtual Router                                                                   </span>|<span class="hljs-string"> dvr                       </span>|<span class="hljs-string"> Enables configuration of Distributed Virtual Routers.                                                                                                    </span>|<br>+----------------------------------------------------------------------------------------------+---------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+<br></code></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">$ openstack network agent list<br>+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+<br>|<span class="hljs-string"> ID                                   </span>|<span class="hljs-string"> Agent Type         </span>|<span class="hljs-string"> Host       </span>|<span class="hljs-string"> Availability Zone </span>|<span class="hljs-string"> Alive </span>|<span class="hljs-string"> State </span>|<span class="hljs-string"> Binary                    </span>|<br>+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+<br>|<span class="hljs-string"> 0fcf4aa9-3592-4552-9b4c-f2b55e23ef6b </span>|<span class="hljs-string"> DHCP agent         </span>|<span class="hljs-string"> controller </span>|<span class="hljs-string"> nova              </span>|<span class="hljs-string"> :-)   </span>|<span class="hljs-string"> UP    </span>|<span class="hljs-string"> neutron-dhcp-agent        </span>|<br>|<span class="hljs-string"> 1a08e5eb-d867-4697-850d-bd2400134162 </span>|<span class="hljs-string"> Metadata agent     </span>|<span class="hljs-string"> controller </span>|<span class="hljs-string"> None              </span>|<span class="hljs-string"> :-)   </span>|<span class="hljs-string"> UP    </span>|<span class="hljs-string"> neutron-metadata-agent    </span>|<br>|<span class="hljs-string"> 9a33be1e-61bd-4d6b-9ee1-bda6dc7b44cd </span>|<span class="hljs-string"> Linux bridge agent </span>|<span class="hljs-string"> controller </span>|<span class="hljs-string"> None              </span>|<span class="hljs-string"> :-)   </span>|<span class="hljs-string"> UP    </span>|<span class="hljs-string"> neutron-linuxbridge-agent </span>|<br>|<span class="hljs-string"> bfdb443d-feee-4006-8618-558b73c3c4a2 </span>|<span class="hljs-string"> L3 agent           </span>|<span class="hljs-string"> controller </span>|<span class="hljs-string"> nova              </span>|<span class="hljs-string"> :-)   </span>|<span class="hljs-string"> UP    </span>|<span class="hljs-string"> neutron-l3-agent          </span>|<br>|<span class="hljs-string"> ce5abc8d-504a-4164-ae0f-801e56a06653 </span>|<span class="hljs-string"> Linux bridge agent </span>|<span class="hljs-string"> compute    </span>|<span class="hljs-string"> None              </span>|<span class="hljs-string"> :-)   </span>|<span class="hljs-string"> UP    </span>|<span class="hljs-string"> neutron-linuxbridge-agent </span>|<br>+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Openstack Queens 环境搭建（五）Nova服务</title>
    <link href="/2019/03/19/openstack/queens/openstack_queens_install_5/"/>
    <url>/2019/03/19/openstack/queens/openstack_queens_install_5/</url>
    
    <content type="html"><![CDATA[<p><strong>Controller节点：</strong><br><em><strong>创建 nova_api, nova,和 nova_cell0 的数据库，授予权限：</strong></em></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">$ mysql <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p<br><br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">CREATE</span> DATABASE nova_api;<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">CREATE</span> DATABASE nova;<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">CREATE</span> DATABASE nova_cell0;<br><br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> nova_api.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> nova_api.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> nova.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> nova.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> nova_cell0.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> nova_cell0.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br><br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> exit;<br></code></pre></td></tr></table></figure><p><em><strong>创建nova用户：</strong></em><br><code>$ . admin-openrc</code></p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">$ openstack user create --domain default --password-prompt nova<br>User Password: 123456<br><span class="hljs-section">Repeat User Password: 123456</span><br><span class="hljs-section">+---------------------+----------------------------------+</span><br><span class="hljs-section">| Field               | Value                            |</span><br><span class="hljs-section">+---------------------+----------------------------------+</span><br>| domain<span class="hljs-emphasis">_id           | default                          |</span><br><span class="hljs-emphasis">| enabled             | True                             |</span><br><span class="hljs-emphasis">| id                  | 81f1d5dfad5a42bb806d197ceb9881ce |</span><br><span class="hljs-emphasis">| name                | nova                             |</span><br><span class="hljs-emphasis">| options             | &#123;&#125;                               |</span><br><span class="hljs-emphasis">| password_expires_</span>at | None                             |<br><span class="hljs-code">+---------------------+</span>----------------------------------+<br></code></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">$ openstack <span class="hljs-keyword">role</span> <span class="hljs-title">add</span> --project service --<span class="hljs-keyword">user</span> <span class="hljs-title">nova</span> admin<br></code></pre></td></tr></table></figure><p><em><strong>创建nova服务实体：</strong></em></p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">$ openstack service create --name nova --description &quot;OpenStack Compute&quot; compute</span><br><span class="hljs-section">+-------------+----------------------------------+</span><br><span class="hljs-section">| Field       | Value                            |</span><br><span class="hljs-section">+-------------+----------------------------------+</span><br>| description | OpenStack Compute                |<br>| enabled     | True                             |<br>| id          | 3e011d345e4442fe8a232ab5ab1f8323 |<br>| name        | nova                             |<br><span class="hljs-section">| type        | compute                          |</span><br><span class="hljs-section">+-------------+----------------------------------+</span><br></code></pre></td></tr></table></figure><p><em><strong>创建Compute API服务端点：</strong></em></p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">$ openstack endpoint create --region RegionOne compute public http://controller:8774/v2.1</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br><span class="hljs-section">| Field        | Value                            |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br>| enabled      | True                             |<br>| id           | 343b6a8fc9564623aca0097b2383650d |<br>| interface    | public                           |<br>| region       | RegionOne                        |<br>| region<span class="hljs-emphasis">_id    | RegionOne                        |</span><br><span class="hljs-emphasis">| service_id   | 3e011d345e4442fe8a232ab5ab1f8323 |</span><br><span class="hljs-emphasis">| service_name | nova                             |</span><br><span class="hljs-emphasis">| service_</span>type | compute                          |<br><span class="hljs-section">| url          | http://controller:8774/v2.1      |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">$ openstack endpoint create --region RegionOne compute internal http://controller:8774/v2.1</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br><span class="hljs-section">| Field        | Value                            |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br>| enabled      | True                             |<br>| id           | 3458cf55ac8b44d58c949fe88bf9afe3 |<br>| interface    | internal                         |<br>| region       | RegionOne                        |<br>| region<span class="hljs-emphasis">_id    | RegionOne                        |</span><br><span class="hljs-emphasis">| service_id   | 3e011d345e4442fe8a232ab5ab1f8323 |</span><br><span class="hljs-emphasis">| service_name | nova                             |</span><br><span class="hljs-emphasis">| service_</span>type | compute                          |<br><span class="hljs-section">| url          | http://controller:8774/v2.1      |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">$ openstack endpoint create --region RegionOne compute admin http://controller:8774/v2.1</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br><span class="hljs-section">| Field        | Value                            |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br>| enabled      | True                             |<br>| id           | 9f9115389c2a49a2874761b92c849bb0 |<br>| interface    | admin                            |<br>| region       | RegionOne                        |<br>| region<span class="hljs-emphasis">_id    | RegionOne                        |</span><br><span class="hljs-emphasis">| service_id   | 3e011d345e4442fe8a232ab5ab1f8323 |</span><br><span class="hljs-emphasis">| service_name | nova                             |</span><br><span class="hljs-emphasis">| service_</span>type | compute                          |<br><span class="hljs-section">| url          | http://controller:8774/v2.1      |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br></code></pre></td></tr></table></figure><p><em><strong>创建Placement服务相关：</strong></em></p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">$ openstack user create --domain default --password-prompt placement<br>User Password: 123456<br><span class="hljs-section">Repeat User Password: 123456</span><br><span class="hljs-section">+---------------------+----------------------------------+</span><br><span class="hljs-section">| Field               | Value                            |</span><br><span class="hljs-section">+---------------------+----------------------------------+</span><br>| domain<span class="hljs-emphasis">_id           | default                          |</span><br><span class="hljs-emphasis">| enabled             | True                             |</span><br><span class="hljs-emphasis">| id                  | 74870bc86a7c4108869c620099bffc30 |</span><br><span class="hljs-emphasis">| name                | placement                        |</span><br><span class="hljs-emphasis">| options             | &#123;&#125;                               |</span><br><span class="hljs-emphasis">| password_expires_</span>at | None                             |<br><span class="hljs-code">+---------------------+</span>----------------------------------+<br></code></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">$ openstack <span class="hljs-keyword">role</span> <span class="hljs-title">add</span> --project service --<span class="hljs-keyword">user</span> <span class="hljs-title">placement</span> admin<br></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">$ openstack service create --name placement --description &quot;Placement API&quot; placement</span><br><span class="hljs-section">+-------------+----------------------------------+</span><br><span class="hljs-section">| Field       | Value                            |</span><br><span class="hljs-section">+-------------+----------------------------------+</span><br>| description | Placement API                    |<br>| enabled     | True                             |<br>| id          | bbd270a97c3a499fb73765120094e9da |<br>| name        | placement                        |<br><span class="hljs-section">| type        | placement                        |</span><br><span class="hljs-section">+-------------+----------------------------------+</span><br></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">$ openstack endpoint create --region RegionOne placement public http://controller:8778</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br><span class="hljs-section">| Field        | Value                            |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br>| enabled      | True                             |<br>| id           | d79b3b62302a4055924762ac676fc9b4 |<br>| interface    | public                           |<br>| region       | RegionOne                        |<br>| region<span class="hljs-emphasis">_id    | RegionOne                        |</span><br><span class="hljs-emphasis">| service_id   | bbd270a97c3a499fb73765120094e9da |</span><br><span class="hljs-emphasis">| service_name | placement                        |</span><br><span class="hljs-emphasis">| service_</span>type | placement                        |<br><span class="hljs-section">| url          | http://controller:8778           |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">$ openstack endpoint create --region RegionOne placement internal http://controller:8778</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br><span class="hljs-section">| Field        | Value                            |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br>| enabled      | True                             |<br>| id           | 5424919fbee34a7a92946c607706b38a |<br>| interface    | internal                         |<br>| region       | RegionOne                        |<br>| region<span class="hljs-emphasis">_id    | RegionOne                        |</span><br><span class="hljs-emphasis">| service_id   | bbd270a97c3a499fb73765120094e9da |</span><br><span class="hljs-emphasis">| service_name | placement                        |</span><br><span class="hljs-emphasis">| service_</span>type | placement                        |<br><span class="hljs-section">| url          | http://controller:8778           |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">$ openstack endpoint create --region RegionOne placement admin http://controller:8778</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br><span class="hljs-section">| Field        | Value                            |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br>| enabled      | True                             |<br>| id           | d9d5626cdb5442ac91dff8c1588f4726 |<br>| interface    | admin                            |<br>| region       | RegionOne                        |<br>| region<span class="hljs-emphasis">_id    | RegionOne                        |</span><br><span class="hljs-emphasis">| service_id   | bbd270a97c3a499fb73765120094e9da |</span><br><span class="hljs-emphasis">| service_name | placement                        |</span><br><span class="hljs-emphasis">| service_</span>type | placement                        |<br><span class="hljs-section">| url          | http://controller:8778           |</span><br><span class="hljs-section">+--------------+----------------------------------+</span><br></code></pre></td></tr></table></figure><p><em><strong>安装和配置：</strong></em></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># yum install openstack-nova-api openstack-nova-conductor openstack-nova-console openstack-nova-novncproxy openstack-nova-scheduler openstack-nova-placement-api</span><br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># vi /etc/nova/nova.conf</span><br><span class="hljs-section">[DEFAULT]</span><br><span class="hljs-attr">my_ip</span>=<span class="hljs-number">192.100</span>.<span class="hljs-number">10.160</span><br><span class="hljs-attr">use_neutron</span>=<span class="hljs-literal">true</span><br><span class="hljs-attr">firewall_driver</span>=nova.virt.firewall.NoopFirewallDriver<br><span class="hljs-attr">enabled_apis</span>=osapi_compute,metadata<br><span class="hljs-attr">transport_url</span>=rabbit://openstack:<span class="hljs-number">123456</span>@controller<br><span class="hljs-section">[api]</span><br><span class="hljs-attr">auth_strategy</span>=keystone<br><span class="hljs-section">[api_database]</span><br><span class="hljs-attr">connection</span> = mysql+pymysql://nova:<span class="hljs-number">123456</span>@controller/nova_api<br><span class="hljs-section">[database]</span><br><span class="hljs-attr">connection</span> = mysql+pymysql://nova:<span class="hljs-number">123456</span>@controller/nova<br><span class="hljs-section">[glance]</span><br><span class="hljs-attr">api_servers</span> = http://controller:<span class="hljs-number">9292</span><br><span class="hljs-section">[keystone_authtoken]</span><br><span class="hljs-attr">auth_url</span> = http://controller:<span class="hljs-number">5000</span>/v3<br><span class="hljs-attr">memcached_servers</span> = controller:<span class="hljs-number">11211</span><br><span class="hljs-attr">auth_type</span> = password<br><span class="hljs-attr">project_domain_name</span> = default<br><span class="hljs-attr">user_domain_name</span> = default<br><span class="hljs-attr">project_name</span> = service<br><span class="hljs-attr">username</span> = nova<br><span class="hljs-attr">password</span> = <span class="hljs-number">123456</span><br><span class="hljs-section">[libvirt]</span><br><span class="hljs-comment">#virt_type=kvm</span><br><span class="hljs-section">[neutron]</span><br><span class="hljs-attr">url</span> = http://controller:<span class="hljs-number">9696</span><br><span class="hljs-attr">auth_url</span> = http://controller:<span class="hljs-number">35357</span><br><span class="hljs-attr">auth_type</span> = password<br><span class="hljs-attr">project_domain_name</span> = default<br><span class="hljs-attr">user_domain_name</span> = default<br><span class="hljs-attr">region_name</span> = RegionOne<br><span class="hljs-attr">project_name</span> = service<br><span class="hljs-attr">username</span> = neutron<br><span class="hljs-attr">password</span> = <span class="hljs-number">123456</span><br><span class="hljs-attr">service_metadata_proxy</span> = <span class="hljs-literal">true</span><br><span class="hljs-attr">metadata_proxy_shared_secret</span> = <span class="hljs-number">123456</span><br><span class="hljs-section">[oslo_concurrency]</span><br><span class="hljs-attr">lock_path</span>=/var/lib/nova/tmp<br><span class="hljs-section">[placement]</span><br><span class="hljs-attr">os_region_name</span> = RegionOne<br><span class="hljs-attr">project_domain_name</span> = Default<br><span class="hljs-attr">project_name</span> = service<br><span class="hljs-attr">auth_type</span> = password<br><span class="hljs-attr">user_domain_name</span> = Default<br><span class="hljs-attr">auth_url</span> = http://controller:<span class="hljs-number">5000</span>/v3<br><span class="hljs-attr">username</span> = placement<br><span class="hljs-attr">password</span> = <span class="hljs-number">123456</span><br><span class="hljs-section">[vnc]</span><br><span class="hljs-attr">enabled</span>=<span class="hljs-literal">true</span><br><span class="hljs-attr">server_listen</span>=<span class="hljs-variable">$my_ip</span><br><span class="hljs-attr">server_proxyclient_address</span>=<span class="hljs-variable">$my_ip</span><br><span class="hljs-comment">#novncproxy_base_url=http://127.0.0.1:6080/vnc_auto.html</span><br></code></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><span class="hljs-comment"># vi /etc/httpd/conf.d/00-nova-placement-api.conf            在最下方加入</span><br><span class="hljs-variable">&lt;Directory /usr/bin&gt;</span><br>   <span class="hljs-variable">&lt;IfVersion &gt;</span>= 2.4&gt;<br>      Require all granted<br>   <span class="hljs-variable">&lt;/IfVersion&gt;</span><br>   <span class="hljs-variable">&lt;IfVersion &lt; 2.4&gt;</span><br>      Order allow,deny<br>      Allow from all<br>   <span class="hljs-variable">&lt;/IfVersion&gt;</span><br><span class="hljs-variable">&lt;/Directory&gt;</span><br></code></pre></td></tr></table></figure><p>完成安装：</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># systemctl restart httpd</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">su -s /bin/sh -c <span class="hljs-string">&quot;nova-manage api_db sync&quot;</span> nova</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">su -s /bin/sh -c <span class="hljs-string">&quot;nova-manage cell_v2 map_cell0&quot;</span> nova</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">su -s /bin/sh -c <span class="hljs-string">&quot;nova-manage cell_v2 create_cell --name=cell1 --verbose&quot;</span> nova</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">su -s /bin/sh -c <span class="hljs-string">&quot;nova-manage db sync&quot;</span> nova</span><br></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section"># nova-manage cell_v2 list_cells</span><br><span class="hljs-section">+-------+--------------------------------------+------------------------------------+-------------------------------------------------+</span><br><span class="hljs-section">|  名称 |                 UUID                 |           Transport URL            |                    数据库连接                   |</span><br><span class="hljs-section">+-------+--------------------------------------+------------------------------------+-------------------------------------------------+</span><br>| cell0 | 00000000-0000-0000-0000-000000000000 |               none:/               | mysql+pymysql://nova:<span class="hljs-strong">***</span><span class="hljs-strong">*@controller/nova_cell0 |</span><br><span class="hljs-strong">| cell1 | c795b2eb-4814-4fe7-b9ff-090a1b1b2be5 | rabbit://openstack:****@controller |    mysql+pymysql://nova:****</span>@controller/nova    |<br><span class="hljs-code">+-------+</span>--------------------------------------<span class="hljs-code">+------------------------------------+</span>-------------------------------------------------+<br></code></pre></td></tr></table></figure><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"># systemctl enable openstack-nova-api.<span class="hljs-keyword">service </span><span class="hljs-title class_">openstack</span>-nova-consoleauth.<span class="hljs-keyword">service </span><span class="hljs-title class_">openstack</span>-nova-scheduler.<span class="hljs-keyword">service </span><span class="hljs-title class_">openstack</span>-nova-conductor.<span class="hljs-keyword">service </span><span class="hljs-title class_">openstack</span>-nova-novncproxy.service<br># systemctl start openstack-nova-api.<span class="hljs-keyword">service </span><span class="hljs-title class_">openstack</span>-nova-consoleauth.<span class="hljs-keyword">service </span><span class="hljs-title class_">openstack</span>-nova-scheduler.<span class="hljs-keyword">service </span><span class="hljs-title class_">openstack</span>-nova-conductor.<span class="hljs-keyword">service </span><span class="hljs-title class_">openstack</span>-nova-novncproxy.service<br></code></pre></td></tr></table></figure><p><strong>Compute节点：</strong><br><em><strong>安装和配置：</strong></em></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># yum install openstack-nova-compute</span><br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># vi /etc/nova/nova.conf</span><br><span class="hljs-section">[DEFAULT]</span><br><span class="hljs-attr">my_ip</span> = <span class="hljs-number">192.100</span>.<span class="hljs-number">10.161</span><br><span class="hljs-attr">enabled_apis</span> = osapi_compute,metadata<br><span class="hljs-attr">use_neutron</span> = <span class="hljs-literal">True</span><br><span class="hljs-attr">firewall_driver</span> = nova.virt.firewall.NoopFirewallDriver<br><span class="hljs-attr">transport_url</span> = rabbit://openstack:<span class="hljs-number">123456</span>@controller<br><span class="hljs-section">[api]</span><br><span class="hljs-attr">auth_strategy</span> = keystone<br><span class="hljs-section">[vnc]</span><br><span class="hljs-attr">enabled</span> = <span class="hljs-literal">True</span><br><span class="hljs-attr">server_listen</span> = <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><br><span class="hljs-attr">server_proxyclient_address</span> = <span class="hljs-variable">$my_ip</span><br><span class="hljs-attr">novncproxy_base_url</span> = http://controller:<span class="hljs-number">6080</span>/vnc_auto.html<br><span class="hljs-section">[glance]</span><br><span class="hljs-attr">api_servers</span> = http://controller:<span class="hljs-number">9292</span><br><span class="hljs-section">[oslo_concurrency]</span><br><span class="hljs-attr">lock_path</span> = /var/lib/nova/tmp<br><span class="hljs-section">[placement]</span><br><span class="hljs-attr">os_region_name</span> = RegionOne<br><span class="hljs-attr">project_domain_name</span> = Default<br><span class="hljs-attr">project_name</span> = service<br><span class="hljs-attr">auth_type</span> = password<br><span class="hljs-attr">user_domain_name</span> = Default<br><span class="hljs-attr">auth_url</span> = http://controller:<span class="hljs-number">5000</span>/v3<br><span class="hljs-attr">username</span> = placement<br><span class="hljs-attr">password</span> = <span class="hljs-number">123456</span><br><span class="hljs-section">[keystone_authtoken]</span><br><span class="hljs-attr">auth_url</span> = http://controller:<span class="hljs-number">5000</span>/v3<br><span class="hljs-attr">memcached_servers</span> = controller:<span class="hljs-number">11211</span><br><span class="hljs-attr">auth_type</span> = password<br><span class="hljs-attr">project_domain_name</span> = default<br><span class="hljs-attr">user_domain_name</span> = default<br><span class="hljs-attr">project_name</span> = service<br><span class="hljs-attr">username</span> = nova<br><span class="hljs-attr">password</span> = <span class="hljs-number">123456</span><br></code></pre></td></tr></table></figure><p><em><strong>完成安装</strong></em></p><figure class="highlight thrift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs thrift"># systemctl enable libvirtd.<span class="hljs-keyword">service</span> openstack-nova-compute.<span class="hljs-keyword">service</span><br># systemctl start libvirtd.<span class="hljs-keyword">service</span> openstack-nova-compute.<span class="hljs-keyword">service</span><br></code></pre></td></tr></table></figure><p><strong>Controller节点：</strong><br><em><strong>将计算节点添加到cell数据库：</strong></em><br><code>$ . admin-openrc</code></p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">$ openstack compute service list --service nova-compute</span><br><span class="hljs-section">+----+--------------+-----------------------+------+---------+-------+----------------------------+</span><br><span class="hljs-section">| ID | Binary       | Host                  | Zone | Status  | State | Updated At                 |</span><br><span class="hljs-section">+----+--------------+-----------------------+------+---------+-------+----------------------------+</span><br><span class="hljs-section">|  9 | nova-compute | localhost.localdomain | nova | enabled | up    | 2018-09-13T02:59:06.000000 |</span><br><span class="hljs-section">+----+--------------+-----------------------+------+---------+-------+----------------------------+</span><br></code></pre></td></tr></table></figure><p>发现计算主机：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># su -s /bin/sh -c &quot;nova-manage cell_v2 discover_hosts --verbose&quot; nova<br><br>/usr/lib/python2<span class="hljs-number">.7</span>/site-packages/oslo_db/sqlalchemy/enginefacade.py:<span class="hljs-number">332</span>: NotSupportedWarning: <span class="hljs-keyword">Configuration</span> <span class="hljs-keyword">option</span>(s) [<span class="hljs-string">&#x27;use_tpool&#x27;</span>] <span class="hljs-keyword">not</span> supported<br>  <span class="hljs-keyword">exception</span>.NotSupportedWarning<br><span class="hljs-built_in">Found</span> <span class="hljs-number">2</span> cell mappings.<br>Skipping cell0 since it does <span class="hljs-keyword">not</span> contain hosts.<br>Getting computes <span class="hljs-keyword">from</span> cell <span class="hljs-string">&#x27;cell1&#x27;</span>: c795b2eb<span class="hljs-number">-4814</span><span class="hljs-number">-4</span>fe7-b9ff<span class="hljs-number">-090</span>a1b1b2be5<br>Checking host <span class="hljs-keyword">mapping</span> <span class="hljs-keyword">for</span> compute host <span class="hljs-string">&#x27;localhost.localdomain&#x27;</span>: <span class="hljs-number">58</span>be78ad<span class="hljs-number">-5220</span><span class="hljs-number">-4869</span>-ab31<span class="hljs-number">-33</span>c9674ecfd1<br>Creating host <span class="hljs-keyword">mapping</span> <span class="hljs-keyword">for</span> compute host <span class="hljs-string">&#x27;localhost.localdomain&#x27;</span>: <span class="hljs-number">58</span>be78ad<span class="hljs-number">-5220</span><span class="hljs-number">-4869</span>-ab31<span class="hljs-number">-33</span>c9674ecfd1<br><span class="hljs-built_in">Found</span> <span class="hljs-number">1</span> unmapped computes <span class="hljs-keyword">in</span> cell: c795b2eb<span class="hljs-number">-4814</span><span class="hljs-number">-4</span>fe7-b9ff<span class="hljs-number">-090</span>a1b1b2be5<br></code></pre></td></tr></table></figure><p>注意：添加新计算节点时，必须在控制器节点上运行nova-manage cell_v2 discover_hosts以注册这些新计算节点。<br>或者，您可以在 &#x2F;etc&#x2F;nova&#x2F;nova.conf 中设置适当的间隔：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[scheduler]</span><br><span class="hljs-attr">discover_hosts_in_cells_interval</span> = <span class="hljs-number">300</span><br></code></pre></td></tr></table></figure><p>验证：<br><code>$ . admin-openrc</code></p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">$ openstack compute service list<br>+----+------------------+-----------------------+----------+---------+-------+----------------------------+<br>|<span class="hljs-string"> ID </span>|<span class="hljs-string"> Binary           </span>|<span class="hljs-string"> Host                  </span>|<span class="hljs-string"> Zone     </span>|<span class="hljs-string"> Status  </span>|<span class="hljs-string"> State </span>|<span class="hljs-string"> Updated At                 </span>|<br>+----+------------------+-----------------------+----------+---------+-------+----------------------------+<br>|<span class="hljs-string">  1 </span>|<span class="hljs-string"> nova-conductor   </span>|<span class="hljs-string"> controller            </span>|<span class="hljs-string"> internal </span>|<span class="hljs-string"> enabled </span>|<span class="hljs-string"> up    </span>|<span class="hljs-string"> 2018-09-13T03:00:28.000000 </span>|<br>|<span class="hljs-string">  3 </span>|<span class="hljs-string"> nova-consoleauth </span>|<span class="hljs-string"> controller            </span>|<span class="hljs-string"> internal </span>|<span class="hljs-string"> enabled </span>|<span class="hljs-string"> up    </span>|<span class="hljs-string"> 2018-09-13T03:00:29.000000 </span>|<br>|<span class="hljs-string">  4 </span>|<span class="hljs-string"> nova-scheduler   </span>|<span class="hljs-string"> controller            </span>|<span class="hljs-string"> internal </span>|<span class="hljs-string"> enabled </span>|<span class="hljs-string"> up    </span>|<span class="hljs-string"> 2018-09-13T03:00:29.000000 </span>|<br>|<span class="hljs-string">  9 </span>|<span class="hljs-string"> nova-compute     </span>|<span class="hljs-string"> localhost.localdomain </span>|<span class="hljs-string"> nova     </span>|<span class="hljs-string"> enabled </span>|<span class="hljs-string"> up    </span>|<span class="hljs-string"> 2018-09-13T03:00:26.000000 </span>|<br>+----+------------------+-----------------------+----------+---------+-------+----------------------------+<br></code></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">$ openstack catalog list<br>+-----------+-----------+-----------------------------------------+<br>|<span class="hljs-string"> Name      </span>|<span class="hljs-string"> Type      </span>|<span class="hljs-string"> Endpoints                               </span>|<br>+-----------+-----------+-----------------------------------------+<br>|<span class="hljs-string"> keystone  </span>|<span class="hljs-string"> identity  </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   public: http://controller:5000/v3/    </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   internal: http://controller:5000/v3/  </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   admin: http://controller:5000/v3/     </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">                                         </span>|<br>|<span class="hljs-string"> nova      </span>|<span class="hljs-string"> compute   </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   public: http://controller:8774/v2.1   </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   internal: http://controller:8774/v2.1 </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   admin: http://controller:8774/v2.1    </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">                                         </span>|<br>|<span class="hljs-string"> glance    </span>|<span class="hljs-string"> image     </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   internal: http://controller:9292      </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   admin: http://controller:9292         </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   public: http://controller:9292        </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">                                         </span>|<br>|<span class="hljs-string"> placement </span>|<span class="hljs-string"> placement </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   internal: http://controller:8778      </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   public: http://controller:8778        </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   admin: http://controller:8778         </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">                                         </span>|<br>+-----------+-----------+-----------------------------------------+<br></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">$ openstack image list</span><br><span class="hljs-section">+--------------------------------------+--------+--------+</span><br><span class="hljs-section">| ID                                   | Name   | Status |</span><br><span class="hljs-section">+--------------------------------------+--------+--------+</span><br><span class="hljs-section">| ad7da2d4-cb83-4a41-836f-e58e47e899f5 | cirros | active |</span><br><span class="hljs-section">+--------------------------------------+--------+--------+</span><br></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"># nova-status upgrade check<br>/usr/lib/python2.7/site-packages/oslo<span class="hljs-emphasis">_db/sqlalchemy/enginefacade.py:332: NotSupportedWarning: Configuration option(s) [&#x27;use_tpool&#x27;] not supported</span><br><span class="hljs-emphasis">  exception.NotSupportedWarning</span><br><span class="hljs-emphasis">Option &quot;os_region_</span>name&quot; from group &quot;placement&quot; is deprecated. Use option &quot;region-name&quot; from group &quot;placement&quot;.<br><span class="hljs-code">+-------------------------------+</span><br><span class="hljs-section">| 升级检查结果                  |</span><br><span class="hljs-section">+-------------------------------+</span><br>| 检查: Cells v2                |<br>| 结果: 成功                    |<br><span class="hljs-section">| 详情: None                    |</span><br><span class="hljs-section">+-------------------------------+</span><br>| 检查: Placement API           |<br>| 结果: 成功                    |<br><span class="hljs-section">| 详情: None                    |</span><br><span class="hljs-section">+-------------------------------+</span><br>| 检查: Resource Providers      |<br>| 结果: 成功                    |<br><span class="hljs-section">| 详情: None                    |</span><br><span class="hljs-section">+-------------------------------+</span><br>| 检查: Ironic Flavor Migration |<br>| 结果: 成功                    |<br><span class="hljs-section">| 详情: None                    |</span><br><span class="hljs-section">+-------------------------------+</span><br>| 检查: API Service Version     |<br>| 结果: 成功                    |<br><span class="hljs-section">| 详情: None                    |</span><br><span class="hljs-section">+-------------------------------+</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Openstack Queens 环境搭建（四）Glance服务</title>
    <link href="/2019/03/19/openstack/queens/openstack_queens_install_4/"/>
    <url>/2019/03/19/openstack/queens/openstack_queens_install_4/</url>
    
    <content type="html"><![CDATA[<p><strong>Controller节点：</strong><br>创建glance数据库，授予权限：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">$ mysql <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">CREATE</span> DATABASE glance;<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> glance.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;glance&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> glance.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;glance&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> exit;<br></code></pre></td></tr></table></figure><p>创建glance用户：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs Groovy">$ . admin-openrc<br><br>$ openstack user create --domain <span class="hljs-keyword">default</span> --password-prompt glance<br>User <span class="hljs-attr">Password:</span> <span class="hljs-number">123456</span><br>Repeat User <span class="hljs-attr">Password:</span> <span class="hljs-number">123456</span><br>+---------------------+----------------------------------+<br>| Field               | Value                            |<br>+---------------------+----------------------------------+<br>| domain_id           | <span class="hljs-keyword">default</span>                          |<br>| enabled             | True                             |<br>| id                  | <span class="hljs-number">5</span>b7e76213b4b4945b7c702be5b595c0e |<br>| name                | glance                           |<br>| options             | &#123;&#125;                               |<br>| password_expires_at | None                             |<br>+---------------------+----------------------------------+<br></code></pre></td></tr></table></figure><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Groovy">$ openstack role add --project service --user glance admin<br></code></pre></td></tr></table></figure><p>创建glance服务实体：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Groovy">$ openstack service create --name glance --description <span class="hljs-string">&quot;OpenStack Image&quot;</span> image<br>+-------------+----------------------------------+<br>| Field       | Value                            |<br>+-------------+----------------------------------+<br>| description | OpenStack Image                  |<br>| enabled     | True                             |<br>| id          | b9cfd97d134e4ec2bf19d78306e85a5a |<br>| name        | glance                           |<br>| type        | image                            |<br>+-------------+----------------------------------+<br></code></pre></td></tr></table></figure><p>创建API端点：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Groovy">$ openstack endpoint create --region RegionOne image <span class="hljs-keyword">public</span> <span class="hljs-attr">http:</span><span class="hljs-comment">//controller:9292</span><br>+--------------+----------------------------------+<br>| Field        | Value                            |<br>+--------------+----------------------------------+<br>| enabled      | True                             |<br>| id           | b9c90172de704ea4a867190ba44fc931 |<br>| <span class="hljs-keyword">interface</span>    | <span class="hljs-keyword">public</span>                           |<br>| region       | RegionOne                        |<br>| region_id    | RegionOne                        |<br>| service_id   | b9cfd97d134e4ec2bf19d78306e85a5a |<br>| service_name | glance                           |<br>| service_type | image                            |<br>| url          | <span class="hljs-attr">http:</span><span class="hljs-comment">//controller:9292           |</span><br>+--------------+----------------------------------+<br></code></pre></td></tr></table></figure><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Groovy">$ openstack endpoint create --region RegionOne image internal <span class="hljs-attr">http:</span><span class="hljs-comment">//controller:9292</span><br>+--------------+----------------------------------+<br>| Field        | Value                            |<br>+--------------+----------------------------------+<br>| enabled      | True                             |<br>| id           | <span class="hljs-number">074</span>bde7662044e93830f4eca15d9c887 |<br>| <span class="hljs-keyword">interface</span>    | internal                         |<br>| region       | RegionOne                        |<br>| region_id    | RegionOne                        |<br>| service_id   | b9cfd97d134e4ec2bf19d78306e85a5a |<br>| service_name | glance                           |<br>| service_type | image                            |<br>| url          | <span class="hljs-attr">http:</span><span class="hljs-comment">//controller:9292           |</span><br>+--------------+----------------------------------+<br></code></pre></td></tr></table></figure><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Groovy">$ openstack endpoint create --region RegionOne image admin <span class="hljs-attr">http:</span><span class="hljs-comment">//controller:9292</span><br>+--------------+----------------------------------+<br>| Field        | Value                            |<br>+--------------+----------------------------------+<br>| enabled      | True                             |<br>| id           | <span class="hljs-number">17030061</span>f9b84301ac515765706933b2 |<br>| <span class="hljs-keyword">interface</span>    | admin                            |<br>| region       | RegionOne                        |<br>| region_id    | RegionOne                        |<br>| service_id   | b9cfd97d134e4ec2bf19d78306e85a5a |<br>| service_name | glance                           |<br>| service_type | image                            |<br>| url          | <span class="hljs-attr">http:</span><span class="hljs-comment">//controller:9292           |</span><br>+--------------+----------------------------------+<br></code></pre></td></tr></table></figure><p>安装和配置：</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs ActionScript"># yum install openstack-glance<br><br># vi /etc/glance/glance-api.conf<br>[database]<br>connection = mysql+pymysql:<span class="hljs-comment">//glance:123456@controller/glance</span><br>[glance_store]<br>stores = file,http<br>default_store = file<br>filesystem_store_datadir = /<span class="hljs-keyword">var</span>/lib/glance/images/<br>[keystone_authtoken]<br>auth_uri = http:<span class="hljs-comment">//controller:5000</span><br>auth_url = http:<span class="hljs-comment">//controller:5000</span><br>memcached_servers = controller:<span class="hljs-number">11211</span><br>auth_type = password<br>project_domain_name = Default<br>user_domain_name = Default<br>project_name = service<br>username = glance<br>password = <span class="hljs-number">123456</span><br>[paste_deploy]<br>flavor = keystone<br></code></pre></td></tr></table></figure><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs ActionScript"># vi /etc/glance/glance-registry.conf<br>[database]<br>connection = mysql+pymysql:<span class="hljs-comment">//glance:123456@controller/glance</span><br>[keystone_authtoken]<br>auth_uri = http:<span class="hljs-comment">//controller:5000</span><br>auth_url = http:<span class="hljs-comment">//controller:5000</span><br>memcached_servers = controller:<span class="hljs-number">11211</span><br>auth_type = password<br>project_domain_name = Default<br>user_domain_name = Default<br>project_name = service<br>username = glance<br>password = <span class="hljs-number">123456</span><br>[paste_deploy]<br>flavor = keystone<br></code></pre></td></tr></table></figure><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ActionScript"># su -s /bin/sh -c <span class="hljs-string">&quot;glance-manage db_sync&quot;</span> glance<br></code></pre></td></tr></table></figure><p>完成安装</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ActionScript"># systemctl enable openstack-glance-api.service openstack-glance-registry.service<br># systemctl start openstack-glance-api.service openstack-glance-registry.service<br></code></pre></td></tr></table></figure><p>验证操作</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">$ . admin-openrc<br><br>$ wget http://download.cirros-cloud.net/0.3.5/cirros-0.3.5-x86_64-disk.img<br><br>$ openstack image create <span class="hljs-string">&quot;cirros&quot;</span> \<br>  --file cirros-0.3.5-x86_64-disk.img \<br>  --disk-format qcow2 --container-format bare \<br>  --public<br>+------------------+------------------------------------------------------+<br>|<span class="hljs-string"> Field            </span>|<span class="hljs-string"> Value                                                </span>|<br>+------------------+------------------------------------------------------+<br>|<span class="hljs-string"> checksum         </span>|<span class="hljs-string"> f8ab98ff5e73ebab884d80c9dc9c7290                     </span>|<br>|<span class="hljs-string"> container_format </span>|<span class="hljs-string"> bare                                                 </span>|<br>|<span class="hljs-string"> created_at       </span>|<span class="hljs-string"> 2018-09-13T00:55:04Z                                 </span>|<br>|<span class="hljs-string"> disk_format      </span>|<span class="hljs-string"> qcow2                                                </span>|<br>|<span class="hljs-string"> file             </span>|<span class="hljs-string"> /v2/images/ad7da2d4-cb83-4a41-836f-e58e47e899f5/file </span>|<br>|<span class="hljs-string"> id               </span>|<span class="hljs-string"> ad7da2d4-cb83-4a41-836f-e58e47e899f5                 </span>|<br>|<span class="hljs-string"> min_disk         </span>|<span class="hljs-string"> 0                                                    </span>|<br>|<span class="hljs-string"> min_ram          </span>|<span class="hljs-string"> 0                                                    </span>|<br>|<span class="hljs-string"> name             </span>|<span class="hljs-string"> cirros                                               </span>|<br>|<span class="hljs-string"> owner            </span>|<span class="hljs-string"> 4a5e42dd8cbf410f85a5f145039d69a6                     </span>|<br>|<span class="hljs-string"> protected        </span>|<span class="hljs-string"> False                                                </span>|<br>|<span class="hljs-string"> schema           </span>|<span class="hljs-string"> /v2/schemas/image                                    </span>|<br>|<span class="hljs-string"> size             </span>|<span class="hljs-string"> 13267968                                             </span>|<br>|<span class="hljs-string"> status           </span>|<span class="hljs-string"> active                                               </span>|<br>|<span class="hljs-string"> tags             </span>|<span class="hljs-string">                                                      </span>|<br>|<span class="hljs-string"> updated_at       </span>|<span class="hljs-string"> 2018-09-13T00:55:04Z                                 </span>|<br>|<span class="hljs-string"> virtual_size     </span>|<span class="hljs-string"> None                                                 </span>|<br>|<span class="hljs-string"> visibility       </span>|<span class="hljs-string"> public                                               </span>|<br>+------------------+------------------------------------------------------+<br></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">$ openstack image list</span><br><span class="hljs-section">+--------------------------------------+--------+--------+</span><br><span class="hljs-section">| ID                                   | Name   | Status |</span><br><span class="hljs-section">+--------------------------------------+--------+--------+</span><br><span class="hljs-section">| ad7da2d4-cb83-4a41-836f-e58e47e899f5 | cirros | active |</span><br><span class="hljs-section">+--------------------------------------+--------+--------+</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Openstack Queens 环境搭建（三）Keystone服务</title>
    <link href="/2019/03/19/openstack/queens/openstack_queens_install_3/"/>
    <url>/2019/03/19/openstack/queens/openstack_queens_install_3/</url>
    
    <content type="html"><![CDATA[<p><strong>Controller节点：</strong><br>创建keystone数据库，授予权限：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">$ mysql <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p<br>密码：<span class="hljs-number">123456</span><br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">CREATE</span> DATABASE keystone;<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> keystone.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;keystone&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> \<br>IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> keystone.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;keystone&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> \<br>IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br>MariaDB [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> exit;<br></code></pre></td></tr></table></figure><p>安装及配置组件</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs Groovy"># yum install openstack-keystone httpd mod_wsgi<br><br># vi <span class="hljs-regexp">/etc/</span>keystone/keystone.conf<br>[database]<br>connection = mysql+<span class="hljs-attr">pymysql:</span><span class="hljs-comment">//keystone:123456@controller/keystone</span><br>[token]<br>provider = fernet<br><br># su -s <span class="hljs-regexp">/bin/</span>sh -c <span class="hljs-string">&quot;keystone-manage db_sync&quot;</span> keystone<br># keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone<br># keystone-manage credential_setup --keystone-user keystone --keystone-group keystone<br># keystone-manage bootstrap --bootstrap-password <span class="hljs-number">123456</span> \<br>  --bootstrap-admin-url <span class="hljs-attr">http:</span><span class="hljs-comment">//controller:5000/v3/ \</span><br>  --bootstrap-internal-url <span class="hljs-attr">http:</span><span class="hljs-comment">//controller:5000/v3/ \</span><br>  --bootstrap-<span class="hljs-keyword">public</span>-url <span class="hljs-attr">http:</span><span class="hljs-comment">//controller:5000/v3/ \</span><br>  --bootstrap-region-id RegionOne<br></code></pre></td></tr></table></figure><p>配置Apache HTTP Server</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Groovy"># vi <span class="hljs-regexp">/etc/</span>httpd<span class="hljs-regexp">/conf/</span>httpd.conf<br>ServerName controller<br><br># ln -s <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/keystone/</span>wsgi-keystone.conf <span class="hljs-regexp">/etc/</span>httpd<span class="hljs-regexp">/conf.d/</span><br></code></pre></td></tr></table></figure><p>完成安装：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Groovy"># systemctl enable httpd.service<br># systemctl start httpd.service<br></code></pre></td></tr></table></figure><p>配置管理帐户</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Groovy">$ export OS_USERNAME=admin<br>$ export OS_PASSWORD=<span class="hljs-number">123456</span><br>$ export OS_PROJECT_NAME=admin<br>$ export OS_USER_DOMAIN_NAME=Default<br>$ export OS_PROJECT_DOMAIN_NAME=Default<br>$ export OS_AUTH_URL=<span class="hljs-attr">http:</span><span class="hljs-comment">//controller:35357/v3</span><br>$ export OS_IDENTITY_API_VERSION=<span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><p>创建域、项目、用户和角色：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Groovy">$ openstack domain create --description <span class="hljs-string">&quot;An Example Domain&quot;</span> example<br>+-------------+----------------------------------+<br>| Field       | Value                            |<br>+-------------+----------------------------------+<br>| description | An Example Domain                |<br>| enabled     | True                             |<br>| id          | <span class="hljs-number">2</span>f338489f6c64472a0b2b6db54ecc2df |<br>| name        | example                          |<br>| tags        | []                               |<br>+-------------+----------------------------------+<br></code></pre></td></tr></table></figure><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs Groovy">$ openstack project create --domain <span class="hljs-keyword">default</span> --description <span class="hljs-string">&quot;Service Project&quot;</span> service<br>+-------------+----------------------------------+<br>| Field       | Value                            |<br>+-------------+----------------------------------+<br>| description | Service Project                  |<br>| domain_id   | <span class="hljs-keyword">default</span>                          |<br>| enabled     | True                             |<br>| id          | <span class="hljs-number">84218999229845e2</span>ad7f4e88208b3bee |<br>| is_domain   | False                            |<br>| name        | service                          |<br>| parent_id   | <span class="hljs-keyword">default</span>                          |<br>| tags        | []                               |<br>+-------------+----------------------------------+<br></code></pre></td></tr></table></figure><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs Groovy">$ openstack project create --domain <span class="hljs-keyword">default</span> --description <span class="hljs-string">&quot;Demo Project&quot;</span> demo<br>+-------------+----------------------------------+<br>| Field       | Value                            |<br>+-------------+----------------------------------+<br>| description | Demo Project                     |<br>| domain_id   | <span class="hljs-keyword">default</span>                          |<br>| enabled     | True                             |<br>| id          | <span class="hljs-number">5</span>c4692ce6659454eb830e7e9633a09f1 |<br>| is_domain   | False                            |<br>| name        | demo                             |<br>| parent_id   | <span class="hljs-keyword">default</span>                          |<br>| tags        | []                               |<br>+-------------+----------------------------------+<br></code></pre></td></tr></table></figure><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs Groovy">$ openstack user create --domain <span class="hljs-keyword">default</span> --password-prompt demo<br>User <span class="hljs-attr">Password:</span><span class="hljs-number">123456</span><br>Repeat User <span class="hljs-attr">Password:</span><span class="hljs-number">123456</span><br>+---------------------+----------------------------------+<br>| Field               | Value                            |<br>+---------------------+----------------------------------+<br>| domain_id           | <span class="hljs-keyword">default</span>                          |<br>| enabled             | True                             |<br>| id                  | <span class="hljs-number">803e7</span>ad2e94b4af39f9be9e0742b45fd |<br>| name                | demo                             |<br>| options             | &#123;&#125;                               |<br>| password_expires_at | None                             |<br>+---------------------+----------------------------------+<br></code></pre></td></tr></table></figure><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Groovy">$ openstack role create user<br>+-----------+----------------------------------+<br>| Field     | Value                            |<br>+-----------+----------------------------------+<br>| domain_id | None                             |<br>| id        | cbe4799bac204eacbf0012a77dc349c4 |<br>| name      | user                             |<br>+-----------+----------------------------------+<br></code></pre></td></tr></table></figure><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Groovy">$ openstack role add --project demo --user demo user<br></code></pre></td></tr></table></figure><p>验证操作：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Groovy">$ unset OS_AUTH_URL OS_PASSWORD<br></code></pre></td></tr></table></figure><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Groovy">$ openstack --os-auth-url <span class="hljs-attr">http:</span><span class="hljs-comment">//controller:35357/v3 \</span><br>  --os-project-domain-name Default --os-user-domain-name Default \<br>  --os-project-name admin --os-username admin token issue<br><span class="hljs-attr">Password:</span> <span class="hljs-number">123456</span><br>+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+<br>| Field      | Value                                                                                                                                                                                   |<br>+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+<br>| expires    | <span class="hljs-number">2018</span><span class="hljs-number">-09</span><span class="hljs-number">-12</span><span class="hljs-attr">T09:</span><span class="hljs-number">43</span>:<span class="hljs-number">34</span>+<span class="hljs-number">0000</span>                                                                                                                                                                |<br>| id         | gAAAAABbmNG25wIya<span class="hljs-number">-0xF</span>Yb3zCW3ljtDTWnr8ZCpB4iAZPMfQnP<span class="hljs-number">-62</span>EGiIr6aKEjO847h6jH5nNONRqeLXO2BC_bJ0O-b5Fwj2GZpYGWRSSucAU4Mh6MqLQzetbOsRCv9-ZGO6VQYkmr0cPTEm7kzuzUL2bwTcUCbAVCpuFvCnRUZ7Hu4FE5bAI |<br>| project_id | <span class="hljs-number">4</span>a5e42dd8cbf410f85a5f145039d69a6                                                                                                                                                        |<br>| user_id    | <span class="hljs-number">2</span>ffffa1e6cbe4d239bdacc9760a54dd5                                                                                                                                                        |<br>+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+<br></code></pre></td></tr></table></figure><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Groovy">$ openstack --os-auth-url <span class="hljs-attr">http:</span><span class="hljs-comment">//controller:5000/v3 \</span><br>  --os-project-domain-name Default --os-user-domain-name Default \<br>  --os-project-name demo --os-username demo token issue<br><span class="hljs-attr">Password:</span> <span class="hljs-number">123456</span><br>+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+<br>| Field      | Value                                                                                                                                                                                   |<br>+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+<br>| expires    | <span class="hljs-number">2018</span><span class="hljs-number">-09</span><span class="hljs-number">-12</span><span class="hljs-attr">T09:</span><span class="hljs-number">45</span>:<span class="hljs-number">20</span>+<span class="hljs-number">0000</span>                                                                                                                                                                |<br>| id         | gAAAAABbmNIgtMBObdQXwOlGu-HMLvKNTBZuYvVizTCn3aDJLMvqzQRTyjhfm5RjEkAgIWcYfal9TrjZan2VWL_AZ8cASpkBwoa0TQn_rWlZw1wh8xcDeb5XNES3jMNxhtZA87peDCnMkGJoMaJVhvkR4gsDQiIUmCImzjYv6ZvJjLgGEotBszY |<br>| project_id | <span class="hljs-number">5</span>c4692ce6659454eb830e7e9633a09f1                                                                                                                                                        |<br>| user_id    | <span class="hljs-number">803e7</span>ad2e94b4af39f9be9e0742b45fd                                                                                                                                                        |<br>+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+<br></code></pre></td></tr></table></figure><p>创建OpenStack客户端环境脚本：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs Groovy"># vi <span class="hljs-regexp">/root/</span>admin-openrc<br>export OS_PROJECT_DOMAIN_NAME=Default<br>export OS_USER_DOMAIN_NAME=Default<br>export OS_PROJECT_NAME=admin<br>export OS_USERNAME=admin<br>export OS_PASSWORD=<span class="hljs-number">123456</span><br>export OS_AUTH_URL=<span class="hljs-attr">http:</span><span class="hljs-comment">//controller:5000/v3</span><br>export OS_IDENTITY_API_VERSION=<span class="hljs-number">3</span><br>export OS_IMAGE_API_VERSION=<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs Groovy"># vi <span class="hljs-regexp">/root/</span>demo-openrc<br>export OS_PROJECT_DOMAIN_NAME=Default<br>export OS_USER_DOMAIN_NAME=Default<br>export OS_PROJECT_NAME=demo<br>export OS_USERNAME=demo<br>export OS_PASSWORD=<span class="hljs-number">123456</span><br>export OS_AUTH_URL=<span class="hljs-attr">http:</span><span class="hljs-comment">//controller:5000/v3</span><br>export OS_IDENTITY_API_VERSION=<span class="hljs-number">3</span><br>export OS_IMAGE_API_VERSION=<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>使用脚本验证：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs Groovy">$ . admin-openrc<br><br>$ openstack token issue<br>+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+<br>| Field      | Value                                                                                                                                                                                   |<br>+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+<br>| expires    | <span class="hljs-number">2018</span><span class="hljs-number">-09</span><span class="hljs-number">-12</span><span class="hljs-attr">T09:</span><span class="hljs-number">55</span>:<span class="hljs-number">59</span>+<span class="hljs-number">0000</span>                                                                                                                                                                |<br>| id         | gAAAAABbmNSfM00gw3qvJi-U8ytTcBxfuVhgNkETRa-gh3PqLp6Md9cW_5FfbkUL1nyQGW4Bg_XvvdIhSBv7fXRnbfyqGxTxOUloe7BmnWgM9LqLn8Fm2FLQp8qcuFamyW<span class="hljs-number">-9</span>_FZA5SPqxbYS1Ozk6fO7TRDWAIWdzy5i0-qqB4Ypt6vQOyW-pqk |<br>| project_id | <span class="hljs-number">4</span>a5e42dd8cbf410f85a5f145039d69a6                                                                                                                                                        |<br>| user_id    | <span class="hljs-number">2</span>ffffa1e6cbe4d239bdacc9760a54dd5                                                                                                                                                        |<br>+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Openstack Queens 环境搭建（二）环境相关服务</title>
    <link href="/2019/03/19/openstack/queens/openstack_queens_install_2/"/>
    <url>/2019/03/19/openstack/queens/openstack_queens_install_2/</url>
    
    <content type="html"><![CDATA[<p><strong>Controller节点：</strong><br>安装NTP服务</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs ActionScript"># yum install chrony<br><br># vi /etc/chrony.conf<br><br>server <span class="hljs-number">0.</span>centos.pool.ntp.org iburst<br>server <span class="hljs-number">1.</span>centos.pool.ntp.org iburst<br>server <span class="hljs-number">2.</span>centos.pool.ntp.org iburst<br>server <span class="hljs-number">3.</span>centos.pool.ntp.org iburst<br>...<br>allow <span class="hljs-number">192.100</span><span class="hljs-number">.10</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span><br>...<br><br># systemctl enable chronyd.service                            开机启用NTP<br># systemctl start chronyd.service                             开启NTP服务<br></code></pre></td></tr></table></figure><p>验证NTP服务：</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ActionScript"># chronyc sources<br><br>  <span class="hljs-number">210</span> Number of sources = <span class="hljs-number">2</span><br>  MS Name/IP address         Stratum Poll Reach LastRx Last sample<br>  ===============================================================================<br>  ^- <span class="hljs-number">192.0</span><span class="hljs-number">.2</span><span class="hljs-number">.11</span>                    <span class="hljs-number">2</span>   <span class="hljs-number">7</span>    <span class="hljs-number">12</span>   <span class="hljs-number">137</span>  <span class="hljs-number">-2814</span>us[<span class="hljs-number">-3000</span>us] +/-   <span class="hljs-number">43</span>ms<br>  ^* <span class="hljs-number">192.0</span><span class="hljs-number">.2</span><span class="hljs-number">.12</span>                    <span class="hljs-number">2</span>   <span class="hljs-number">6</span>   <span class="hljs-number">177</span>    <span class="hljs-number">46</span>    +<span class="hljs-number">17</span>us[  <span class="hljs-number">-23</span>us] +/-   <span class="hljs-number">68</span>ms<br></code></pre></td></tr></table></figure><p>安装Openstack相关库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># yum install centos-release-openstack-queens                 安装Openstack库</span><br><span class="hljs-comment"># yum upgrade                                                 更新包</span><br><span class="hljs-comment"># yum install python-openstackclient                          安装Openstack客户端</span><br><span class="hljs-comment"># yum install openstack-selinux                               安装openstack-selinux用来管理Openstack服务的安全策略</span><br></code></pre></td></tr></table></figure><p>关闭防火墙</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># systemctl stop firewalld                                    关闭防火墙服务</span><br><span class="hljs-comment"># systemctl disable firewalld                                 永久防火墙开机自启动</span><br></code></pre></td></tr></table></figure><p>关闭SELINUX服务</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ActionScript"># setenforce <span class="hljs-number">0</span>                                               关闭selinux服务<br># vi /etc/selinux/config                                     永久关闭selinux服务<br>    SELINUX=disabled<br></code></pre></td></tr></table></figure><p>安装数据库服务</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs ActionScript"># yum install mariadb mariadb-server python2-PyMySQL<br><br># vi /etc/my.cnf.d/openstack.cnf<br><br>[mysqld]<br>bind-address = <span class="hljs-number">192.100</span><span class="hljs-number">.10</span><span class="hljs-number">.160</span><br><span class="hljs-keyword">default</span>-storage-engine = innodb<br>innodb_file_per_table = on<br>max_connections = <span class="hljs-number">4096</span><br>collation-server = utf8_general_ci<br>character-<span class="hljs-keyword">set</span>-server = utf8<br><br><br># systemctl enable mariadb.service                     开机启用Mysql服务<br># systemctl start mariadb.service                      开启Mysql服务<br># mysql_secure_installation                            设置Mysql密码-&gt;<span class="hljs-number">123456</span><br></code></pre></td></tr></table></figure><p>安装消息队列</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Groovy"># yum install rabbitmq-server<br><br># systemctl enable rabbitmq-server.service<br># systemctl start rabbitmq-server.service<br><br># rabbitmqctl add_user openstack <span class="hljs-number">123456</span><br># rabbitmqctl set_permissions openstack <span class="hljs-string">&quot;.*&quot;</span> <span class="hljs-string">&quot;.*&quot;</span> <span class="hljs-string">&quot;.*&quot;</span><br></code></pre></td></tr></table></figure><p>安装Memcached缓存</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Groovy"># yum install memcached python-memcached<br><br># vi <span class="hljs-regexp">/etc/</span>sysconfig/memcached<br>OPTIONS=<span class="hljs-string">&quot;-l 127.0.0.1,::1,controller&quot;</span><br><br># systemctl enable memcached.service<br># systemctl start memcached.service<br></code></pre></td></tr></table></figure><p>安装Etcd</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs ActionScript"># yum install etcd<br><br># vi /etc/etcd/etcd.conf<br>#[Member]<br>ETCD_DATA_DIR=<span class="hljs-string">&quot;/var/lib/etcd/default.etcd&quot;</span><br>ETCD_LISTEN_PEER_URLS=<span class="hljs-string">&quot;http://192.100.10.160:2380&quot;</span><br>ETCD_LISTEN_CLIENT_URLS=<span class="hljs-string">&quot;http://192.100.10.160:2379&quot;</span><br>ETCD_NAME=<span class="hljs-string">&quot;controller&quot;</span><br>#[Clustering]<br>ETCD_INITIAL_ADVERTISE_PEER_URLS=<span class="hljs-string">&quot;http://192.100.10.160:2380&quot;</span><br>ETCD_ADVERTISE_CLIENT_URLS=<span class="hljs-string">&quot;http://192.100.10.160:2379&quot;</span><br>ETCD_INITIAL_CLUSTER=<span class="hljs-string">&quot;controller=http://192.100.10.160:2380&quot;</span><br>ETCD_INITIAL_CLUSTER_TOKEN=<span class="hljs-string">&quot;etcd-cluster-01&quot;</span><br>ETCD_INITIAL_CLUSTER_STATE=<span class="hljs-string">&quot;new&quot;</span><br><br># systemctl enable etcd<br># systemctl start etcd<br></code></pre></td></tr></table></figure><p><strong>Compute节点：</strong><br>安装NTP服务</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs ActionScript"># yum install chrony<br><br># vi /etc/chrony.conf<br><br>server controller iburst<br>...<br>allow <span class="hljs-number">192.100</span><span class="hljs-number">.10</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span><br>...<br><br># systemctl enable chronyd.service                            开机启用NTP<br># systemctl start chronyd.service                             开启NTP服务<br></code></pre></td></tr></table></figure><p>安装Openstack相关库</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Groovy"># yum install centos-release-openstack-queens                 安装Openstack库<br># yum upgrade                                                 更新包<br># yum install python-openstackclient                          安装Openstack客户端<br># yum install openstack-selinux                               安装openstack-selinux用来管理Openstack服务的安全策略<br></code></pre></td></tr></table></figure><p>关闭防火墙</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Groovy"># systemctl stop firewalld                                    关闭防火墙服务<br># systemctl disable firewalld                                 永久防火墙开机自启动<br></code></pre></td></tr></table></figure><p>关闭SELINUX服务</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ActionScript"># setenforce <span class="hljs-number">0</span>                                               关闭selinux服务<br># vi /etc/selinux/config                                     永久关闭selinux服务<br>    SELINUX=disabled<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Openstack Queens 环境搭建（一）环境准备</title>
    <link href="/2019/03/19/openstack/queens/openstack_queens_install_1/"/>
    <url>/2019/03/19/openstack/queens/openstack_queens_install_1/</url>
    
    <content type="html"><![CDATA[<p>环境准备：<br>基于CentOS Linux release 7.6.1810 (Core)</p><p>控制节点（Controller）：<br>eth0：192.100.10.160&#x2F;24<br>eth1：10.0.0.11&#x2F;24<br>eth2：预留</p><p>计算节点（Compute):<br>eth0：192.100.10.161&#x2F;24<br>eth1：10.0.0.12&#x2F;24<br>eth2：预留</p><p>网卡0接口为管理网络 -&gt; 交换机 + 路由器<br>网卡1接口为Overlay网络 -&gt; 目前直连 &#x2F; 交换机连接<br>网卡2接口为外部网络 -&gt; 路由器<br>-（可以先使用eth1作为外部网络下载Openstack安装所需资源，后修改）</p><p>通用密码： 123456</p><p><strong>Controller节点：</strong><br>配置网卡信息：</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ActionScript">vi /etc/sysconfig/network-scripts/ifcfg-eth0<br>BOOTPROTO=<span class="hljs-keyword">static</span><br>IPADDR=<span class="hljs-number">192.100</span><span class="hljs-number">.10</span><span class="hljs-number">.160</span><br>NETMASK=<span class="hljs-number">255.255</span><span class="hljs-number">.255</span><span class="hljs-number">.0</span><br>GATEWAY=<span class="hljs-number">192.100</span><span class="hljs-number">.10</span><span class="hljs-number">.1</span><br></code></pre></td></tr></table></figure><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ActionScript">vi /etc/sysconfig/network-scripts/ifcfg-eth1<br>BOOTPROTO=<span class="hljs-keyword">static</span><br>IPADDR=<span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.11</span><br>NETMASK=<span class="hljs-number">255.255</span><span class="hljs-number">.255</span><span class="hljs-number">.0</span><br></code></pre></td></tr></table></figure><p>配置主机信息：</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ActionScript">vi /etc/hosts<br># controller<br><span class="hljs-number">192.100</span><span class="hljs-number">.10</span><span class="hljs-number">.160</span>     controller<br># compute<br><span class="hljs-number">192.100</span><span class="hljs-number">.10</span><span class="hljs-number">.161</span>     compute<br></code></pre></td></tr></table></figure><p>配置主机名：<br>控制节点的主机名为controller，设置如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">~<span class="hljs-comment"># hostnamectl set-hostname controller</span><br></code></pre></td></tr></table></figure><p>对主机名进行验证：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">~<span class="hljs-comment"># hostname</span><br></code></pre></td></tr></table></figure><p>看到输出为controller即可</p><p>配置DNS：</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ActionScript">vi /etc/resolv.conf<br>nameserver <span class="hljs-number">114.114</span><span class="hljs-number">.114</span><span class="hljs-number">.114</span><br></code></pre></td></tr></table></figure><p><strong>Compute节点：</strong><br>配置管理网络：</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ActionScript">vi /etc/sysconfig/network-scripts/ifcfg-eth0<br>BOOTPROTO=<span class="hljs-keyword">static</span><br>IPADDR=<span class="hljs-number">192.100</span><span class="hljs-number">.10</span><span class="hljs-number">.161</span><br>NETMASK=<span class="hljs-number">255.255</span><span class="hljs-number">.255</span><span class="hljs-number">.0</span><br>GATEWAY=<span class="hljs-number">192.100</span><span class="hljs-number">.10</span><span class="hljs-number">.1</span><br></code></pre></td></tr></table></figure><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ActionScript">vi /etc/sysconfig/network-scripts/ifcfg-eth1<br>BOOTPROTO=<span class="hljs-keyword">static</span><br>IPADDR=<span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.21</span><br>NETMASK=<span class="hljs-number">255.255</span><span class="hljs-number">.255</span><span class="hljs-number">.0</span><br></code></pre></td></tr></table></figure><p>配置主机信息：</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ActionScript">vi /etc/hosts<br># controller<br><span class="hljs-number">192.100</span><span class="hljs-number">.10</span><span class="hljs-number">.160</span>     controller<br># compute<br><span class="hljs-number">192.100</span><span class="hljs-number">.10</span><span class="hljs-number">.161</span>     compute<br></code></pre></td></tr></table></figure><p>配置主机名：<br>计算节点的主机名为compute，设置如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">~<span class="hljs-comment"># hostnamectl set-hostname compute</span><br></code></pre></td></tr></table></figure><p>对主机名进行验证：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">~<span class="hljs-comment"># hostname</span><br></code></pre></td></tr></table></figure><p>看到输出为compute即可</p><p>配置DNS：</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ActionScript">vi /etc/resolv.conf<br>nameserver <span class="hljs-number">114.114</span><span class="hljs-number">.114</span><span class="hljs-number">.114</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Openstack</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
